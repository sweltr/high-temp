<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.598">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Reproducible workflows to reproduce all Main, Extended Data, and Supplementary figures in the publication.">
<title>SWELTR - Code for Publication Figures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./about.html" rel="prev">
<link href="./assets/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><style>
    .quarto-title-block .quarto-title-banner {
      background: #113858;
    }
    </style>
<link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="nav-sidebar nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <img src="./assets/icon.png" alt=""></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item compact">
    <a class="nav-link" href="./index.html"><i class="bi bi-home" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-a.-processing" role="button" data-bs-toggle="dropdown" aria-expanded="false">A. Processing</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-a.-processing">
<li class="dropdown-header">Workflows</li>
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./dada2.html">
 <span class="dropdown-text">1. DADA2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./data-prep.html">
 <span class="dropdown-text">2. Data Set Prep</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./filtering.html">
 <span class="dropdown-text">3. Filtering</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-b.-diversity" role="button" data-bs-toggle="dropdown" aria-expanded="false">B. Diversity</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-b.-diversity">
<li class="dropdown-header">Workflows</li>
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./taxa.html">
 <span class="dropdown-text">4. Taxonomic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./alpha.html">
 <span class="dropdown-text">5. Alpha Diversity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./beta.html">
 <span class="dropdown-text">6. Beta Diversity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./da.html">
 <span class="dropdown-text">7. DA ASVs &amp; Taxa</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./metadata.html">
 <span class="dropdown-text">8. Metadata</span></a>
  </li>  
    </ul>
</li>
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./data-availability.html">DATA</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./pub.html" aria-current="page">PAPER</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./som.html">SOM</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sweltr/high-temp/"><i class="bi bi-github" role="img" aria-label="Agua Salud GitHub">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="./about.html"><i class="bi bi-question" role="img">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">Code for Publication Figures</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          <p>Reproducible workflows to reproduce all Main, Extended Data, and Supplementary figures in the publication.</p>
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#main-paper" id="toc-main-paper" class="nav-link active" data-scroll-target="#main-paper">Main Paper</a></li>
  <li>
<a href="#extended-data" id="toc-extended-data" class="nav-link" data-scroll-target="#extended-data">Extended Data</a>
  <ul class="collapse">
<li><a href="#extended-data-figure-2" id="toc-extended-data-figure-2" class="nav-link" data-scroll-target="#extended-data-figure-2">Extended Data Figure 2</a></li>
  <li><a href="#extended-data-figure-3" id="toc-extended-data-figure-3" class="nav-link" data-scroll-target="#extended-data-figure-3">Extended Data Figure 3</a></li>
  <li><a href="#extended-data-figure-4" id="toc-extended-data-figure-4" class="nav-link" data-scroll-target="#extended-data-figure-4">Extended Data Figure 4</a></li>
  <li><a href="#extended-data-figure-5" id="toc-extended-data-figure-5" class="nav-link" data-scroll-target="#extended-data-figure-5">Extended Data Figure 5</a></li>
  </ul>
</li>
  <li>
<a href="#supplementary-material" id="toc-supplementary-material" class="nav-link" data-scroll-target="#supplementary-material">Supplementary Material</a>
  <ul class="collapse">
<li><a href="#supplementary-figure-1" id="toc-supplementary-figure-1" class="nav-link" data-scroll-target="#supplementary-figure-1">Supplementary Figure 1</a></li>
  <li><a href="#supplementary-figure-2" id="toc-supplementary-figure-2" class="nav-link" data-scroll-target="#supplementary-figure-2">Supplementary Figure 2</a></li>
  <li><a href="#supplementary-figure-3" id="toc-supplementary-figure-3" class="nav-link" data-scroll-target="#supplementary-figure-3">Supplementary Figure 3</a></li>
  <li><a href="#supplementary-figure-4" id="toc-supplementary-figure-4" class="nav-link" data-scroll-target="#supplementary-figure-4">Supplementary Figure 4</a></li>
  <li><a href="#supplementary-figure-5" id="toc-supplementary-figure-5" class="nav-link" data-scroll-target="#supplementary-figure-5">Supplementary Figure 5</a></li>
  <li><a href="#supplementary-figure-6" id="toc-supplementary-figure-6" class="nav-link" data-scroll-target="#supplementary-figure-6">Supplementary Figure 6</a></li>
  <li><a href="#supplementary-figures-714" id="toc-supplementary-figures-714" class="nav-link" data-scroll-target="#supplementary-figures-714">Supplementary Figures 7â€“14</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/sweltr/high-temp/edit/main/pub.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/sweltr/high-temp/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content"><div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217">phyloseq</a></span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"phyloseq"</span><span class="op">)</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">magrittr</span>, <span class="va">file2meco</span>, <span class="va">microbiomeMarker</span>,
               <span class="va">microeco</span>, <span class="va">cowplot</span>, <span class="va">hilldiv</span>, <span class="va">ggpubr</span>, <span class="va">vegan</span>, <span class="va">Matrix</span>,
               <span class="va">patchwork</span>,
               install <span class="op">=</span> <span class="cn">FALSE</span>, update <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_current</a></span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"cache"</span>,
  <span class="st">"cache.path"</span>,
  <span class="st">"cache.rebuild"</span>,
  <span class="st">"dependson"</span>,
  <span class="st">"autodep"</span>
<span class="op">)</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<style>

details {
    background-color: #F6F6F6;
    border: 1px solid  #B22271;

}

pre.sourceCode.r {
    font-size: 0.85em;
}

.step #download-button {
  margin-top: 0;
  padding-top: 0;
}

</style>
<p>For each figure we include the raw figure generated in R, the post-processed figure, plus the code and data needed to generate the figure.</p>
<section id="main-paper" class="level1"><h1>Main Paper</h1>
</section><section id="extended-data" class="level1"><h1>Extended Data</h1>
<section id="extended-data-figure-2" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-2">Extended Data Figure 2</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include axes and label resizing, removing non-significant (NS) values from plots, changing significant p-values to asterisks (<code>*</code>), creating a legend, and enlarging outlier points.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><img src="include/pub/ext/Extended_Data_Figure_2.png" class="img-fluid"></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_2.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/extended_data_fig_2.rdata">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Extended_Data_Figure_2.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<section id="alpha-diversity-plot-code" class="level3"><h3 class="anchored" data-anchor-id="alpha-diversity-plot-code">Alpha diversity plot code</h3>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/ext/extended_data_fig_2.rdata"</span><span class="op">)</span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">### 16S rRNA ALPHA DIV PLOTS ########</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>

<span class="va">tmp_objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span><span class="op">)</span>

<span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmp_qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span>

<span class="va">qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tmp_objects</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
     <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">homogeneity.pvalue</span>
          <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span><span class="op">)</span>

  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">normality.pvalue</span>
          <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span><span class="op">)</span>

  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">method</span>
          <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_method</span><span class="op">)</span>

  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">posthoc.method</span>
          <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span><span class="op">)</span>

  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">tmp_metric</span>, <span class="va">tmp_qvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_n_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_h_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_method</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_phoc_method</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"metric"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"q-value"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"normality p-value"</span> <span class="op">=</span> <span class="fl">3</span>, 
                <span class="st">"homogeneity p-value"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"method"</span> <span class="op">=</span> <span class="fl">5</span>, <span class="st">"posthoc method"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_sig_tab"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span>
<span class="co">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span>

<span class="va">tmp_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,
                           <span class="va">ssu18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,
                           <span class="va">ssu18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_sig_tab</span>, <span class="va">tmp_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"posthoc p-value"</span> <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>

<span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span>
<span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">lineage</span> <span class="op">&lt;-</span> <span class="st">"No"</span>
<span class="va">ssu18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span>

<span class="va">ssu18_sig_tab_all</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_sig_tab</span>

<span class="co">## PostHoc Analyses </span>

<span class="co">## First let's check the results of each posthoc analysis.</span>
<span class="co">### Observed (q-value = 0)</span>
<span class="va">ssu18_asvr0_lab</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span>
<span class="va">ssu18_asvr0_lab</span>
<span class="va">ssu18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc.method</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span>

<span class="va">ssu18_asvr1_lab</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span>
<span class="va">ssu18_asvr1_lab</span>
<span class="va">ssu18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc.method</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span>

<span class="va">ssu18_asvr2_lab</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span>
<span class="va">ssu18_asvr2_lab</span>
<span class="va">ssu18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc.method</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span>
<span class="co">## Now we can plot the results from the posthoc analyses for each metric </span>
<span class="co">## and data set using the function `div_test_plot_jjs`. </span>
<span class="co">## I modified the original function (`div_test_plot`) to control a </span>
<span class="co">## little of the formatting.</span>

<span class="co">## The command is as follows:</span>


<span class="co">## div_test_plot(divtest = x, chart = "type", colour = col.pal, </span>
<span class="co">##               posthoc = TRUE, threshold = value))</span>

<span class="co">## where `x` is the results from the `div_test` function, `"type"` is </span>
<span class="co">## chart type (box, jitter, or violin), `colour` is is a color palette, </span>
<span class="co">## `posthoc` indicates whether to run posthoc pairwise analyses, and `value` </span>
<span class="co">## is the maximum p-value to show in pairwise posthoc results. </span>
<span class="co">## **WARNING** if none of the posthoc results are below the specified </span>
<span class="co">## threshold, the function will throw an error. Therefore, until this is </span>
<span class="co">## fixed, all posthoc values are shown.</span>

<span class="va">div_test_plot_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">divtest</span>, <span class="va">chart</span>, <span class="va">colour</span>, <span class="va">posthoc</span>, <span class="va">threshold</span><span class="op">)</span> 
<span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">chart</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">chart</span> <span class="op">=</span> <span class="st">"box"</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">posthoc</span> <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> 
        <span class="st">"normality.pvalue"</span><span class="op">)</span><span class="op">)</span> 
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input object does not seem to be a div_test output."</span><span class="op">)</span>
    <span class="va">divtestdata</span> <span class="op">&lt;-</span> <span class="va">divtest</span><span class="op">$</span><span class="va">data</span>
    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span>
    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">getPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span>, 
            <span class="st">"Paired"</span><span class="op">)</span><span class="op">)</span>
        <span class="va">colour</span> <span class="op">&lt;-</span> <span class="fu">getPalette</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> 
            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input div_test object does not seem to contain pairwise posthoc data. 
                 Re-run div_test() using 'posthoc=TRUE' argument."</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Tukey post-hoc test"</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, 
                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, 
                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, 
                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, 
                <span class="st">"p"</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, 
                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, 
                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, 
                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, 
                <span class="st">"p"</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, 
            <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="va">pairwisetable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;</span> 
                <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span>
        <span class="op">}</span>
        <span class="va">sortedgroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">group1</span>, <span class="va">pairwisetable</span><span class="op">$</span><span class="va">group2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datamax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datamin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datarange</span> <span class="op">&lt;-</span> <span class="va">datamax</span> <span class="op">-</span> <span class="va">datamin</span>
        <span class="va">by</span> <span class="op">&lt;-</span> <span class="va">datarange</span> <span class="op">*</span> <span class="fl">0.1</span>
        <span class="va">min</span> <span class="op">&lt;-</span> <span class="va">datamax</span>
        <span class="va">max</span> <span class="op">&lt;-</span> <span class="va">min</span> <span class="op">+</span> <span class="op">(</span><span class="va">by</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span><span class="op">)</span>
        <span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min</span>, <span class="va">max</span>, <span class="va">by</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
        <span class="va">pairwisetable</span><span class="op">$</span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">ypos</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"box"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, outlier.size <span class="op">=</span> <span class="fl">3</span>,
            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span>
            <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu">scale_linetype_manual</span><span class="op">(</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"jitter"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, 
            color <span class="op">=</span> <span class="st">"Group"</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, width <span class="op">=</span> <span class="fl">0</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
                <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"violin"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggviolin</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, 
            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
                <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
            <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">}</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span>
     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>, chart <span class="op">=</span> <span class="st">"box"</span>,
                                 colour <span class="op">=</span> <span class="va">swel_col</span>, posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#</span>
<span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">+</span>
                             <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Effective no. of Taxon Units"</span>, x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">+</span>
                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">+</span>
                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span>
  <span class="va">ssu18_ps_perfect_q0_adt_plot</span>, 
  <span class="va">ssu18_ps_perfect_q1_adt_plot</span>, 
  <span class="va">ssu18_ps_perfect_q2_adt_plot</span>, 
  ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">ssu18_alph_div_plots_asv</span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">### ITS ALPHA DIV PLOTS #############</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>

<span class="va">tmp_objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span><span class="op">)</span>

<span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmp_qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span>

<span class="va">qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tmp_objects</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
     <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">homogeneity.pvalue</span>
          <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span><span class="op">)</span>

  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">normality.pvalue</span>
          <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span><span class="op">)</span>

  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">method</span>
          <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_method</span><span class="op">)</span>

  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span>
          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">posthoc.method</span>
          <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
     <span class="op">}</span>
  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span><span class="op">)</span>

  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">tmp_metric</span>, <span class="va">tmp_qvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_n_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_h_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_method</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_phoc_method</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"metric"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"q-value"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"normality p-value"</span> <span class="op">=</span> <span class="fl">3</span>, 
                <span class="st">"homogeneity p-value"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"method"</span> <span class="op">=</span> <span class="fl">5</span>, <span class="st">"posthoc method"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_sig_tab"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span>
<span class="co">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span>

<span class="va">tmp_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,
                           <span class="va">its18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,
                           <span class="va">its18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">its18_ps_perfect_sig_tab</span>, <span class="va">tmp_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span>
                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"posthoc p-value"</span> <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>

<span class="va">its18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span>
<span class="va">its18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">its18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">lineage</span> <span class="op">&lt;-</span> <span class="st">"No"</span>
<span class="va">its18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_sig_tab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span>

<span class="va">its18_sig_tab_all</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_sig_tab</span>

<span class="co">## PostHoc Analyses </span>

<span class="co">## First let's check the results of each posthoc analysis.</span>
<span class="co">### Observed (q-value = 0)</span>
<span class="va">its18_asvr0_lab</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span>
<span class="va">its18_asvr0_lab</span>
<span class="va">its18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc.method</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span>

<span class="va">its18_asvr1_lab</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span>
<span class="va">its18_asvr1_lab</span>
<span class="va">its18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc.method</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span>

<span class="va">its18_asvr2_lab</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span>
<span class="va">its18_asvr2_lab</span>
<span class="va">its18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc.method</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span>
     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>, chart <span class="op">=</span> <span class="st">"box"</span>,
                                 colour <span class="op">=</span> <span class="va">swel_col</span>, posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#</span>
<span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">+</span>
                             <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Effective no. of Taxon Units"</span>, x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">+</span>
                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">+</span>
                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span> 
                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span>
  <span class="va">its18_ps_perfect_q0_adt_plot</span>, 
  <span class="va">its18_ps_perfect_q1_adt_plot</span>, 
  <span class="va">its18_ps_perfect_q2_adt_plot</span>, 
  ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">its18_alph_div_plots_asv</span>
<span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="beta-diversity-plot-code" class="level3"><h3 class="anchored" data-anchor-id="beta-diversity-plot-code">Beta diversity plot code</h3>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">### 16S rRNA BETA DIV PLOTS #########</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">## First the code for ordination implementation in `phyloseq`. </span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span>

<span class="va">ssu18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span><span class="op">)</span>
<span class="va">ssu_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"unifrac"</span>, <span class="st">"wunifrac"</span><span class="op">)</span>
<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">samp_ps</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="va">ssu_dist</span><span class="op">)</span><span class="op">{</span>
     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_prop"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
     <span class="va">ord_meths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PCoA"</span><span class="op">)</span> <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span>
     <span class="va">tmp_plist</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/llply.html">llply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">ord_meths</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">physeq</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">ordi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/ordinate.html">ordinate</a></span><span class="op">(</span><span class="va">physeq</span>, method <span class="op">=</span> <span class="va">i</span>, distance <span class="op">=</span> <span class="va">d</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/plot_ordination.html">plot_ordination</a></span><span class="op">(</span><span class="va">physeq</span>, <span class="va">ordi</span>, <span class="st">"samples"</span>, color <span class="op">=</span> <span class="st">"TEMP"</span><span class="op">)</span>
   <span class="op">}</span>, <span class="va">tmp_get</span>, <span class="va">d</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_plist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ord_meths</span>

  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span><span class="op">(</span><span class="va">tmp_plist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
      <span class="va">df</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>
      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span><span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"method"</span>
  
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Axis_1</span>, <span class="va">Axis_2</span>, color <span class="op">=</span> <span class="va">TEMP</span>, fill <span class="op">=</span> <span class="va">TEMP</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">method</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span>
  
  <span class="va">tmp_df_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plist_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plist"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"tmp_df_name"</span> <span class="op">=</span> <span class="va">tmp_df</span>, tmp_plist_name <span class="op">=</span> <span class="va">tmp_plist</span>, tmp_plot_name <span class="op">=</span> <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>,  <span class="va">d</span>, <span class="st">"_ord_results"</span><span class="op">)</span>, <span class="va">tmp_list</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_tmp"</span><span class="op">)</span><span class="op">)</span>
 <span class="op">}</span>
<span class="op">}</span>

<span class="va">plist_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"_ord_results"</span><span class="op">)</span>
<span class="co">#plot_num &lt;- c(1,2,3,4)</span>
<span class="va">plot_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">plist_name</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">plot_num</span><span class="op">)</span> <span class="op">{</span>
       <span class="va">tmp_get_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">tmp_plist_name</span>
       <span class="va">tmp_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_get_i</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
       <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"ord_results"</span>, <span class="va">tmp_ord</span><span class="op">)</span>
       <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="st">"ssu18_ps_perfect_"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_ord</span><span class="op">)</span> <span class="op">%&gt;%</span> 
         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span><span class="op">)</span>
       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_get_i</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span>
       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, 
               panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
               panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
               panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
               axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>
       <span class="va">tmp_plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="st">"TEMP"</span>
       
    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"unifrac"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Unweighted Unifrac"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"wunifrac"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Weighted Unifrac"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span>
      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">""</span>
    <span class="op">}</span>
   <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_dist_name</span><span class="op">)</span>
       
       <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
       <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co">## And now the code for ordination implementation in `microeco`. </span>

<span class="va">microeco_path</span> <span class="op">&lt;-</span> <span class="st">"include/pub/ext/"</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">cal_betadiv</span><span class="op">(</span>unifrac <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Here I made a custom "function" to run the analysis, plot the graphs, </span>
<span class="co">## save graph objects, and save plots (as `.png` and `.pdf` files). </span>
<span class="co">## I am sure an actual programmer would be shocked, but it works. </span>

<span class="va">microeco_beta_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">choose_input</span>, <span class="va">choose_metric</span>, <span class="va">choose_ord</span><span class="op">)</span> <span class="op">{</span>  
  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_t1</span> <span class="op">&lt;-</span> <span class="va">trans_beta</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_dataset</span>, group <span class="op">=</span> <span class="st">"TEMP"</span>, measure <span class="op">=</span> <span class="va">choose_metric</span><span class="op">)</span>
  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_ordination</span><span class="op">(</span>ordination <span class="op">=</span> <span class="va">choose_ord</span><span class="op">)</span>
  <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_ordination</span><span class="op">(</span>plot_color <span class="op">=</span> <span class="st">"TEMP"</span>, 
                                            plot_shape <span class="op">=</span> <span class="st">"TEMP"</span>, 
                                            color_values <span class="op">=</span> <span class="va">swel_col</span>, 
                                            shape_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
                       <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, 
          panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
          panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
          panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
          axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>
  
    <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"unwei_unifrac"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Unweighted Unifrac"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"wei_unifrac"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Weighted Unifrac"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span>
      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">""</span>
    <span class="op">}</span>
   <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_ord_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span>

  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span><span class="op">)</span>
  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance</span><span class="op">(</span>distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span>
  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_within_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span>
  <span class="va">tmp_t1</span><span class="op">$</span><span class="va">res_group_distance</span>
  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span>within_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance</span><span class="op">(</span>distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> 
  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span>

<span class="co">###### SET names</span>
  <span class="va">tmp_name_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_name_wg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_wg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_name_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_bg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_ord</span>, <span class="va">tmp_t1_ord_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_wg</span>, <span class="va">tmp_t1_within_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_bg</span>, <span class="va">tmp_t1_btwn_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_PCoA"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">microeco_beta_plot</span><span class="op">(</span>choose_input <span class="op">=</span> <span class="st">"ssu18_ps_perfect"</span>, choose_metric <span class="op">=</span> <span class="va">tmp_metric</span>, choose_ord <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">ssu18_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_unifrac_PCoA</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">ssu18_wunifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_wunifrac_PCoA</span>  <span class="op">+</span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_me_wg_unwei_unifrac_PCoA</span>
<span class="va">ssu18_wg_wei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_me_wg_wei_unifrac_PCoA</span>

<span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span>
<span class="va">ssu18_wg_wei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_wg_wei_unifrac</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">### ITS  BETA DIV PLOTS #############</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span>

<span class="va">its18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span><span class="op">)</span>
<span class="va">its_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"jsd"</span>, <span class="st">"bray"</span><span class="op">)</span>
<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">samp_ps</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="va">its_dist</span><span class="op">)</span><span class="op">{</span>
     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_prop"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
     <span class="va">ord_meths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PCoA"</span><span class="op">)</span> <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span>
     <span class="va">tmp_plist</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/llply.html">llply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">ord_meths</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">physeq</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">ordi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/ordinate.html">ordinate</a></span><span class="op">(</span><span class="va">physeq</span>, method <span class="op">=</span> <span class="va">i</span>, distance <span class="op">=</span> <span class="va">d</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/plot_ordination.html">plot_ordination</a></span><span class="op">(</span><span class="va">physeq</span>, <span class="va">ordi</span>, <span class="st">"samples"</span>, color <span class="op">=</span> <span class="st">"TEMP"</span><span class="op">)</span>
   <span class="op">}</span>, <span class="va">tmp_get</span>, <span class="va">d</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_plist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ord_meths</span>

  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span><span class="op">(</span><span class="va">tmp_plist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
      <span class="va">df</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>
      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span><span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"method"</span>
  
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Axis_1</span>, <span class="va">Axis_2</span>, color <span class="op">=</span> <span class="va">TEMP</span>, fill <span class="op">=</span> <span class="va">TEMP</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">method</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span>
  
  <span class="va">tmp_df_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plist_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plist"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"tmp_df_name"</span> <span class="op">=</span> <span class="va">tmp_df</span>, tmp_plist_name <span class="op">=</span> <span class="va">tmp_plist</span>, tmp_plot_name <span class="op">=</span> <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>,  <span class="va">d</span>, <span class="st">"_ord_results"</span><span class="op">)</span>, <span class="va">tmp_list</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_tmp"</span><span class="op">)</span><span class="op">)</span>
 <span class="op">}</span>
<span class="op">}</span>

<span class="va">plist_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"_ord_results"</span><span class="op">)</span>
<span class="co">#plot_num &lt;- c(1,2,3,4)</span>
<span class="va">plot_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">plist_name</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">plot_num</span><span class="op">)</span> <span class="op">{</span>
       <span class="va">tmp_get_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">tmp_plist_name</span>
       <span class="va">tmp_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_get_i</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
       <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"ord_results"</span>, <span class="va">tmp_ord</span><span class="op">)</span>
       <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="st">"its18_ps_perfect_"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_ord</span><span class="op">)</span> <span class="op">%&gt;%</span> 
         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span><span class="op">)</span>
       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_get_i</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span>
       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, 
               panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
               panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
               panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
               axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>
       <span class="va">tmp_plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="st">"TEMP"</span>
       
    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"jsd"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Jensen-Shannon"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Bray-Curtis"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span>
      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">""</span>
    <span class="op">}</span>
   <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_dist_name</span><span class="op">)</span>
       
       <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
       <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co">## And now the code for ordination implementation in `microeco`. </span>

<span class="va">microeco_path</span> <span class="op">&lt;-</span> <span class="st">"include/pub/ext/"</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">cal_betadiv</span><span class="op">(</span>unifrac <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#### CODE TO ADD JSD DISTANCE ####  </span>
  <span class="va">tmp_jsd</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/distance.html">distance</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"jsd"</span><span class="op">)</span> 
  <span class="va">tmp_jsd</span> <span class="op">&lt;-</span> <span class="fu">forceSymmetric</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_jsd</span><span class="op">)</span>, uplo <span class="op">=</span> <span class="st">"L"</span><span class="op">)</span>
  <span class="va">tmp_jsd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_jsd</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">$</span><span class="va">jsd</span> <span class="op">&lt;-</span> <span class="va">tmp_jsd</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>    

<span class="co">## Here I made a custom "function" to run the analysis, plot the graphs, </span>
<span class="co">## save graph objects, and save plots (as `.png` and `.pdf` files). </span>
<span class="co">## I am sure an actual programmer would be shocked, but it works. </span>

<span class="va">microeco_beta_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">choose_input</span>, <span class="va">choose_metric</span>, <span class="va">choose_ord</span><span class="op">)</span> <span class="op">{</span>  
  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_t1</span> <span class="op">&lt;-</span> <span class="va">trans_beta</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_dataset</span>, group <span class="op">=</span> <span class="st">"TEMP"</span>, measure <span class="op">=</span> <span class="va">choose_metric</span><span class="op">)</span>
  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_ordination</span><span class="op">(</span>ordination <span class="op">=</span> <span class="va">choose_ord</span><span class="op">)</span>
  <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_ordination</span><span class="op">(</span>plot_color <span class="op">=</span> <span class="st">"TEMP"</span>, 
                                            plot_shape <span class="op">=</span> <span class="st">"TEMP"</span>, 
                                            color_values <span class="op">=</span> <span class="va">swel_col</span>, 
                                            shape_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
                       <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, 
          panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
          panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
          panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, 
          axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>
  
    <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"jsd"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Jensen-Shannon"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Bray-Curtis"</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span>
      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">""</span>
    <span class="op">}</span>
   <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_ord_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span>

  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span><span class="op">)</span>
  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance</span><span class="op">(</span>distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span>
  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_within_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span>
  <span class="va">tmp_t1</span><span class="op">$</span><span class="va">res_group_distance</span>
  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span>within_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance</span><span class="op">(</span>distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> 
  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span>

<span class="co">###### SET names</span>
  <span class="va">tmp_name_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_name_wg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_wg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_name_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_bg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_ord</span>, <span class="va">tmp_t1_ord_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_wg</span>, <span class="va">tmp_t1_within_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_bg</span>, <span class="va">tmp_t1_btwn_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_PCoA"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">microeco_beta_plot</span><span class="op">(</span>choose_input <span class="op">=</span> <span class="st">"its18_ps_perfect"</span>, choose_metric <span class="op">=</span> <span class="va">tmp_metric</span>, choose_ord <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">its18_jsd</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_jsd_PCoA</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">its18_bray</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_bray_PCoA</span>  <span class="op">+</span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">its18_wg_jsd</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_me_wg_jsd_PCoA</span>
<span class="va">its18_wg_bray</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_me_wg_bray_PCoA</span>

<span class="va">its18_wg_jsd</span> <span class="op">&lt;-</span> <span class="va">its18_wg_jsd</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span>
<span class="va">its18_wg_bray</span> <span class="op">&lt;-</span> <span class="va">its18_wg_bray</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span>

<span class="co">### CREATE combo plot using PATCHWORK</span>

<span class="va">layout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">15</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">17</span>, b <span class="op">=</span> <span class="fl">31</span>, l <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">17</span>, b <span class="op">=</span> <span class="fl">31</span>, l <span class="op">=</span> <span class="fl">10</span>, r <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">16</span>, b <span class="op">=</span> <span class="fl">23</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">24</span>, b <span class="op">=</span> <span class="fl">31</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,

  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">32</span>, b <span class="op">=</span> <span class="fl">46</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">48</span>, b <span class="op">=</span> <span class="fl">62</span>, l <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">48</span>, b <span class="op">=</span> <span class="fl">62</span>, l <span class="op">=</span> <span class="fl">10</span>, r <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">47</span>, b <span class="op">=</span> <span class="fl">54</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,
  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">55</span>, b <span class="op">=</span> <span class="fl">62</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>
  
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">layout</span><span class="op">)</span>

<span class="va">combo_plot</span> <span class="op">&lt;-</span> 
  <span class="va">ssu18_alph_div_plots_asv</span> <span class="op">+</span> 
           <span class="va">ssu18_unifrac</span> <span class="op">+</span> <span class="va">ssu18_wunifrac</span> <span class="op">+</span>  
           <span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">+</span> <span class="va">ssu18_wg_wei_unifrac</span> <span class="op">+</span> 
  <span class="va">its18_alph_div_plots_asv</span> <span class="op">+</span> 
           <span class="va">its18_jsd</span> <span class="op">+</span> <span class="va">its18_bray</span> <span class="op">+</span>  
           <span class="va">its18_wg_jsd</span> <span class="op">+</span> <span class="va">its18_wg_bray</span> <span class="op">+</span> 
  <span class="fu">plot_layout</span><span class="op">(</span>design <span class="op">=</span> <span class="va">layout</span><span class="op">)</span>  
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_2.png"</span>, height <span class="op">=</span> <span class="fl">56</span>, width <span class="op">=</span> <span class="fl">40</span>,
    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_2.pdf"</span>, height <span class="op">=</span> <span class="fl">56</span>, width <span class="op">=</span> <span class="fl">40</span>,
    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="extended-data-figure-3" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-3">Extended Data Figure 3</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include axes renaming, removing non-significant (NS) values from plots, changing significant p-values to asterisks (<code>*</code>), removing gridlines, and enlarging outlier points.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p><img src="include/pub/ext/Extended_Data_Figure_3.png" class="img-fluid"></p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_3.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/ssu18_ps_perfect_rf_all.rds">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Extended_Data_Figure_3.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">## In this section of the workflow we use the </span>
<span class="co">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span>
<span class="co">## to assess the response of taxonomic lineages to soil warming. </span>
<span class="co">## In the first step we need to fix the selected data set to make it </span>
<span class="co">## compatible with the various functions. For this analysis we use the </span>
<span class="co">## PERfect filtered data set.</span>


<span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_perfect_rf_all</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/ext/ssu18_ps_perfect_rf_all.rds"</span><span class="op">)</span>

<span class="co">## FIX ps object</span>
<span class="va">ssu_ps</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_rf_all</span>
<span class="va">tmp_tax1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmp_rn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span>
<span class="va">tmp_tax</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmp_tax1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\(|)"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tmp_rn</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span><span class="op">)</span>
<span class="va">ps_tax_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>
<span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phyloseq.html">phyloseq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span>,
                   <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phy_tree-methods.html">phy_tree</a></span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span>,
                   <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">ps_tax_new</span><span class="op">)</span>,
                   <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu_ps</span> <span class="op">&lt;-</span> <span class="va">tmp_ps</span>
<span class="fu">phyloseq</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span>
<span class="co">## Next we run a statistical test for multiple groups</span>
<span class="co">## using the `run_test_multiple_groups` function.</span>

<span class="va">ssu_group_anova</span> <span class="op">&lt;-</span>
  <span class="fu">run_test_multiple_groups</span><span class="op">(</span><span class="va">ssu_ps</span>,
                           group <span class="op">=</span> <span class="st">"TEMP"</span>,
                           taxa_rank <span class="op">=</span> <span class="st">"all"</span>,
                           method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span>
<span class="va">ssu_group_anova</span><span class="op">@</span><span class="va">marker_table</span>
<span class="fu">marker_table</span><span class="op">(</span><span class="va">ssu_group_anova</span><span class="op">)</span>
<span class="co">## And then conduct post hoc pairwise comparisons for multiple</span>
<span class="co">## groups test using the `run_posthoc_test` function.</span>

<span class="va">ssu_default_pht</span> <span class="op">&lt;-</span> <span class="fu">run_posthoc_test</span><span class="op">(</span><span class="va">ssu_ps</span>,
                                    group <span class="op">=</span> <span class="st">"TEMP"</span>,
                                    method <span class="op">=</span> <span class="st">"tukey"</span>,
                                    transform <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span>

<span class="co">## We can filter out a select taxa and plot the results.</span>

<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu_default_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>,
  <span class="va">group_name</span> <span class="op">==</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span>
<span class="op">)</span>
<span class="fu">plot_postHocTest</span><span class="op">(</span><span class="va">ssu_default_pht</span>, feature <span class="op">=</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="co">## But what we really want to do is get all of the markers that are</span>
<span class="co">## significant from the analysis, excluding any significant ASVs so we can</span>
<span class="co">## look at high taxa ranks.</span>

<span class="va">ssu_pht</span> <span class="op">&lt;-</span> <span class="va">ssu_default_pht</span>
<span class="va">ssu18_pht_filt</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"ASV"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">ssu18_pht_filt</span> <span class="op">&lt;-</span>
  <span class="va">ssu18_pht_filt</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[a-z]__$"</span>, <span class="va">ssu18_pht_filt</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">ssu18_pht_filt</span> <span class="op">&lt;-</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="va">ssu18_pht_filt</span>, <span class="va">group_name</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ssu18_pht_filt</span><span class="op">)</span>

<span class="va">plot_postHocTest_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">pht</span>, <span class="va">feature</span>, <span class="va">step_increase</span> <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span> 
<span class="op">{</span>
    <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="va">pht</span><span class="op">@</span><span class="va">abundance</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">.data</span><span class="op">$</span><span class="va">group</span>, 
        names_to <span class="op">=</span> <span class="st">"feat"</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">feature</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">abd_long</span>, <span class="va">.data</span><span class="op">$</span><span class="va">feat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">feature</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu">get_sig_annotation</span><span class="op">(</span><span class="va">pht</span>, step_increase <span class="op">=</span> <span class="va">step_increase</span><span class="op">)</span>
    <span class="va">p_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu">ggplot</span><span class="op">(</span><span class="va">abd_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">group</span>, 
        y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggsignif</span><span class="fu">::</span><span class="fu"><a href="https://const-ae.github.io/ggsignif/reference/stat_signif.html">geom_signif</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">annotation</span><span class="op">[</span><span class="va">annotation</span><span class="op">$</span><span class="va">feature</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
        <span class="va">feature</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmax</span>, 
        annotations <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">annotation</span>, y_position <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">y_position</span><span class="op">)</span>, 
        manual <span class="op">=</span> <span class="cn">TRUE</span>, textsize <span class="op">=</span> <span class="fl">3</span>, vjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, 
        y <span class="op">=</span> <span class="st">"Abundance"</span><span class="op">)</span><span class="op">)</span>
    <span class="va">test_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pht</span><span class="op">@</span><span class="va">result</span><span class="op">[[</span><span class="va">feature</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">p_test</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">test_res</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">comparions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_lower</span>, 
        ymax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">diff_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"95% confidence intervals"</span><span class="op">)</span>
    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html">wrap_plots</a></span><span class="op">(</span><span class="va">p_box</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">plot_postHocTest_jjs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html">asNamespace</a></span><span class="op">(</span><span class="st">'microbiomeMarker'</span><span class="op">)</span>

<span class="va">ssu_select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
<span class="st">"k__Bacteria|p__Acidobacteriota|c__Acidobacteriae|o__Subgroup_2"</span>, 
<span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Chitinophagales|f__Saprospiraceae"</span>, 
<span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Cytophagales"</span>, 
<span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Flavobacteriales"</span>, 
<span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Sphingobacteriales"</span>, 
<span class="st">"k__Bacteria|p__Myxococcota|c__Polyangia|o__mle1-27"</span>, 
<span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Comamonadaceae|g__Rubrivivax"</span>, 
<span class="st">"k__Bacteria|p__Actinobacteriota|c__Acidimicrobiia|o__Microtrichales"</span>, 
<span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span>, 
<span class="st">"k__Bacteria|p__Firmicutes|c__Bacilli|o__Bacillales"</span>, 
<span class="st">"k__Bacteria|p__Myxococcota|c__Myxococcia|o__Myxococcales|f__Myxococcaceae|g__Corallococcus"</span>, 
<span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Burkholderiaceae|g__Ralstonia"</span> 
<span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu_select</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_select_feat</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span><span class="op">(</span><span class="va">ssu_pht</span>, feature <span class="op">=</span> <span class="va">tmp_select_feat</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> 
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative abundance (% total reads)"</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".png", sep = ""), </span>
  <span class="co">#                height = 7, width = 9, units = 'cm', dpi = 600, bg = "white")</span>
  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".pdf", sep = ""), </span>
  <span class="co">#                height = 5, width = 6.5)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> 

<span class="va">ssu_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
<span class="st">"Subgroup_2 (Acidobacteriota)"</span>, 
<span class="st">"Saprospiraceae (Bacteroidota)"</span>, 
<span class="st">"Cytophagales (Bacteroidota)"</span>, 
<span class="st">"Flavobacteriales (Bacteroidota)"</span>, 
<span class="st">"Sphingobacteriales (Bacteroidota)"</span>, 
<span class="st">"mle1-27 (Myxococcota)"</span>, 
<span class="st">"Rubrivivax (Proteobacteria)"</span>, 
<span class="st">"Microtrichales (Actinobacteriota)"</span>, 
<span class="st">"Gaiellales (Actinobacteriota)"</span>, 
<span class="st">"Bacillales (Firmicutes)"</span>, 
<span class="st">"Corallococcus (Myxococcota)"</span>, 
<span class="st">"Ralstonia (Proteobacteria)"</span>
<span class="op">)</span>

<span class="va">ssu_plt_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lineage <span class="op">=</span> <span class="va">ssu_select</span>, label <span class="op">=</span> <span class="va">ssu_title</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ssu_plt_info</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"plot_"</span>, <span class="va">i</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">ssu_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_point</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
  
<span class="va">ssu_taxa_combo_plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">plot_1</span> <span class="op">+</span> <span class="va">plot_2</span> <span class="op">+</span> <span class="va">plot_3</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_4</span> <span class="op">+</span> <span class="va">plot_5</span> <span class="op">+</span> <span class="va">plot_6</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_7</span> <span class="op">+</span> <span class="va">plot_8</span> <span class="op">+</span> <span class="va">plot_9</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_10</span> <span class="op">+</span> <span class="va">plot_11</span> <span class="op">+</span> <span class="va">plot_12</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu_taxa_combo_plot</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">ssu_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, 
                filename <span class="op">=</span>  <span class="st">"Extended_Data_Figure_3.png"</span>, 
                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, 
                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
                
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">ssu_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, 
                filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_3.pdf"</span>, 
                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, 
                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="extended-data-figure-4" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-4">Extended Data Figure 4</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include axes renaming, removing non-significant (NS) values from plots, changing significant p-values to asterisks (<code>*</code>), removing gridlines, and enlarging outlier points.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p><img src="include/pub/ext/Extended_Data_Figure_4.png" class="img-fluid"></p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_4.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/its18_ps_perfect_rf_all.rds">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Extended_Data_Figure_4.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">## In this section of the workflow we use the </span>
<span class="co">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span>
<span class="co">## to assess the response of taxonomic lineages to soil warming. </span>
<span class="co">## In the first step we need to fix the selected data set to make it </span>
<span class="co">## compatible with the various functions. For this analysis we use the </span>
<span class="co">## PERfect filtered data set.</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_perfect_rf_all</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/ext/its18_ps_perfect_rf_all.rds"</span><span class="op">)</span>

<span class="co">## FIX ps object</span>
<span class="va">its_ps</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_rf_all</span>
<span class="va">tmp_tax1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span><span class="op">)</span>
<span class="va">tmp_tax1</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">tmp_rn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span>
<span class="va">tmp_tax</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmp_tax1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\(|)"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tmp_rn</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span><span class="op">)</span>
<span class="va">ps_tax_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>
<span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phyloseq.html">phyloseq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span>,
                   <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">ps_tax_new</span><span class="op">)</span>,
                   <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span><span class="op">)</span>
<span class="va">its_ps</span> <span class="op">&lt;-</span> <span class="va">tmp_ps</span>
<span class="fu">phyloseq</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span>

<span class="co">## Next we run a statistical test for multiple groups</span>
<span class="co">## using the `run_test_multiple_groups` function.</span>

<span class="va">its_group_anova</span> <span class="op">&lt;-</span>
  <span class="fu">run_test_multiple_groups</span><span class="op">(</span><span class="va">its_ps</span>,
                           group <span class="op">=</span> <span class="st">"TEMP"</span>,
                           taxa_rank <span class="op">=</span> <span class="st">"all"</span>,
                           method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span>
<span class="va">its_group_anova</span><span class="op">@</span><span class="va">marker_table</span>
<span class="fu">marker_table</span><span class="op">(</span><span class="va">its_group_anova</span><span class="op">)</span>
<span class="co">## And then conduct post hoc pairwise comparisons for multiple</span>
<span class="co">## groups test using the `run_posthoc_test` function.</span>

<span class="va">its_default_pht</span> <span class="op">&lt;-</span> <span class="fu">run_posthoc_test</span><span class="op">(</span><span class="va">its_ps</span>,
                                    group <span class="op">=</span> <span class="st">"TEMP"</span>,
                                    method <span class="op">=</span> <span class="st">"tukey"</span>,
                                    transform <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span>

<span class="co">## But what we really want to do is get all of the markers that are</span>
<span class="co">## significant from the analysis, excluding any significant ASVs so we can</span>
<span class="co">## look at high taxa ranks.</span>

<span class="va">its_pht</span> <span class="op">&lt;-</span> <span class="va">its_default_pht</span>
<span class="va">its18_pht_filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"ASV"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">its18_pht_filt</span> <span class="op">&lt;-</span> <span class="va">its18_pht_filt</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[a-z]__$"</span>, <span class="va">its18_pht_filt</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">its18_pht_filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">its18_pht_filt</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>

<span class="va">plot_postHocTest_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">pht</span>, <span class="va">feature</span>, <span class="va">step_increase</span> <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span> 
<span class="op">{</span>
    <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="va">pht</span><span class="op">@</span><span class="va">abundance</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">.data</span><span class="op">$</span><span class="va">group</span>, 
        names_to <span class="op">=</span> <span class="st">"feat"</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">feature</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">abd_long</span>, <span class="va">.data</span><span class="op">$</span><span class="va">feat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">feature</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu">get_sig_annotation</span><span class="op">(</span><span class="va">pht</span>, step_increase <span class="op">=</span> <span class="va">step_increase</span><span class="op">)</span>
    <span class="va">p_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu">ggplot</span><span class="op">(</span><span class="va">abd_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">group</span>, 
        y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggsignif</span><span class="fu">::</span><span class="fu"><a href="https://const-ae.github.io/ggsignif/reference/stat_signif.html">geom_signif</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">annotation</span><span class="op">[</span><span class="va">annotation</span><span class="op">$</span><span class="va">feature</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
        <span class="va">feature</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmax</span>, 
        annotations <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">annotation</span>, y_position <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">y_position</span><span class="op">)</span>, 
        manual <span class="op">=</span> <span class="cn">TRUE</span>, textsize <span class="op">=</span> <span class="fl">3</span>, vjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, 
        y <span class="op">=</span> <span class="st">"Abundance"</span><span class="op">)</span><span class="op">)</span>
    <span class="va">test_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pht</span><span class="op">@</span><span class="va">result</span><span class="op">[[</span><span class="va">feature</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">p_test</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">test_res</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">comparions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_lower</span>, 
        ymax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">diff_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"95% confidence intervals"</span><span class="op">)</span>
    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html">wrap_plots</a></span><span class="op">(</span><span class="va">p_box</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">plot_postHocTest_jjs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html">asNamespace</a></span><span class="op">(</span><span class="st">'microbiomeMarker'</span><span class="op">)</span>

<span class="va">its_select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
<span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Xylariales|f__Microdochiaceae"</span>, 
<span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Entolomataceae"</span>, 
<span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Clavariaceae"</span>, 
<span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales"</span>, 
<span class="st">"k__Fungi|p__Basidiomycota|c__Microbotryomycetes|o__Sporidiobolales"</span>, 
<span class="st">"k__Fungi|p__Rozellomycota|c__Rozellomycotina_cls_Incertae_sedis"</span>, 
<span class="st">"k__Fungi|p__Ascomycota|c__Eurotiomycetes|o__Eurotiales|f__Trichocomaceae|g__Talaromyces"</span>, 
<span class="st">"k__Fungi|p__Ascomycota|c__Pezizomycetes|o__Pezizales|f__Pyronemataceae"</span>, 
<span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Hypocreales|f__Nectriaceae|g__Fusarium"</span>, 
<span class="st">"k__Fungi|p__Ascomycota|c__Saccharomycetes|o__Saccharomycetales|f__Metschnikowiaceae"</span>, 
<span class="st">"k__Fungi|p__Glomeromycota|c__Glomeromycetes|o__Glomerales"</span>, 
<span class="st">"k__Fungi|p__Mortierellomycota|c__Mortierellomycetes|o__Mortierellales"</span>
<span class="op">)</span>


<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its_select</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_select_feat</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span><span class="op">(</span><span class="va">its_pht</span>, feature <span class="op">=</span> <span class="va">tmp_select_feat</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> 
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative abundance (% total reads)"</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".png", sep = ""), </span>
  <span class="co">#                height = 7, width = 9, units = 'cm', dpi = 600, bg = "white")</span>
  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".pdf", sep = ""), </span>
  <span class="co">#                height = 5, width = 6.5)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> 

<span class="va">its_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
<span class="st">"Microdochiaceae (Ascomycota)"</span>, 
<span class="st">"Entolomataceae (Basidiomycota)"</span>, 
<span class="st">"Clavariaceae (Basidiomycota)"</span>, 
<span class="st">"Agaricales (Basidiomycota)"</span>, 
<span class="st">"Sporidiobolales (Basidiomycota)"</span>, 
<span class="st">"Rozellomycotina (Rozellomycota)"</span>, 
<span class="st">"Talaromyces (Ascomycota)"</span>, 
<span class="st">"Pyronemataceae (Ascomycota)"</span>, 
<span class="st">"Fusarium (Ascomycota)"</span>, 
<span class="st">"Metschnikowiaceae (Ascomycota)"</span>, 
<span class="st">"Glomerales (Glomeromycota)"</span>, 
<span class="st">"Mortierellales (Mortierellomycota)"</span>
<span class="op">)</span>

<span class="va">its_plt_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lineage <span class="op">=</span> <span class="va">its_select</span>, label <span class="op">=</span> <span class="va">its_title</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">its_plt_info</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"plot_"</span>, <span class="va">i</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">its_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_point</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
  
<span class="va">its_taxa_combo_plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">plot_1</span> <span class="op">+</span> <span class="va">plot_2</span> <span class="op">+</span> <span class="va">plot_3</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_4</span> <span class="op">+</span> <span class="va">plot_5</span> <span class="op">+</span> <span class="va">plot_6</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_7</span> <span class="op">+</span> <span class="va">plot_8</span> <span class="op">+</span> <span class="va">plot_9</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_10</span> <span class="op">+</span> <span class="va">plot_11</span> <span class="op">+</span> <span class="va">plot_12</span><span class="op">)</span><span class="op">)</span>
<span class="va">its_taxa_combo_plot</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">its_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, 
                filename <span class="op">=</span>  <span class="st">"Extended_Data_Figure_4.png"</span>, 
                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, 
                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
                
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">its_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, 
                filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_4.pdf"</span>, 
                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, 
                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="extended-data-figure-5" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-5">Extended Data Figure 5</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include repositioning vector overlay labels, styling legend, and changing font size and style.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p><img src="include/pub/ext/Extended_Data_Figure_5.png" class="img-fluid"></p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_5.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/extended_data_fig_5.rdata">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Extended_Data_Figure_5.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/ext/extended_data_fig_5.rdata"</span><span class="op">)</span>
<span class="co">## 1) Run `rankindex` to compare metadata and community dissimilarity indices </span>
<span class="co">## for gradient detection. This will help us select the best dissimilarity </span>
<span class="co">## metric to use.</span>
<span class="co">## 2) Run `capscale` for distance-based redundancy analysis.</span>
<span class="co">## 3) Run `envfit` to fit environmental parameters onto the ordination. </span>
<span class="co">## This function basically calculates correlation scores between the metadata </span>
<span class="co">## parameters and the ordination axes. </span>
<span class="co">## 4) Select metadata parameters significant for `bioenv` (see above) </span>
<span class="co">## and/or `envfit` analyses.</span>
<span class="co">## 5) Run `envfit` on ASVs.</span>
<span class="co">## 6) Plot the ordination and vector overlays. </span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">### 16S rRNA EDAPHIC PROPERTIES #####</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">edaphic</span>
<span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span>
<span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/rankindex.html">rankindex</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, 
          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, 
          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>

<span class="co">## Run `capscale` using Bray-Curtis. </span>

<span class="co">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN</span>
<span class="co">## * Autocorrelated removed: TEB, DON, Na, Al, Ca</span>
<span class="co">## 15 total, only works with 13</span>
<span class="co">## * Remove for capscale: Mg, Mn</span>
<span class="va">edaphic_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/capscale.html">capscale</a></span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span> <span class="va">AST</span> <span class="op">+</span> <span class="va">H2O</span> <span class="op">+</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">Fe</span> <span class="op">+</span> <span class="va">K</span> <span class="op">+</span> <span class="va">ECEC</span> <span class="op">+</span> 
                                   <span class="va">pH</span> <span class="op">+</span> <span class="va">NH4</span> <span class="op">+</span> <span class="va">NO3</span> <span class="op">+</span> <span class="va">PO4</span> <span class="op">+</span> <span class="va">DOC</span> <span class="op">+</span> <span class="va">DOCN</span>, 
                        <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span>

<span class="co">## Next, we need to grab capscale scores for the samples and create a </span>
<span class="co">## data frame of the first two dimensions. We will also need to add some </span>
<span class="co">## of the sample details to the data frame. For this we use the vegan </span>
<span class="co">## function `scores` which gets species or site scores from the ordination.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggvegan</span><span class="op">)</span>
<span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span>
<span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">edaphic_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span>
<span class="co">## Now we have a new data frame that contains sample details and capscale values. </span>

<span class="co">## We can then do the same with the metadata vectors. </span>
<span class="co">## Here though we only need the scores and parameter name. </span>

<span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span>
<span class="va">edaphic_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>

<span class="co">## Let's run some quick correlations of metadata with ordination axes to </span>
<span class="co">## see which parameters are significant. For this we use the vegan function `envfit`.</span>

<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>
<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span>
<span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span>

<span class="va">envfit_edaphic_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,
                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_md_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_md_signif_hits</span>,<span class="op">]</span>
<span class="co">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span>
<span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, 
                       <span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span>
<span class="va">edaphic_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">new_edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">edaphic_sig_diff</span>
<span class="va">edaphic_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">new_edaphic_md_signif_hits</span>,<span class="op">]</span>
<span class="co">## Check. Next, we run `envfit` for the ASVs.</span>

<span class="va">envfit_edaphic_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, 
                             <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,
                             perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span>
<span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>
<span class="va">edaphic_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_asv_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span><span class="op">[</span><span class="va">edaphic_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_asv_signif_hits</span>,<span class="op">]</span>

<span class="va">edaphic_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span>
<span class="va">edaphic_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">edaphic_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">edaphic_md_signif_all</span>, <span class="va">edaphic_asv_signif</span><span class="op">)</span>
<span class="co">## The last thing to do is categorize parameters scores and ASV </span>
<span class="co">## scores into different variable types for plotting.</span>

<span class="va">edaphic_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, 
                                  <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span>
<span class="va">edaphic_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, 
                                   <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span>
<span class="co">##  code for the plot</span>

<span class="va">edaphic_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">edaphic_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">edaphic_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>
<span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">edaphic_plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,
                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, 
               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>, 
            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Edaphic properties"</span>, 
       x <span class="op">=</span> <span class="va">cpa1_lab</span>, 
       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span>
<span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>


<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co"># 16S rRNA Soil Functional Response #</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>

<span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">soil_funct</span>
<span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span>
<span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/rankindex.html">rankindex</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, 
          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, 
          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>

<span class="co">## Let's run `capscale` using Bray-Curtis. </span>

<span class="co">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span>
<span class="co">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span>
<span class="co">## * Remove for capscale: NONE</span>
<span class="va">soil_funct_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/capscale.html">capscale</a></span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span> <span class="va">micC</span> <span class="op">+</span> <span class="va">micP</span> <span class="op">+</span> <span class="va">micCN</span> <span class="op">+</span> <span class="va">micCP</span> <span class="op">+</span> <span class="va">AG_ase</span> <span class="op">+</span> <span class="va">BG_ase</span> <span class="op">+</span> 
                                      <span class="va">S_ase</span> <span class="op">+</span> <span class="va">XY_ase</span> <span class="op">+</span> <span class="va">PX_ase</span> <span class="op">+</span> <span class="va">CO2</span> <span class="op">+</span> <span class="va">enzNP</span>, 
                           <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span>


<span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span>

<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span>
<span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">soil_funct_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, 
                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span>

<span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span>
<span class="va">soil_funct_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>

<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>
<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span>
<span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span>

<span class="va">envfit_soil_funct_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,
                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_md_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                               <span class="va">soil_funct_md_signif_hits</span>,<span class="op">]</span>
<span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span>
<span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, 
                       <span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span>
<span class="va">soil_funct_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_sig_diff</span>

<span class="va">new_soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">soil_funct_sig_diff</span>
<span class="va">soil_funct_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                   <span class="va">new_soil_funct_md_signif_hits</span>,<span class="op">]</span>

<span class="va">envfit_soil_funct_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, 
                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, 
                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span>
<span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>
<span class="va">soil_funct_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_asv_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span><span class="op">[</span><span class="va">soil_funct_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                 <span class="va">soil_funct_asv_signif_hits</span>,<span class="op">]</span>
<span class="va">soil_funct_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span>
<span class="va">soil_funct_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">soil_funct_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_all</span>, <span class="va">soil_funct_asv_signif</span><span class="op">)</span>

<span class="va">soil_funct_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, 
                                  <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span>
<span class="va">soil_funct_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, 
                                   <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span>

<span class="co">## PLOT Code</span>

<span class="va">soil_funct_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">soil_funct_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">soil_funct_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">soil_funct_plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,
                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, 
               color <span class="op">=</span> <span class="st">"#191919"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,
            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Functional Response"</span>, 
       x <span class="op">=</span> <span class="va">cpa1_lab</span>, 
       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span>
<span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">### 16S rRNA Temperature Adaptation #</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>

<span class="co">### </span>
<span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">temp_adapt</span>
<span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span>
<span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/rankindex.html">rankindex</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, 
          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, 
          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>
<span class="co">## Let's run `capscale` using Bray-Curtis. </span>

<span class="co">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span>
<span class="co">## * Autocorrelated removed: NUE, PUE, SI</span>
<span class="co">## * Remove for capscale: NONE</span>

<span class="va">temp_adapt_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/capscale.html">capscale</a></span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">AG_Q10</span> <span class="op">+</span> <span class="va">BG_Q10</span> <span class="op">+</span> <span class="va">BP_Q10</span> <span class="op">+</span> <span class="va">CE_Q10</span> <span class="op">+</span> 
                                       <span class="va">P_Q10</span> <span class="op">+</span> <span class="va">N_Q10</span> <span class="op">+</span> <span class="va">S_Q10</span> <span class="op">+</span> <span class="va">XY_Q10</span> <span class="op">+</span> 
                                       <span class="va">LP_Q10</span> <span class="op">+</span> <span class="va">PX_Q10</span> <span class="op">+</span> <span class="va">CUEcn</span> <span class="op">+</span> <span class="va">CUEcp</span> <span class="op">+</span> <span class="va">Tmin</span>, 
                             <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span>
<span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span>

<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span>
<span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">temp_adapt_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, 
                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span>
<span class="va">temp_adapt_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>

<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>
<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span>
<span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span>

<span class="va">envfit_temp_adapt_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,
                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                               <span class="va">temp_adapt_md_signif_hits</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, 
                       <span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and  bioenv."</span><span class="op">)</span>
<span class="va">temp_adapt_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_sig_diff</span>

<span class="va">new_temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_sig_diff</span>
<span class="va">temp_adapt_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                   <span class="va">new_temp_adapt_md_signif_hits</span>,<span class="op">]</span>

<span class="va">envfit_temp_adapt_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, 
                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,
                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span>

<span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span> <span class="op">%&gt;%</span> 
                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span>
                         <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>
<span class="va">temp_adapt_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_asv_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span><span class="op">[</span><span class="va">temp_adapt_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                 <span class="va">temp_adapt_asv_signif_hits</span>,<span class="op">]</span>
<span class="va">temp_adapt_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span>
<span class="va">temp_adapt_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">temp_adapt_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_all</span>, <span class="va">temp_adapt_asv_signif</span><span class="op">)</span>

<span class="va">temp_adapt_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, 
                                  <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span>
<span class="va">temp_adapt_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, 
                                   <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span>
<span class="va">temp_adapt_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">temp_adapt_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">temp_adapt_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">temp_adapt_plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,
                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>,
               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,
            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Temperature Adaptation"</span>,
       x <span class="op">=</span> <span class="va">cpa1_lab</span>, 
       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span>
<span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>aspect.ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_plot"</span><span class="op">)</span>

<span class="va">ssu18_edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span>
<span class="va">ssu18_soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span>
<span class="va">ssu18_temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span>
<span class="fu">gdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gdata/man/keep.html">keep</a></span><span class="op">(</span><span class="va">ssu18_edaphic_plot</span>, <span class="va">ssu18_soil_funct_plot</span>, <span class="va">ssu18_temp_adapt_plot</span>, <span class="va">its18_edaphic_bioenv_ind_mantel</span>, <span class="va">its18_select_mc_norm_split_no_ac</span>, <span class="va">its18_soil_funct_bioenv_ind_mantel</span>, <span class="va">its18_temp_adapt_bioenv_ind_mantel</span>, <span class="va">ssu18_edaphic_bioenv_ind_mantel</span>, <span class="va">ssu18_select_mc_norm_split_no_ac</span>, <span class="va">ssu18_soil_funct_bioenv_ind_mantel</span>, <span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span>, sure <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">###### ITS EDAPHIC PROPERTIES #######</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>

<span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">edaphic</span>
<span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span>
<span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/rankindex.html">rankindex</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, 
          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, 
          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>
<span class="co">## Run `capscale` using Bray-Curtis. </span>

<span class="co">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN.</span>
<span class="co">## * Autocorrelated removed: TEB, DON, Na, Al, Ca.</span>
<span class="co">## * Remove for capscale: Mg, Mn, Na, Al, Fe, K</span>

<span class="va">edaphic_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/capscale.html">capscale</a></span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span> <span class="va">AST</span> <span class="op">+</span> <span class="va">H2O</span> <span class="op">+</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">ECEC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> 
                                   <span class="va">NH4</span> <span class="op">+</span> <span class="va">NO3</span> <span class="op">+</span> <span class="va">PO4</span> <span class="op">+</span> <span class="va">DOC</span> <span class="op">+</span> <span class="va">DOCN</span>, 
                        <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span>

<span class="co">## Next, we need to grab capscale scores for the samples and create a </span>
<span class="co">## data frame of the first two dimensions. We will also need to add some </span>
<span class="co">## of the sample details to the data frame. For this we use the vegan </span>
<span class="co">## function `scores` which gets species or site scores from the ordination.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggvegan</span><span class="op">)</span>
<span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span>
<span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">edaphic_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span>
<span class="co">## Now we have a new data frame that contains sample details and capscale values. </span>

<span class="co">## We can then do the same with the metadata vectors. </span>
<span class="co">## Here though we only need the scores and parameter name. </span>

<span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span>
<span class="va">edaphic_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>

<span class="co">## Let's run some quick correlations of metadata with ordination axes to </span>
<span class="co">## see which parameters are significant. For this we use the vegan function `envfit`.</span>

<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>
<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span>
<span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span>

<span class="va">envfit_edaphic_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,
                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_md_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_md_signif_hits</span>,<span class="op">]</span>
<span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>
<span class="co">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span>
<span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, 
                       <span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span>
<span class="va">edaphic_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_sig_diff</span>

<span class="va">new_edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">edaphic_sig_diff</span>
<span class="va">edaphic_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">new_edaphic_md_signif_hits</span>,<span class="op">]</span>
<span class="co">## Check. Next, we run `envfit` for the ASVs.</span>

<span class="va">envfit_edaphic_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, 
                             <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,
                             perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span>
<span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>
<span class="va">edaphic_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span>
<span class="va">edaphic_asv_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span><span class="op">[</span><span class="va">edaphic_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_asv_signif_hits</span>,<span class="op">]</span>

<span class="va">edaphic_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span>
<span class="va">edaphic_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">edaphic_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">edaphic_md_signif_all</span>, <span class="va">edaphic_asv_signif</span><span class="op">)</span>
<span class="co">## The last thing to do is categorize parameters scores and ASV </span>
<span class="co">## scores into different variable types for plotting.</span>

<span class="va">edaphic_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, 
                                  <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span>
<span class="va">edaphic_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, 
                                   <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span>
<span class="co">##  code for the plot</span>

<span class="va">edaphic_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">edaphic_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">edaphic_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>
<span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">edaphic_plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,
                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, 
               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>, 
            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, 
       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span>
<span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">edaphic_plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">###### ITS Soil Functional Response #</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>


<span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">soil_funct</span>
<span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span>
<span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/rankindex.html">rankindex</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, 
          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, 
          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>

<span class="co">## Let's run `capscale` using Bray-Curtis </span>
<span class="co">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span>
<span class="co">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span>
<span class="co">## * Remove for capscale: NONE</span>

<span class="va">soil_funct_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/capscale.html">capscale</a></span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">micC</span> <span class="op">+</span> <span class="va">micP</span> <span class="op">+</span> <span class="va">micCN</span> <span class="op">+</span> <span class="va">micCP</span> <span class="op">+</span> <span class="va">AG_ase</span> <span class="op">+</span> <span class="va">BG_ase</span> <span class="op">+</span> 
                                       <span class="va">S_ase</span> <span class="op">+</span> <span class="va">XY_ase</span> <span class="op">+</span> <span class="va">PX_ase</span> <span class="op">+</span> <span class="va">CO2</span> <span class="op">+</span> <span class="va">enzNP</span>, 
                           <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span>


<span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span>

<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span>
<span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">soil_funct_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, 
                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span>

<span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span>
<span class="va">soil_funct_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>

<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>
<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span>
<span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span>

<span class="va">envfit_soil_funct_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,
                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_md_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                               <span class="va">soil_funct_md_signif_hits</span>,<span class="op">]</span>
<span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span>
<span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, 
                       <span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span>
<span class="va">soil_funct_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_sig_diff</span>

<span class="va">new_soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">soil_funct_sig_diff</span>
<span class="va">soil_funct_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                   <span class="va">new_soil_funct_md_signif_hits</span>,<span class="op">]</span>

<span class="va">envfit_soil_funct_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, 
                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, 
                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span>
<span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>
<span class="va">soil_funct_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span>
<span class="va">soil_funct_asv_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span><span class="op">[</span><span class="va">soil_funct_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                 <span class="va">soil_funct_asv_signif_hits</span>,<span class="op">]</span>
<span class="va">soil_funct_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span>
<span class="va">soil_funct_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">soil_funct_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_all</span>, <span class="va">soil_funct_asv_signif</span><span class="op">)</span>

<span class="va">soil_funct_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, 
                                  <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span>
<span class="va">soil_funct_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, 
                                   <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span>

<span class="co">## PLOT Code</span>

<span class="va">soil_funct_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">soil_funct_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">soil_funct_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">soil_funct_plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,
                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, 
               color <span class="op">=</span> <span class="st">"#191919"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,
            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, 
       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span>
<span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#####################################</span>
<span class="co">#####################################</span>
<span class="co">###### ITS Temperature Adaptation ###</span>
<span class="co">#####################################</span>
<span class="co">#####################################</span>


<span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">temp_adapt</span>
<span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span>
<span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/rankindex.html">rankindex</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, 
          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, 
          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>

<span class="co">## Let's run `capscale` using Bray-Curtis. </span>

<span class="co">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span>
<span class="co">## * Autocorrelated removed: NUE, PUE, P_Q10, SI                                                                        </span>
<span class="co">## * Remove for capscale: S_Q10</span>


<span class="va">temp_adapt_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/capscale.html">capscale</a></span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">AG_Q10</span> <span class="op">+</span> <span class="va">BG_Q10</span> <span class="op">+</span> <span class="va">BP_Q10</span> <span class="op">+</span> <span class="va">CE_Q10</span> <span class="op">+</span> 
                                       <span class="va">N_Q10</span> <span class="op">+</span> <span class="va">XY_Q10</span> <span class="op">+</span> <span class="va">LP_Q10</span> <span class="op">+</span> <span class="va">PX_Q10</span> <span class="op">+</span> 
                                       <span class="va">CUEcn</span> <span class="op">+</span> <span class="va">CUEcp</span> <span class="op">+</span> <span class="va">Tmin</span>, 
                           <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span>
<span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span>

<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span>
<span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">temp_adapt_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, 
                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span>
<span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span>
<span class="va">temp_adapt_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>

<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>
<span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span>
<span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span>

<span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span>

<span class="va">envfit_temp_adapt_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,
                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                               <span class="va">temp_adapt_md_signif_hits</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span>
<span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, 
                       <span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and  bioenv."</span><span class="op">)</span>
<span class="va">temp_adapt_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, 
                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_sig_diff</span>

<span class="va">new_temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_sig_diff</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="va">temp_adapt_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                   <span class="va">new_temp_adapt_md_signif_hits</span>,<span class="op">]</span>

<span class="va">envfit_temp_adapt_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/envfit.html">envfit</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, 
                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,
                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span>

<span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span> <span class="op">%&gt;%</span> 
                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span>
                         <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span>
<span class="va">temp_adapt_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, 
                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> 
                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span>
<span class="va">temp_adapt_asv_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span><span class="op">[</span><span class="va">temp_adapt_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
                                                 <span class="va">temp_adapt_asv_signif_hits</span>,<span class="op">]</span>
<span class="va">temp_adapt_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span>
<span class="va">temp_adapt_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span>
<span class="va">temp_adapt_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_all</span>, <span class="va">temp_adapt_asv_signif</span><span class="op">)</span>

<span class="va">temp_adapt_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, 
                                  <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span>
<span class="va">temp_adapt_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, 
                                   <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span>
<span class="va">temp_adapt_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">temp_adapt_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">temp_adapt_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">temp_adapt_plot_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,
                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>,
               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,
            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, 
       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span>
<span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">its18_edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span>
<span class="va">its18_soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span>
<span class="va">its18_temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span>

<span class="co">### BUILD the final Plot</span>
<span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ssu18_edaphic_plot</span> <span class="op">|</span> <span class="va">ssu18_soil_funct_plot</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">its18_edaphic_plot</span> <span class="op">|</span> <span class="va">its18_soil_funct_plot</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"a"</span>, 
                              title <span class="op">=</span> <span class="cn">NULL</span>, 
                              subtitle <span class="op">=</span> <span class="cn">NULL</span>, 
                              caption <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> 
<span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_final</span> <span class="op">+</span> 
  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,
             plot.tag <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">31</span><span class="op">)</span>, 
             axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>, 
             axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span> 

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">tmp_plot_final</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, 
                filename <span class="op">=</span>  <span class="st">"Extended_Data_Figure_5.png"</span>, 
                height <span class="op">=</span> <span class="fl">8398</span>, width <span class="op">=</span> <span class="fl">7485</span>, units <span class="op">=</span> <span class="st">'px'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
                
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">tmp_plot_final</span>, path <span class="op">=</span> <span class="st">"include/pub/ext/"</span>, 
                filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_5.pdf"</span>, 
                height <span class="op">=</span> <span class="fl">8398</span>, width <span class="op">=</span> <span class="fl">7485</span>, units <span class="op">=</span> <span class="st">'px'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="supplementary-material" class="level1"><h1>Supplementary Material</h1>
<section id="supplementary-figure-1" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-1">Supplementary Figure 1</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_1.png" class="img-fluid"></p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_main_ssu.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/ssu18_ps_work.rds">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_1.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co">## Load data</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span>
<span class="va">ssu18_ps_work</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/som/ssu18_ps_work.rds"</span><span class="op">)</span>

<span class="co">## 1) Get all Class-level Proteobacteria names</span>
<span class="va">ssu18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span>
     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/subset_taxa-methods.html">subset_taxa</a></span><span class="op">(</span><span class="va">tmp_get</span>, <span class="va">Phylum</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
     <span class="va">tmp_get_taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/get_taxa_unique.html">get_taxa_unique</a></span><span class="op">(</span><span class="va">tmp_df</span>,
                                     taxonomic.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
                                     errorIfNULL<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_get_taxa</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## 2) Replace Phylum Proteobacteria with the Class name.</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span>
  <span class="va">tmp_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span>
        <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Alphaproteobacteria"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Alphaproteobacteria"</span><span class="op">)</span>
      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span>
                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Gammaproteobacteria"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gammaproteobacteria"</span><span class="op">)</span>
      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span>
                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Zetaproteobacteria"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Zetaproteobacteria"</span><span class="op">)</span>
      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span>
                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p_Proteobacteria"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p_Proteobacteria"</span><span class="op">)</span>
      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/get_taxa_unique.html">get_taxa_unique</a></span><span class="op">(</span>
      <span class="va">tmp_get</span>,
      taxonomic.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
      errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">tmp_get</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">j</span>, <span class="st">"_clean.rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">order</span>, <span class="va">phylum</span><span class="op">)</span>

<span class="co">## 3) In order to use `microeco`, we need to add the rank designation as a prefix to each taxa. </span>
<span class="co">## For example, `Actinobacteriota` is changed to `p__Actinobacteriota`. </span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_sam_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"p_Proteobacteria"</span>, <span class="st">"Proteobacteria"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span><span class="op">)</span>
  
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  
  <span class="va">tmp_tax_data</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
      <span class="va">tmp_tax_data</span>,
      <span class="va">gsub</span>,
      pattern <span class="op">=</span> <span class="st">"^[k | p | c | o | f]_.*"</span>,
      replacement <span class="op">=</span> <span class="st">""</span>,
      fixed <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">)</span>
  <span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"k__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"c__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"o__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"f__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"g__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span>
  
  <span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phyloseq.html">phyloseq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>,
                     <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phy_tree-methods.html">phy_tree</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>,
                     <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span>,
                     <span class="va">tmp_sam_data</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_ps</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## 4) Next, we need to covert each `phyloseq object` to a `microtable class`.  </span>
<span class="co">## The microtable class is the basic data structure for the `microeco` package </span>
<span class="co">## and designed to store basic information from all the downstream analyses </span>
<span class="co">## (e.g, alpha diversity, beta diversity, etc.). </span>
<span class="co">## We use the [file2meco](https://github.com/ChiLiubio/file2meco) to read the phyloseq </span>
<span class="co">## object and convert into a microtable object. We can add `_me` as a suffix </span>
<span class="co">## to each object to distiguish it from its' phyloseq counterpart. </span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_otu_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_taxonomy_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_phylo_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phy_tree-methods.html">phy_tree</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>
  <span class="va">tmp_taxonomy_table</span> <span class="op">%&lt;&gt;%</span> <span class="va">tidy_taxonomy</span>
  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="va">microtable</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
    sample_table <span class="op">=</span> <span class="va">tmp_sample_info</span>,
    otu_table <span class="op">=</span> <span class="va">tmp_otu_table</span>,
    tax_table <span class="op">=</span> <span class="va">tmp_taxonomy_table</span>,
    phylo_tree <span class="op">=</span> <span class="va">tmp_phylo_tree</span>
  <span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="va">tax_table</span> <span class="op">%&lt;&gt;%</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Kingdom</span> <span class="op">==</span> <span class="st">"k__Archaea"</span> <span class="op">|</span>
                                            <span class="va">Kingdom</span> <span class="op">==</span> <span class="st">"k__Bacteria"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">filter_pollution</span><span class="op">(</span>taxa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mitochondria"</span>, <span class="st">"chloroplast"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>  

<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ssu18_ps_work_me</span>, <span class="st">"include/pub/som/ssu18_ps_work_me.rds"</span><span class="op">)</span>

<span class="co">## 5) Now, we calculate the taxa abundance at each taxonomic rank using </span>
<span class="co">## `cal_abund()`. This function return a list called `taxa_abund` containing </span>
<span class="co">## several data frame of the abundance information at each taxonomic rank. </span>
<span class="co">## The list is stored in the microtable object automatically. </span>
<span class="co">## Itâ€™s worth noting that the `cal_abund()` function can be used to solve </span>
<span class="co">## some complex cases, such as supporting both the relative and absolute </span>
<span class="co">## abundance calculation and selecting the partial taxonomic columns. More </span>
<span class="co">## information can be found in the description of the </span>
<span class="co">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span>
<span class="co">## In the same loop we also create a `trans_abund` class, which is used to </span>
<span class="co">## transform taxonomic abundance data for plotting.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_me</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_me</span><span class="op">$</span><span class="fu">cal_abund</span><span class="op">(</span><span class="op">)</span>
  <span class="va">tmp_me_abund</span> <span class="op">&lt;-</span>
    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_me</span>,
                    taxrank <span class="op">=</span> <span class="st">"Phylum"</span>,
                    ntaxa <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>
  <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span>
    <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span>
  <span class="va">tmp_me_abund_gr</span> <span class="op">&lt;-</span>
    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
      dataset <span class="op">=</span> <span class="va">tmp_me</span>,
      taxrank <span class="op">=</span> <span class="st">"Phylum"</span>,
      ntaxa <span class="op">=</span> <span class="fl">12</span>,
      groupmean <span class="op">=</span> <span class="st">"TEMP"</span>
    <span class="op">)</span>
  <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span>
    <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_me_abund</span><span class="op">)</span>
  <span class="va">tmp_name_gr</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_gr</span>, <span class="va">tmp_me_abund_gr</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## 6) I prefer to specify the order of taxa in these kinds of plots. </span>
<span class="co">## We can look the top `ntaxa` (defined above) by accessing the </span>
<span class="co">## `data_taxanames` character vector of each microtable object.</span>
<span class="co">## Now we can define the order. Once we do that, we will override the </span>
<span class="co">## `data_taxanames` character vectors with the reordered vectors.</span>

<span class="va">ssu18_ps_work_tax_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alphaproteobacteria"</span>, <span class="st">"Gammaproteobacteria"</span>, 
                           <span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, 
                           <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Myxococcota"</span>, 
                           <span class="st">"Verrucomicrobiota"</span>, <span class="st">"Chloroflexi"</span>, 
                           <span class="st">"Planctomycetota"</span>, <span class="st">"Methylomirabilota"</span>, 
                           <span class="st">"Crenarchaeota"</span><span class="op">)</span>
<span class="co">## 7) And one more little step before plotting. </span>
<span class="co">## Here we  **a**) specify a custom color palette and  </span>
<span class="co">## **b**) specify the sample order. </span>

<span class="va">top_level</span> <span class="op">&lt;-</span> <span class="st">"Phylum"</span>
<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>
<span class="va">ssu18_colvec.tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00463C"</span>,<span class="st">"#FFD5FD"</span>,<span class="st">"#00A51C"</span>,<span class="st">"#C80B2A"</span>,<span class="st">"#00C7F9"</span>,
                      <span class="st">"#FFA035"</span>, <span class="st">"#ED0DFD"</span>,<span class="st">"#0063E5"</span>,<span class="st">"#5FFFDE"</span>,<span class="st">"#C00B6F"</span>,
                      <span class="st">"#00A090"</span>,<span class="st">"#FF95BA"</span><span class="op">)</span>
<span class="va">ssu18_samp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, 
                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, 
                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P05_D00_010_W3C"</span>, <span class="st">"P07_D00_010_W3D"</span>, 
                      <span class="st">"P09_D00_010_W3E"</span>, <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, 
                      <span class="st">"P05_D00_010_W8C"</span>, <span class="st">"P07_D00_010_W8D"</span>, <span class="st">"P09_D00_010_W8E"</span><span class="op">)</span>
<span class="co">## 8) Now we can generate plots (in a loop) for each faceted data set.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span>
  <span class="va">tmp_facet_plot</span> <span class="op">&lt;-</span>
    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>
      color_values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span>,
      others_color <span class="op">=</span> <span class="st">"#323232"</span>,
      facet <span class="op">=</span> <span class="st">"TEMP"</span>,
      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,
      xtext_type_hor <span class="op">=</span> <span class="cn">FALSE</span>,
      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,
      xtext_size <span class="op">=</span> <span class="fl">6</span>,
      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span>,
      order_x <span class="op">=</span> <span class="va">ssu18_samp_order</span>
    <span class="op">)</span>
  <span class="va">tmp_facet_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_facet_name</span>, <span class="va">tmp_facet_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## Then add a little formatting to the faceted plots.</span>

<span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work_facet_plot"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span>
    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="va">top_level</span>,
      reverse <span class="op">=</span> <span class="cn">FALSE</span>,
      keywidth <span class="op">=</span> <span class="fl">0.7</span>,
      keyheight <span class="op">=</span> <span class="fl">0.7</span>
    <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
      legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
      legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">"right"</span>,
      axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,
      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
      strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## And now plots for the group-means sets. We can use the same </span>
<span class="co">## taxa order since that should not have changed.</span>

<span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work_group_plot"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span>
  <span class="va">tmp_group_plot</span> <span class="op">&lt;-</span>
    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>
      color_values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span>,
      others_color <span class="op">=</span> <span class="st">"#323232"</span>,
      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,
      xtext_type_hor <span class="op">=</span> <span class="cn">TRUE</span>,
      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,
      xtext_size <span class="op">=</span> <span class="fl">10</span>,
      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span>
    <span class="op">)</span>
  <span class="va">tmp_group_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_group_name</span>, <span class="va">tmp_group_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Let's also add a little formatting to the groupmean plots.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span>
    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Relative Abundance (% total reads)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">"none"</span>,
      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## 10) Finally we use the `patchwork` package to combine the </span>
<span class="co">## two plots and customize the look.</span>
<span class="co">## single index that acts as an index for referencing elements (variables) in a list</span>
<span class="co">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span>
<span class="va">var_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="va">ssu18_data_sets</span>,
                 var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FULL"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span>  <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_plot_final_name</span> <span class="op">&lt;-</span>
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>, <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_set_type</span> <span class="op">&lt;-</span> <span class="va">var_list</span><span class="op">$</span><span class="va">var2</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
  <span class="va">tmp_p_plot</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_m_plot</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_p_plot</span> <span class="op">+</span> <span class="va">tmp_m_plot</span>
  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_final</span> <span class="op">+</span>
    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,
      plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      plot.tag <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_plot_final_name</span>, <span class="va">tmp_plot_final</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
   <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> 
     <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>,  <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
     <span class="va">tmp_plot_final</span>, 
     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.png"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
     <span class="va">tmp_plot_final</span>, 
     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.pdf"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
   <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/som/ssu18_ps_work_tax_div_bar_plots.png"</span>, 
            <span class="st">"include/pub/som/Supplementary_Figure_1.png"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/som/ssu18_ps_work_tax_div_bar_plots.pdf"</span>, 
            <span class="st">"include/pub/som/Supplementary_Figure_1.pdf"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-2" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-2">Supplementary Figure 2</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_2.png" class="img-fluid"></p>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_main_its.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/its18_ps_work.rds">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_2.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">its18_ps_work</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/som/its18_ps_work.rds"</span><span class="op">)</span>
<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>
<span class="va">its18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_work"</span><span class="op">)</span>
<span class="co">## 1) Choose the **number** of taxa to display and the </span>
<span class="co">## taxonomic **level**. Aggregate the rest into "Other".</span>
<span class="va">top_hits</span> <span class="op">&lt;-</span> <span class="fl">14</span>
<span class="va">top_level</span> <span class="op">&lt;-</span> <span class="st">"Order"</span>
<span class="co">## As above, in order to use `microeco`, we need to add the rank </span>
<span class="co">## designation as a prefix to each taxa. For example, `Basidiomycota` </span>
<span class="co">## is changed to `p__Basidiomycota`. </span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_sam_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"k__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"c__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"o__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"f__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"g__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span>
  
  <span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/phyloseq.html">phyloseq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>,
                     <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span>,
                     <span class="va">tmp_sam_data</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_ps</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_otu_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_taxonomy_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="va">microtable</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sample_table <span class="op">=</span> <span class="va">tmp_sample_info</span>,
                                otu_table <span class="op">=</span> <span class="va">tmp_otu_table</span>,
                                tax_table <span class="op">=</span> <span class="va">tmp_taxonomy_table</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="va">tax_table</span> <span class="op">%&lt;&gt;%</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Kingdom</span> <span class="op">==</span> <span class="st">"k__Fungi"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_dataset</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>  

<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">its18_ps_work_me</span>, <span class="st">"include/pub/som/its18_ps_work_me.rds"</span><span class="op">)</span>
<span class="co">## 5) Now, we calculate the taxa abundance at each taxonomic </span>
<span class="co">## rank using `cal_abund()`. This function return a list called </span>
<span class="co">## `taxa_abund` containing several data frame of the abundance </span>
<span class="co">## information at each taxonomic rank. The list is stored in the </span>
<span class="co">## microtable object automatically. Itâ€™s worth noting that the </span>
<span class="co">## `cal_abund()` function can be used to solve some complex cases, </span>
<span class="co">## such as supporting both the relative and absolute abundance </span>
<span class="co">## calculation and selecting the partial taxonomic columns. </span>
<span class="co">## More information can be found in the description of the </span>
<span class="co">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span>
<span class="co">## In the same loop we also create a `trans_abund` class, which </span>
<span class="co">## is used to transform taxonomic abundance data for plotting.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_me</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_me</span><span class="op">$</span><span class="fu">cal_abund</span><span class="op">(</span><span class="op">)</span>
  <span class="va">tmp_me_abund</span> <span class="op">&lt;-</span>
    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_me</span>,
                    taxrank <span class="op">=</span> <span class="va">top_level</span>,
                    ntaxa <span class="op">=</span> <span class="va">top_hits</span><span class="op">)</span>
  <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span>
    <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span>
  <span class="va">tmp_me_abund_gr</span> <span class="op">&lt;-</span>
    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
      dataset <span class="op">=</span> <span class="va">tmp_me</span>,
      taxrank <span class="op">=</span> <span class="va">top_level</span>,
      ntaxa <span class="op">=</span> <span class="va">top_hits</span>,
      groupmean <span class="op">=</span> <span class="st">"TEMP"</span>
    <span class="op">)</span>
  <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span>
    <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_me_abund</span><span class="op">)</span>
  <span class="va">tmp_name_gr</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_gr</span>, <span class="va">tmp_me_abund_gr</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## 6) I prefer to specify the order of taxa in these kinds of plots. </span>
<span class="co">## We can look the top `ntaxa` (defined above) by accessing the </span>
<span class="co">## `data_taxanames` character vector of each microtable object.</span>

<span class="va">its18_ps_work_tax_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"k_Fungi"</span>,  <span class="st">"p_Ascomycota"</span>,  <span class="st">"c_Agaricomycetes"</span>, <span class="st">"Agaricales"</span>,  
  <span class="st">"Archaeorhizomycetales"</span>,  <span class="st">"Capnodiales"</span>,  <span class="st">"Eurotiales"</span>,  <span class="st">"Geastrales"</span>,  
  <span class="st">"Glomerales"</span>,  <span class="st">"Helotiales"</span>, <span class="st">"Hypocreales"</span>,  <span class="st">"Saccharomycetales"</span>,  
  <span class="st">"Trichosporonales"</span>,  <span class="st">"Xylariales"</span><span class="op">)</span><span class="op">)</span>   
<span class="co">## And one more little step before plotting. Here we  </span>
<span class="co">## **a**) specify a custom color palette and  </span>
<span class="co">## **b**) specify the sample order. </span>

<span class="va">its18_colvec.tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#323232"</span>, <span class="st">"#004949"</span>, <span class="st">"#924900"</span>, <span class="st">"#490092"</span>, 
                      <span class="st">"#6db6ff"</span>, <span class="st">"#920000"</span>, <span class="st">"#ffb6db"</span>, <span class="st">"#24ff24"</span>, 
                      <span class="st">"#006ddb"</span>, <span class="st">"#db6d00"</span>, <span class="st">"#b66dff"</span>, <span class="st">"#ffff6d"</span>, 
                      <span class="st">"#009292"</span>, <span class="st">"#b6dbff"</span>, <span class="st">"#ff6db6"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_samp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, 
                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, 
                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P07_D00_010_W3D"</span>, <span class="st">"P09_D00_010_W3E"</span>, 
                      <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, <span class="st">"P05_D00_010_W8C"</span>, 
                      <span class="st">"P07_D00_010_W8D"</span><span class="op">)</span>
<span class="co">## 8) Now we can generate plots (in a loop) for each faceted data set.</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span>
  <span class="va">tmp_facet_plot</span> <span class="op">&lt;-</span>
    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>
      color_values <span class="op">=</span> <span class="va">its18_colvec.tax</span>,
      others_color <span class="op">=</span> <span class="st">"#323232"</span>,
      facet <span class="op">=</span> <span class="st">"TEMP"</span>,
      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,
      xtext_type_hor <span class="op">=</span> <span class="cn">FALSE</span>,
      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,
      xtext_size <span class="op">=</span> <span class="fl">6</span>,
      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span>,
      order_x <span class="op">=</span> <span class="va">its18_samp_order</span>
    <span class="op">)</span>
  <span class="va">tmp_facet_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_facet_name</span>, <span class="va">tmp_facet_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## Then add a little formatting to the faceted plots.</span>
<span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_work_facet_plot"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span>
    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="va">top_level</span>,
      reverse <span class="op">=</span> <span class="cn">FALSE</span>,
      keywidth <span class="op">=</span> <span class="fl">0.7</span>,
      keyheight <span class="op">=</span> <span class="fl">0.7</span>
    <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
      legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
      legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">"right"</span>,
      axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,
      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
      strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## And now plots for the groupmeans sets. </span>
<span class="co">## We can use the same taxa order since that </span>
<span class="co">## should not have changed.</span>
<span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_work_group_plot"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span>
  <span class="va">tmp_group_plot</span> <span class="op">&lt;-</span>
    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span>
      color_values <span class="op">=</span> <span class="va">its18_colvec.tax</span>,
      others_color <span class="op">=</span> <span class="st">"#323232"</span>,
      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,
      xtext_type_hor <span class="op">=</span> <span class="cn">TRUE</span>,
      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,
      xtext_size <span class="op">=</span> <span class="fl">10</span>,
      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span>
    <span class="op">)</span>
  <span class="va">tmp_group_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_group_name</span>, <span class="va">tmp_group_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## Let's also add a little formatting to the groupmean plots.</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span>
    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Relative Abundance (% total reads)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">"none"</span>,
      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## 10) Finally we use the `patchwork` package to combine the </span>
<span class="co">## two plots and customize the look.</span>
<span class="co">## single index that acts as an index for referencing elements (variables) in a list</span>
<span class="co">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span>
<span class="va">var_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="va">its18_data_sets</span>,
                 var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FULL"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span>  <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_plot_final_name</span> <span class="op">&lt;-</span>
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>, <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_set_type</span> <span class="op">&lt;-</span> <span class="va">var_list</span><span class="op">$</span><span class="va">var2</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
  <span class="va">tmp_p_plot</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_m_plot</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_p_plot</span> <span class="op">+</span> <span class="va">tmp_m_plot</span>
  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_final</span> <span class="op">+</span>
    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,
      plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      plot.tag <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_plot_final_name</span>, <span class="va">tmp_plot_final</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span>
   <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>,  <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
     <span class="va">tmp_plot_final</span>, 
     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.png"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
     <span class="va">tmp_plot_final</span>, 
     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.pdf"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
   <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/som/its18_ps_work_tax_div_bar_plots.png"</span>, 
            <span class="st">"include/pub/som/Supplementary_Figure_2.png"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/som/its18_ps_work_tax_div_bar_plots.pdf"</span>, 
            <span class="st">"include/pub/som/Supplementary_Figure_2.pdf"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-3" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-3">Supplementary Figure 3</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<code>*</code>).</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_3.png" class="img-fluid"></p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p><img src="paper/ESM/FIGURES/ssu_supp_alpha_div.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/ssu_alpha_diversity.rdata">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_3.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">alpha_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/som/ssu_alpha_diversity.rdata"</span><span class="op">)</span>
<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="va">div_test_plot_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">divtest</span>, <span class="va">chart</span>, <span class="va">colour</span>, <span class="va">posthoc</span>, <span class="va">threshold</span><span class="op">)</span> 
<span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">chart</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">chart</span> <span class="op">=</span> <span class="st">"box"</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">posthoc</span> <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> 
        <span class="st">"normality.pvalue"</span><span class="op">)</span><span class="op">)</span> 
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input object does not seem to be a div_test output."</span><span class="op">)</span>
    <span class="va">divtestdata</span> <span class="op">&lt;-</span> <span class="va">divtest</span><span class="op">$</span><span class="va">data</span>
    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span>
    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">getPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span>, 
            <span class="st">"Paired"</span><span class="op">)</span><span class="op">)</span>
        <span class="va">colour</span> <span class="op">&lt;-</span> <span class="fu">getPalette</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> 
            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input div_test object does not seem to contain pairwise posthoc data. 
                 Re-run div_test() using 'posthoc=TRUE' argument."</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Tukey post-hoc test"</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, 
                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, 
                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, 
                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, 
                <span class="st">"p"</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, 
                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, 
                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, 
                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, 
                <span class="st">"p"</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, 
            <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="va">pairwisetable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;</span> 
                <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span>
        <span class="op">}</span>
        <span class="va">sortedgroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">group1</span>, <span class="va">pairwisetable</span><span class="op">$</span><span class="va">group2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datamax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datamin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datarange</span> <span class="op">&lt;-</span> <span class="va">datamax</span> <span class="op">-</span> <span class="va">datamin</span>
        <span class="va">by</span> <span class="op">&lt;-</span> <span class="va">datarange</span> <span class="op">*</span> <span class="fl">0.1</span>
        <span class="va">min</span> <span class="op">&lt;-</span> <span class="va">datamax</span>
        <span class="va">max</span> <span class="op">&lt;-</span> <span class="va">min</span> <span class="op">+</span> <span class="op">(</span><span class="va">by</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span><span class="op">)</span>
        <span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min</span>, <span class="va">max</span>, <span class="va">by</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
        <span class="va">pairwisetable</span><span class="op">$</span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">ypos</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"box"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, outlier.size <span class="op">=</span> <span class="fl">3</span>,
            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_linetype_manual</a></span><span class="op">(</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"jitter"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, 
            color <span class="op">=</span> <span class="st">"Group"</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, width <span class="op">=</span> <span class="fl">0</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
                <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"violin"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggviolin</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, 
            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
                <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
            <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>,
                              chart <span class="op">=</span> <span class="st">"box"</span>,
                              colour    <span class="op">=</span> <span class="va">swel_col</span>,
                              posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_split</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_"</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"work"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"f"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FULL"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"filt"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"l"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FILT"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"perfect"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"r"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"pime"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"p"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PIME"</span>
  <span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q0"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"0"</span>
    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q1"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"1"</span>
    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q2"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"2"</span>
    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span>
  <span class="op">}</span>
  
  <span class="va">tmp_var</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"_asv"</span>, <span class="va">tmp_ds</span>, <span class="va">tmp_hill</span>, <span class="st">"_lab"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_name1</span>, <span class="st">" ("</span>, <span class="va">tmp_name2</span>, <span class="st">")"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_var</span>, <span class="va">tmp_name</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">ssu18_ps_work_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_work_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvf0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_filt_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_filt_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvl0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_pime_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_pime_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvp0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#####################</span>
<span class="va">ssu18_ps_work_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_work_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvf1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_filt_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_filt_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvl1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_pime_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_pime_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvp1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#####################</span>
<span class="va">ssu18_ps_work_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_work_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvf2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_filt_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_filt_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvl2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_pime_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_pime_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">ssu18_asvp2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>

<span class="va">ssu18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span>
  <span class="va">ssu18_ps_work_q0_adt_plot</span>,
  <span class="va">ssu18_ps_filt_q0_adt_plot</span>,
  <span class="va">ssu18_ps_perfect_q0_adt_plot</span>,
  <span class="va">ssu18_ps_pime_q0_adt_plot</span>,
  <span class="va">ssu18_ps_work_q1_adt_plot</span>,
  <span class="va">ssu18_ps_filt_q1_adt_plot</span>,
  <span class="va">ssu18_ps_perfect_q1_adt_plot</span>,
  <span class="va">ssu18_ps_pime_q1_adt_plot</span>,
  <span class="va">ssu18_ps_work_q2_adt_plot</span>,
  <span class="va">ssu18_ps_filt_q2_adt_plot</span>,
  <span class="va">ssu18_ps_perfect_q2_adt_plot</span>,
  <span class="va">ssu18_ps_pime_q2_adt_plot</span>,
  ncol <span class="op">=</span> <span class="fl">4</span>,
  nrow <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">ssu18_alph_div_plots_asv</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.png"</span>,
  height <span class="op">=</span> <span class="fl">5852</span>,
  width <span class="op">=</span> <span class="fl">7449</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>


<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">ssu18_alph_div_plots_asv</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.pdf"</span>,
  height <span class="op">=</span> <span class="fl">5852</span>,
  width <span class="op">=</span> <span class="fl">7449</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_3.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_3.pdf"</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-4" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-4">Supplementary Figure 4</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<code>*</code>).</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_4.png" class="img-fluid"></p>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p><img src="paper/ESM/FIGURES/its_supp_alpha_div.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/its_alpha_diversity.rdata">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_4.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/som/its_alpha_diversity.rdata"</span><span class="op">)</span>
<span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span>

<span class="va">div_test_plot_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">divtest</span>, <span class="va">chart</span>, <span class="va">colour</span>, <span class="va">posthoc</span>, <span class="va">threshold</span><span class="op">)</span> 
<span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">chart</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">chart</span> <span class="op">=</span> <span class="st">"box"</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">posthoc</span> <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> 
        <span class="st">"normality.pvalue"</span><span class="op">)</span><span class="op">)</span> 
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input object does not seem to be a div_test output."</span><span class="op">)</span>
    <span class="va">divtestdata</span> <span class="op">&lt;-</span> <span class="va">divtest</span><span class="op">$</span><span class="va">data</span>
    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span>
    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">getPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span>, 
            <span class="st">"Paired"</span><span class="op">)</span><span class="op">)</span>
        <span class="va">colour</span> <span class="op">&lt;-</span> <span class="fu">getPalette</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> 
            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input div_test object does not seem to contain pairwise posthoc data. 
                 Re-run div_test() using 'posthoc=TRUE' argument."</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Tukey post-hoc test"</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, 
                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, 
                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, 
                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, 
                <span class="st">"p"</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, 
                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, 
                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, 
                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, 
                <span class="st">"p"</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>
        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, 
            <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="va">pairwisetable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;</span> 
                <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span>
        <span class="op">}</span>
        <span class="va">sortedgroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">group1</span>, <span class="va">pairwisetable</span><span class="op">$</span><span class="va">group2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datamax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datamin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> 
            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">datarange</span> <span class="op">&lt;-</span> <span class="va">datamax</span> <span class="op">-</span> <span class="va">datamin</span>
        <span class="va">by</span> <span class="op">&lt;-</span> <span class="va">datarange</span> <span class="op">*</span> <span class="fl">0.1</span>
        <span class="va">min</span> <span class="op">&lt;-</span> <span class="va">datamax</span>
        <span class="va">max</span> <span class="op">&lt;-</span> <span class="va">min</span> <span class="op">+</span> <span class="op">(</span><span class="va">by</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span><span class="op">)</span>
        <span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min</span>, <span class="va">max</span>, <span class="va">by</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
        <span class="va">pairwisetable</span><span class="op">$</span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">ypos</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"box"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, outlier.size <span class="op">=</span> <span class="fl">3</span>,
            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_linetype_manual</a></span><span class="op">(</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"jitter"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, 
            color <span class="op">=</span> <span class="st">"Group"</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, width <span class="op">=</span> <span class="fl">0</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
                <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"violin"</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggviolin</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, 
            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
                <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, 
            <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, 
                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>
        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>,
                              chart <span class="op">=</span> <span class="st">"box"</span>,
                              colour    <span class="op">=</span> <span class="va">swel_col</span>,
                              posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_split</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_"</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"work"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"f"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FULL"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"filt"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"l"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FILT"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"perfect"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"r"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"pime"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"p"</span>
    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PIME"</span>
  <span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q0"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"0"</span>
    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q1"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"1"</span>
    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q2"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"2"</span>
    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span>
  <span class="op">}</span>
  
  <span class="va">tmp_var</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"_asv"</span>, <span class="va">tmp_ds</span>, <span class="va">tmp_hill</span>, <span class="st">"_lab"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_name1</span>, <span class="st">" ("</span>, <span class="va">tmp_name2</span>, <span class="st">")"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_var</span>, <span class="va">tmp_name</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">its18_ps_work_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_work_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvf0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_filt_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_filt_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvl0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_pime_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_pime_q0_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvp0_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#####################</span>
<span class="va">its18_ps_work_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_work_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvf1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_filt_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_filt_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvl1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_pime_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_pime_q1_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvp1_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#####################</span>
<span class="va">its18_ps_work_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_work_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvf2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_filt_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_filt_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvl2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_ps_pime_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_pime_q2_adt_plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">its18_asvp2_lab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>

<span class="va">its18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span>
  <span class="va">its18_ps_work_q0_adt_plot</span>,
  <span class="va">its18_ps_filt_q0_adt_plot</span>,
  <span class="va">its18_ps_perfect_q0_adt_plot</span>,
  <span class="va">its18_ps_pime_q0_adt_plot</span>,
  <span class="va">its18_ps_work_q1_adt_plot</span>,
  <span class="va">its18_ps_filt_q1_adt_plot</span>,
  <span class="va">its18_ps_perfect_q1_adt_plot</span>,
  <span class="va">its18_ps_pime_q1_adt_plot</span>,
  <span class="va">its18_ps_work_q2_adt_plot</span>,
  <span class="va">its18_ps_filt_q2_adt_plot</span>,
  <span class="va">its18_ps_perfect_q2_adt_plot</span>,
  <span class="va">its18_ps_pime_q2_adt_plot</span>,
  ncol <span class="op">=</span> <span class="fl">4</span>,
  nrow <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">its18_alph_div_plots_asv</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/its18_alph_div_plots_asv.png"</span>,
  height <span class="op">=</span> <span class="fl">5852</span>,
  width <span class="op">=</span> <span class="fl">7449</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>


<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">its18_alph_div_plots_asv</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/its18_alph_div_plots_asv.pdf"</span>,
  height <span class="op">=</span> <span class="fl">5852</span>,
  width <span class="op">=</span> <span class="fl">7449</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/its18_alph_div_plots_asv.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_4.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/its18_alph_div_plots_asv.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_4.pdf"</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-5" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-5">Supplementary Figure 5</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>No post processing performed.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_5.png" class="img-fluid"></p>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p><img src="paper/ESM/FIGURES/ssu18_auto_cor_combo.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/ssu18_select_mc_norm_split.rds">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_5.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_select_mc_norm_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/ssu18_select_mc_norm_split.rds"</span>
  <span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="va">edaphic_norm_cor</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split</span><span class="op">$</span><span class="va">edaphic</span>
<span class="va">edaphic_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">soil_funct_norm_cor</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split</span><span class="op">$</span><span class="va">soil_funct</span>
<span class="va">soil_funct_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">temp_adapt_norm_cor</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split</span><span class="op">$</span><span class="va">temp_adapt</span>
<span class="va">temp_adapt_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_cor$"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
  
  <span class="va">tmp_get_lower_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="co"># Get upper triangle of the correlation matrix</span>
  <span class="va">tmp_get_upper_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="va">tmp_upper_tri</span> <span class="op">&lt;-</span> <span class="fu">tmp_get_upper_tri</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">tmp_upper_tri</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Var1</span>, y <span class="op">=</span> <span class="va">Var2</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">tmp_ggheatmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"red"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, 
                         midpoint <span class="op">=</span> <span class="fl">0</span>, limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, space <span class="op">=</span> <span class="st">"Lab"</span>, 
                         name<span class="op">=</span><span class="st">"Pearson\nCorrelation"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">1</span>, 
                                     size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
          axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, label <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.7</span><span class="op">)</span>,
      legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colorbar</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">7</span>, barheight <span class="op">=</span> <span class="fl">1</span>,
                                   title.position <span class="op">=</span> <span class="st">"top"</span>, 
                                   title.hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_ggheatmap"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_ggheatmap</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>  
<span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_ggheatmap"</span><span class="op">)</span>
<span class="va">edaphic_norm_cor_ggheatmap</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">edaphic_norm_cor_ggheatmap</span>,
  path <span class="op">=</span> <span class="st">"include/pub/som/"</span>,
  filename <span class="op">=</span> <span class="st">"ssu_auto_cor_edaphic.png"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">soil_funct_norm_cor_ggheatmap</span>,
  path <span class="op">=</span> <span class="st">"include/pub/som/"</span>,
  filename <span class="op">=</span> <span class="st">"ssu_auto_cor_functional.png"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">temp_adapt_norm_cor_ggheatmap</span>,
  path <span class="op">=</span> <span class="st">"include/pub/som/"</span>,
  filename <span class="op">=</span> <span class="st">"ssu_auto_cor_temperature.png"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>

<span class="va">auto_cor_figs</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span>
  <span class="va">edaphic_norm_cor_ggheatmap</span>,
  <span class="va">soil_funct_norm_cor_ggheatmap</span>,
  <span class="va">temp_adapt_norm_cor_ggheatmap</span>,
  ncol <span class="op">=</span> <span class="fl">3</span>,
  nrow <span class="op">=</span> <span class="fl">1</span>,
  common.legend <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">auto_cor_figs</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/ssu18_auto_cor_figs.png"</span>,
  height <span class="op">=</span> <span class="fl">2500</span>,
  width <span class="op">=</span> <span class="fl">7500</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>


<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">auto_cor_figs</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/ssu18_auto_cor_figs.pdf"</span>,
  height <span class="op">=</span> <span class="fl">2500</span>,
  width <span class="op">=</span> <span class="fl">7500</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/ssu18_auto_cor_figs.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_5.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/ssu18_auto_cor_figs.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_5.pdf"</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-6" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-6">Supplementary Figure 6</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>No post processing performed.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_6.png" class="img-fluid"></p>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p><img src="paper/ESM/FIGURES/its18_auto_cor_combo.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/its18_select_mc_norm_split.rds">Download the data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_6.pdf">Download the raw figure (.pdf)</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">its18_select_mc_norm_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/som/its18_select_mc_norm_split.rds"</span><span class="op">)</span>

<span class="va">edaphic_norm_cor</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split</span><span class="op">$</span><span class="va">edaphic</span>
<span class="va">edaphic_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">soil_funct_norm_cor</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split</span><span class="op">$</span><span class="va">soil_funct</span>
<span class="va">soil_funct_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="va">temp_adapt_norm_cor</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split</span><span class="op">$</span><span class="va">temp_adapt</span>
<span class="va">temp_adapt_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_cor$"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">tmp_cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
  
  <span class="va">tmp_get_lower_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="co"># Get upper triangle of the correlation matrix</span>
  <span class="va">tmp_get_upper_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="va">tmp_upper_tri</span> <span class="op">&lt;-</span> <span class="fu">tmp_get_upper_tri</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span>
  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">tmp_upper_tri</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Var1</span>, y <span class="op">=</span> <span class="va">Var2</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">tmp_ggheatmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"red"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, 
                         midpoint <span class="op">=</span> <span class="fl">0</span>, limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, space <span class="op">=</span> <span class="st">"Lab"</span>, 
                         name<span class="op">=</span><span class="st">"Pearson\nCorrelation"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">1</span>, 
                                     size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
          axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, label <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.7</span><span class="op">)</span>,
      legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colorbar</a></span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">7</span>, barheight <span class="op">=</span> <span class="fl">1</span>,
                                   title.position <span class="op">=</span> <span class="st">"top"</span>, 
                                   title.hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_ggheatmap"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_ggheatmap</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>  
<span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_ggheatmap"</span><span class="op">)</span>

<span class="va">auto_cor_figs</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span>
  <span class="va">edaphic_norm_cor_ggheatmap</span>, 
  <span class="va">soil_funct_norm_cor_ggheatmap</span>, 
  <span class="va">temp_adapt_norm_cor_ggheatmap</span>,
  ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">1</span>, common.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">auto_cor_figs</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/its18_auto_cor_figs.png"</span>,
  height <span class="op">=</span> <span class="fl">2500</span>,
  width <span class="op">=</span> <span class="fl">7500</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>


<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
  <span class="va">auto_cor_figs</span>,
  file <span class="op">=</span> <span class="st">"include/pub/som/its18_auto_cor_figs.pdf"</span>,
  height <span class="op">=</span> <span class="fl">2500</span>,
  width <span class="op">=</span> <span class="fl">7500</span>,
  units <span class="op">=</span> <span class="st">'px'</span>,
  bg <span class="op">=</span> <span class="st">"white"</span>,
  dpi <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/its18_auto_cor_figs.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_6.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/its18_auto_cor_figs.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_6.pdf"</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figures-714" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figures-714">Supplementary Figures 7â€“14</h2>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/ssu18_ps_work.rds">Download the data pack</a></p>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">ssu18_ps_work</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/som/ssu18_ps_work.rds"</span><span class="op">)</span>
<span class="va">ssu18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span>
     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/subset_taxa-methods.html">subset_taxa</a></span><span class="op">(</span><span class="va">tmp_get</span>, <span class="va">Phylum</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span>
     <span class="va">tmp_get_taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/get_taxa_unique.html">get_taxa_unique</a></span><span class="op">(</span><span class="va">tmp_df</span>,
                                     taxonomic.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
                                     errorIfNULL<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_get_taxa</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## 2) Replace Phylum Proteobacteria with the Class name.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span>
  <span class="va">tmp_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>

   <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
       <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Alphaproteobacteria"</span><span class="op">)</span><span class="op">{</span>
           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Alphaproteobacteria"</span><span class="op">)</span>
           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Gammaproteobacteria"</span><span class="op">)</span><span class="op">{</span>
           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gammaproteobacteria"</span><span class="op">)</span>
           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Zetaproteobacteria"</span><span class="op">)</span><span class="op">{</span>
              <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Zetaproteobacteria"</span><span class="op">)</span>
           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p_Proteobacteria"</span><span class="op">)</span><span class="op">{</span>
           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p_Proteobacteria"</span><span class="op">)</span>
           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span>
       <span class="op">}</span>
     <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/get_taxa_unique.html">get_taxa_unique</a></span><span class="op">(</span><span class="va">tmp_get</span>,
                               taxonomic.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
                               errorIfNULL<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">tmp_get</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">j</span>, <span class="st">"_clean.rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">order</span>, <span class="va">phylum</span><span class="op">)</span>

<span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="st">"ssu18_ps_work"</span>
<span class="va">tax_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"Alphaproteobacteria"</span>,
  <span class="st">"Gammaproteobacteria"</span>,
  <span class="st">"Acidobacteriota"</span>,
  <span class="st">"Actinobacteriota"</span>,
  <span class="st">"Bacteroidota"</span>,
  <span class="st">"Firmicutes"</span>,
  <span class="st">"Myxococcota"</span>,
  <span class="st">"Verrucomicrobiota"</span>
<span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="va">tmp_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/subset_taxa-methods.html">subset_taxa</a></span><span class="op">(</span><span class="va">tmp_get</span>, <span class="va">Phylum</span> <span class="op">==</span> <span class="va">j</span><span class="op">)</span>
    <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_sub</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_list</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/get_taxa_unique.html">get_taxa_unique</a></span><span class="op">(</span><span class="va">tmp_get</span>, taxonomic.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"####################################################"</span>, <span class="st">"\n"</span><span class="op">)</span>
  <span class="va">tmp_print</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Unique taxa:"</span>, <span class="va">i</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">tmp_print</span>, <span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"####################################################"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_list</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## 3) Choose the **number** of taxa to display and the taxonomic **level**. </span>
<span class="co">## Aggregate the rest into "Other".</span>

<span class="va">aggregate_top_taxa</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">top</span>, <span class="va">level</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">aggregate_taxa</span><span class="op">(</span><span class="va">x</span>, <span class="va">level</span><span class="op">)</span>
  
  <span class="va">tops</span> <span class="op">&lt;-</span> <span class="fu">top_taxa</span><span class="op">(</span><span class="va">x</span>, <span class="va">top</span><span class="op">)</span>
  <span class="va">tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  
  <span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">tax</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">tops</span><span class="op">)</span>
  
  <span class="va">tax</span><span class="op">[</span><span class="va">inds</span>, <span class="va">level</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Other"</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tax</span>
  
  <span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span>, <span class="va">level</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span>
  
  <span class="fu">aggregate_taxa</span><span class="op">(</span><span class="va">x</span>, <span class="va">level</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">top_hits</span> <span class="op">&lt;-</span> <span class="fl">12</span>
<span class="va">top_level</span> <span class="op">&lt;-</span> <span class="st">"Family"</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_otu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transpose-methods.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_otu</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmp_otu</span>, <span class="va">as.numeric</span><span class="op">)</span>
  <span class="va">tmp_otu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_otu</span><span class="op">)</span>
  <span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_clean_df</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/merge_phyloseq.html">merge_phyloseq</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html">otu_table</a></span><span class="op">(</span><span class="va">tmp_otu</span>, taxa_are_rows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html">tax_table</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">tmp_samples</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="va">tmp_agg_df</span> <span class="op">&lt;-</span> <span class="fu">aggregate_top_taxa</span><span class="op">(</span><span class="va">tmp_clean_df</span>,
                                   top <span class="op">=</span> <span class="va">top_hits</span>,
                                   level <span class="op">=</span> <span class="va">top_level</span><span class="op">)</span>
  <span class="va">tmp_agg_name</span> <span class="op">&lt;-</span>
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_agg_name</span>, <span class="va">tmp_agg_df</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_sep_agg"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tmp_data</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_data</span><span class="op">)</span>
  <span class="va">tmp_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/get_taxa_unique.html">get_taxa_unique</a></span><span class="op">(</span><span class="va">tmp_get</span>, taxonomic.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html">rank_names</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
                        errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">tmp_data</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_order"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_list</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg_order"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"#########"</span>, <span class="va">i</span>, <span class="st">"########"</span>, <span class="st">"\n"</span><span class="op">)</span>
  <span class="va">tmp_print</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">tmp_print</span>, <span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"####################################################"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span>

<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Alphaproteobacteria"</span>, <span class="st">"o_Elsterales"</span>, 
                   <span class="st">"o_Azospirillales"</span>, <span class="st">"Rhizobiales_Incertae_Sedis"</span>, 
                   <span class="st">"Xanthobacteraceae"</span>, <span class="st">"Sphingomonadaceae"</span>, <span class="st">"Rhizobiaceae"</span>, 
                   <span class="st">"Micropepsaceae"</span>, <span class="st">"Methyloligellaceae"</span>, <span class="st">"KF-JG30-B3"</span>, 
                   <span class="st">"Hyphomicrobiaceae"</span>, <span class="st">"Dongiaceae"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Alphaproteobacteria"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>
<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Gammaproteobacteria"</span>, <span class="st">"o_PLTA13"</span>, <span class="st">"o_CCD24"</span>, 
                   <span class="st">"Unknown_Family"</span>, <span class="st">"Xanthomonadaceae"</span>, <span class="st">"TRA3-20"</span>, 
                   <span class="st">"Steroidobacteraceae"</span>, <span class="st">"SC-I-84"</span>, <span class="st">"Nitrosomonadaceae"</span>, 
                   <span class="st">"Comamonadaceae"</span>, <span class="st">"Burkholderiaceae"</span>, <span class="st">"B1-7BS"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>
<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Subgroup_22"</span>, <span class="st">"c_Subgroup_25"</span>, <span class="st">"c_Subgroup_5"</span>, 
                   <span class="st">"o_Vicinamibacterales"</span>, <span class="st">"o_11-24"</span>, <span class="st">"o_Subgroup_17"</span>, 
                   <span class="st">"o_Subgroup_2"</span>, <span class="st">"o_Subgroup_7"</span>, <span class="st">"o_Acidobacteriales"</span>, 
                   <span class="st">"Vicinamibacteraceae"</span>, <span class="st">"Solibacteraceae"</span>, <span class="st">"Pyrinomonadaceae"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Acidobacteriota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>
<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_MB-A2-108"</span>, <span class="st">"o_IMCC26256"</span>, <span class="st">"o_Gaiellales"</span>, 
                   <span class="st">"o_Frankiales"</span>, <span class="st">"Streptomycetaceae"</span>, <span class="st">"Solirubrobacteraceae"</span>, 
                   <span class="st">"Nocardioidaceae"</span>, <span class="st">"Mycobacteriaceae"</span>, <span class="st">"Micromonosporaceae"</span>, 
                   <span class="st">"Gaiellaceae"</span>, <span class="st">"Acidothermaceae"</span>, <span class="st">"67-14"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>
<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_SJA-28"</span>, <span class="st">"o_Chitinophagales"</span>, <span class="st">"Sphingobacteriaceae"</span>, 
                   <span class="st">"Saprospiraceae"</span>, <span class="st">"Microscillaceae"</span>, <span class="st">"Hymenobacteraceae"</span>, 
                   <span class="st">"Flavobacteriaceae"</span>, <span class="st">"Cytophagaceae"</span>, <span class="st">"Chitinophagaceae"</span>, 
                   <span class="st">"BSV26"</span>, <span class="st">"env.OPS_17"</span>, <span class="st">"AKYH767"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Bacteroidota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>
<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"p_Firmicutes"</span>, <span class="st">"c_Bacilli"</span>, <span class="st">"o_Bacillales"</span>, 
                   <span class="st">"Thermoactinomycetaceae"</span>, <span class="st">"type_III"</span>, <span class="st">"Paenibacillaceae"</span>, 
                   <span class="st">"Lachnospiraceae"</span>, <span class="st">"Hungateiclostridiaceae"</span>, <span class="st">"Clostridiaceae"</span>, 
                   <span class="st">"Bacillaceae"</span>, <span class="st">"Alicyclobacillaceae"</span>, <span class="st">"Planococcaceae"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>
<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"p_Myxococcota"</span>, <span class="st">"c_bacteriap25"</span>, <span class="st">"c_Polyangia"</span>, 
                   <span class="st">"o_mle1-27"</span>, <span class="st">"o_MSB-4B10"</span>, <span class="st">"Sandaracinaceae"</span>, <span class="st">"Polyangiaceae"</span>, 
                   <span class="st">"Phaselicystidaceae"</span>, <span class="st">"Myxococcaceae"</span>, <span class="st">"Haliangiaceae"</span>, 
                   <span class="st">"BIrii41"</span>, <span class="st">"Anaeromyxobacteraceae"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Myxococcota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>
<span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Verrucomicrobiae"</span>, <span class="st">"o_Chlamydiales"</span>, <span class="st">"o_LD1-PA32"</span>, 
                   <span class="st">"o_S-BQ2-57_soil_group"</span>, <span class="st">"Xiphinematobacteraceae"</span>, 
                   <span class="st">"Simkaniaceae"</span>, <span class="st">"Pedosphaeraceae"</span>, <span class="st">"Parachlamydiaceae"</span>, 
                   <span class="st">"Opitutaceae"</span>, <span class="st">"Omnitrophaceae"</span>, <span class="st">"cvE6"</span>, <span class="st">"Chthoniobacteraceae"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Verrucomicrobiota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, 
       <span class="va">tmp_order</span><span class="op">)</span> 
<span class="co">###################</span>

<span class="co">## 4) Now, transform the data to relative abundance.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_agg</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">tmp_agg</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_order"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_get_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_agg</span><span class="op">)</span>
  <span class="va">tmp_get_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_order</span><span class="op">)</span>
  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_get_agg</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/transformcounts.html">transform_sample_counts</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/psmelt.html">psmelt</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">tmp_df</span><span class="op">[[</span><span class="va">top_level</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">gdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gdata/man/reorder.html">reorder.factor</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">[[</span><span class="va">top_level</span><span class="op">]</span><span class="op">]</span>,
                                               new.order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">tmp_get_order</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">top_level</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">tmp_agg</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span>
  <span class="co">#print(c(i, tmp_name, tmp_agg))</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg_tax"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">[[</span><span class="va">top_level</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_levels</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## 5) Plot the data for a single phyloseq object. Here you use an aggregated tax file.</span>

<span class="va">ssu18_colvec.tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
<span class="st">"#3D3C04"</span>,
<span class="st">"#FF95BA"</span>,
<span class="st">"#00A090"</span>,
<span class="st">"#C00B6F"</span>,
<span class="st">"#5FFFDE"</span>,
<span class="st">"#0063E5"</span>,
<span class="st">"#ED0DFD"</span>,
<span class="st">"#FFA035"</span>,
<span class="st">"#00C7F9"</span>,
<span class="st">"#C80B2A"</span>,
<span class="st">"#00A51C"</span>,
<span class="st">"#FFD5FD"</span>,
<span class="st">"#00463C"</span>
<span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg_tax"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tmp_get</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">TEMP</span><span class="op">)</span>,
    y <span class="op">=</span> <span class="va">Abundance</span>,
    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">top_level</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">top_level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Relative Abundance (% total reads)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">"none"</span>
    <span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span>
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## 6) Plot the data for multiple taxa. Here again you use an aggregated tax file. </span>
<span class="co">## This code can be used to generate plots for multiple data frames by adding the </span>
<span class="co">## base  phyloseq names to the `ssu18_split_df` variable. This code will also </span>
<span class="co">## facet the plots by a metadata variable. If you do not want to facet remove </span>
<span class="co">## the line beginning with `facet_grid`.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_level_get</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">tmp_level_get</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_level</span> <span class="op">&lt;-</span> <span class="va">tmp_level</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">tmp_level</span><span class="op">$</span><span class="va">TEMP</span><span class="op">)</span>,<span class="op">]</span>
  <span class="va">tmp_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">tmp_level</span><span class="op">$</span><span class="va">SamName</span><span class="op">)</span>
  
  <span class="va">tmp_agg_name</span> <span class="op">&lt;-</span>
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>,  <span class="st">"_agg_tax"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_agg_name</span><span class="op">)</span>
  <span class="va">tmp_df</span> <span class="op">&lt;-</span>
    <span class="fu">reshape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape/man/melt-24.html">melt</a></span><span class="op">(</span><span class="va">tmp_get</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample"</span>, <span class="st">"TEMP"</span>, <span class="st">"Abundance"</span>, <span class="st">"Family"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot_name</span> <span class="op">&lt;-</span>
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot_melt"</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tmp_df</span>,
                     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
                       x <span class="op">=</span> <span class="va">Sample</span>,
                       y <span class="op">=</span> <span class="va">Abundance</span>,
                       fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">top_level</span><span class="op">)</span>
                     <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">TEMP</span>, scale <span class="op">=</span> <span class="st">"free_x"</span>, space <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span>  <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>
      title <span class="op">=</span> <span class="va">top_level</span>,
      reverse <span class="op">=</span> <span class="cn">FALSE</span>,
      keywidth <span class="op">=</span> <span class="fl">0.7</span>,
      keyheight <span class="op">=</span> <span class="fl">0.7</span>
    <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
      panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
      panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">"right"</span>,
      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_plot_name</span>, <span class="va">tmp_plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## 7) Finally we use the `patchwork` package to combine the two </span>
<span class="co">## plots and customize the look.</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_plot_main</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_plot_melt</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot_melt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tmp_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_main</span> <span class="op">+</span> <span class="va">tmp_plot_melt</span>
  <span class="va">tmp_final</span> <span class="op">&lt;-</span> <span class="va">tmp_final</span> <span class="op">+</span>
    <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,
      plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
      plot.tag <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,
      axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
      axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,
      strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
      legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
      legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,
    <span class="op">)</span>
  <span class="va">tmp_name</span> <span class="op">&lt;-</span>
    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_final_plot"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_final</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">taxa_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"Alphaproteobacteria"</span>, 
                  <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"Myxococcota"</span>, 
                  <span class="st">"Verrucomicrobiota"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">taxa_to_plot</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp_get</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
      <span class="st">"ssu18_ps_work_"</span>, <span class="va">i</span>, <span class="st">"_final_plot"</span>, sep <span class="op">=</span> <span class="st">""</span>
    <span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
    <span class="va">tmp_get</span>,
    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.png"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,
    height <span class="op">=</span> <span class="fl">2415</span>,
    width <span class="op">=</span> <span class="fl">6350</span>,
    units <span class="op">=</span> <span class="st">'px'</span>,
    bg <span class="op">=</span> <span class="st">"white"</span>,
    dpi <span class="op">=</span> <span class="fl">600</span>
  <span class="op">)</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
    <span class="va">tmp_get</span>,
    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/som/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.pdf"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,
    height <span class="op">=</span> <span class="fl">2415</span>,
    width <span class="op">=</span> <span class="fl">6350</span>,
    units <span class="op">=</span> <span class="st">'px'</span>,
    bg <span class="op">=</span> <span class="st">"white"</span>,
    dpi <span class="op">=</span> <span class="fl">600</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Acidobacteriota_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_7.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Actinobacteriota_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_8.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Alphaproteobacteria_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_9.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Gammaproteobacteria_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_10.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Bacteroidota_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_11.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Firmicutes_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_12.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Myxococcota_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_13.png"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Verrucomicrobiota_tax_div_bar_plots.png"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_14.png"</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Acidobacteriota_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_7.pdf"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Actinobacteriota_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_8.pdf"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Alphaproteobacteria_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_9.pdf"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Gammaproteobacteria_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_10.pdf"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Bacteroidota_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_11.pdf"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Firmicutes_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_12.pdf"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Myxococcota_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_13.pdf"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>
  <span class="st">"include/pub/som/Verrucomicrobiota_tax_div_bar_plots.pdf"</span>,
  <span class="st">"include/pub/som/Supplementary_Figure_14.pdf"</span>
<span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post prossessing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Original (SF7)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Modified (SF7)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_7.png" class="img-fluid"></p>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Acido.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_7.pdf">Download the raw pdf file of Figure S7</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Original (SF8)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Modified (SF8)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_8.png" class="img-fluid"></p>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Actino.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_8.pdf">Download the raw pdf file of Figure S8</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Original (SF9)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Modified (SF9)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_9.png" class="img-fluid"></p>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Alpha.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_9.pdf">Download the raw pdf file of Figure S9</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Original (SF10)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Modified (SF10)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_10.png" class="img-fluid"></p>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Gamma.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_10.pdf">Download the raw pdf file of Figure S10</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Original (SF11)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Modified (SF11)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_11.png" class="img-fluid"></p>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Bacter.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_11.pdf">Download the raw pdf file of Figure S11</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Original (SF12)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Modified (SF12)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_12.png" class="img-fluid"></p>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Firm.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_12.pdf">Download the raw pdf file of Figure S12</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">Original (SF13)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Modified (SF13)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_13.png" class="img-fluid"></p>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Myxo.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_13.pdf">Download the raw pdf file of Figure S13</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">Original (SF14)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Modified (SF14)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<p><img src="include/pub/som/Supplementary_Figure_14.png" class="img-fluid"></p>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Verruco.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/som/Supplementary_Figure_14.pdf">Download the raw pdf file of Figure S14</a></p>
</div>
</div>
</div>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation column-page-left"><div class="nav-page nav-page-previous">
      <a href="./about.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Website Contruction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb16" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Code for Publication Figures"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Reproducible workflows to reproduce all Main, Extended Data, and Supplementary figures in the publication. </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="an">page-layout:</span><span class="co"> full</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">    sidebar: false</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Get the code"</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: </span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: true</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">      caption: Code</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="an">comments:</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">  hypothesis: true  </span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq); <span class="fu">packageVersion</span>(<span class="st">"phyloseq"</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, magrittr, file2meco, microbiomeMarker,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>               microeco, cowplot, hilldiv, ggpubr, vegan, Matrix,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>               patchwork,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">install =</span> <span class="cn">FALSE</span>, <span class="at">update =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="fu">c</span>(</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cache"</span>,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cache.path"</span>,</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cache.rebuild"</span>,</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dependson"</span>,</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"autodep"</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="in">details {</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="in">    background-color: #F6F6F6;</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="in">    border: 1px solid  #B22271;</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="in">pre.sourceCode.r {</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="in">    font-size: 0.85em;</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="in">.step #download-button {</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 0;</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="in">  padding-top: 0;</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>For each figure we include the raw figure generated in R, the post-processed figure, plus the code and data needed to generate the figure. </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="fu"># Main Paper</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="fu"># Extended Data</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 2</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include axes and label resizing, removing non-significant (NS) values from plots,  changing significant p-values to asterisks (<span class="in">`*`</span>), creating a legend, and enlarging outlier points. </span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/ext/Extended_Data_Figure_2.png)</span></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_2.png)</span></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/extended_data_fig_2.rdata)</span>  </span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Extended_Data_Figure_2.pdf)</span></span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alpha diversity plot code</span></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/ext/extended_data_fig_2.rdata"</span>)</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA ALPHA DIV PLOTS ########</span></span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>tmp_objects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_perfect"</span>)</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>tmp_metric <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span>))</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>tmp_qvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>))</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>qvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tmp_objects) {</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>homogeneity.pvalue</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>          tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_h_pvalue, tmp_get))</span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_h_pvalue)</span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>normality.pvalue</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>          tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_n_pvalue, tmp_get))</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_n_pvalue)</span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>method</span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>          tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_method, tmp_get))</span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_method)</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>posthoc.method</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>          tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_phoc_method, tmp_get))</span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_phoc_method)</span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(tmp_metric, tmp_qvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_n_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_h_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_method) <span class="sc">%&gt;%</span></span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_phoc_method) <span class="sc">%&gt;%</span></span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"metric"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"q-value"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"normality p-value"</span> <span class="ot">=</span> <span class="dv">3</span>, </span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>                <span class="st">"homogeneity p-value"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"method"</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">"posthoc method"</span> <span class="ot">=</span> <span class="dv">6</span>)</span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">"_sig_tab"</span>))</span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span></span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a><span class="do">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span></span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a>tmp_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(ssu18_ps_perfect_q0_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a>                           ssu18_ps_perfect_q1_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a>                           ssu18_ps_perfect_q2_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]]))</span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(ssu18_ps_perfect_sig_tab, tmp_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"posthoc p-value"</span> <span class="ot">=</span> <span class="dv">7</span>)</span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab<span class="sc">$</span>lineage <span class="ot">&lt;-</span> <span class="st">"No"</span></span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab <span class="ot">&lt;-</span> ssu18_ps_perfect_sig_tab[,<span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a>ssu18_sig_tab_all <span class="ot">&lt;-</span> ssu18_ps_perfect_sig_tab</span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a><span class="do">## PostHoc Analyses </span></span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a><span class="do">## First let's check the results of each posthoc analysis.</span></span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a><span class="do">### Observed (q-value = 0)</span></span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a>ssu18_asvr0_lab <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a>ssu18_asvr0_lab</span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q0_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(ssu18_ps_perfect_q0_adt<span class="sc">$</span>posthoc)</span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a>ssu18_asvr1_lab <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>ssu18_asvr1_lab</span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q1_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(ssu18_ps_perfect_q1_adt<span class="sc">$</span>posthoc)</span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a>ssu18_asvr2_lab <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a>ssu18_asvr2_lab</span>
<span id="cb16-212"><a href="#cb16-212" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q2_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb16-213"><a href="#cb16-213" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(ssu18_ps_perfect_q2_adt<span class="sc">$</span>posthoc)</span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we can plot the results from the posthoc analyses for each metric </span></span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a><span class="do">## and data set using the function `div_test_plot_jjs`. </span></span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a><span class="do">## I modified the original function (`div_test_plot`) to control a </span></span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a><span class="do">## little of the formatting.</span></span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a><span class="do">## The command is as follows:</span></span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a><span class="do">## div_test_plot(divtest = x, chart = "type", colour = col.pal, </span></span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a><span class="do">##               posthoc = TRUE, threshold = value))</span></span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a><span class="do">## where `x` is the results from the `div_test` function, `"type"` is </span></span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a><span class="do">## chart type (box, jitter, or violin), `colour` is is a color palette, </span></span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a><span class="do">## `posthoc` indicates whether to run posthoc pairwise analyses, and `value` </span></span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a><span class="do">## is the maximum p-value to show in pairwise posthoc results. </span></span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a><span class="do">## **</span><span class="al">WARNING</span><span class="do">** if none of the posthoc results are below the specified </span></span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a><span class="do">## threshold, the function will throw an error. Therefore, until this is </span></span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a><span class="do">## fixed, all posthoc values are shown.</span></span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-233"><a href="#cb16-233" aria-hidden="true" tabindex="-1"></a>div_test_plot_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (divtest, chart, colour, posthoc, threshold) </span>
<span id="cb16-234"><a href="#cb16-234" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-235"><a href="#cb16-235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(chart)) {</span>
<span id="cb16-236"><a href="#cb16-236" aria-hidden="true" tabindex="-1"></a>        chart <span class="ot">=</span> <span class="st">"box"</span></span>
<span id="cb16-237"><a href="#cb16-237" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-238"><a href="#cb16-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(posthoc)) {</span>
<span id="cb16-239"><a href="#cb16-239" aria-hidden="true" tabindex="-1"></a>        posthoc <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb16-240"><a href="#cb16-240" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-241"><a href="#cb16-241" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">names</span>(divtest)[<span class="dv">1</span>] <span class="sc">!=</span> <span class="st">"data"</span>) <span class="sc">&amp;</span> (<span class="fu">names</span>(divtest)[<span class="dv">2</span>] <span class="sc">!=</span> </span>
<span id="cb16-242"><a href="#cb16-242" aria-hidden="true" tabindex="-1"></a>        <span class="st">"normality.pvalue"</span>)) </span>
<span id="cb16-243"><a href="#cb16-243" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"The input object does not seem to be a div_test output."</span>)</span>
<span id="cb16-244"><a href="#cb16-244" aria-hidden="true" tabindex="-1"></a>    divtestdata <span class="ot">&lt;-</span> divtest<span class="sc">$</span>data</span>
<span id="cb16-245"><a href="#cb16-245" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(divtestdata<span class="sc">$</span>Group)</span>
<span id="cb16-246"><a href="#cb16-246" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(divtestdata<span class="sc">$</span>Group, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(divtestdata<span class="sc">$</span>Group)))</span>
<span id="cb16-247"><a href="#cb16-247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(colour) <span class="sc">||</span> (<span class="fu">length</span>(colour) <span class="sc">&lt;</span> divtest<span class="sc">$</span>groups)) {</span>
<span id="cb16-248"><a href="#cb16-248" aria-hidden="true" tabindex="-1"></a>        getPalette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(divtest<span class="sc">$</span>groups, </span>
<span id="cb16-249"><a href="#cb16-249" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Paired"</span>))</span>
<span id="cb16-250"><a href="#cb16-250" aria-hidden="true" tabindex="-1"></a>        colour <span class="ot">&lt;-</span> <span class="fu">getPalette</span>(divtest<span class="sc">$</span>groups)</span>
<span id="cb16-251"><a href="#cb16-251" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-252"><a href="#cb16-252" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-253"><a href="#cb16-253" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">names</span>(divtest)[<span class="dv">7</span>])) </span>
<span id="cb16-254"><a href="#cb16-254" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span id="cb16-255"><a href="#cb16-255" aria-hidden="true" tabindex="-1"></a><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span>)</span>
<span id="cb16-256"><a href="#cb16-256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Tukey post-hoc test"</span>) {</span>
<span id="cb16-257"><a href="#cb16-257" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb16-258"><a href="#cb16-258" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb16-259"><a href="#cb16-259" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-260"><a href="#cb16-260" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">4</span>], <span class="dv">3</span>)</span>
<span id="cb16-261"><a href="#cb16-261" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb16-262"><a href="#cb16-262" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb16-263"><a href="#cb16-263" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb16-264"><a href="#cb16-264" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb16-265"><a href="#cb16-265" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span>) {</span>
<span id="cb16-267"><a href="#cb16-267" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb16-268"><a href="#cb16-268" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb16-269"><a href="#cb16-269" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-270"><a href="#cb16-270" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">3</span>], <span class="dv">3</span>)</span>
<span id="cb16-271"><a href="#cb16-271" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb16-272"><a href="#cb16-272" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb16-273"><a href="#cb16-273" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb16-274"><a href="#cb16-274" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb16-275"><a href="#cb16-275" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-276"><a href="#cb16-276" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">1</span>])</span>
<span id="cb16-277"><a href="#cb16-277" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">2</span>])</span>
<span id="cb16-278"><a href="#cb16-278" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(pairwisetable[, </span>
<span id="cb16-279"><a href="#cb16-279" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>]))</span>
<span id="cb16-280"><a href="#cb16-280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(threshold)) {</span>
<span id="cb16-281"><a href="#cb16-281" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> pairwisetable[<span class="fu">which</span>(pairwisetable<span class="sc">$</span>p <span class="sc">&lt;</span> </span>
<span id="cb16-282"><a href="#cb16-282" aria-hidden="true" tabindex="-1"></a>                threshold), ]</span>
<span id="cb16-283"><a href="#cb16-283" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-284"><a href="#cb16-284" aria-hidden="true" tabindex="-1"></a>        sortedgroups <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(pairwisetable<span class="sc">$</span>group1, pairwisetable<span class="sc">$</span>group2)))</span>
<span id="cb16-285"><a href="#cb16-285" aria-hidden="true" tabindex="-1"></a>        datamax <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">max</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb16-286"><a href="#cb16-286" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb16-287"><a href="#cb16-287" aria-hidden="true" tabindex="-1"></a>        datamin <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">min</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb16-288"><a href="#cb16-288" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb16-289"><a href="#cb16-289" aria-hidden="true" tabindex="-1"></a>        datarange <span class="ot">&lt;-</span> datamax <span class="sc">-</span> datamin</span>
<span id="cb16-290"><a href="#cb16-290" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">&lt;-</span> datarange <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb16-291"><a href="#cb16-291" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">&lt;-</span> datamax</span>
<span id="cb16-292"><a href="#cb16-292" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">&lt;-</span> min <span class="sc">+</span> (by <span class="sc">*</span> <span class="fu">nrow</span>(pairwisetable))</span>
<span id="cb16-293"><a href="#cb16-293" aria-hidden="true" tabindex="-1"></a>        ypos <span class="ot">&lt;-</span> <span class="fu">seq</span>(min, max, by)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb16-294"><a href="#cb16-294" aria-hidden="true" tabindex="-1"></a>        pairwisetable<span class="sc">$</span>ypos <span class="ot">&lt;-</span> ypos</span>
<span id="cb16-295"><a href="#cb16-295" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-296"><a href="#cb16-296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"box"</span>) {</span>
<span id="cb16-297"><a href="#cb16-297" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">outlier.size =</span> <span class="dv">3</span>,</span>
<span id="cb16-298"><a href="#cb16-298" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb16-299"><a href="#cb16-299" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-300"><a href="#cb16-300" aria-hidden="true" tabindex="-1"></a>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span id="cb16-301"><a href="#cb16-301" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb16-302"><a href="#cb16-302" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-303"><a href="#cb16-303" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_linetype_manual</span>()</span>
<span id="cb16-304"><a href="#cb16-304" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-305"><a href="#cb16-305" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-306"><a href="#cb16-306" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-307"><a href="#cb16-307" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-308"><a href="#cb16-308" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(plot)</span>
<span id="cb16-309"><a href="#cb16-309" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-310"><a href="#cb16-310" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"jitter"</span>) {</span>
<span id="cb16-311"><a href="#cb16-311" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb16-312"><a href="#cb16-312" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb16-313"><a href="#cb16-313" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-314"><a href="#cb16-314" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-315"><a href="#cb16-315" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>))</span>
<span id="cb16-316"><a href="#cb16-316" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-317"><a href="#cb16-317" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-318"><a href="#cb16-318" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-319"><a href="#cb16-319" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-320"><a href="#cb16-320" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb16-321"><a href="#cb16-321" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-322"><a href="#cb16-322" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"violin"</span>) {</span>
<span id="cb16-323"><a href="#cb16-323" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggviolin</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb16-324"><a href="#cb16-324" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb16-325"><a href="#cb16-325" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-326"><a href="#cb16-326" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-327"><a href="#cb16-327" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-328"><a href="#cb16-328" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>))</span>
<span id="cb16-329"><a href="#cb16-329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-330"><a href="#cb16-330" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-331"><a href="#cb16-331" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-332"><a href="#cb16-332" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-333"><a href="#cb16-333" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb16-334"><a href="#cb16-334" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-335"><a href="#cb16-335" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-336"><a href="#cb16-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-337"><a href="#cb16-337" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-338"><a href="#cb16-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-339"><a href="#cb16-339" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb16-340"><a href="#cb16-340" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb16-341"><a href="#cb16-341" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb16-342"><a href="#cb16-342" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-343"><a href="#cb16-343" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get, <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb16-344"><a href="#cb16-344" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">colour =</span> swel_col, <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-345"><a href="#cb16-345" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb16-346"><a href="#cb16-346" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-347"><a href="#cb16-347" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-348"><a href="#cb16-348" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-349"><a href="#cb16-349" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-350"><a href="#cb16-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-351"><a href="#cb16-351" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb16-352"><a href="#cb16-352" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-353"><a href="#cb16-353" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effective no. of Taxon Units"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-354"><a href="#cb16-354" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(ssu18_asvr0_lab) <span class="sc">+</span> </span>
<span id="cb16-355"><a href="#cb16-355" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-356"><a href="#cb16-356" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-357"><a href="#cb16-357" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatment"</span>) <span class="sc">+</span></span>
<span id="cb16-358"><a href="#cb16-358" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-359"><a href="#cb16-359" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(ssu18_asvr1_lab) <span class="sc">+</span> </span>
<span id="cb16-360"><a href="#cb16-360" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-361"><a href="#cb16-361" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-362"><a href="#cb16-362" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-363"><a href="#cb16-363" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb16-364"><a href="#cb16-364" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(ssu18_asvr2_lab) <span class="sc">+</span> </span>
<span id="cb16-365"><a href="#cb16-365" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-366"><a href="#cb16-366" aria-hidden="true" tabindex="-1"></a>ssu18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb16-367"><a href="#cb16-367" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q0_adt_plot, </span>
<span id="cb16-368"><a href="#cb16-368" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q1_adt_plot, </span>
<span id="cb16-369"><a href="#cb16-369" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q2_adt_plot, </span>
<span id="cb16-370"><a href="#cb16-370" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb16-371"><a href="#cb16-371" aria-hidden="true" tabindex="-1"></a>ssu18_alph_div_plots_asv</span>
<span id="cb16-372"><a href="#cb16-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-373"><a href="#cb16-373" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-374"><a href="#cb16-374" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-375"><a href="#cb16-375" aria-hidden="true" tabindex="-1"></a><span class="do">### ITS ALPHA DIV PLOTS #############</span></span>
<span id="cb16-376"><a href="#cb16-376" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-377"><a href="#cb16-377" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-378"><a href="#cb16-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-379"><a href="#cb16-379" aria-hidden="true" tabindex="-1"></a>tmp_objects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_perfect"</span>)</span>
<span id="cb16-380"><a href="#cb16-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-381"><a href="#cb16-381" aria-hidden="true" tabindex="-1"></a>tmp_metric <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span>))</span>
<span id="cb16-382"><a href="#cb16-382" aria-hidden="true" tabindex="-1"></a>tmp_qvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>))</span>
<span id="cb16-383"><a href="#cb16-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-384"><a href="#cb16-384" aria-hidden="true" tabindex="-1"></a>qvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb16-385"><a href="#cb16-385" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tmp_objects) {</span>
<span id="cb16-386"><a href="#cb16-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-387"><a href="#cb16-387" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-388"><a href="#cb16-388" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-389"><a href="#cb16-389" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-390"><a href="#cb16-390" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>homogeneity.pvalue</span>
<span id="cb16-391"><a href="#cb16-391" aria-hidden="true" tabindex="-1"></a>          tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_h_pvalue, tmp_get))</span>
<span id="cb16-392"><a href="#cb16-392" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-393"><a href="#cb16-393" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_h_pvalue)</span>
<span id="cb16-394"><a href="#cb16-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-395"><a href="#cb16-395" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-396"><a href="#cb16-396" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-397"><a href="#cb16-397" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-398"><a href="#cb16-398" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>normality.pvalue</span>
<span id="cb16-399"><a href="#cb16-399" aria-hidden="true" tabindex="-1"></a>          tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_n_pvalue, tmp_get))</span>
<span id="cb16-400"><a href="#cb16-400" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-401"><a href="#cb16-401" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_n_pvalue)</span>
<span id="cb16-402"><a href="#cb16-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-403"><a href="#cb16-403" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-404"><a href="#cb16-404" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-405"><a href="#cb16-405" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-406"><a href="#cb16-406" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>method</span>
<span id="cb16-407"><a href="#cb16-407" aria-hidden="true" tabindex="-1"></a>          tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_method, tmp_get))</span>
<span id="cb16-408"><a href="#cb16-408" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-409"><a href="#cb16-409" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_method)</span>
<span id="cb16-410"><a href="#cb16-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-411"><a href="#cb16-411" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb16-412"><a href="#cb16-412" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb16-413"><a href="#cb16-413" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb16-414"><a href="#cb16-414" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>posthoc.method</span>
<span id="cb16-415"><a href="#cb16-415" aria-hidden="true" tabindex="-1"></a>          tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_phoc_method, tmp_get))</span>
<span id="cb16-416"><a href="#cb16-416" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-417"><a href="#cb16-417" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_phoc_method)</span>
<span id="cb16-418"><a href="#cb16-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-419"><a href="#cb16-419" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(tmp_metric, tmp_qvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-420"><a href="#cb16-420" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_n_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-421"><a href="#cb16-421" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_h_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-422"><a href="#cb16-422" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_method) <span class="sc">%&gt;%</span></span>
<span id="cb16-423"><a href="#cb16-423" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_phoc_method) <span class="sc">%&gt;%</span></span>
<span id="cb16-424"><a href="#cb16-424" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"metric"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"q-value"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"normality p-value"</span> <span class="ot">=</span> <span class="dv">3</span>, </span>
<span id="cb16-425"><a href="#cb16-425" aria-hidden="true" tabindex="-1"></a>                <span class="st">"homogeneity p-value"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"method"</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">"posthoc method"</span> <span class="ot">=</span> <span class="dv">6</span>)</span>
<span id="cb16-426"><a href="#cb16-426" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">"_sig_tab"</span>))</span>
<span id="cb16-427"><a href="#cb16-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-428"><a href="#cb16-428" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-429"><a href="#cb16-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-430"><a href="#cb16-430" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span></span>
<span id="cb16-431"><a href="#cb16-431" aria-hidden="true" tabindex="-1"></a><span class="do">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span></span>
<span id="cb16-432"><a href="#cb16-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-433"><a href="#cb16-433" aria-hidden="true" tabindex="-1"></a>tmp_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(its18_ps_perfect_q0_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb16-434"><a href="#cb16-434" aria-hidden="true" tabindex="-1"></a>                           its18_ps_perfect_q1_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb16-435"><a href="#cb16-435" aria-hidden="true" tabindex="-1"></a>                           its18_ps_perfect_q2_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]]))</span>
<span id="cb16-436"><a href="#cb16-436" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(its18_ps_perfect_sig_tab, tmp_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb16-437"><a href="#cb16-437" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"posthoc p-value"</span> <span class="ot">=</span> <span class="dv">7</span>)</span>
<span id="cb16-438"><a href="#cb16-438" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-439"><a href="#cb16-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-440"><a href="#cb16-440" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb16-441"><a href="#cb16-441" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-442"><a href="#cb16-442" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab<span class="sc">$</span>lineage <span class="ot">&lt;-</span> <span class="st">"No"</span></span>
<span id="cb16-443"><a href="#cb16-443" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab <span class="ot">&lt;-</span> its18_ps_perfect_sig_tab[,<span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb16-444"><a href="#cb16-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-445"><a href="#cb16-445" aria-hidden="true" tabindex="-1"></a>its18_sig_tab_all <span class="ot">&lt;-</span> its18_ps_perfect_sig_tab</span>
<span id="cb16-446"><a href="#cb16-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-447"><a href="#cb16-447" aria-hidden="true" tabindex="-1"></a><span class="do">## PostHoc Analyses </span></span>
<span id="cb16-448"><a href="#cb16-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-449"><a href="#cb16-449" aria-hidden="true" tabindex="-1"></a><span class="do">## First let's check the results of each posthoc analysis.</span></span>
<span id="cb16-450"><a href="#cb16-450" aria-hidden="true" tabindex="-1"></a><span class="do">### Observed (q-value = 0)</span></span>
<span id="cb16-451"><a href="#cb16-451" aria-hidden="true" tabindex="-1"></a>its18_asvr0_lab <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb16-452"><a href="#cb16-452" aria-hidden="true" tabindex="-1"></a>its18_asvr0_lab</span>
<span id="cb16-453"><a href="#cb16-453" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q0_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb16-454"><a href="#cb16-454" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(its18_ps_perfect_q0_adt<span class="sc">$</span>posthoc)</span>
<span id="cb16-455"><a href="#cb16-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-456"><a href="#cb16-456" aria-hidden="true" tabindex="-1"></a>its18_asvr1_lab <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb16-457"><a href="#cb16-457" aria-hidden="true" tabindex="-1"></a>its18_asvr1_lab</span>
<span id="cb16-458"><a href="#cb16-458" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q1_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb16-459"><a href="#cb16-459" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(its18_ps_perfect_q1_adt<span class="sc">$</span>posthoc)</span>
<span id="cb16-460"><a href="#cb16-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-461"><a href="#cb16-461" aria-hidden="true" tabindex="-1"></a>its18_asvr2_lab <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb16-462"><a href="#cb16-462" aria-hidden="true" tabindex="-1"></a>its18_asvr2_lab</span>
<span id="cb16-463"><a href="#cb16-463" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q2_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb16-464"><a href="#cb16-464" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(its18_ps_perfect_q2_adt<span class="sc">$</span>posthoc)</span>
<span id="cb16-465"><a href="#cb16-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-466"><a href="#cb16-466" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-467"><a href="#cb16-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-468"><a href="#cb16-468" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb16-469"><a href="#cb16-469" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb16-470"><a href="#cb16-470" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb16-471"><a href="#cb16-471" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-472"><a href="#cb16-472" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get, <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb16-473"><a href="#cb16-473" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">colour =</span> swel_col, <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-474"><a href="#cb16-474" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb16-475"><a href="#cb16-475" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-476"><a href="#cb16-476" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-477"><a href="#cb16-477" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-478"><a href="#cb16-478" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-479"><a href="#cb16-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-480"><a href="#cb16-480" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb16-481"><a href="#cb16-481" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-482"><a href="#cb16-482" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effective no. of Taxon Units"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-483"><a href="#cb16-483" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(its18_asvr0_lab) <span class="sc">+</span> </span>
<span id="cb16-484"><a href="#cb16-484" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-485"><a href="#cb16-485" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-486"><a href="#cb16-486" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatment"</span>) <span class="sc">+</span></span>
<span id="cb16-487"><a href="#cb16-487" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-488"><a href="#cb16-488" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(its18_asvr1_lab) <span class="sc">+</span> </span>
<span id="cb16-489"><a href="#cb16-489" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-490"><a href="#cb16-490" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-491"><a href="#cb16-491" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-492"><a href="#cb16-492" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb16-493"><a href="#cb16-493" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(its18_asvr2_lab) <span class="sc">+</span> </span>
<span id="cb16-494"><a href="#cb16-494" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-495"><a href="#cb16-495" aria-hidden="true" tabindex="-1"></a>its18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb16-496"><a href="#cb16-496" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q0_adt_plot, </span>
<span id="cb16-497"><a href="#cb16-497" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q1_adt_plot, </span>
<span id="cb16-498"><a href="#cb16-498" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q2_adt_plot, </span>
<span id="cb16-499"><a href="#cb16-499" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb16-500"><a href="#cb16-500" aria-hidden="true" tabindex="-1"></a>its18_alph_div_plots_asv</span>
<span id="cb16-501"><a href="#cb16-501" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb16-502"><a href="#cb16-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-503"><a href="#cb16-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-504"><a href="#cb16-504" aria-hidden="true" tabindex="-1"></a><span class="fu">### Beta diversity plot code</span></span>
<span id="cb16-505"><a href="#cb16-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-508"><a href="#cb16-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-509"><a href="#cb16-509" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-510"><a href="#cb16-510" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-511"><a href="#cb16-511" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA BETA DIV PLOTS #########</span></span>
<span id="cb16-512"><a href="#cb16-512" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-513"><a href="#cb16-513" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-514"><a href="#cb16-514" aria-hidden="true" tabindex="-1"></a><span class="do">## First the code for ordination implementation in `phyloseq`. </span></span>
<span id="cb16-515"><a href="#cb16-515" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb16-516"><a href="#cb16-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-517"><a href="#cb16-517" aria-hidden="true" tabindex="-1"></a>ssu18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_perfect"</span>)</span>
<span id="cb16-518"><a href="#cb16-518" aria-hidden="true" tabindex="-1"></a>ssu_dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"unifrac"</span>, <span class="st">"wunifrac"</span>)</span>
<span id="cb16-519"><a href="#cb16-519" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-520"><a href="#cb16-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-521"><a href="#cb16-521" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (samp_ps <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-522"><a href="#cb16-522" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> ssu_dist){</span>
<span id="cb16-523"><a href="#cb16-523" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_prop"</span>)))</span>
<span id="cb16-524"><a href="#cb16-524" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PCoA"</span>) <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span></span>
<span id="cb16-525"><a href="#cb16-525" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb16-526"><a href="#cb16-526" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb16-527"><a href="#cb16-527" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color =</span> <span class="st">"TEMP"</span>)</span>
<span id="cb16-528"><a href="#cb16-528" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb16-529"><a href="#cb16-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-530"><a href="#cb16-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb16-531"><a href="#cb16-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-532"><a href="#cb16-532" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb16-533"><a href="#cb16-533" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb16-534"><a href="#cb16-534" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb16-535"><a href="#cb16-535" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb16-536"><a href="#cb16-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb16-537"><a href="#cb16-537" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-538"><a href="#cb16-538" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">color =</span> TEMP, <span class="at">fill =</span> TEMP))</span>
<span id="cb16-539"><a href="#cb16-539" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb16-540"><a href="#cb16-540" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb16-541"><a href="#cb16-541" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb16-542"><a href="#cb16-542" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-543"><a href="#cb16-543" aria-hidden="true" tabindex="-1"></a>  tmp_df_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, .))</span>
<span id="cb16-544"><a href="#cb16-544" aria-hidden="true" tabindex="-1"></a>  tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>, ., <span class="st">"_plist"</span>))</span>
<span id="cb16-545"><a href="#cb16-545" aria-hidden="true" tabindex="-1"></a>  tmp_plot_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, ., <span class="st">"_plot"</span>))</span>
<span id="cb16-546"><a href="#cb16-546" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"tmp_df_name"</span> <span class="ot">=</span> tmp_df, <span class="at">tmp_plist_name =</span> tmp_plist, <span class="at">tmp_plot_name =</span> tmp_plot)</span>
<span id="cb16-547"><a href="#cb16-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>,  d, <span class="st">"_ord_results"</span>), tmp_list)</span>
<span id="cb16-548"><a href="#cb16-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_tmp"</span>))</span>
<span id="cb16-549"><a href="#cb16-549" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb16-550"><a href="#cb16-550" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-551"><a href="#cb16-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-552"><a href="#cb16-552" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">"_ord_results"</span>)</span>
<span id="cb16-553"><a href="#cb16-553" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_num &lt;- c(1,2,3,4)</span></span>
<span id="cb16-554"><a href="#cb16-554" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb16-555"><a href="#cb16-555" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb16-556"><a href="#cb16-556" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb16-557"><a href="#cb16-557" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)<span class="sc">$</span>tmp_plist_name</span>
<span id="cb16-558"><a href="#cb16-558" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb16-559"><a href="#cb16-559" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">"ord_results"</span>, tmp_ord)</span>
<span id="cb16-560"><a href="#cb16-560" aria-hidden="true" tabindex="-1"></a>       tmp_dist <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(tmp_name, <span class="st">"ssu18_ps_perfect_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-561"><a href="#cb16-561" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., tmp_ord) <span class="sc">%&gt;%</span> </span>
<span id="cb16-562"><a href="#cb16-562" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., <span class="st">"_"</span>)</span>
<span id="cb16-563"><a href="#cb16-563" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb16-564"><a href="#cb16-564" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb16-565"><a href="#cb16-565" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb16-566"><a href="#cb16-566" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-567"><a href="#cb16-567" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-568"><a href="#cb16-568" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-569"><a href="#cb16-569" aria-hidden="true" tabindex="-1"></a>               <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb16-570"><a href="#cb16-570" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">"TEMP"</span></span>
<span id="cb16-571"><a href="#cb16-571" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb16-572"><a href="#cb16-572" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"unifrac"</span>) {</span>
<span id="cb16-573"><a href="#cb16-573" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Unweighted Unifrac"</span></span>
<span id="cb16-574"><a href="#cb16-574" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"wunifrac"</span>) {</span>
<span id="cb16-575"><a href="#cb16-575" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Weighted Unifrac"</span></span>
<span id="cb16-576"><a href="#cb16-576" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb16-577"><a href="#cb16-577" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb16-578"><a href="#cb16-578" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-579"><a href="#cb16-579" aria-hidden="true" tabindex="-1"></a>   tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_dist_name)</span>
<span id="cb16-580"><a href="#cb16-580" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb16-581"><a href="#cb16-581" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb16-582"><a href="#cb16-582" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-583"><a href="#cb16-583" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-584"><a href="#cb16-584" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-585"><a href="#cb16-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-586"><a href="#cb16-586" aria-hidden="true" tabindex="-1"></a><span class="do">## And now the code for ordination implementation in `microeco`. </span></span>
<span id="cb16-587"><a href="#cb16-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-588"><a href="#cb16-588" aria-hidden="true" tabindex="-1"></a>microeco_path <span class="ot">&lt;-</span> <span class="st">"include/pub/ext/"</span></span>
<span id="cb16-589"><a href="#cb16-589" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-590"><a href="#cb16-590" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb16-591"><a href="#cb16-591" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">cal_betadiv</span>(<span class="at">unifrac =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-592"><a href="#cb16-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-593"><a href="#cb16-593" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-594"><a href="#cb16-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-595"><a href="#cb16-595" aria-hidden="true" tabindex="-1"></a><span class="do">## Here I made a custom "function" to run the analysis, plot the graphs, </span></span>
<span id="cb16-596"><a href="#cb16-596" aria-hidden="true" tabindex="-1"></a><span class="do">## save graph objects, and save plots (as `.png` and `.pdf` files). </span></span>
<span id="cb16-597"><a href="#cb16-597" aria-hidden="true" tabindex="-1"></a><span class="do">## I am sure an actual programmer would be shocked, but it works. </span></span>
<span id="cb16-598"><a href="#cb16-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-599"><a href="#cb16-599" aria-hidden="true" tabindex="-1"></a>microeco_beta_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(choose_input, choose_metric, choose_ord) {  </span>
<span id="cb16-600"><a href="#cb16-600" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(choose_input, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb16-601"><a href="#cb16-601" aria-hidden="true" tabindex="-1"></a>  tmp_t1 <span class="ot">&lt;-</span> trans_beta<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_dataset, <span class="at">group =</span> <span class="st">"TEMP"</span>, <span class="at">measure =</span> choose_metric)</span>
<span id="cb16-602"><a href="#cb16-602" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_ordination</span>(<span class="at">ordination =</span> choose_ord)</span>
<span id="cb16-603"><a href="#cb16-603" aria-hidden="true" tabindex="-1"></a>  tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_ordination</span>(<span class="at">plot_color =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb16-604"><a href="#cb16-604" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">plot_shape =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb16-605"><a href="#cb16-605" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">color_values =</span> swel_col, </span>
<span id="cb16-606"><a href="#cb16-606" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">shape_values =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">16</span>)) <span class="sc">+</span> </span>
<span id="cb16-607"><a href="#cb16-607" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb16-608"><a href="#cb16-608" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb16-609"><a href="#cb16-609" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-610"><a href="#cb16-610" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-611"><a href="#cb16-611" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-612"><a href="#cb16-612" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb16-613"><a href="#cb16-613" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-614"><a href="#cb16-614" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"unwei_unifrac"</span>) {</span>
<span id="cb16-615"><a href="#cb16-615" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Unweighted Unifrac"</span></span>
<span id="cb16-616"><a href="#cb16-616" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"wei_unifrac"</span>) {</span>
<span id="cb16-617"><a href="#cb16-617" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Weighted Unifrac"</span></span>
<span id="cb16-618"><a href="#cb16-618" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb16-619"><a href="#cb16-619" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb16-620"><a href="#cb16-620" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-621"><a href="#cb16-621" aria-hidden="true" tabindex="-1"></a>   tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1_ord_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb16-622"><a href="#cb16-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-623"><a href="#cb16-623" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>()</span>
<span id="cb16-624"><a href="#cb16-624" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance</span>(<span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col)</span>
<span id="cb16-625"><a href="#cb16-625" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1_within_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb16-626"><a href="#cb16-626" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span>res_group_distance</span>
<span id="cb16-627"><a href="#cb16-627" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>(<span class="at">within_group =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-628"><a href="#cb16-628" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance</span>(<span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col) </span>
<span id="cb16-629"><a href="#cb16-629" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1_btwn_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb16-630"><a href="#cb16-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-631"><a href="#cb16-631" aria-hidden="true" tabindex="-1"></a><span class="do">###### SET names</span></span>
<span id="cb16-632"><a href="#cb16-632" aria-hidden="true" tabindex="-1"></a>  tmp_name_ord <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-633"><a href="#cb16-633" aria-hidden="true" tabindex="-1"></a>  tmp_name_wg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_wg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-634"><a href="#cb16-634" aria-hidden="true" tabindex="-1"></a>  tmp_name_bg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_bg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-635"><a href="#cb16-635" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-636"><a href="#cb16-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_ord, tmp_t1_ord_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb16-637"><a href="#cb16-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_wg, tmp_t1_within_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb16-638"><a href="#cb16-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_bg, tmp_t1_btwn_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb16-639"><a href="#cb16-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_PCoA"</span>))</span>
<span id="cb16-640"><a href="#cb16-640" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-641"><a href="#cb16-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-642"><a href="#cb16-642" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity)) {</span>
<span id="cb16-643"><a href="#cb16-643" aria-hidden="true" tabindex="-1"></a>  tmp_metric <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity[j])</span>
<span id="cb16-644"><a href="#cb16-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">microeco_beta_plot</span>(<span class="at">choose_input =</span> <span class="st">"ssu18_ps_perfect"</span>, <span class="at">choose_metric =</span> tmp_metric, <span class="at">choose_ord =</span> <span class="st">"PCoA"</span>)</span>
<span id="cb16-645"><a href="#cb16-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-646"><a href="#cb16-646" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-647"><a href="#cb16-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-648"><a href="#cb16-648" aria-hidden="true" tabindex="-1"></a>ssu18_unifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_unifrac_PCoA <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb16-649"><a href="#cb16-649" aria-hidden="true" tabindex="-1"></a>ssu18_wunifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_wunifrac_PCoA  <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb16-650"><a href="#cb16-650" aria-hidden="true" tabindex="-1"></a>ssu18_wg_unwei_unifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_me_wg_unwei_unifrac_PCoA</span>
<span id="cb16-651"><a href="#cb16-651" aria-hidden="true" tabindex="-1"></a>ssu18_wg_wei_unifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_me_wg_wei_unifrac_PCoA</span>
<span id="cb16-652"><a href="#cb16-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-653"><a href="#cb16-653" aria-hidden="true" tabindex="-1"></a>ssu18_wg_unwei_unifrac <span class="ot">&lt;-</span> ssu18_wg_unwei_unifrac <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb16-654"><a href="#cb16-654" aria-hidden="true" tabindex="-1"></a>ssu18_wg_wei_unifrac <span class="ot">&lt;-</span> ssu18_wg_wei_unifrac <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb16-655"><a href="#cb16-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-656"><a href="#cb16-656" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-657"><a href="#cb16-657" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-658"><a href="#cb16-658" aria-hidden="true" tabindex="-1"></a><span class="do">### ITS  BETA DIV PLOTS #############</span></span>
<span id="cb16-659"><a href="#cb16-659" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-660"><a href="#cb16-660" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-661"><a href="#cb16-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-662"><a href="#cb16-662" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb16-663"><a href="#cb16-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-664"><a href="#cb16-664" aria-hidden="true" tabindex="-1"></a>its18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_perfect"</span>)</span>
<span id="cb16-665"><a href="#cb16-665" aria-hidden="true" tabindex="-1"></a>its_dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"jsd"</span>, <span class="st">"bray"</span>)</span>
<span id="cb16-666"><a href="#cb16-666" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-667"><a href="#cb16-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-668"><a href="#cb16-668" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (samp_ps <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-669"><a href="#cb16-669" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> its_dist){</span>
<span id="cb16-670"><a href="#cb16-670" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_prop"</span>)))</span>
<span id="cb16-671"><a href="#cb16-671" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PCoA"</span>) <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span></span>
<span id="cb16-672"><a href="#cb16-672" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb16-673"><a href="#cb16-673" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb16-674"><a href="#cb16-674" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color =</span> <span class="st">"TEMP"</span>)</span>
<span id="cb16-675"><a href="#cb16-675" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb16-676"><a href="#cb16-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-677"><a href="#cb16-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb16-678"><a href="#cb16-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-679"><a href="#cb16-679" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb16-680"><a href="#cb16-680" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb16-681"><a href="#cb16-681" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb16-682"><a href="#cb16-682" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb16-683"><a href="#cb16-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb16-684"><a href="#cb16-684" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-685"><a href="#cb16-685" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">color =</span> TEMP, <span class="at">fill =</span> TEMP))</span>
<span id="cb16-686"><a href="#cb16-686" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb16-687"><a href="#cb16-687" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb16-688"><a href="#cb16-688" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb16-689"><a href="#cb16-689" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-690"><a href="#cb16-690" aria-hidden="true" tabindex="-1"></a>  tmp_df_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, .))</span>
<span id="cb16-691"><a href="#cb16-691" aria-hidden="true" tabindex="-1"></a>  tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>, ., <span class="st">"_plist"</span>))</span>
<span id="cb16-692"><a href="#cb16-692" aria-hidden="true" tabindex="-1"></a>  tmp_plot_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, ., <span class="st">"_plot"</span>))</span>
<span id="cb16-693"><a href="#cb16-693" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"tmp_df_name"</span> <span class="ot">=</span> tmp_df, <span class="at">tmp_plist_name =</span> tmp_plist, <span class="at">tmp_plot_name =</span> tmp_plot)</span>
<span id="cb16-694"><a href="#cb16-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>,  d, <span class="st">"_ord_results"</span>), tmp_list)</span>
<span id="cb16-695"><a href="#cb16-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_tmp"</span>))</span>
<span id="cb16-696"><a href="#cb16-696" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb16-697"><a href="#cb16-697" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-698"><a href="#cb16-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-699"><a href="#cb16-699" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">"_ord_results"</span>)</span>
<span id="cb16-700"><a href="#cb16-700" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_num &lt;- c(1,2,3,4)</span></span>
<span id="cb16-701"><a href="#cb16-701" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb16-702"><a href="#cb16-702" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb16-703"><a href="#cb16-703" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb16-704"><a href="#cb16-704" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)<span class="sc">$</span>tmp_plist_name</span>
<span id="cb16-705"><a href="#cb16-705" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb16-706"><a href="#cb16-706" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">"ord_results"</span>, tmp_ord)</span>
<span id="cb16-707"><a href="#cb16-707" aria-hidden="true" tabindex="-1"></a>       tmp_dist <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(tmp_name, <span class="st">"its18_ps_perfect_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-708"><a href="#cb16-708" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., tmp_ord) <span class="sc">%&gt;%</span> </span>
<span id="cb16-709"><a href="#cb16-709" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., <span class="st">"_"</span>)</span>
<span id="cb16-710"><a href="#cb16-710" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb16-711"><a href="#cb16-711" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb16-712"><a href="#cb16-712" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb16-713"><a href="#cb16-713" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-714"><a href="#cb16-714" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-715"><a href="#cb16-715" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-716"><a href="#cb16-716" aria-hidden="true" tabindex="-1"></a>               <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb16-717"><a href="#cb16-717" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">"TEMP"</span></span>
<span id="cb16-718"><a href="#cb16-718" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb16-719"><a href="#cb16-719" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"jsd"</span>) {</span>
<span id="cb16-720"><a href="#cb16-720" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Jensen-Shannon"</span></span>
<span id="cb16-721"><a href="#cb16-721" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"bray"</span>) {</span>
<span id="cb16-722"><a href="#cb16-722" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Bray-Curtis"</span></span>
<span id="cb16-723"><a href="#cb16-723" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb16-724"><a href="#cb16-724" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb16-725"><a href="#cb16-725" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-726"><a href="#cb16-726" aria-hidden="true" tabindex="-1"></a>   tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_dist_name)</span>
<span id="cb16-727"><a href="#cb16-727" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb16-728"><a href="#cb16-728" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb16-729"><a href="#cb16-729" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-730"><a href="#cb16-730" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-731"><a href="#cb16-731" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-732"><a href="#cb16-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-733"><a href="#cb16-733" aria-hidden="true" tabindex="-1"></a><span class="do">## And now the code for ordination implementation in `microeco`. </span></span>
<span id="cb16-734"><a href="#cb16-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-735"><a href="#cb16-735" aria-hidden="true" tabindex="-1"></a>microeco_path <span class="ot">&lt;-</span> <span class="st">"include/pub/ext/"</span></span>
<span id="cb16-736"><a href="#cb16-736" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-737"><a href="#cb16-737" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb16-738"><a href="#cb16-738" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">cal_betadiv</span>(<span class="at">unifrac =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-739"><a href="#cb16-739" aria-hidden="true" tabindex="-1"></a><span class="do">#### CODE TO ADD JSD DISTANCE ####  </span></span>
<span id="cb16-740"><a href="#cb16-740" aria-hidden="true" tabindex="-1"></a>  tmp_jsd <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(<span class="fu">get</span>(i), <span class="at">method =</span> <span class="st">"jsd"</span>) </span>
<span id="cb16-741"><a href="#cb16-741" aria-hidden="true" tabindex="-1"></a>  tmp_jsd <span class="ot">&lt;-</span> <span class="fu">forceSymmetric</span>(<span class="fu">as.matrix</span>(tmp_jsd), <span class="at">uplo =</span> <span class="st">"L"</span>)</span>
<span id="cb16-742"><a href="#cb16-742" aria-hidden="true" tabindex="-1"></a>  tmp_jsd <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_jsd)</span>
<span id="cb16-743"><a href="#cb16-743" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span>beta_diversity<span class="sc">$</span>jsd <span class="ot">&lt;-</span> tmp_jsd</span>
<span id="cb16-744"><a href="#cb16-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-745"><a href="#cb16-745" aria-hidden="true" tabindex="-1"></a>}    </span>
<span id="cb16-746"><a href="#cb16-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-747"><a href="#cb16-747" aria-hidden="true" tabindex="-1"></a><span class="do">## Here I made a custom "function" to run the analysis, plot the graphs, </span></span>
<span id="cb16-748"><a href="#cb16-748" aria-hidden="true" tabindex="-1"></a><span class="do">## save graph objects, and save plots (as `.png` and `.pdf` files). </span></span>
<span id="cb16-749"><a href="#cb16-749" aria-hidden="true" tabindex="-1"></a><span class="do">## I am sure an actual programmer would be shocked, but it works. </span></span>
<span id="cb16-750"><a href="#cb16-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-751"><a href="#cb16-751" aria-hidden="true" tabindex="-1"></a>microeco_beta_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(choose_input, choose_metric, choose_ord) {  </span>
<span id="cb16-752"><a href="#cb16-752" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(choose_input, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb16-753"><a href="#cb16-753" aria-hidden="true" tabindex="-1"></a>  tmp_t1 <span class="ot">&lt;-</span> trans_beta<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_dataset, <span class="at">group =</span> <span class="st">"TEMP"</span>, <span class="at">measure =</span> choose_metric)</span>
<span id="cb16-754"><a href="#cb16-754" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_ordination</span>(<span class="at">ordination =</span> choose_ord)</span>
<span id="cb16-755"><a href="#cb16-755" aria-hidden="true" tabindex="-1"></a>  tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_ordination</span>(<span class="at">plot_color =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb16-756"><a href="#cb16-756" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">plot_shape =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb16-757"><a href="#cb16-757" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">color_values =</span> swel_col, </span>
<span id="cb16-758"><a href="#cb16-758" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">shape_values =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">16</span>)) <span class="sc">+</span> </span>
<span id="cb16-759"><a href="#cb16-759" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb16-760"><a href="#cb16-760" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb16-761"><a href="#cb16-761" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-762"><a href="#cb16-762" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-763"><a href="#cb16-763" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb16-764"><a href="#cb16-764" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb16-765"><a href="#cb16-765" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-766"><a href="#cb16-766" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"jsd"</span>) {</span>
<span id="cb16-767"><a href="#cb16-767" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Jensen-Shannon"</span></span>
<span id="cb16-768"><a href="#cb16-768" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"bray"</span>) {</span>
<span id="cb16-769"><a href="#cb16-769" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Bray-Curtis"</span></span>
<span id="cb16-770"><a href="#cb16-770" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb16-771"><a href="#cb16-771" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb16-772"><a href="#cb16-772" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-773"><a href="#cb16-773" aria-hidden="true" tabindex="-1"></a>   tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1_ord_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb16-774"><a href="#cb16-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-775"><a href="#cb16-775" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>()</span>
<span id="cb16-776"><a href="#cb16-776" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance</span>(<span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col)</span>
<span id="cb16-777"><a href="#cb16-777" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1_within_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb16-778"><a href="#cb16-778" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span>res_group_distance</span>
<span id="cb16-779"><a href="#cb16-779" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>(<span class="at">within_group =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-780"><a href="#cb16-780" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance</span>(<span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col) </span>
<span id="cb16-781"><a href="#cb16-781" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1_btwn_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb16-782"><a href="#cb16-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-783"><a href="#cb16-783" aria-hidden="true" tabindex="-1"></a><span class="do">###### SET names</span></span>
<span id="cb16-784"><a href="#cb16-784" aria-hidden="true" tabindex="-1"></a>  tmp_name_ord <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-785"><a href="#cb16-785" aria-hidden="true" tabindex="-1"></a>  tmp_name_wg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_wg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-786"><a href="#cb16-786" aria-hidden="true" tabindex="-1"></a>  tmp_name_bg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_bg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-787"><a href="#cb16-787" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-788"><a href="#cb16-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_ord, tmp_t1_ord_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb16-789"><a href="#cb16-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_wg, tmp_t1_within_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb16-790"><a href="#cb16-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_bg, tmp_t1_btwn_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb16-791"><a href="#cb16-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_PCoA"</span>))</span>
<span id="cb16-792"><a href="#cb16-792" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-793"><a href="#cb16-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-794"><a href="#cb16-794" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity)) {</span>
<span id="cb16-795"><a href="#cb16-795" aria-hidden="true" tabindex="-1"></a>  tmp_metric <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity[j])</span>
<span id="cb16-796"><a href="#cb16-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">microeco_beta_plot</span>(<span class="at">choose_input =</span> <span class="st">"its18_ps_perfect"</span>, <span class="at">choose_metric =</span> tmp_metric, <span class="at">choose_ord =</span> <span class="st">"PCoA"</span>)</span>
<span id="cb16-797"><a href="#cb16-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-798"><a href="#cb16-798" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-799"><a href="#cb16-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-800"><a href="#cb16-800" aria-hidden="true" tabindex="-1"></a>its18_jsd <span class="ot">&lt;-</span> its18_ps_perfect_jsd_PCoA <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb16-801"><a href="#cb16-801" aria-hidden="true" tabindex="-1"></a>its18_bray <span class="ot">&lt;-</span> its18_ps_perfect_bray_PCoA  <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb16-802"><a href="#cb16-802" aria-hidden="true" tabindex="-1"></a>its18_wg_jsd <span class="ot">&lt;-</span> its18_ps_perfect_me_wg_jsd_PCoA</span>
<span id="cb16-803"><a href="#cb16-803" aria-hidden="true" tabindex="-1"></a>its18_wg_bray <span class="ot">&lt;-</span> its18_ps_perfect_me_wg_bray_PCoA</span>
<span id="cb16-804"><a href="#cb16-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-805"><a href="#cb16-805" aria-hidden="true" tabindex="-1"></a>its18_wg_jsd <span class="ot">&lt;-</span> its18_wg_jsd <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb16-806"><a href="#cb16-806" aria-hidden="true" tabindex="-1"></a>its18_wg_bray <span class="ot">&lt;-</span> its18_wg_bray <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb16-807"><a href="#cb16-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-808"><a href="#cb16-808" aria-hidden="true" tabindex="-1"></a><span class="do">### CREATE combo plot using PATCHWORK</span></span>
<span id="cb16-809"><a href="#cb16-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-810"><a href="#cb16-810" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-811"><a href="#cb16-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">15</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">22</span>),</span>
<span id="cb16-812"><a href="#cb16-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">17</span>, <span class="at">b =</span> <span class="dv">31</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">9</span>),</span>
<span id="cb16-813"><a href="#cb16-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">17</span>, <span class="at">b =</span> <span class="dv">31</span>, <span class="at">l =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">17</span>),</span>
<span id="cb16-814"><a href="#cb16-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">16</span>, <span class="at">b =</span> <span class="dv">23</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>),</span>
<span id="cb16-815"><a href="#cb16-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">24</span>, <span class="at">b =</span> <span class="dv">31</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>),</span>
<span id="cb16-816"><a href="#cb16-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-817"><a href="#cb16-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">32</span>, <span class="at">b =</span> <span class="dv">46</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">22</span>),</span>
<span id="cb16-818"><a href="#cb16-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">48</span>, <span class="at">b =</span> <span class="dv">62</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">9</span>),</span>
<span id="cb16-819"><a href="#cb16-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">48</span>, <span class="at">b =</span> <span class="dv">62</span>, <span class="at">l =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">17</span>),</span>
<span id="cb16-820"><a href="#cb16-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">47</span>, <span class="at">b =</span> <span class="dv">54</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>),</span>
<span id="cb16-821"><a href="#cb16-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">55</span>, <span class="at">b =</span> <span class="dv">62</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>)</span>
<span id="cb16-822"><a href="#cb16-822" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-823"><a href="#cb16-823" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-824"><a href="#cb16-824" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(layout)</span>
<span id="cb16-825"><a href="#cb16-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-826"><a href="#cb16-826" aria-hidden="true" tabindex="-1"></a>combo_plot <span class="ot">&lt;-</span> </span>
<span id="cb16-827"><a href="#cb16-827" aria-hidden="true" tabindex="-1"></a>  ssu18_alph_div_plots_asv <span class="sc">+</span> </span>
<span id="cb16-828"><a href="#cb16-828" aria-hidden="true" tabindex="-1"></a>           ssu18_unifrac <span class="sc">+</span> ssu18_wunifrac <span class="sc">+</span>  </span>
<span id="cb16-829"><a href="#cb16-829" aria-hidden="true" tabindex="-1"></a>           ssu18_wg_unwei_unifrac <span class="sc">+</span> ssu18_wg_wei_unifrac <span class="sc">+</span> </span>
<span id="cb16-830"><a href="#cb16-830" aria-hidden="true" tabindex="-1"></a>  its18_alph_div_plots_asv <span class="sc">+</span> </span>
<span id="cb16-831"><a href="#cb16-831" aria-hidden="true" tabindex="-1"></a>           its18_jsd <span class="sc">+</span> its18_bray <span class="sc">+</span>  </span>
<span id="cb16-832"><a href="#cb16-832" aria-hidden="true" tabindex="-1"></a>           its18_wg_jsd <span class="sc">+</span> its18_wg_bray <span class="sc">+</span> </span>
<span id="cb16-833"><a href="#cb16-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)  </span>
<span id="cb16-834"><a href="#cb16-834" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_2.png"</span>, <span class="at">height =</span> <span class="dv">56</span>, <span class="at">width =</span> <span class="dv">40</span>,</span>
<span id="cb16-835"><a href="#cb16-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb16-836"><a href="#cb16-836" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_2.pdf"</span>, <span class="at">height =</span> <span class="dv">56</span>, <span class="at">width =</span> <span class="dv">40</span>,</span>
<span id="cb16-837"><a href="#cb16-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb16-838"><a href="#cb16-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-839"><a href="#cb16-839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-840"><a href="#cb16-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-841"><a href="#cb16-841" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 3</span></span>
<span id="cb16-842"><a href="#cb16-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-843"><a href="#cb16-843" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-844"><a href="#cb16-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-845"><a href="#cb16-845" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-846"><a href="#cb16-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-847"><a href="#cb16-847" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include axes renaming, removing non-significant (NS) values from plots,  changing significant p-values to asterisks (<span class="in">`*`</span>), removing gridlines, and enlarging outlier points. </span>
<span id="cb16-848"><a href="#cb16-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-849"><a href="#cb16-849" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-850"><a href="#cb16-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-851"><a href="#cb16-851" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-852"><a href="#cb16-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-853"><a href="#cb16-853" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-854"><a href="#cb16-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-855"><a href="#cb16-855" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/ext/Extended_Data_Figure_3.png)</span></span>
<span id="cb16-856"><a href="#cb16-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-857"><a href="#cb16-857" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-858"><a href="#cb16-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-859"><a href="#cb16-859" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_3.png)</span></span>
<span id="cb16-860"><a href="#cb16-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-861"><a href="#cb16-861" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-862"><a href="#cb16-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-863"><a href="#cb16-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-864"><a href="#cb16-864" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-865"><a href="#cb16-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-866"><a href="#cb16-866" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-867"><a href="#cb16-867" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/ssu18_ps_perfect_rf_all.rds)</span>  </span>
<span id="cb16-868"><a href="#cb16-868" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-869"><a href="#cb16-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-870"><a href="#cb16-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-871"><a href="#cb16-871" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-872"><a href="#cb16-872" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Extended_Data_Figure_3.pdf)</span></span>
<span id="cb16-873"><a href="#cb16-873" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-874"><a href="#cb16-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-875"><a href="#cb16-875" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-876"><a href="#cb16-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-879"><a href="#cb16-879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-880"><a href="#cb16-880" aria-hidden="true" tabindex="-1"></a><span class="do">## In this section of the workflow we use the </span></span>
<span id="cb16-881"><a href="#cb16-881" aria-hidden="true" tabindex="-1"></a><span class="do">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span></span>
<span id="cb16-882"><a href="#cb16-882" aria-hidden="true" tabindex="-1"></a><span class="do">## to assess the response of taxonomic lineages to soil warming. </span></span>
<span id="cb16-883"><a href="#cb16-883" aria-hidden="true" tabindex="-1"></a><span class="do">## In the first step we need to fix the selected data set to make it </span></span>
<span id="cb16-884"><a href="#cb16-884" aria-hidden="true" tabindex="-1"></a><span class="do">## compatible with the various functions. For this analysis we use the </span></span>
<span id="cb16-885"><a href="#cb16-885" aria-hidden="true" tabindex="-1"></a><span class="do">## PERfect filtered data set.</span></span>
<span id="cb16-886"><a href="#cb16-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-887"><a href="#cb16-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-888"><a href="#cb16-888" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-889"><a href="#cb16-889" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_rf_all <span class="ot">&lt;-</span></span>
<span id="cb16-890"><a href="#cb16-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="st">"include/pub/ext/ssu18_ps_perfect_rf_all.rds"</span>)</span>
<span id="cb16-891"><a href="#cb16-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-892"><a href="#cb16-892" aria-hidden="true" tabindex="-1"></a><span class="do">## FIX ps object</span></span>
<span id="cb16-893"><a href="#cb16-893" aria-hidden="true" tabindex="-1"></a>ssu_ps <span class="ot">&lt;-</span> ssu18_ps_perfect_rf_all</span>
<span id="cb16-894"><a href="#cb16-894" aria-hidden="true" tabindex="-1"></a>tmp_tax1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(ssu_ps))</span>
<span id="cb16-895"><a href="#cb16-895" aria-hidden="true" tabindex="-1"></a>tmp_rn <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp_tax1)</span>
<span id="cb16-896"><a href="#cb16-896" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span></span>
<span id="cb16-897"><a href="#cb16-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">lapply</span>(tmp_tax1, <span class="cf">function</span>(x) {</span>
<span id="cb16-898"><a href="#cb16-898" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(|)"</span>, <span class="st">""</span>, x)</span>
<span id="cb16-899"><a href="#cb16-899" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb16-900"><a href="#cb16-900" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(tmp_tax) <span class="ot">&lt;-</span> tmp_rn</span>
<span id="cb16-901"><a href="#cb16-901" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">row.names</span>(tmp_tax), <span class="fu">row.names</span>(tmp_tax1))</span>
<span id="cb16-902"><a href="#cb16-902" aria-hidden="true" tabindex="-1"></a>ps_tax_new <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax)</span>
<span id="cb16-903"><a href="#cb16-903" aria-hidden="true" tabindex="-1"></a>tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(ssu_ps),</span>
<span id="cb16-904"><a href="#cb16-904" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">phy_tree</span>(ssu_ps),</span>
<span id="cb16-905"><a href="#cb16-905" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">tax_table</span>(ps_tax_new),</span>
<span id="cb16-906"><a href="#cb16-906" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample_data</span>(ssu_ps))</span>
<span id="cb16-907"><a href="#cb16-907" aria-hidden="true" tabindex="-1"></a>ssu_ps <span class="ot">&lt;-</span> tmp_ps</span>
<span id="cb16-908"><a href="#cb16-908" aria-hidden="true" tabindex="-1"></a>phyloseq<span class="sc">::</span><span class="fu">rank_names</span>(ssu_ps)</span>
<span id="cb16-909"><a href="#cb16-909" aria-hidden="true" tabindex="-1"></a><span class="do">## Next we run a statistical test for multiple groups</span></span>
<span id="cb16-910"><a href="#cb16-910" aria-hidden="true" tabindex="-1"></a><span class="do">## using the `run_test_multiple_groups` function.</span></span>
<span id="cb16-911"><a href="#cb16-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-912"><a href="#cb16-912" aria-hidden="true" tabindex="-1"></a>ssu_group_anova <span class="ot">&lt;-</span></span>
<span id="cb16-913"><a href="#cb16-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_test_multiple_groups</span>(ssu_ps,</span>
<span id="cb16-914"><a href="#cb16-914" aria-hidden="true" tabindex="-1"></a>                           <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb16-915"><a href="#cb16-915" aria-hidden="true" tabindex="-1"></a>                           <span class="at">taxa_rank =</span> <span class="st">"all"</span>,</span>
<span id="cb16-916"><a href="#cb16-916" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb16-917"><a href="#cb16-917" aria-hidden="true" tabindex="-1"></a>ssu_group_anova<span class="sc">@</span>marker_table</span>
<span id="cb16-918"><a href="#cb16-918" aria-hidden="true" tabindex="-1"></a><span class="fu">marker_table</span>(ssu_group_anova)</span>
<span id="cb16-919"><a href="#cb16-919" aria-hidden="true" tabindex="-1"></a><span class="do">## And then conduct post hoc pairwise comparisons for multiple</span></span>
<span id="cb16-920"><a href="#cb16-920" aria-hidden="true" tabindex="-1"></a><span class="do">## groups test using the `run_posthoc_test` function.</span></span>
<span id="cb16-921"><a href="#cb16-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-922"><a href="#cb16-922" aria-hidden="true" tabindex="-1"></a>ssu_default_pht <span class="ot">&lt;-</span> <span class="fu">run_posthoc_test</span>(ssu_ps,</span>
<span id="cb16-923"><a href="#cb16-923" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb16-924"><a href="#cb16-924" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">method =</span> <span class="st">"tukey"</span>,</span>
<span id="cb16-925"><a href="#cb16-925" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">transform =</span> <span class="st">"log10"</span>)</span>
<span id="cb16-926"><a href="#cb16-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-927"><a href="#cb16-927" aria-hidden="true" tabindex="-1"></a><span class="do">## We can filter out a select taxa and plot the results.</span></span>
<span id="cb16-928"><a href="#cb16-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-929"><a href="#cb16-929" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(</span>
<span id="cb16-930"><a href="#cb16-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(ssu_default_pht<span class="sc">@</span>result),</span>
<span id="cb16-931"><a href="#cb16-931" aria-hidden="true" tabindex="-1"></a>  group_name <span class="sc">==</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span></span>
<span id="cb16-932"><a href="#cb16-932" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-933"><a href="#cb16-933" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_postHocTest</span>(ssu_default_pht, <span class="at">feature =</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span>) <span class="sc">&amp;</span></span>
<span id="cb16-934"><a href="#cb16-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb16-935"><a href="#cb16-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-936"><a href="#cb16-936" aria-hidden="true" tabindex="-1"></a><span class="do">## But what we really want to do is get all of the markers that are</span></span>
<span id="cb16-937"><a href="#cb16-937" aria-hidden="true" tabindex="-1"></a><span class="do">## significant from the analysis, excluding any significant ASVs so we can</span></span>
<span id="cb16-938"><a href="#cb16-938" aria-hidden="true" tabindex="-1"></a><span class="do">## look at high taxa ranks.</span></span>
<span id="cb16-939"><a href="#cb16-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-940"><a href="#cb16-940" aria-hidden="true" tabindex="-1"></a>ssu_pht <span class="ot">&lt;-</span> ssu_default_pht</span>
<span id="cb16-941"><a href="#cb16-941" aria-hidden="true" tabindex="-1"></a>ssu18_pht_filt <span class="ot">&lt;-</span></span>
<span id="cb16-942"><a href="#cb16-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">data.frame</span>(ssu_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"ASV"</span>, <span class="fu">filter</span>(<span class="fu">data.frame</span>(ssu_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)<span class="sc">$</span>group_name), ]</span>
<span id="cb16-943"><a href="#cb16-943" aria-hidden="true" tabindex="-1"></a>ssu18_pht_filt <span class="ot">&lt;-</span></span>
<span id="cb16-944"><a href="#cb16-944" aria-hidden="true" tabindex="-1"></a>  ssu18_pht_filt[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[a-z]__$"</span>, ssu18_pht_filt<span class="sc">$</span>group_name), ]</span>
<span id="cb16-945"><a href="#cb16-945" aria-hidden="true" tabindex="-1"></a>ssu18_pht_filt <span class="ot">&lt;-</span></span>
<span id="cb16-946"><a href="#cb16-946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ssu18_pht_filt, group_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-947"><a href="#cb16-947" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(ssu18_pht_filt)</span>
<span id="cb16-948"><a href="#cb16-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-949"><a href="#cb16-949" aria-hidden="true" tabindex="-1"></a>plot_postHocTest_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (pht, feature, <span class="at">step_increase =</span> <span class="fl">0.12</span>) </span>
<span id="cb16-950"><a href="#cb16-950" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-951"><a href="#cb16-951" aria-hidden="true" tabindex="-1"></a>    abd_long <span class="ot">&lt;-</span> pht<span class="sc">@</span>abundance <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>.data<span class="sc">$</span>group, </span>
<span id="cb16-952"><a href="#cb16-952" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"feat"</span>)</span>
<span id="cb16-953"><a href="#cb16-953" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(feature)) {</span>
<span id="cb16-954"><a href="#cb16-954" aria-hidden="true" tabindex="-1"></a>        abd_long <span class="ot">&lt;-</span> <span class="fu">filter</span>(abd_long, .data<span class="sc">$</span>feat <span class="sc">%in%</span> feature)</span>
<span id="cb16-955"><a href="#cb16-955" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-956"><a href="#cb16-956" aria-hidden="true" tabindex="-1"></a>    annotation <span class="ot">&lt;-</span> <span class="fu">get_sig_annotation</span>(pht, <span class="at">step_increase =</span> step_increase)</span>
<span id="cb16-957"><a href="#cb16-957" aria-hidden="true" tabindex="-1"></a>    p_box <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">ggplot</span>(abd_long, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>group, </span>
<span id="cb16-958"><a href="#cb16-958" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> .data<span class="sc">$</span>value)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> ggsignif<span class="sc">::</span><span class="fu">geom_signif</span>(<span class="at">data =</span> annotation[annotation<span class="sc">$</span>feature <span class="sc">%in%</span> </span>
<span id="cb16-959"><a href="#cb16-959" aria-hidden="true" tabindex="-1"></a>        feature, ], <span class="fu">aes</span>(<span class="at">xmin =</span> .data<span class="sc">$</span>xmin, <span class="at">xmax =</span> .data<span class="sc">$</span>xmax, </span>
<span id="cb16-960"><a href="#cb16-960" aria-hidden="true" tabindex="-1"></a>        <span class="at">annotations =</span> .data<span class="sc">$</span>annotation, <span class="at">y_position =</span> .data<span class="sc">$</span>y_position), </span>
<span id="cb16-961"><a href="#cb16-961" aria-hidden="true" tabindex="-1"></a>        <span class="at">manual =</span> <span class="cn">TRUE</span>, <span class="at">textsize =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb16-962"><a href="#cb16-962" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Abundance"</span>))</span>
<span id="cb16-963"><a href="#cb16-963" aria-hidden="true" tabindex="-1"></a>    test_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pht<span class="sc">@</span>result[[feature]])</span>
<span id="cb16-964"><a href="#cb16-964" aria-hidden="true" tabindex="-1"></a>    p_test <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(test_res, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>comparions)) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .data<span class="sc">$</span>ci_lower, </span>
<span id="cb16-965"><a href="#cb16-965" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymax =</span> .data<span class="sc">$</span>ci_upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .data<span class="sc">$</span>diff_mean)) <span class="sc">+</span> </span>
<span id="cb16-966"><a href="#cb16-966" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"95% confidence intervals"</span>)</span>
<span id="cb16-967"><a href="#cb16-967" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(p_box)</span>
<span id="cb16-968"><a href="#cb16-968" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-969"><a href="#cb16-969" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(plot_postHocTest_jjs) <span class="ot">&lt;-</span> <span class="fu">asNamespace</span>(<span class="st">'microbiomeMarker'</span>)</span>
<span id="cb16-970"><a href="#cb16-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-971"><a href="#cb16-971" aria-hidden="true" tabindex="-1"></a>ssu_select <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-972"><a href="#cb16-972" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Acidobacteriota|c__Acidobacteriae|o__Subgroup_2"</span>, </span>
<span id="cb16-973"><a href="#cb16-973" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Chitinophagales|f__Saprospiraceae"</span>, </span>
<span id="cb16-974"><a href="#cb16-974" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Cytophagales"</span>, </span>
<span id="cb16-975"><a href="#cb16-975" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Flavobacteriales"</span>, </span>
<span id="cb16-976"><a href="#cb16-976" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Sphingobacteriales"</span>, </span>
<span id="cb16-977"><a href="#cb16-977" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Myxococcota|c__Polyangia|o__mle1-27"</span>, </span>
<span id="cb16-978"><a href="#cb16-978" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Comamonadaceae|g__Rubrivivax"</span>, </span>
<span id="cb16-979"><a href="#cb16-979" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Actinobacteriota|c__Acidimicrobiia|o__Microtrichales"</span>, </span>
<span id="cb16-980"><a href="#cb16-980" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span>, </span>
<span id="cb16-981"><a href="#cb16-981" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Firmicutes|c__Bacilli|o__Bacillales"</span>, </span>
<span id="cb16-982"><a href="#cb16-982" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Myxococcota|c__Myxococcia|o__Myxococcales|f__Myxococcaceae|g__Corallococcus"</span>, </span>
<span id="cb16-983"><a href="#cb16-983" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Burkholderiaceae|g__Ralstonia"</span> </span>
<span id="cb16-984"><a href="#cb16-984" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-985"><a href="#cb16-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-986"><a href="#cb16-986" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-987"><a href="#cb16-987" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu_select) {</span>
<span id="cb16-988"><a href="#cb16-988" aria-hidden="true" tabindex="-1"></a>  tmp_select_feat <span class="ot">&lt;-</span> i</span>
<span id="cb16-989"><a href="#cb16-989" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span>(ssu_pht, <span class="at">feature =</span> tmp_select_feat) <span class="sc">&amp;</span> <span class="fu">theme_bw</span>() </span>
<span id="cb16-990"><a href="#cb16-990" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> swel_col) <span class="sc">+</span> </span>
<span id="cb16-991"><a href="#cb16-991" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb16-992"><a href="#cb16-992" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb16-993"><a href="#cb16-993" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative abundance (% total reads)"</span>)</span>
<span id="cb16-994"><a href="#cb16-994" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))</span>
<span id="cb16-995"><a href="#cb16-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb16-996"><a href="#cb16-996" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".png", sep = ""), </span></span>
<span id="cb16-997"><a href="#cb16-997" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                height = 7, width = 9, units = 'cm', dpi = 600, bg = "white")</span></span>
<span id="cb16-998"><a href="#cb16-998" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".pdf", sep = ""), </span></span>
<span id="cb16-999"><a href="#cb16-999" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                height = 5, width = 6.5)</span></span>
<span id="cb16-1000"><a href="#cb16-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-1001"><a href="#cb16-1001" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb16-1002"><a href="#cb16-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1003"><a href="#cb16-1003" aria-hidden="true" tabindex="-1"></a>ssu_title <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-1004"><a href="#cb16-1004" aria-hidden="true" tabindex="-1"></a><span class="st">"Subgroup_2 (Acidobacteriota)"</span>, </span>
<span id="cb16-1005"><a href="#cb16-1005" aria-hidden="true" tabindex="-1"></a><span class="st">"Saprospiraceae (Bacteroidota)"</span>, </span>
<span id="cb16-1006"><a href="#cb16-1006" aria-hidden="true" tabindex="-1"></a><span class="st">"Cytophagales (Bacteroidota)"</span>, </span>
<span id="cb16-1007"><a href="#cb16-1007" aria-hidden="true" tabindex="-1"></a><span class="st">"Flavobacteriales (Bacteroidota)"</span>, </span>
<span id="cb16-1008"><a href="#cb16-1008" aria-hidden="true" tabindex="-1"></a><span class="st">"Sphingobacteriales (Bacteroidota)"</span>, </span>
<span id="cb16-1009"><a href="#cb16-1009" aria-hidden="true" tabindex="-1"></a><span class="st">"mle1-27 (Myxococcota)"</span>, </span>
<span id="cb16-1010"><a href="#cb16-1010" aria-hidden="true" tabindex="-1"></a><span class="st">"Rubrivivax (Proteobacteria)"</span>, </span>
<span id="cb16-1011"><a href="#cb16-1011" aria-hidden="true" tabindex="-1"></a><span class="st">"Microtrichales (Actinobacteriota)"</span>, </span>
<span id="cb16-1012"><a href="#cb16-1012" aria-hidden="true" tabindex="-1"></a><span class="st">"Gaiellales (Actinobacteriota)"</span>, </span>
<span id="cb16-1013"><a href="#cb16-1013" aria-hidden="true" tabindex="-1"></a><span class="st">"Bacillales (Firmicutes)"</span>, </span>
<span id="cb16-1014"><a href="#cb16-1014" aria-hidden="true" tabindex="-1"></a><span class="st">"Corallococcus (Myxococcota)"</span>, </span>
<span id="cb16-1015"><a href="#cb16-1015" aria-hidden="true" tabindex="-1"></a><span class="st">"Ralstonia (Proteobacteria)"</span></span>
<span id="cb16-1016"><a href="#cb16-1016" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-1017"><a href="#cb16-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1018"><a href="#cb16-1018" aria-hidden="true" tabindex="-1"></a>ssu_plt_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lineage =</span> ssu_select, <span class="at">label =</span> ssu_title)</span>
<span id="cb16-1019"><a href="#cb16-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1020"><a href="#cb16-1020" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(ssu_plt_info))) {</span>
<span id="cb16-1021"><a href="#cb16-1021" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"plot_"</span>, i, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1022"><a href="#cb16-1022" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(ssu_plt_info[i, <span class="dv">1</span>], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))) <span class="sc">+</span> </span>
<span id="cb16-1023"><a href="#cb16-1023" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(ssu_plt_info[i, <span class="dv">2</span>])</span>
<span id="cb16-1024"><a href="#cb16-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb16-1025"><a href="#cb16-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-1026"><a href="#cb16-1026" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-1027"><a href="#cb16-1027" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1028"><a href="#cb16-1028" aria-hidden="true" tabindex="-1"></a>ssu_taxa_combo_plot <span class="ot">&lt;-</span> ((plot_1 <span class="sc">+</span> plot_2 <span class="sc">+</span> plot_3) <span class="sc">/</span> (plot_4 <span class="sc">+</span> plot_5 <span class="sc">+</span> plot_6) <span class="sc">/</span> (plot_7 <span class="sc">+</span> plot_8 <span class="sc">+</span> plot_9) <span class="sc">/</span> (plot_10 <span class="sc">+</span> plot_11 <span class="sc">+</span> plot_12))</span>
<span id="cb16-1029"><a href="#cb16-1029" aria-hidden="true" tabindex="-1"></a>ssu_taxa_combo_plot</span>
<span id="cb16-1030"><a href="#cb16-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1031"><a href="#cb16-1031" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(ssu_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, </span>
<span id="cb16-1032"><a href="#cb16-1032" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Extended_Data_Figure_3.png"</span>, </span>
<span id="cb16-1033"><a href="#cb16-1033" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb16-1034"><a href="#cb16-1034" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-1035"><a href="#cb16-1035" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-1036"><a href="#cb16-1036" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(ssu_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, </span>
<span id="cb16-1037"><a href="#cb16-1037" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_3.pdf"</span>, </span>
<span id="cb16-1038"><a href="#cb16-1038" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb16-1039"><a href="#cb16-1039" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-1040"><a href="#cb16-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1041"><a href="#cb16-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-1042"><a href="#cb16-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1043"><a href="#cb16-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 4</span></span>
<span id="cb16-1044"><a href="#cb16-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1045"><a href="#cb16-1045" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-1046"><a href="#cb16-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1047"><a href="#cb16-1047" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-1048"><a href="#cb16-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1049"><a href="#cb16-1049" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include axes renaming, removing non-significant (NS) values from plots,  changing significant p-values to asterisks (<span class="in">`*`</span>), removing gridlines, and enlarging outlier points. </span>
<span id="cb16-1050"><a href="#cb16-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1051"><a href="#cb16-1051" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1052"><a href="#cb16-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1053"><a href="#cb16-1053" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-1054"><a href="#cb16-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1055"><a href="#cb16-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-1056"><a href="#cb16-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1057"><a href="#cb16-1057" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/ext/Extended_Data_Figure_4.png)</span></span>
<span id="cb16-1058"><a href="#cb16-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1059"><a href="#cb16-1059" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-1060"><a href="#cb16-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1061"><a href="#cb16-1061" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_4.png)</span></span>
<span id="cb16-1062"><a href="#cb16-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1063"><a href="#cb16-1063" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1064"><a href="#cb16-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1065"><a href="#cb16-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1066"><a href="#cb16-1066" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-1067"><a href="#cb16-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1068"><a href="#cb16-1068" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-1069"><a href="#cb16-1069" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/its18_ps_perfect_rf_all.rds)</span>  </span>
<span id="cb16-1070"><a href="#cb16-1070" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1071"><a href="#cb16-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1072"><a href="#cb16-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1073"><a href="#cb16-1073" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-1074"><a href="#cb16-1074" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Extended_Data_Figure_4.pdf)</span></span>
<span id="cb16-1075"><a href="#cb16-1075" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1076"><a href="#cb16-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1077"><a href="#cb16-1077" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1078"><a href="#cb16-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1081"><a href="#cb16-1081" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-1082"><a href="#cb16-1082" aria-hidden="true" tabindex="-1"></a><span class="do">## In this section of the workflow we use the </span></span>
<span id="cb16-1083"><a href="#cb16-1083" aria-hidden="true" tabindex="-1"></a><span class="do">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span></span>
<span id="cb16-1084"><a href="#cb16-1084" aria-hidden="true" tabindex="-1"></a><span class="do">## to assess the response of taxonomic lineages to soil warming. </span></span>
<span id="cb16-1085"><a href="#cb16-1085" aria-hidden="true" tabindex="-1"></a><span class="do">## In the first step we need to fix the selected data set to make it </span></span>
<span id="cb16-1086"><a href="#cb16-1086" aria-hidden="true" tabindex="-1"></a><span class="do">## compatible with the various functions. For this analysis we use the </span></span>
<span id="cb16-1087"><a href="#cb16-1087" aria-hidden="true" tabindex="-1"></a><span class="do">## PERfect filtered data set.</span></span>
<span id="cb16-1088"><a href="#cb16-1088" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-1089"><a href="#cb16-1089" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_rf_all <span class="ot">&lt;-</span></span>
<span id="cb16-1090"><a href="#cb16-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="st">"include/pub/ext/its18_ps_perfect_rf_all.rds"</span>)</span>
<span id="cb16-1091"><a href="#cb16-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1092"><a href="#cb16-1092" aria-hidden="true" tabindex="-1"></a><span class="do">## FIX ps object</span></span>
<span id="cb16-1093"><a href="#cb16-1093" aria-hidden="true" tabindex="-1"></a>its_ps <span class="ot">&lt;-</span> its18_ps_perfect_rf_all</span>
<span id="cb16-1094"><a href="#cb16-1094" aria-hidden="true" tabindex="-1"></a>tmp_tax1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(its_ps))</span>
<span id="cb16-1095"><a href="#cb16-1095" aria-hidden="true" tabindex="-1"></a>tmp_tax1<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1096"><a href="#cb16-1096" aria-hidden="true" tabindex="-1"></a>tmp_rn <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp_tax1)</span>
<span id="cb16-1097"><a href="#cb16-1097" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span></span>
<span id="cb16-1098"><a href="#cb16-1098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">lapply</span>(tmp_tax1, <span class="cf">function</span>(x) {</span>
<span id="cb16-1099"><a href="#cb16-1099" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(|)"</span>, <span class="st">""</span>, x)</span>
<span id="cb16-1100"><a href="#cb16-1100" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb16-1101"><a href="#cb16-1101" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(tmp_tax) <span class="ot">&lt;-</span> tmp_rn</span>
<span id="cb16-1102"><a href="#cb16-1102" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">row.names</span>(tmp_tax), <span class="fu">row.names</span>(tmp_tax1))</span>
<span id="cb16-1103"><a href="#cb16-1103" aria-hidden="true" tabindex="-1"></a>ps_tax_new <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax)</span>
<span id="cb16-1104"><a href="#cb16-1104" aria-hidden="true" tabindex="-1"></a>tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(its_ps),</span>
<span id="cb16-1105"><a href="#cb16-1105" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">tax_table</span>(ps_tax_new),</span>
<span id="cb16-1106"><a href="#cb16-1106" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample_data</span>(its_ps))</span>
<span id="cb16-1107"><a href="#cb16-1107" aria-hidden="true" tabindex="-1"></a>its_ps <span class="ot">&lt;-</span> tmp_ps</span>
<span id="cb16-1108"><a href="#cb16-1108" aria-hidden="true" tabindex="-1"></a>phyloseq<span class="sc">::</span><span class="fu">rank_names</span>(its_ps)</span>
<span id="cb16-1109"><a href="#cb16-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1110"><a href="#cb16-1110" aria-hidden="true" tabindex="-1"></a><span class="do">## Next we run a statistical test for multiple groups</span></span>
<span id="cb16-1111"><a href="#cb16-1111" aria-hidden="true" tabindex="-1"></a><span class="do">## using the `run_test_multiple_groups` function.</span></span>
<span id="cb16-1112"><a href="#cb16-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1113"><a href="#cb16-1113" aria-hidden="true" tabindex="-1"></a>its_group_anova <span class="ot">&lt;-</span></span>
<span id="cb16-1114"><a href="#cb16-1114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_test_multiple_groups</span>(its_ps,</span>
<span id="cb16-1115"><a href="#cb16-1115" aria-hidden="true" tabindex="-1"></a>                           <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb16-1116"><a href="#cb16-1116" aria-hidden="true" tabindex="-1"></a>                           <span class="at">taxa_rank =</span> <span class="st">"all"</span>,</span>
<span id="cb16-1117"><a href="#cb16-1117" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb16-1118"><a href="#cb16-1118" aria-hidden="true" tabindex="-1"></a>its_group_anova<span class="sc">@</span>marker_table</span>
<span id="cb16-1119"><a href="#cb16-1119" aria-hidden="true" tabindex="-1"></a><span class="fu">marker_table</span>(its_group_anova)</span>
<span id="cb16-1120"><a href="#cb16-1120" aria-hidden="true" tabindex="-1"></a><span class="do">## And then conduct post hoc pairwise comparisons for multiple</span></span>
<span id="cb16-1121"><a href="#cb16-1121" aria-hidden="true" tabindex="-1"></a><span class="do">## groups test using the `run_posthoc_test` function.</span></span>
<span id="cb16-1122"><a href="#cb16-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1123"><a href="#cb16-1123" aria-hidden="true" tabindex="-1"></a>its_default_pht <span class="ot">&lt;-</span> <span class="fu">run_posthoc_test</span>(its_ps,</span>
<span id="cb16-1124"><a href="#cb16-1124" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb16-1125"><a href="#cb16-1125" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">method =</span> <span class="st">"tukey"</span>,</span>
<span id="cb16-1126"><a href="#cb16-1126" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">transform =</span> <span class="st">"log10"</span>)</span>
<span id="cb16-1127"><a href="#cb16-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1128"><a href="#cb16-1128" aria-hidden="true" tabindex="-1"></a><span class="do">## But what we really want to do is get all of the markers that are</span></span>
<span id="cb16-1129"><a href="#cb16-1129" aria-hidden="true" tabindex="-1"></a><span class="do">## significant from the analysis, excluding any significant ASVs so we can</span></span>
<span id="cb16-1130"><a href="#cb16-1130" aria-hidden="true" tabindex="-1"></a><span class="do">## look at high taxa ranks.</span></span>
<span id="cb16-1131"><a href="#cb16-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1132"><a href="#cb16-1132" aria-hidden="true" tabindex="-1"></a>its_pht <span class="ot">&lt;-</span> its_default_pht</span>
<span id="cb16-1133"><a href="#cb16-1133" aria-hidden="true" tabindex="-1"></a>its18_pht_filt <span class="ot">&lt;-</span> <span class="fu">filter</span>(<span class="fu">data.frame</span>(its_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"ASV"</span>, <span class="fu">filter</span>(<span class="fu">data.frame</span>(its_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)<span class="sc">$</span>group_name),]</span>
<span id="cb16-1134"><a href="#cb16-1134" aria-hidden="true" tabindex="-1"></a>its18_pht_filt <span class="ot">&lt;-</span> its18_pht_filt[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[a-z]__$"</span>, its18_pht_filt<span class="sc">$</span>group_name),]</span>
<span id="cb16-1135"><a href="#cb16-1135" aria-hidden="true" tabindex="-1"></a>its18_pht_filt <span class="ot">&lt;-</span> <span class="fu">unique</span>(its18_pht_filt<span class="sc">$</span>group_name)</span>
<span id="cb16-1136"><a href="#cb16-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1137"><a href="#cb16-1137" aria-hidden="true" tabindex="-1"></a>plot_postHocTest_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (pht, feature, <span class="at">step_increase =</span> <span class="fl">0.12</span>) </span>
<span id="cb16-1138"><a href="#cb16-1138" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-1139"><a href="#cb16-1139" aria-hidden="true" tabindex="-1"></a>    abd_long <span class="ot">&lt;-</span> pht<span class="sc">@</span>abundance <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>.data<span class="sc">$</span>group, </span>
<span id="cb16-1140"><a href="#cb16-1140" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"feat"</span>)</span>
<span id="cb16-1141"><a href="#cb16-1141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(feature)) {</span>
<span id="cb16-1142"><a href="#cb16-1142" aria-hidden="true" tabindex="-1"></a>        abd_long <span class="ot">&lt;-</span> <span class="fu">filter</span>(abd_long, .data<span class="sc">$</span>feat <span class="sc">%in%</span> feature)</span>
<span id="cb16-1143"><a href="#cb16-1143" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-1144"><a href="#cb16-1144" aria-hidden="true" tabindex="-1"></a>    annotation <span class="ot">&lt;-</span> <span class="fu">get_sig_annotation</span>(pht, <span class="at">step_increase =</span> step_increase)</span>
<span id="cb16-1145"><a href="#cb16-1145" aria-hidden="true" tabindex="-1"></a>    p_box <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">ggplot</span>(abd_long, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>group, </span>
<span id="cb16-1146"><a href="#cb16-1146" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> .data<span class="sc">$</span>value)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> ggsignif<span class="sc">::</span><span class="fu">geom_signif</span>(<span class="at">data =</span> annotation[annotation<span class="sc">$</span>feature <span class="sc">%in%</span> </span>
<span id="cb16-1147"><a href="#cb16-1147" aria-hidden="true" tabindex="-1"></a>        feature, ], <span class="fu">aes</span>(<span class="at">xmin =</span> .data<span class="sc">$</span>xmin, <span class="at">xmax =</span> .data<span class="sc">$</span>xmax, </span>
<span id="cb16-1148"><a href="#cb16-1148" aria-hidden="true" tabindex="-1"></a>        <span class="at">annotations =</span> .data<span class="sc">$</span>annotation, <span class="at">y_position =</span> .data<span class="sc">$</span>y_position), </span>
<span id="cb16-1149"><a href="#cb16-1149" aria-hidden="true" tabindex="-1"></a>        <span class="at">manual =</span> <span class="cn">TRUE</span>, <span class="at">textsize =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb16-1150"><a href="#cb16-1150" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Abundance"</span>))</span>
<span id="cb16-1151"><a href="#cb16-1151" aria-hidden="true" tabindex="-1"></a>    test_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pht<span class="sc">@</span>result[[feature]])</span>
<span id="cb16-1152"><a href="#cb16-1152" aria-hidden="true" tabindex="-1"></a>    p_test <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(test_res, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>comparions)) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .data<span class="sc">$</span>ci_lower, </span>
<span id="cb16-1153"><a href="#cb16-1153" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymax =</span> .data<span class="sc">$</span>ci_upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .data<span class="sc">$</span>diff_mean)) <span class="sc">+</span> </span>
<span id="cb16-1154"><a href="#cb16-1154" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"95% confidence intervals"</span>)</span>
<span id="cb16-1155"><a href="#cb16-1155" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(p_box)</span>
<span id="cb16-1156"><a href="#cb16-1156" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-1157"><a href="#cb16-1157" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(plot_postHocTest_jjs) <span class="ot">&lt;-</span> <span class="fu">asNamespace</span>(<span class="st">'microbiomeMarker'</span>)</span>
<span id="cb16-1158"><a href="#cb16-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1159"><a href="#cb16-1159" aria-hidden="true" tabindex="-1"></a>its_select <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-1160"><a href="#cb16-1160" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Xylariales|f__Microdochiaceae"</span>, </span>
<span id="cb16-1161"><a href="#cb16-1161" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Entolomataceae"</span>, </span>
<span id="cb16-1162"><a href="#cb16-1162" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Clavariaceae"</span>, </span>
<span id="cb16-1163"><a href="#cb16-1163" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales"</span>, </span>
<span id="cb16-1164"><a href="#cb16-1164" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Microbotryomycetes|o__Sporidiobolales"</span>, </span>
<span id="cb16-1165"><a href="#cb16-1165" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Rozellomycota|c__Rozellomycotina_cls_Incertae_sedis"</span>, </span>
<span id="cb16-1166"><a href="#cb16-1166" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Eurotiomycetes|o__Eurotiales|f__Trichocomaceae|g__Talaromyces"</span>, </span>
<span id="cb16-1167"><a href="#cb16-1167" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Pezizomycetes|o__Pezizales|f__Pyronemataceae"</span>, </span>
<span id="cb16-1168"><a href="#cb16-1168" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Hypocreales|f__Nectriaceae|g__Fusarium"</span>, </span>
<span id="cb16-1169"><a href="#cb16-1169" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Saccharomycetes|o__Saccharomycetales|f__Metschnikowiaceae"</span>, </span>
<span id="cb16-1170"><a href="#cb16-1170" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Glomeromycota|c__Glomeromycetes|o__Glomerales"</span>, </span>
<span id="cb16-1171"><a href="#cb16-1171" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Mortierellomycota|c__Mortierellomycetes|o__Mortierellales"</span></span>
<span id="cb16-1172"><a href="#cb16-1172" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-1173"><a href="#cb16-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1174"><a href="#cb16-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1175"><a href="#cb16-1175" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-1176"><a href="#cb16-1176" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its_select) {</span>
<span id="cb16-1177"><a href="#cb16-1177" aria-hidden="true" tabindex="-1"></a>  tmp_select_feat <span class="ot">&lt;-</span> i</span>
<span id="cb16-1178"><a href="#cb16-1178" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span>(its_pht, <span class="at">feature =</span> tmp_select_feat) <span class="sc">&amp;</span> <span class="fu">theme_bw</span>() </span>
<span id="cb16-1179"><a href="#cb16-1179" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> swel_col) <span class="sc">+</span> </span>
<span id="cb16-1180"><a href="#cb16-1180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb16-1181"><a href="#cb16-1181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb16-1182"><a href="#cb16-1182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative abundance (% total reads)"</span>)</span>
<span id="cb16-1183"><a href="#cb16-1183" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))</span>
<span id="cb16-1184"><a href="#cb16-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb16-1185"><a href="#cb16-1185" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".png", sep = ""), </span></span>
<span id="cb16-1186"><a href="#cb16-1186" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                height = 7, width = 9, units = 'cm', dpi = 600, bg = "white")</span></span>
<span id="cb16-1187"><a href="#cb16-1187" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot2::ggsave(tmp_plot, file = paste0("include/pub/ext/", i,".pdf", sep = ""), </span></span>
<span id="cb16-1188"><a href="#cb16-1188" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                height = 5, width = 6.5)</span></span>
<span id="cb16-1189"><a href="#cb16-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-1190"><a href="#cb16-1190" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb16-1191"><a href="#cb16-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1192"><a href="#cb16-1192" aria-hidden="true" tabindex="-1"></a>its_title <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-1193"><a href="#cb16-1193" aria-hidden="true" tabindex="-1"></a><span class="st">"Microdochiaceae (Ascomycota)"</span>, </span>
<span id="cb16-1194"><a href="#cb16-1194" aria-hidden="true" tabindex="-1"></a><span class="st">"Entolomataceae (Basidiomycota)"</span>, </span>
<span id="cb16-1195"><a href="#cb16-1195" aria-hidden="true" tabindex="-1"></a><span class="st">"Clavariaceae (Basidiomycota)"</span>, </span>
<span id="cb16-1196"><a href="#cb16-1196" aria-hidden="true" tabindex="-1"></a><span class="st">"Agaricales (Basidiomycota)"</span>, </span>
<span id="cb16-1197"><a href="#cb16-1197" aria-hidden="true" tabindex="-1"></a><span class="st">"Sporidiobolales (Basidiomycota)"</span>, </span>
<span id="cb16-1198"><a href="#cb16-1198" aria-hidden="true" tabindex="-1"></a><span class="st">"Rozellomycotina (Rozellomycota)"</span>, </span>
<span id="cb16-1199"><a href="#cb16-1199" aria-hidden="true" tabindex="-1"></a><span class="st">"Talaromyces (Ascomycota)"</span>, </span>
<span id="cb16-1200"><a href="#cb16-1200" aria-hidden="true" tabindex="-1"></a><span class="st">"Pyronemataceae (Ascomycota)"</span>, </span>
<span id="cb16-1201"><a href="#cb16-1201" aria-hidden="true" tabindex="-1"></a><span class="st">"Fusarium (Ascomycota)"</span>, </span>
<span id="cb16-1202"><a href="#cb16-1202" aria-hidden="true" tabindex="-1"></a><span class="st">"Metschnikowiaceae (Ascomycota)"</span>, </span>
<span id="cb16-1203"><a href="#cb16-1203" aria-hidden="true" tabindex="-1"></a><span class="st">"Glomerales (Glomeromycota)"</span>, </span>
<span id="cb16-1204"><a href="#cb16-1204" aria-hidden="true" tabindex="-1"></a><span class="st">"Mortierellales (Mortierellomycota)"</span></span>
<span id="cb16-1205"><a href="#cb16-1205" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-1206"><a href="#cb16-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1207"><a href="#cb16-1207" aria-hidden="true" tabindex="-1"></a>its_plt_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lineage =</span> its_select, <span class="at">label =</span> its_title)</span>
<span id="cb16-1208"><a href="#cb16-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1209"><a href="#cb16-1209" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(its_plt_info))) {</span>
<span id="cb16-1210"><a href="#cb16-1210" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"plot_"</span>, i, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1211"><a href="#cb16-1211" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(its_plt_info[i, <span class="dv">1</span>], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))) <span class="sc">+</span> </span>
<span id="cb16-1212"><a href="#cb16-1212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(its_plt_info[i, <span class="dv">2</span>])</span>
<span id="cb16-1213"><a href="#cb16-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb16-1214"><a href="#cb16-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-1215"><a href="#cb16-1215" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-1216"><a href="#cb16-1216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1217"><a href="#cb16-1217" aria-hidden="true" tabindex="-1"></a>its_taxa_combo_plot <span class="ot">&lt;-</span> ((plot_1 <span class="sc">+</span> plot_2 <span class="sc">+</span> plot_3) <span class="sc">/</span> (plot_4 <span class="sc">+</span> plot_5 <span class="sc">+</span> plot_6) <span class="sc">/</span> (plot_7 <span class="sc">+</span> plot_8 <span class="sc">+</span> plot_9) <span class="sc">/</span> (plot_10 <span class="sc">+</span> plot_11 <span class="sc">+</span> plot_12))</span>
<span id="cb16-1218"><a href="#cb16-1218" aria-hidden="true" tabindex="-1"></a>its_taxa_combo_plot</span>
<span id="cb16-1219"><a href="#cb16-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1220"><a href="#cb16-1220" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(its_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, </span>
<span id="cb16-1221"><a href="#cb16-1221" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Extended_Data_Figure_4.png"</span>, </span>
<span id="cb16-1222"><a href="#cb16-1222" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb16-1223"><a href="#cb16-1223" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-1224"><a href="#cb16-1224" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-1225"><a href="#cb16-1225" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(its_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, </span>
<span id="cb16-1226"><a href="#cb16-1226" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_4.pdf"</span>, </span>
<span id="cb16-1227"><a href="#cb16-1227" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb16-1228"><a href="#cb16-1228" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-1229"><a href="#cb16-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1230"><a href="#cb16-1230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-1231"><a href="#cb16-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1232"><a href="#cb16-1232" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 5</span></span>
<span id="cb16-1233"><a href="#cb16-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1234"><a href="#cb16-1234" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-1235"><a href="#cb16-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1236"><a href="#cb16-1236" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-1237"><a href="#cb16-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1238"><a href="#cb16-1238" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include repositioning vector overlay labels, styling legend, and changing font size and style. </span>
<span id="cb16-1239"><a href="#cb16-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1240"><a href="#cb16-1240" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1241"><a href="#cb16-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1242"><a href="#cb16-1242" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-1243"><a href="#cb16-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1244"><a href="#cb16-1244" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-1245"><a href="#cb16-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1246"><a href="#cb16-1246" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/ext/Extended_Data_Figure_5.png)</span></span>
<span id="cb16-1247"><a href="#cb16-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1248"><a href="#cb16-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-1249"><a href="#cb16-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1250"><a href="#cb16-1250" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_5.png)</span></span>
<span id="cb16-1251"><a href="#cb16-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1252"><a href="#cb16-1252" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1253"><a href="#cb16-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1254"><a href="#cb16-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1255"><a href="#cb16-1255" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-1256"><a href="#cb16-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1257"><a href="#cb16-1257" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-1258"><a href="#cb16-1258" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/extended_data_fig_5.rdata)</span>  </span>
<span id="cb16-1259"><a href="#cb16-1259" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1260"><a href="#cb16-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1261"><a href="#cb16-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1262"><a href="#cb16-1262" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-1263"><a href="#cb16-1263" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Extended_Data_Figure_5.pdf)</span></span>
<span id="cb16-1264"><a href="#cb16-1264" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1265"><a href="#cb16-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1266"><a href="#cb16-1266" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-1267"><a href="#cb16-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1270"><a href="#cb16-1270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-1271"><a href="#cb16-1271" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-1272"><a href="#cb16-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/ext/extended_data_fig_5.rdata"</span>)</span>
<span id="cb16-1273"><a href="#cb16-1273" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Run `rankindex` to compare metadata and community dissimilarity indices </span></span>
<span id="cb16-1274"><a href="#cb16-1274" aria-hidden="true" tabindex="-1"></a><span class="do">## for gradient detection. This will help us select the best dissimilarity </span></span>
<span id="cb16-1275"><a href="#cb16-1275" aria-hidden="true" tabindex="-1"></a><span class="do">## metric to use.</span></span>
<span id="cb16-1276"><a href="#cb16-1276" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Run `capscale` for distance-based redundancy analysis.</span></span>
<span id="cb16-1277"><a href="#cb16-1277" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Run `envfit` to fit environmental parameters onto the ordination. </span></span>
<span id="cb16-1278"><a href="#cb16-1278" aria-hidden="true" tabindex="-1"></a><span class="do">## This function basically calculates correlation scores between the metadata </span></span>
<span id="cb16-1279"><a href="#cb16-1279" aria-hidden="true" tabindex="-1"></a><span class="do">## parameters and the ordination axes. </span></span>
<span id="cb16-1280"><a href="#cb16-1280" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Select metadata parameters significant for `bioenv` (see above) </span></span>
<span id="cb16-1281"><a href="#cb16-1281" aria-hidden="true" tabindex="-1"></a><span class="do">## and/or `envfit` analyses.</span></span>
<span id="cb16-1282"><a href="#cb16-1282" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Run `envfit` on ASVs.</span></span>
<span id="cb16-1283"><a href="#cb16-1283" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) Plot the ordination and vector overlays. </span></span>
<span id="cb16-1284"><a href="#cb16-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1285"><a href="#cb16-1285" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1286"><a href="#cb16-1286" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1287"><a href="#cb16-1287" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA EDAPHIC PROPERTIES #####</span></span>
<span id="cb16-1288"><a href="#cb16-1288" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1289"><a href="#cb16-1289" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1290"><a href="#cb16-1290" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>edaphic</span>
<span id="cb16-1291"><a href="#cb16-1291" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb16-1292"><a href="#cb16-1292" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb16-1293"><a href="#cb16-1293" aria-hidden="true" tabindex="-1"></a>edaphic_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb16-1294"><a href="#cb16-1294" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb16-1295"><a href="#cb16-1295" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb16-1296"><a href="#cb16-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1297"><a href="#cb16-1297" aria-hidden="true" tabindex="-1"></a><span class="do">## Run `capscale` using Bray-Curtis. </span></span>
<span id="cb16-1298"><a href="#cb16-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1299"><a href="#cb16-1299" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN</span></span>
<span id="cb16-1300"><a href="#cb16-1300" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: TEB, DON, Na, Al, Ca</span></span>
<span id="cb16-1301"><a href="#cb16-1301" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 total, only works with 13</span></span>
<span id="cb16-1302"><a href="#cb16-1302" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: Mg, Mn</span></span>
<span id="cb16-1303"><a href="#cb16-1303" aria-hidden="true" tabindex="-1"></a>edaphic_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span> AST <span class="sc">+</span> H2O <span class="sc">+</span> N <span class="sc">+</span> P <span class="sc">+</span> Fe <span class="sc">+</span> K <span class="sc">+</span> ECEC <span class="sc">+</span> </span>
<span id="cb16-1304"><a href="#cb16-1304" aria-hidden="true" tabindex="-1"></a>                                   pH <span class="sc">+</span> NH4 <span class="sc">+</span> NO3 <span class="sc">+</span> PO4 <span class="sc">+</span> DOC <span class="sc">+</span> DOCN, </span>
<span id="cb16-1305"><a href="#cb16-1305" aria-hidden="true" tabindex="-1"></a>                        tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb16-1306"><a href="#cb16-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1307"><a href="#cb16-1307" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb16-1308"><a href="#cb16-1308" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb16-1309"><a href="#cb16-1309" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb16-1310"><a href="#cb16-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1311"><a href="#cb16-1311" aria-hidden="true" tabindex="-1"></a><span class="do">## Next, we need to grab capscale scores for the samples and create a </span></span>
<span id="cb16-1312"><a href="#cb16-1312" aria-hidden="true" tabindex="-1"></a><span class="do">## data frame of the first two dimensions. We will also need to add some </span></span>
<span id="cb16-1313"><a href="#cb16-1313" aria-hidden="true" tabindex="-1"></a><span class="do">## of the sample details to the data frame. For this we use the vegan </span></span>
<span id="cb16-1314"><a href="#cb16-1314" aria-hidden="true" tabindex="-1"></a><span class="do">## function `scores` which gets species or site scores from the ordination.</span></span>
<span id="cb16-1315"><a href="#cb16-1315" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggvegan)</span>
<span id="cb16-1316"><a href="#cb16-1316" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(edaphic_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-1317"><a href="#cb16-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1318"><a href="#cb16-1318" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb16-1319"><a href="#cb16-1319" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1320"><a href="#cb16-1320" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb16-1321"><a href="#cb16-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1322"><a href="#cb16-1322" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb16-1323"><a href="#cb16-1323" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb16-1324"><a href="#cb16-1324" aria-hidden="true" tabindex="-1"></a>edaphic_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb16-1325"><a href="#cb16-1325" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we have a new data frame that contains sample details and capscale values. </span></span>
<span id="cb16-1326"><a href="#cb16-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1327"><a href="#cb16-1327" aria-hidden="true" tabindex="-1"></a><span class="do">## We can then do the same with the metadata vectors. </span></span>
<span id="cb16-1328"><a href="#cb16-1328" aria-hidden="true" tabindex="-1"></a><span class="do">## Here though we only need the scores and parameter name. </span></span>
<span id="cb16-1329"><a href="#cb16-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1330"><a href="#cb16-1330" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb16-1331"><a href="#cb16-1331" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1332"><a href="#cb16-1332" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> edaphic_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1333"><a href="#cb16-1333" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb16-1334"><a href="#cb16-1334" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1335"><a href="#cb16-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1336"><a href="#cb16-1336" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run some quick correlations of metadata with ordination axes to </span></span>
<span id="cb16-1337"><a href="#cb16-1337" aria-hidden="true" tabindex="-1"></a><span class="do">## see which parameters are significant. For this we use the vegan function `envfit`.</span></span>
<span id="cb16-1338"><a href="#cb16-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1339"><a href="#cb16-1339" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> edaphic_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb16-1340"><a href="#cb16-1340" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb16-1341"><a href="#cb16-1341" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> edaphic_md_scores<span class="sc">$</span>parameters</span>
<span id="cb16-1342"><a href="#cb16-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1343"><a href="#cb16-1343" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb16-1344"><a href="#cb16-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1345"><a href="#cb16-1345" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb16-1346"><a href="#cb16-1346" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1347"><a href="#cb16-1347" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1348"><a href="#cb16-1348" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1349"><a href="#cb16-1349" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb16-1350"><a href="#cb16-1350" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_md_signif_hits)</span>
<span id="cb16-1351"><a href="#cb16-1351" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_md_signif_hits)</span>
<span id="cb16-1352"><a href="#cb16-1352" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_md_signif_hits,]</span>
<span id="cb16-1353"><a href="#cb16-1353" aria-hidden="true" tabindex="-1"></a><span class="do">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span></span>
<span id="cb16-1354"><a href="#cb16-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1355"><a href="#cb16-1355" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb16-1356"><a href="#cb16-1356" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel))</span>
<span id="cb16-1357"><a href="#cb16-1357" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1358"><a href="#cb16-1358" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1359"><a href="#cb16-1359" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb16-1360"><a href="#cb16-1360" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1361"><a href="#cb16-1361" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1362"><a href="#cb16-1362" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1363"><a href="#cb16-1363" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb16-1364"><a href="#cb16-1364" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel)), </span>
<span id="cb16-1365"><a href="#cb16-1365" aria-hidden="true" tabindex="-1"></a>                       edaphic_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb16-1366"><a href="#cb16-1366" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1367"><a href="#cb16-1367" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1368"><a href="#cb16-1368" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb16-1369"><a href="#cb16-1369" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1370"><a href="#cb16-1370" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb16-1371"><a href="#cb16-1371" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1372"><a href="#cb16-1372" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1373"><a href="#cb16-1373" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb16-1374"><a href="#cb16-1374" aria-hidden="true" tabindex="-1"></a>edaphic_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1375"><a href="#cb16-1375" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb16-1376"><a href="#cb16-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1377"><a href="#cb16-1377" aria-hidden="true" tabindex="-1"></a>new_edaphic_md_signif_hits <span class="ot">&lt;-</span> edaphic_sig_diff</span>
<span id="cb16-1378"><a href="#cb16-1378" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> new_edaphic_md_signif_hits,]</span>
<span id="cb16-1379"><a href="#cb16-1379" aria-hidden="true" tabindex="-1"></a><span class="do">## Check. Next, we run `envfit` for the ASVs.</span></span>
<span id="cb16-1380"><a href="#cb16-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1381"><a href="#cb16-1381" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb16-1382"><a href="#cb16-1382" aria-hidden="true" tabindex="-1"></a>                             tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb16-1383"><a href="#cb16-1383" aria-hidden="true" tabindex="-1"></a>                             <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1384"><a href="#cb16-1384" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb16-1385"><a href="#cb16-1385" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> edaphic_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1386"><a href="#cb16-1386" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb16-1387"><a href="#cb16-1387" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1388"><a href="#cb16-1388" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1389"><a href="#cb16-1389" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1390"><a href="#cb16-1390" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1391"><a href="#cb16-1391" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb16-1392"><a href="#cb16-1392" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_asv_signif_hits)</span>
<span id="cb16-1393"><a href="#cb16-1393" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_asv_signif_hits)</span>
<span id="cb16-1394"><a href="#cb16-1394" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif <span class="ot">&lt;-</span> edaphic_asv_scores[edaphic_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_asv_signif_hits,]</span>
<span id="cb16-1395"><a href="#cb16-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1396"><a href="#cb16-1396" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb16-1397"><a href="#cb16-1397" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-1398"><a href="#cb16-1398" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(edaphic_md_signif_all, edaphic_asv_signif)</span>
<span id="cb16-1399"><a href="#cb16-1399" aria-hidden="true" tabindex="-1"></a><span class="do">## The last thing to do is categorize parameters scores and ASV </span></span>
<span id="cb16-1400"><a href="#cb16-1400" aria-hidden="true" tabindex="-1"></a><span class="do">## scores into different variable types for plotting.</span></span>
<span id="cb16-1401"><a href="#cb16-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1402"><a href="#cb16-1402" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb16-1403"><a href="#cb16-1403" aria-hidden="true" tabindex="-1"></a>                                  edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb16-1404"><a href="#cb16-1404" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb16-1405"><a href="#cb16-1405" aria-hidden="true" tabindex="-1"></a>                                   edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb16-1406"><a href="#cb16-1406" aria-hidden="true" tabindex="-1"></a><span class="do">##  code for the plot</span></span>
<span id="cb16-1407"><a href="#cb16-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1408"><a href="#cb16-1408" aria-hidden="true" tabindex="-1"></a>edaphic_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb16-1409"><a href="#cb16-1409" aria-hidden="true" tabindex="-1"></a>edaphic_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1410"><a href="#cb16-1410" aria-hidden="true" tabindex="-1"></a>edaphic_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1411"><a href="#cb16-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1412"><a href="#cb16-1412" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, edaphic_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1413"><a href="#cb16-1413" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, edaphic_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1414"><a href="#cb16-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1415"><a href="#cb16-1415" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-1416"><a href="#cb16-1416" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(edaphic_plot_data) <span class="sc">+</span></span>
<span id="cb16-1417"><a href="#cb16-1417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb16-1418"><a href="#cb16-1418" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb16-1419"><a href="#cb16-1419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb16-1420"><a href="#cb16-1420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb16-1421"><a href="#cb16-1421" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> edaphic_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb16-1422"><a href="#cb16-1422" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb16-1423"><a href="#cb16-1423" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-1424"><a href="#cb16-1424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> edaphic_bioplot_data_md, </span>
<span id="cb16-1425"><a href="#cb16-1425" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>, </span>
<span id="cb16-1426"><a href="#cb16-1426" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb16-1427"><a href="#cb16-1427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb16-1428"><a href="#cb16-1428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Edaphic properties"</span>, </span>
<span id="cb16-1429"><a href="#cb16-1429" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> cpa1_lab, </span>
<span id="cb16-1430"><a href="#cb16-1430" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb16-1431"><a href="#cb16-1431" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> edaphic_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb16-1432"><a href="#cb16-1432" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-1433"><a href="#cb16-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1434"><a href="#cb16-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1435"><a href="#cb16-1435" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1436"><a href="#cb16-1436" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1437"><a href="#cb16-1437" aria-hidden="true" tabindex="-1"></a><span class="co"># 16S rRNA Soil Functional Response #</span></span>
<span id="cb16-1438"><a href="#cb16-1438" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1439"><a href="#cb16-1439" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1440"><a href="#cb16-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1441"><a href="#cb16-1441" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>soil_funct</span>
<span id="cb16-1442"><a href="#cb16-1442" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb16-1443"><a href="#cb16-1443" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb16-1444"><a href="#cb16-1444" aria-hidden="true" tabindex="-1"></a>soil_funct_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb16-1445"><a href="#cb16-1445" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb16-1446"><a href="#cb16-1446" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb16-1447"><a href="#cb16-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1448"><a href="#cb16-1448" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb16-1449"><a href="#cb16-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1450"><a href="#cb16-1450" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span></span>
<span id="cb16-1451"><a href="#cb16-1451" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span></span>
<span id="cb16-1452"><a href="#cb16-1452" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: NONE</span></span>
<span id="cb16-1453"><a href="#cb16-1453" aria-hidden="true" tabindex="-1"></a>soil_funct_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span> micC <span class="sc">+</span> micP <span class="sc">+</span> micCN <span class="sc">+</span> micCP <span class="sc">+</span> AG_ase <span class="sc">+</span> BG_ase <span class="sc">+</span> </span>
<span id="cb16-1454"><a href="#cb16-1454" aria-hidden="true" tabindex="-1"></a>                                      S_ase <span class="sc">+</span> XY_ase <span class="sc">+</span> PX_ase <span class="sc">+</span> CO2 <span class="sc">+</span> enzNP, </span>
<span id="cb16-1455"><a href="#cb16-1455" aria-hidden="true" tabindex="-1"></a>                           tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb16-1456"><a href="#cb16-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1457"><a href="#cb16-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1458"><a href="#cb16-1458" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(soil_funct_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-1459"><a href="#cb16-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1460"><a href="#cb16-1460" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb16-1461"><a href="#cb16-1461" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb16-1462"><a href="#cb16-1462" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb16-1463"><a href="#cb16-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1464"><a href="#cb16-1464" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb16-1465"><a href="#cb16-1465" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1466"><a href="#cb16-1466" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb16-1467"><a href="#cb16-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1468"><a href="#cb16-1468" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb16-1469"><a href="#cb16-1469" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb16-1470"><a href="#cb16-1470" aria-hidden="true" tabindex="-1"></a>soil_funct_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb16-1471"><a href="#cb16-1471" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb16-1472"><a href="#cb16-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1473"><a href="#cb16-1473" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb16-1474"><a href="#cb16-1474" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1475"><a href="#cb16-1475" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> soil_funct_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1476"><a href="#cb16-1476" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb16-1477"><a href="#cb16-1477" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1478"><a href="#cb16-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1479"><a href="#cb16-1479" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> soil_funct_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb16-1480"><a href="#cb16-1480" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb16-1481"><a href="#cb16-1481" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> soil_funct_md_scores<span class="sc">$</span>parameters</span>
<span id="cb16-1482"><a href="#cb16-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1483"><a href="#cb16-1483" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb16-1484"><a href="#cb16-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1485"><a href="#cb16-1485" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb16-1486"><a href="#cb16-1486" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1487"><a href="#cb16-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1488"><a href="#cb16-1488" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1489"><a href="#cb16-1489" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1490"><a href="#cb16-1490" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb16-1491"><a href="#cb16-1491" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_md_signif_hits)</span>
<span id="cb16-1492"><a href="#cb16-1492" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_md_signif_hits)</span>
<span id="cb16-1493"><a href="#cb16-1493" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1494"><a href="#cb16-1494" aria-hidden="true" tabindex="-1"></a>                                               soil_funct_md_signif_hits,]</span>
<span id="cb16-1495"><a href="#cb16-1495" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1496"><a href="#cb16-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1497"><a href="#cb16-1497" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb16-1498"><a href="#cb16-1498" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel))</span>
<span id="cb16-1499"><a href="#cb16-1499" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1500"><a href="#cb16-1500" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1501"><a href="#cb16-1501" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb16-1502"><a href="#cb16-1502" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1503"><a href="#cb16-1503" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1504"><a href="#cb16-1504" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1505"><a href="#cb16-1505" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb16-1506"><a href="#cb16-1506" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel)), </span>
<span id="cb16-1507"><a href="#cb16-1507" aria-hidden="true" tabindex="-1"></a>                       soil_funct_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb16-1508"><a href="#cb16-1508" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1509"><a href="#cb16-1509" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1510"><a href="#cb16-1510" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb16-1511"><a href="#cb16-1511" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1512"><a href="#cb16-1512" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb16-1513"><a href="#cb16-1513" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1514"><a href="#cb16-1514" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1515"><a href="#cb16-1515" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb16-1516"><a href="#cb16-1516" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1517"><a href="#cb16-1517" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb16-1518"><a href="#cb16-1518" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff</span>
<span id="cb16-1519"><a href="#cb16-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1520"><a href="#cb16-1520" aria-hidden="true" tabindex="-1"></a>new_soil_funct_md_signif_hits <span class="ot">&lt;-</span> soil_funct_sig_diff</span>
<span id="cb16-1521"><a href="#cb16-1521" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1522"><a href="#cb16-1522" aria-hidden="true" tabindex="-1"></a>                                                   new_soil_funct_md_signif_hits,]</span>
<span id="cb16-1523"><a href="#cb16-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1524"><a href="#cb16-1524" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb16-1525"><a href="#cb16-1525" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], </span>
<span id="cb16-1526"><a href="#cb16-1526" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1527"><a href="#cb16-1527" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb16-1528"><a href="#cb16-1528" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> soil_funct_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1529"><a href="#cb16-1529" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb16-1530"><a href="#cb16-1530" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1531"><a href="#cb16-1531" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1532"><a href="#cb16-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1533"><a href="#cb16-1533" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1534"><a href="#cb16-1534" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1535"><a href="#cb16-1535" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb16-1536"><a href="#cb16-1536" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_asv_signif_hits)</span>
<span id="cb16-1537"><a href="#cb16-1537" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_asv_signif_hits)</span>
<span id="cb16-1538"><a href="#cb16-1538" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif <span class="ot">&lt;-</span> soil_funct_asv_scores[soil_funct_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1539"><a href="#cb16-1539" aria-hidden="true" tabindex="-1"></a>                                                 soil_funct_asv_signif_hits,]</span>
<span id="cb16-1540"><a href="#cb16-1540" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb16-1541"><a href="#cb16-1541" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-1542"><a href="#cb16-1542" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(soil_funct_md_signif_all, soil_funct_asv_signif)</span>
<span id="cb16-1543"><a href="#cb16-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1544"><a href="#cb16-1544" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb16-1545"><a href="#cb16-1545" aria-hidden="true" tabindex="-1"></a>                                  soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb16-1546"><a href="#cb16-1546" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb16-1547"><a href="#cb16-1547" aria-hidden="true" tabindex="-1"></a>                                   soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb16-1548"><a href="#cb16-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1549"><a href="#cb16-1549" aria-hidden="true" tabindex="-1"></a><span class="do">## PLOT Code</span></span>
<span id="cb16-1550"><a href="#cb16-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1551"><a href="#cb16-1551" aria-hidden="true" tabindex="-1"></a>soil_funct_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb16-1552"><a href="#cb16-1552" aria-hidden="true" tabindex="-1"></a>soil_funct_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1553"><a href="#cb16-1553" aria-hidden="true" tabindex="-1"></a>soil_funct_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1554"><a href="#cb16-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1555"><a href="#cb16-1555" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, soil_funct_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1556"><a href="#cb16-1556" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, soil_funct_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1557"><a href="#cb16-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1558"><a href="#cb16-1558" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-1559"><a href="#cb16-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1560"><a href="#cb16-1560" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(soil_funct_plot_data) <span class="sc">+</span></span>
<span id="cb16-1561"><a href="#cb16-1561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb16-1562"><a href="#cb16-1562" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb16-1563"><a href="#cb16-1563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb16-1564"><a href="#cb16-1564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb16-1565"><a href="#cb16-1565" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> soil_funct_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb16-1566"><a href="#cb16-1566" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb16-1567"><a href="#cb16-1567" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>) <span class="sc">+</span></span>
<span id="cb16-1568"><a href="#cb16-1568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> soil_funct_bioplot_data_md, </span>
<span id="cb16-1569"><a href="#cb16-1569" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb16-1570"><a href="#cb16-1570" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb16-1571"><a href="#cb16-1571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb16-1572"><a href="#cb16-1572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Functional Response"</span>, </span>
<span id="cb16-1573"><a href="#cb16-1573" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> cpa1_lab, </span>
<span id="cb16-1574"><a href="#cb16-1574" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb16-1575"><a href="#cb16-1575" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb16-1576"><a href="#cb16-1576" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-1577"><a href="#cb16-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1578"><a href="#cb16-1578" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1579"><a href="#cb16-1579" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1580"><a href="#cb16-1580" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA Temperature Adaptation #</span></span>
<span id="cb16-1581"><a href="#cb16-1581" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1582"><a href="#cb16-1582" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1583"><a href="#cb16-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1584"><a href="#cb16-1584" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb16-1585"><a href="#cb16-1585" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>temp_adapt</span>
<span id="cb16-1586"><a href="#cb16-1586" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb16-1587"><a href="#cb16-1587" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb16-1588"><a href="#cb16-1588" aria-hidden="true" tabindex="-1"></a>temp_adapt_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb16-1589"><a href="#cb16-1589" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb16-1590"><a href="#cb16-1590" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb16-1591"><a href="#cb16-1591" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb16-1592"><a href="#cb16-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1593"><a href="#cb16-1593" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span id="cb16-1594"><a href="#cb16-1594" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: NUE, PUE, SI</span></span>
<span id="cb16-1595"><a href="#cb16-1595" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: NONE</span></span>
<span id="cb16-1596"><a href="#cb16-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1597"><a href="#cb16-1597" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  AG_Q10 <span class="sc">+</span> BG_Q10 <span class="sc">+</span> BP_Q10 <span class="sc">+</span> CE_Q10 <span class="sc">+</span> </span>
<span id="cb16-1598"><a href="#cb16-1598" aria-hidden="true" tabindex="-1"></a>                                       P_Q10 <span class="sc">+</span> N_Q10 <span class="sc">+</span> S_Q10 <span class="sc">+</span> XY_Q10 <span class="sc">+</span> </span>
<span id="cb16-1599"><a href="#cb16-1599" aria-hidden="true" tabindex="-1"></a>                                       LP_Q10 <span class="sc">+</span> PX_Q10 <span class="sc">+</span> CUEcn <span class="sc">+</span> CUEcp <span class="sc">+</span> Tmin, </span>
<span id="cb16-1600"><a href="#cb16-1600" aria-hidden="true" tabindex="-1"></a>                             tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb16-1601"><a href="#cb16-1601" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(temp_adapt_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-1602"><a href="#cb16-1602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1603"><a href="#cb16-1603" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb16-1604"><a href="#cb16-1604" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb16-1605"><a href="#cb16-1605" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb16-1606"><a href="#cb16-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1607"><a href="#cb16-1607" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb16-1608"><a href="#cb16-1608" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1609"><a href="#cb16-1609" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb16-1610"><a href="#cb16-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1611"><a href="#cb16-1611" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb16-1612"><a href="#cb16-1612" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb16-1613"><a href="#cb16-1613" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb16-1614"><a href="#cb16-1614" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb16-1615"><a href="#cb16-1615" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb16-1616"><a href="#cb16-1616" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1617"><a href="#cb16-1617" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> temp_adapt_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1618"><a href="#cb16-1618" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb16-1619"><a href="#cb16-1619" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1620"><a href="#cb16-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1621"><a href="#cb16-1621" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> temp_adapt_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb16-1622"><a href="#cb16-1622" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb16-1623"><a href="#cb16-1623" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> temp_adapt_md_scores<span class="sc">$</span>parameters</span>
<span id="cb16-1624"><a href="#cb16-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1625"><a href="#cb16-1625" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb16-1626"><a href="#cb16-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1627"><a href="#cb16-1627" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb16-1628"><a href="#cb16-1628" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1629"><a href="#cb16-1629" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1630"><a href="#cb16-1630" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1631"><a href="#cb16-1631" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb16-1632"><a href="#cb16-1632" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_md_signif_hits)</span>
<span id="cb16-1633"><a href="#cb16-1633" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_md_signif_hits)</span>
<span id="cb16-1634"><a href="#cb16-1634" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1635"><a href="#cb16-1635" aria-hidden="true" tabindex="-1"></a>                                               temp_adapt_md_signif_hits,]</span>
<span id="cb16-1636"><a href="#cb16-1636" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb16-1637"><a href="#cb16-1637" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel))</span>
<span id="cb16-1638"><a href="#cb16-1638" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1639"><a href="#cb16-1639" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1640"><a href="#cb16-1640" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb16-1641"><a href="#cb16-1641" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1642"><a href="#cb16-1642" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1643"><a href="#cb16-1643" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1644"><a href="#cb16-1644" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb16-1645"><a href="#cb16-1645" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)), </span>
<span id="cb16-1646"><a href="#cb16-1646" aria-hidden="true" tabindex="-1"></a>                       temp_adapt_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb16-1647"><a href="#cb16-1647" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1648"><a href="#cb16-1648" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1649"><a href="#cb16-1649" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb16-1650"><a href="#cb16-1650" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1651"><a href="#cb16-1651" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb16-1652"><a href="#cb16-1652" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1653"><a href="#cb16-1653" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1654"><a href="#cb16-1654" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and  bioenv."</span>)</span>
<span id="cb16-1655"><a href="#cb16-1655" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1656"><a href="#cb16-1656" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb16-1657"><a href="#cb16-1657" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff</span>
<span id="cb16-1658"><a href="#cb16-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1659"><a href="#cb16-1659" aria-hidden="true" tabindex="-1"></a>new_temp_adapt_md_signif_hits <span class="ot">&lt;-</span> temp_adapt_sig_diff</span>
<span id="cb16-1660"><a href="#cb16-1660" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1661"><a href="#cb16-1661" aria-hidden="true" tabindex="-1"></a>                                                   new_temp_adapt_md_signif_hits,]</span>
<span id="cb16-1662"><a href="#cb16-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1663"><a href="#cb16-1663" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb16-1664"><a href="#cb16-1664" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb16-1665"><a href="#cb16-1665" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1666"><a href="#cb16-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1667"><a href="#cb16-1667" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb16-1668"><a href="#cb16-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1669"><a href="#cb16-1669" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> temp_adapt_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1670"><a href="#cb16-1670" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb16-1671"><a href="#cb16-1671" aria-hidden="true" tabindex="-1"></a>                         tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1672"><a href="#cb16-1672" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1673"><a href="#cb16-1673" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1674"><a href="#cb16-1674" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1675"><a href="#cb16-1675" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb16-1676"><a href="#cb16-1676" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb16-1677"><a href="#cb16-1677" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb16-1678"><a href="#cb16-1678" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif <span class="ot">&lt;-</span> temp_adapt_asv_scores[temp_adapt_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1679"><a href="#cb16-1679" aria-hidden="true" tabindex="-1"></a>                                                 temp_adapt_asv_signif_hits,]</span>
<span id="cb16-1680"><a href="#cb16-1680" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb16-1681"><a href="#cb16-1681" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-1682"><a href="#cb16-1682" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_adapt_md_signif_all, temp_adapt_asv_signif)</span>
<span id="cb16-1683"><a href="#cb16-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1684"><a href="#cb16-1684" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb16-1685"><a href="#cb16-1685" aria-hidden="true" tabindex="-1"></a>                                  temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb16-1686"><a href="#cb16-1686" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb16-1687"><a href="#cb16-1687" aria-hidden="true" tabindex="-1"></a>                                   temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb16-1688"><a href="#cb16-1688" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb16-1689"><a href="#cb16-1689" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1690"><a href="#cb16-1690" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1691"><a href="#cb16-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1692"><a href="#cb16-1692" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, temp_adapt_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1693"><a href="#cb16-1693" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, temp_adapt_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1694"><a href="#cb16-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1695"><a href="#cb16-1695" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-1696"><a href="#cb16-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1697"><a href="#cb16-1697" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(temp_adapt_plot_data) <span class="sc">+</span></span>
<span id="cb16-1698"><a href="#cb16-1698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb16-1699"><a href="#cb16-1699" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb16-1700"><a href="#cb16-1700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb16-1701"><a href="#cb16-1701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb16-1702"><a href="#cb16-1702" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> temp_adapt_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb16-1703"><a href="#cb16-1703" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>,</span>
<span id="cb16-1704"><a href="#cb16-1704" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-1705"><a href="#cb16-1705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> temp_adapt_bioplot_data_md, </span>
<span id="cb16-1706"><a href="#cb16-1706" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb16-1707"><a href="#cb16-1707" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb16-1708"><a href="#cb16-1708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb16-1709"><a href="#cb16-1709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Temperature Adaptation"</span>,</span>
<span id="cb16-1710"><a href="#cb16-1710" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> cpa1_lab, </span>
<span id="cb16-1711"><a href="#cb16-1711" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb16-1712"><a href="#cb16-1712" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span>
<span id="cb16-1713"><a href="#cb16-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1714"><a href="#cb16-1714" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_plot"</span>)</span>
<span id="cb16-1715"><a href="#cb16-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1716"><a href="#cb16-1716" aria-hidden="true" tabindex="-1"></a>ssu18_edaphic_plot <span class="ot">&lt;-</span> edaphic_plot</span>
<span id="cb16-1717"><a href="#cb16-1717" aria-hidden="true" tabindex="-1"></a>ssu18_soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot</span>
<span id="cb16-1718"><a href="#cb16-1718" aria-hidden="true" tabindex="-1"></a>ssu18_temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot</span>
<span id="cb16-1719"><a href="#cb16-1719" aria-hidden="true" tabindex="-1"></a>gdata<span class="sc">::</span><span class="fu">keep</span>(ssu18_edaphic_plot, ssu18_soil_funct_plot, ssu18_temp_adapt_plot, its18_edaphic_bioenv_ind_mantel, its18_select_mc_norm_split_no_ac, its18_soil_funct_bioenv_ind_mantel, its18_temp_adapt_bioenv_ind_mantel, ssu18_edaphic_bioenv_ind_mantel, ssu18_select_mc_norm_split_no_ac, ssu18_soil_funct_bioenv_ind_mantel, ssu18_temp_adapt_bioenv_ind_mantel, <span class="at">sure =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-1720"><a href="#cb16-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1721"><a href="#cb16-1721" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1722"><a href="#cb16-1722" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1723"><a href="#cb16-1723" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS EDAPHIC PROPERTIES #######</span></span>
<span id="cb16-1724"><a href="#cb16-1724" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1725"><a href="#cb16-1725" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1726"><a href="#cb16-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1727"><a href="#cb16-1727" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> its18_select_mc_norm_split_no_ac<span class="sc">$</span>edaphic</span>
<span id="cb16-1728"><a href="#cb16-1728" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb16-1729"><a href="#cb16-1729" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(its18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb16-1730"><a href="#cb16-1730" aria-hidden="true" tabindex="-1"></a>edaphic_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb16-1731"><a href="#cb16-1731" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb16-1732"><a href="#cb16-1732" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb16-1733"><a href="#cb16-1733" aria-hidden="true" tabindex="-1"></a><span class="do">## Run `capscale` using Bray-Curtis. </span></span>
<span id="cb16-1734"><a href="#cb16-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1735"><a href="#cb16-1735" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN.</span></span>
<span id="cb16-1736"><a href="#cb16-1736" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: TEB, DON, Na, Al, Ca.</span></span>
<span id="cb16-1737"><a href="#cb16-1737" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: Mg, Mn, Na, Al, Fe, K</span></span>
<span id="cb16-1738"><a href="#cb16-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1739"><a href="#cb16-1739" aria-hidden="true" tabindex="-1"></a>edaphic_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span> AST <span class="sc">+</span> H2O <span class="sc">+</span> N <span class="sc">+</span> P <span class="sc">+</span> ECEC <span class="sc">+</span> pH <span class="sc">+</span> </span>
<span id="cb16-1740"><a href="#cb16-1740" aria-hidden="true" tabindex="-1"></a>                                   NH4 <span class="sc">+</span> NO3 <span class="sc">+</span> PO4 <span class="sc">+</span> DOC <span class="sc">+</span> DOCN, </span>
<span id="cb16-1741"><a href="#cb16-1741" aria-hidden="true" tabindex="-1"></a>                        tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb16-1742"><a href="#cb16-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1743"><a href="#cb16-1743" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb16-1744"><a href="#cb16-1744" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb16-1745"><a href="#cb16-1745" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb16-1746"><a href="#cb16-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1747"><a href="#cb16-1747" aria-hidden="true" tabindex="-1"></a><span class="do">## Next, we need to grab capscale scores for the samples and create a </span></span>
<span id="cb16-1748"><a href="#cb16-1748" aria-hidden="true" tabindex="-1"></a><span class="do">## data frame of the first two dimensions. We will also need to add some </span></span>
<span id="cb16-1749"><a href="#cb16-1749" aria-hidden="true" tabindex="-1"></a><span class="do">## of the sample details to the data frame. For this we use the vegan </span></span>
<span id="cb16-1750"><a href="#cb16-1750" aria-hidden="true" tabindex="-1"></a><span class="do">## function `scores` which gets species or site scores from the ordination.</span></span>
<span id="cb16-1751"><a href="#cb16-1751" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggvegan)</span>
<span id="cb16-1752"><a href="#cb16-1752" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(edaphic_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-1753"><a href="#cb16-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1754"><a href="#cb16-1754" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb16-1755"><a href="#cb16-1755" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1756"><a href="#cb16-1756" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb16-1757"><a href="#cb16-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1758"><a href="#cb16-1758" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb16-1759"><a href="#cb16-1759" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb16-1760"><a href="#cb16-1760" aria-hidden="true" tabindex="-1"></a>edaphic_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb16-1761"><a href="#cb16-1761" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we have a new data frame that contains sample details and capscale values. </span></span>
<span id="cb16-1762"><a href="#cb16-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1763"><a href="#cb16-1763" aria-hidden="true" tabindex="-1"></a><span class="do">## We can then do the same with the metadata vectors. </span></span>
<span id="cb16-1764"><a href="#cb16-1764" aria-hidden="true" tabindex="-1"></a><span class="do">## Here though we only need the scores and parameter name. </span></span>
<span id="cb16-1765"><a href="#cb16-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1766"><a href="#cb16-1766" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb16-1767"><a href="#cb16-1767" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1768"><a href="#cb16-1768" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> edaphic_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1769"><a href="#cb16-1769" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb16-1770"><a href="#cb16-1770" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1771"><a href="#cb16-1771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1772"><a href="#cb16-1772" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run some quick correlations of metadata with ordination axes to </span></span>
<span id="cb16-1773"><a href="#cb16-1773" aria-hidden="true" tabindex="-1"></a><span class="do">## see which parameters are significant. For this we use the vegan function `envfit`.</span></span>
<span id="cb16-1774"><a href="#cb16-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1775"><a href="#cb16-1775" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> edaphic_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb16-1776"><a href="#cb16-1776" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb16-1777"><a href="#cb16-1777" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> edaphic_md_scores<span class="sc">$</span>parameters</span>
<span id="cb16-1778"><a href="#cb16-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1779"><a href="#cb16-1779" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb16-1780"><a href="#cb16-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1781"><a href="#cb16-1781" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb16-1782"><a href="#cb16-1782" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1783"><a href="#cb16-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1784"><a href="#cb16-1784" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1785"><a href="#cb16-1785" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1786"><a href="#cb16-1786" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb16-1787"><a href="#cb16-1787" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_md_signif_hits)</span>
<span id="cb16-1788"><a href="#cb16-1788" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_md_signif_hits)</span>
<span id="cb16-1789"><a href="#cb16-1789" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_md_signif_hits,]</span>
<span id="cb16-1790"><a href="#cb16-1790" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1791"><a href="#cb16-1791" aria-hidden="true" tabindex="-1"></a><span class="do">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span></span>
<span id="cb16-1792"><a href="#cb16-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1793"><a href="#cb16-1793" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb16-1794"><a href="#cb16-1794" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel))</span>
<span id="cb16-1795"><a href="#cb16-1795" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1796"><a href="#cb16-1796" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1797"><a href="#cb16-1797" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb16-1798"><a href="#cb16-1798" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1799"><a href="#cb16-1799" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1800"><a href="#cb16-1800" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1801"><a href="#cb16-1801" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb16-1802"><a href="#cb16-1802" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel)), </span>
<span id="cb16-1803"><a href="#cb16-1803" aria-hidden="true" tabindex="-1"></a>                       edaphic_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb16-1804"><a href="#cb16-1804" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1805"><a href="#cb16-1805" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1806"><a href="#cb16-1806" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb16-1807"><a href="#cb16-1807" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1808"><a href="#cb16-1808" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb16-1809"><a href="#cb16-1809" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1810"><a href="#cb16-1810" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1811"><a href="#cb16-1811" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb16-1812"><a href="#cb16-1812" aria-hidden="true" tabindex="-1"></a>edaphic_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1813"><a href="#cb16-1813" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb16-1814"><a href="#cb16-1814" aria-hidden="true" tabindex="-1"></a>edaphic_sig_diff</span>
<span id="cb16-1815"><a href="#cb16-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1816"><a href="#cb16-1816" aria-hidden="true" tabindex="-1"></a>new_edaphic_md_signif_hits <span class="ot">&lt;-</span> edaphic_sig_diff</span>
<span id="cb16-1817"><a href="#cb16-1817" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> new_edaphic_md_signif_hits,]</span>
<span id="cb16-1818"><a href="#cb16-1818" aria-hidden="true" tabindex="-1"></a><span class="do">## Check. Next, we run `envfit` for the ASVs.</span></span>
<span id="cb16-1819"><a href="#cb16-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1820"><a href="#cb16-1820" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb16-1821"><a href="#cb16-1821" aria-hidden="true" tabindex="-1"></a>                             tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb16-1822"><a href="#cb16-1822" aria-hidden="true" tabindex="-1"></a>                             <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1823"><a href="#cb16-1823" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb16-1824"><a href="#cb16-1824" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> edaphic_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1825"><a href="#cb16-1825" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb16-1826"><a href="#cb16-1826" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1827"><a href="#cb16-1827" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1828"><a href="#cb16-1828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1829"><a href="#cb16-1829" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1830"><a href="#cb16-1830" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1831"><a href="#cb16-1831" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb16-1832"><a href="#cb16-1832" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_asv_signif_hits)</span>
<span id="cb16-1833"><a href="#cb16-1833" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_asv_signif_hits)</span>
<span id="cb16-1834"><a href="#cb16-1834" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif <span class="ot">&lt;-</span> edaphic_asv_scores[edaphic_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_asv_signif_hits,]</span>
<span id="cb16-1835"><a href="#cb16-1835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1836"><a href="#cb16-1836" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb16-1837"><a href="#cb16-1837" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-1838"><a href="#cb16-1838" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(edaphic_md_signif_all, edaphic_asv_signif)</span>
<span id="cb16-1839"><a href="#cb16-1839" aria-hidden="true" tabindex="-1"></a><span class="do">## The last thing to do is categorize parameters scores and ASV </span></span>
<span id="cb16-1840"><a href="#cb16-1840" aria-hidden="true" tabindex="-1"></a><span class="do">## scores into different variable types for plotting.</span></span>
<span id="cb16-1841"><a href="#cb16-1841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1842"><a href="#cb16-1842" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb16-1843"><a href="#cb16-1843" aria-hidden="true" tabindex="-1"></a>                                  edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb16-1844"><a href="#cb16-1844" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb16-1845"><a href="#cb16-1845" aria-hidden="true" tabindex="-1"></a>                                   edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb16-1846"><a href="#cb16-1846" aria-hidden="true" tabindex="-1"></a><span class="do">##  code for the plot</span></span>
<span id="cb16-1847"><a href="#cb16-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1848"><a href="#cb16-1848" aria-hidden="true" tabindex="-1"></a>edaphic_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb16-1849"><a href="#cb16-1849" aria-hidden="true" tabindex="-1"></a>edaphic_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1850"><a href="#cb16-1850" aria-hidden="true" tabindex="-1"></a>edaphic_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1851"><a href="#cb16-1851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1852"><a href="#cb16-1852" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, edaphic_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1853"><a href="#cb16-1853" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, edaphic_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1854"><a href="#cb16-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1855"><a href="#cb16-1855" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-1856"><a href="#cb16-1856" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(edaphic_plot_data) <span class="sc">+</span></span>
<span id="cb16-1857"><a href="#cb16-1857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb16-1858"><a href="#cb16-1858" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb16-1859"><a href="#cb16-1859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb16-1860"><a href="#cb16-1860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb16-1861"><a href="#cb16-1861" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> edaphic_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb16-1862"><a href="#cb16-1862" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb16-1863"><a href="#cb16-1863" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-1864"><a href="#cb16-1864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> edaphic_bioplot_data_md, </span>
<span id="cb16-1865"><a href="#cb16-1865" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>, </span>
<span id="cb16-1866"><a href="#cb16-1866" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb16-1867"><a href="#cb16-1867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb16-1868"><a href="#cb16-1868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb16-1869"><a href="#cb16-1869" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb16-1870"><a href="#cb16-1870" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> edaphic_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb16-1871"><a href="#cb16-1871" aria-hidden="true" tabindex="-1"></a>edaphic_plot</span>
<span id="cb16-1872"><a href="#cb16-1872" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-1873"><a href="#cb16-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1874"><a href="#cb16-1874" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1875"><a href="#cb16-1875" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1876"><a href="#cb16-1876" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS Soil Functional Response #</span></span>
<span id="cb16-1877"><a href="#cb16-1877" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1878"><a href="#cb16-1878" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-1879"><a href="#cb16-1879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1880"><a href="#cb16-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1881"><a href="#cb16-1881" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> its18_select_mc_norm_split_no_ac<span class="sc">$</span>soil_funct</span>
<span id="cb16-1882"><a href="#cb16-1882" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb16-1883"><a href="#cb16-1883" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(its18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb16-1884"><a href="#cb16-1884" aria-hidden="true" tabindex="-1"></a>soil_funct_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb16-1885"><a href="#cb16-1885" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb16-1886"><a href="#cb16-1886" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb16-1887"><a href="#cb16-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1888"><a href="#cb16-1888" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis </span></span>
<span id="cb16-1889"><a href="#cb16-1889" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span></span>
<span id="cb16-1890"><a href="#cb16-1890" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span></span>
<span id="cb16-1891"><a href="#cb16-1891" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: NONE</span></span>
<span id="cb16-1892"><a href="#cb16-1892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1893"><a href="#cb16-1893" aria-hidden="true" tabindex="-1"></a>soil_funct_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  micC <span class="sc">+</span> micP <span class="sc">+</span> micCN <span class="sc">+</span> micCP <span class="sc">+</span> AG_ase <span class="sc">+</span> BG_ase <span class="sc">+</span> </span>
<span id="cb16-1894"><a href="#cb16-1894" aria-hidden="true" tabindex="-1"></a>                                       S_ase <span class="sc">+</span> XY_ase <span class="sc">+</span> PX_ase <span class="sc">+</span> CO2 <span class="sc">+</span> enzNP, </span>
<span id="cb16-1895"><a href="#cb16-1895" aria-hidden="true" tabindex="-1"></a>                           tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb16-1896"><a href="#cb16-1896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1897"><a href="#cb16-1897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1898"><a href="#cb16-1898" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(soil_funct_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-1899"><a href="#cb16-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1900"><a href="#cb16-1900" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb16-1901"><a href="#cb16-1901" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb16-1902"><a href="#cb16-1902" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb16-1903"><a href="#cb16-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1904"><a href="#cb16-1904" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb16-1905"><a href="#cb16-1905" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1906"><a href="#cb16-1906" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb16-1907"><a href="#cb16-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1908"><a href="#cb16-1908" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb16-1909"><a href="#cb16-1909" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb16-1910"><a href="#cb16-1910" aria-hidden="true" tabindex="-1"></a>soil_funct_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb16-1911"><a href="#cb16-1911" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb16-1912"><a href="#cb16-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1913"><a href="#cb16-1913" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb16-1914"><a href="#cb16-1914" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1915"><a href="#cb16-1915" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> soil_funct_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1916"><a href="#cb16-1916" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb16-1917"><a href="#cb16-1917" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1918"><a href="#cb16-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1919"><a href="#cb16-1919" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> soil_funct_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb16-1920"><a href="#cb16-1920" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb16-1921"><a href="#cb16-1921" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> soil_funct_md_scores<span class="sc">$</span>parameters</span>
<span id="cb16-1922"><a href="#cb16-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1923"><a href="#cb16-1923" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb16-1924"><a href="#cb16-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1925"><a href="#cb16-1925" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb16-1926"><a href="#cb16-1926" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1927"><a href="#cb16-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1928"><a href="#cb16-1928" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1929"><a href="#cb16-1929" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1930"><a href="#cb16-1930" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb16-1931"><a href="#cb16-1931" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_md_signif_hits)</span>
<span id="cb16-1932"><a href="#cb16-1932" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_md_signif_hits)</span>
<span id="cb16-1933"><a href="#cb16-1933" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1934"><a href="#cb16-1934" aria-hidden="true" tabindex="-1"></a>                                               soil_funct_md_signif_hits,]</span>
<span id="cb16-1935"><a href="#cb16-1935" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1936"><a href="#cb16-1936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1937"><a href="#cb16-1937" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb16-1938"><a href="#cb16-1938" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel))</span>
<span id="cb16-1939"><a href="#cb16-1939" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1940"><a href="#cb16-1940" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1941"><a href="#cb16-1941" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb16-1942"><a href="#cb16-1942" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-1943"><a href="#cb16-1943" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1944"><a href="#cb16-1944" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1945"><a href="#cb16-1945" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb16-1946"><a href="#cb16-1946" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel)), </span>
<span id="cb16-1947"><a href="#cb16-1947" aria-hidden="true" tabindex="-1"></a>                       soil_funct_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb16-1948"><a href="#cb16-1948" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1949"><a href="#cb16-1949" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1950"><a href="#cb16-1950" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb16-1951"><a href="#cb16-1951" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1952"><a href="#cb16-1952" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb16-1953"><a href="#cb16-1953" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-1954"><a href="#cb16-1954" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-1955"><a href="#cb16-1955" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb16-1956"><a href="#cb16-1956" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-1957"><a href="#cb16-1957" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb16-1958"><a href="#cb16-1958" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff</span>
<span id="cb16-1959"><a href="#cb16-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1960"><a href="#cb16-1960" aria-hidden="true" tabindex="-1"></a>new_soil_funct_md_signif_hits <span class="ot">&lt;-</span> soil_funct_sig_diff</span>
<span id="cb16-1961"><a href="#cb16-1961" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1962"><a href="#cb16-1962" aria-hidden="true" tabindex="-1"></a>                                                   new_soil_funct_md_signif_hits,]</span>
<span id="cb16-1963"><a href="#cb16-1963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1964"><a href="#cb16-1964" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb16-1965"><a href="#cb16-1965" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], </span>
<span id="cb16-1966"><a href="#cb16-1966" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-1967"><a href="#cb16-1967" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb16-1968"><a href="#cb16-1968" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> soil_funct_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-1969"><a href="#cb16-1969" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb16-1970"><a href="#cb16-1970" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-1971"><a href="#cb16-1971" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-1972"><a href="#cb16-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1973"><a href="#cb16-1973" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-1974"><a href="#cb16-1974" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-1975"><a href="#cb16-1975" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb16-1976"><a href="#cb16-1976" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_asv_signif_hits)</span>
<span id="cb16-1977"><a href="#cb16-1977" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_asv_signif_hits)</span>
<span id="cb16-1978"><a href="#cb16-1978" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif <span class="ot">&lt;-</span> soil_funct_asv_scores[soil_funct_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-1979"><a href="#cb16-1979" aria-hidden="true" tabindex="-1"></a>                                                 soil_funct_asv_signif_hits,]</span>
<span id="cb16-1980"><a href="#cb16-1980" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb16-1981"><a href="#cb16-1981" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-1982"><a href="#cb16-1982" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(soil_funct_md_signif_all, soil_funct_asv_signif)</span>
<span id="cb16-1983"><a href="#cb16-1983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1984"><a href="#cb16-1984" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb16-1985"><a href="#cb16-1985" aria-hidden="true" tabindex="-1"></a>                                  soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb16-1986"><a href="#cb16-1986" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb16-1987"><a href="#cb16-1987" aria-hidden="true" tabindex="-1"></a>                                   soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb16-1988"><a href="#cb16-1988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1989"><a href="#cb16-1989" aria-hidden="true" tabindex="-1"></a><span class="do">## PLOT Code</span></span>
<span id="cb16-1990"><a href="#cb16-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1991"><a href="#cb16-1991" aria-hidden="true" tabindex="-1"></a>soil_funct_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb16-1992"><a href="#cb16-1992" aria-hidden="true" tabindex="-1"></a>soil_funct_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1993"><a href="#cb16-1993" aria-hidden="true" tabindex="-1"></a>soil_funct_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-1994"><a href="#cb16-1994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1995"><a href="#cb16-1995" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, soil_funct_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1996"><a href="#cb16-1996" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, soil_funct_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-1997"><a href="#cb16-1997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1998"><a href="#cb16-1998" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-1999"><a href="#cb16-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2000"><a href="#cb16-2000" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(soil_funct_plot_data) <span class="sc">+</span></span>
<span id="cb16-2001"><a href="#cb16-2001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb16-2002"><a href="#cb16-2002" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb16-2003"><a href="#cb16-2003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb16-2004"><a href="#cb16-2004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb16-2005"><a href="#cb16-2005" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> soil_funct_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb16-2006"><a href="#cb16-2006" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb16-2007"><a href="#cb16-2007" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>) <span class="sc">+</span></span>
<span id="cb16-2008"><a href="#cb16-2008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> soil_funct_bioplot_data_md, </span>
<span id="cb16-2009"><a href="#cb16-2009" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb16-2010"><a href="#cb16-2010" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb16-2011"><a href="#cb16-2011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb16-2012"><a href="#cb16-2012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb16-2013"><a href="#cb16-2013" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb16-2014"><a href="#cb16-2014" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb16-2015"><a href="#cb16-2015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2016"><a href="#cb16-2016" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2017"><a href="#cb16-2017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2018"><a href="#cb16-2018" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-2019"><a href="#cb16-2019" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-2020"><a href="#cb16-2020" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS Temperature Adaptation </span><span class="al">###</span></span>
<span id="cb16-2021"><a href="#cb16-2021" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-2022"><a href="#cb16-2022" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb16-2023"><a href="#cb16-2023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2024"><a href="#cb16-2024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2025"><a href="#cb16-2025" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> its18_select_mc_norm_split_no_ac<span class="sc">$</span>temp_adapt</span>
<span id="cb16-2026"><a href="#cb16-2026" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb16-2027"><a href="#cb16-2027" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(its18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb16-2028"><a href="#cb16-2028" aria-hidden="true" tabindex="-1"></a>temp_adapt_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb16-2029"><a href="#cb16-2029" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb16-2030"><a href="#cb16-2030" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb16-2031"><a href="#cb16-2031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2032"><a href="#cb16-2032" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb16-2033"><a href="#cb16-2033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2034"><a href="#cb16-2034" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span id="cb16-2035"><a href="#cb16-2035" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: NUE, PUE, P_Q10, SI                                                                        </span></span>
<span id="cb16-2036"><a href="#cb16-2036" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: S_Q10</span></span>
<span id="cb16-2037"><a href="#cb16-2037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2038"><a href="#cb16-2038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2039"><a href="#cb16-2039" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  AG_Q10 <span class="sc">+</span> BG_Q10 <span class="sc">+</span> BP_Q10 <span class="sc">+</span> CE_Q10 <span class="sc">+</span> </span>
<span id="cb16-2040"><a href="#cb16-2040" aria-hidden="true" tabindex="-1"></a>                                       N_Q10 <span class="sc">+</span> XY_Q10 <span class="sc">+</span> LP_Q10 <span class="sc">+</span> PX_Q10 <span class="sc">+</span> </span>
<span id="cb16-2041"><a href="#cb16-2041" aria-hidden="true" tabindex="-1"></a>                                       CUEcn <span class="sc">+</span> CUEcp <span class="sc">+</span> Tmin, </span>
<span id="cb16-2042"><a href="#cb16-2042" aria-hidden="true" tabindex="-1"></a>                           tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb16-2043"><a href="#cb16-2043" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(temp_adapt_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-2044"><a href="#cb16-2044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2045"><a href="#cb16-2045" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb16-2046"><a href="#cb16-2046" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb16-2047"><a href="#cb16-2047" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb16-2048"><a href="#cb16-2048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2049"><a href="#cb16-2049" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb16-2050"><a href="#cb16-2050" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-2051"><a href="#cb16-2051" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb16-2052"><a href="#cb16-2052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2053"><a href="#cb16-2053" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb16-2054"><a href="#cb16-2054" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb16-2055"><a href="#cb16-2055" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb16-2056"><a href="#cb16-2056" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb16-2057"><a href="#cb16-2057" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb16-2058"><a href="#cb16-2058" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-2059"><a href="#cb16-2059" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> temp_adapt_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-2060"><a href="#cb16-2060" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb16-2061"><a href="#cb16-2061" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-2062"><a href="#cb16-2062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2063"><a href="#cb16-2063" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> temp_adapt_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb16-2064"><a href="#cb16-2064" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb16-2065"><a href="#cb16-2065" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> temp_adapt_md_scores<span class="sc">$</span>parameters</span>
<span id="cb16-2066"><a href="#cb16-2066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2067"><a href="#cb16-2067" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb16-2068"><a href="#cb16-2068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2069"><a href="#cb16-2069" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb16-2070"><a href="#cb16-2070" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-2071"><a href="#cb16-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2072"><a href="#cb16-2072" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-2073"><a href="#cb16-2073" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-2074"><a href="#cb16-2074" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb16-2075"><a href="#cb16-2075" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_md_signif_hits)</span>
<span id="cb16-2076"><a href="#cb16-2076" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_md_signif_hits)</span>
<span id="cb16-2077"><a href="#cb16-2077" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-2078"><a href="#cb16-2078" aria-hidden="true" tabindex="-1"></a>                                               temp_adapt_md_signif_hits,]</span>
<span id="cb16-2079"><a href="#cb16-2079" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb16-2080"><a href="#cb16-2080" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel))</span>
<span id="cb16-2081"><a href="#cb16-2081" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-2082"><a href="#cb16-2082" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-2083"><a href="#cb16-2083" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb16-2084"><a href="#cb16-2084" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif<span class="sc">$</span>parameters</span>
<span id="cb16-2085"><a href="#cb16-2085" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-2086"><a href="#cb16-2086" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-2087"><a href="#cb16-2087" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb16-2088"><a href="#cb16-2088" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)), </span>
<span id="cb16-2089"><a href="#cb16-2089" aria-hidden="true" tabindex="-1"></a>                       temp_adapt_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb16-2090"><a href="#cb16-2090" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-2091"><a href="#cb16-2091" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-2092"><a href="#cb16-2092" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb16-2093"><a href="#cb16-2093" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-2094"><a href="#cb16-2094" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb16-2095"><a href="#cb16-2095" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb16-2096"><a href="#cb16-2096" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-2097"><a href="#cb16-2097" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and  bioenv."</span>)</span>
<span id="cb16-2098"><a href="#cb16-2098" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb16-2099"><a href="#cb16-2099" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb16-2100"><a href="#cb16-2100" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff</span>
<span id="cb16-2101"><a href="#cb16-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2102"><a href="#cb16-2102" aria-hidden="true" tabindex="-1"></a>new_temp_adapt_md_signif_hits <span class="ot">&lt;-</span> temp_adapt_sig_diff[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb16-2103"><a href="#cb16-2103" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-2104"><a href="#cb16-2104" aria-hidden="true" tabindex="-1"></a>                                                   new_temp_adapt_md_signif_hits,]</span>
<span id="cb16-2105"><a href="#cb16-2105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2106"><a href="#cb16-2106" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb16-2107"><a href="#cb16-2107" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb16-2108"><a href="#cb16-2108" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb16-2109"><a href="#cb16-2109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2110"><a href="#cb16-2110" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb16-2111"><a href="#cb16-2111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2112"><a href="#cb16-2112" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> temp_adapt_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb16-2113"><a href="#cb16-2113" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb16-2114"><a href="#cb16-2114" aria-hidden="true" tabindex="-1"></a>                         tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb16-2115"><a href="#cb16-2115" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-2116"><a href="#cb16-2116" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb16-2117"><a href="#cb16-2117" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb16-2118"><a href="#cb16-2118" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb16-2119"><a href="#cb16-2119" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb16-2120"><a href="#cb16-2120" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb16-2121"><a href="#cb16-2121" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif <span class="ot">&lt;-</span> temp_adapt_asv_scores[temp_adapt_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb16-2122"><a href="#cb16-2122" aria-hidden="true" tabindex="-1"></a>                                                 temp_adapt_asv_signif_hits,]</span>
<span id="cb16-2123"><a href="#cb16-2123" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb16-2124"><a href="#cb16-2124" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb16-2125"><a href="#cb16-2125" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_adapt_md_signif_all, temp_adapt_asv_signif)</span>
<span id="cb16-2126"><a href="#cb16-2126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2127"><a href="#cb16-2127" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb16-2128"><a href="#cb16-2128" aria-hidden="true" tabindex="-1"></a>                                  temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb16-2129"><a href="#cb16-2129" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb16-2130"><a href="#cb16-2130" aria-hidden="true" tabindex="-1"></a>                                   temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb16-2131"><a href="#cb16-2131" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb16-2132"><a href="#cb16-2132" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-2133"><a href="#cb16-2133" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb16-2134"><a href="#cb16-2134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2135"><a href="#cb16-2135" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, temp_adapt_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2136"><a href="#cb16-2136" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, temp_adapt_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2137"><a href="#cb16-2137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2138"><a href="#cb16-2138" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-2139"><a href="#cb16-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2140"><a href="#cb16-2140" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(temp_adapt_plot_data) <span class="sc">+</span></span>
<span id="cb16-2141"><a href="#cb16-2141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb16-2142"><a href="#cb16-2142" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb16-2143"><a href="#cb16-2143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb16-2144"><a href="#cb16-2144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb16-2145"><a href="#cb16-2145" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> temp_adapt_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb16-2146"><a href="#cb16-2146" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>,</span>
<span id="cb16-2147"><a href="#cb16-2147" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-2148"><a href="#cb16-2148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> temp_adapt_bioplot_data_md, </span>
<span id="cb16-2149"><a href="#cb16-2149" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb16-2150"><a href="#cb16-2150" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb16-2151"><a href="#cb16-2151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb16-2152"><a href="#cb16-2152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb16-2153"><a href="#cb16-2153" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb16-2154"><a href="#cb16-2154" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb16-2155"><a href="#cb16-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2156"><a href="#cb16-2156" aria-hidden="true" tabindex="-1"></a>its18_edaphic_plot <span class="ot">&lt;-</span> edaphic_plot</span>
<span id="cb16-2157"><a href="#cb16-2157" aria-hidden="true" tabindex="-1"></a>its18_soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot</span>
<span id="cb16-2158"><a href="#cb16-2158" aria-hidden="true" tabindex="-1"></a>its18_temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot</span>
<span id="cb16-2159"><a href="#cb16-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2160"><a href="#cb16-2160" aria-hidden="true" tabindex="-1"></a><span class="do">### BUILD the final Plot</span></span>
<span id="cb16-2161"><a href="#cb16-2161" aria-hidden="true" tabindex="-1"></a>tmp_plot_final <span class="ot">&lt;-</span> (ssu18_edaphic_plot <span class="sc">|</span> ssu18_soil_funct_plot) <span class="sc">/</span> (its18_edaphic_plot <span class="sc">|</span> its18_soil_funct_plot) <span class="sc">+</span></span>
<span id="cb16-2162"><a href="#cb16-2162" aria-hidden="true" tabindex="-1"></a>   patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"a"</span>, </span>
<span id="cb16-2163"><a href="#cb16-2163" aria-hidden="true" tabindex="-1"></a>                              <span class="at">title =</span> <span class="cn">NULL</span>, </span>
<span id="cb16-2164"><a href="#cb16-2164" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subtitle =</span> <span class="cn">NULL</span>, </span>
<span id="cb16-2165"><a href="#cb16-2165" aria-hidden="true" tabindex="-1"></a>                              <span class="at">caption =</span> <span class="cn">NULL</span>) </span>
<span id="cb16-2166"><a href="#cb16-2166" aria-hidden="true" tabindex="-1"></a>tmp_plot_final <span class="ot">&lt;-</span> tmp_plot_final <span class="sc">+</span> </span>
<span id="cb16-2167"><a href="#cb16-2167" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span></span>
<span id="cb16-2168"><a href="#cb16-2168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb16-2169"><a href="#cb16-2169" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">24</span>),</span>
<span id="cb16-2170"><a href="#cb16-2170" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">31</span>), </span>
<span id="cb16-2171"><a href="#cb16-2171" aria-hidden="true" tabindex="-1"></a>             <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>), </span>
<span id="cb16-2172"><a href="#cb16-2172" aria-hidden="true" tabindex="-1"></a>             <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)) </span>
<span id="cb16-2173"><a href="#cb16-2173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2174"><a href="#cb16-2174" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(tmp_plot_final, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, </span>
<span id="cb16-2175"><a href="#cb16-2175" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Extended_Data_Figure_5.png"</span>, </span>
<span id="cb16-2176"><a href="#cb16-2176" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">8398</span>, <span class="at">width =</span> <span class="dv">7485</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb16-2177"><a href="#cb16-2177" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-2178"><a href="#cb16-2178" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(tmp_plot_final, <span class="at">path =</span> <span class="st">"include/pub/ext/"</span>, </span>
<span id="cb16-2179"><a href="#cb16-2179" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_5.pdf"</span>, </span>
<span id="cb16-2180"><a href="#cb16-2180" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">8398</span>, <span class="at">width =</span> <span class="dv">7485</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb16-2181"><a href="#cb16-2181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2182"><a href="#cb16-2182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2183"><a href="#cb16-2183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-2184"><a href="#cb16-2184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2185"><a href="#cb16-2185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2186"><a href="#cb16-2186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2187"><a href="#cb16-2187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2188"><a href="#cb16-2188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2189"><a href="#cb16-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2190"><a href="#cb16-2190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2191"><a href="#cb16-2191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2192"><a href="#cb16-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2193"><a href="#cb16-2193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2194"><a href="#cb16-2194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2195"><a href="#cb16-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2196"><a href="#cb16-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2197"><a href="#cb16-2197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2198"><a href="#cb16-2198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2199"><a href="#cb16-2199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2200"><a href="#cb16-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2201"><a href="#cb16-2201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2202"><a href="#cb16-2202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2203"><a href="#cb16-2203" aria-hidden="true" tabindex="-1"></a><span class="fu"># Supplementary Material</span></span>
<span id="cb16-2204"><a href="#cb16-2204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2205"><a href="#cb16-2205" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 1</span></span>
<span id="cb16-2206"><a href="#cb16-2206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2207"><a href="#cb16-2207" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-2208"><a href="#cb16-2208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2209"><a href="#cb16-2209" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-2210"><a href="#cb16-2210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2211"><a href="#cb16-2211" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb16-2212"><a href="#cb16-2212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2213"><a href="#cb16-2213" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2214"><a href="#cb16-2214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2215"><a href="#cb16-2215" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-2216"><a href="#cb16-2216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2217"><a href="#cb16-2217" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-2218"><a href="#cb16-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2219"><a href="#cb16-2219" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_1.png)</span></span>
<span id="cb16-2220"><a href="#cb16-2220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2221"><a href="#cb16-2221" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-2222"><a href="#cb16-2222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2223"><a href="#cb16-2223" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_main_ssu.png)</span></span>
<span id="cb16-2224"><a href="#cb16-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2225"><a href="#cb16-2225" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2226"><a href="#cb16-2226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2227"><a href="#cb16-2227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2228"><a href="#cb16-2228" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-2229"><a href="#cb16-2229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2230"><a href="#cb16-2230" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-2231"><a href="#cb16-2231" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/ssu18_ps_work.rds)</span>  </span>
<span id="cb16-2232"><a href="#cb16-2232" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2233"><a href="#cb16-2233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2234"><a href="#cb16-2234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2235"><a href="#cb16-2235" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-2236"><a href="#cb16-2236" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Supplementary_Figure_1.pdf)</span></span>
<span id="cb16-2237"><a href="#cb16-2237" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2238"><a href="#cb16-2238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2239"><a href="#cb16-2239" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2240"><a href="#cb16-2240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2241"><a href="#cb16-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2244"><a href="#cb16-2244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-2245"><a href="#cb16-2245" aria-hidden="true" tabindex="-1"></a><span class="do">## Load data</span></span>
<span id="cb16-2246"><a href="#cb16-2246" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-2247"><a href="#cb16-2247" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb16-2248"><a href="#cb16-2248" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/som/ssu18_ps_work.rds"</span>)</span>
<span id="cb16-2249"><a href="#cb16-2249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2250"><a href="#cb16-2250" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Get all Class-level Proteobacteria names</span></span>
<span id="cb16-2251"><a href="#cb16-2251" aria-hidden="true" tabindex="-1"></a>ssu18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work"</span>)</span>
<span id="cb16-2252"><a href="#cb16-2252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2253"><a href="#cb16-2253" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2254"><a href="#cb16-2254" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_proteo"</span>))</span>
<span id="cb16-2255"><a href="#cb16-2255" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2256"><a href="#cb16-2256" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">subset_taxa</span>(tmp_get, Phylum <span class="sc">==</span> <span class="st">"Proteobacteria"</span>)</span>
<span id="cb16-2257"><a href="#cb16-2257" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-2258"><a href="#cb16-2258" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-2259"><a href="#cb16-2259" aria-hidden="true" tabindex="-1"></a>     tmp_get_taxa <span class="ot">&lt;-</span> <span class="fu">get_taxa_unique</span>(tmp_df,</span>
<span id="cb16-2260"><a href="#cb16-2260" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_df)[<span class="dv">3</span>],</span>
<span id="cb16-2261"><a href="#cb16-2261" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">errorIfNULL=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-2262"><a href="#cb16-2262" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_get_taxa)</span>
<span id="cb16-2263"><a href="#cb16-2263" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2264"><a href="#cb16-2264" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_proteo"</span>))</span>
<span id="cb16-2265"><a href="#cb16-2265" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2266"><a href="#cb16-2266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2267"><a href="#cb16-2267" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span id="cb16-2268"><a href="#cb16-2268" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2269"><a href="#cb16-2269" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>))</span>
<span id="cb16-2270"><a href="#cb16-2270" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb16-2271"><a href="#cb16-2271" aria-hidden="true" tabindex="-1"></a>  tmp_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb16-2272"><a href="#cb16-2272" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2273"><a href="#cb16-2273" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tmp_clean)) {</span>
<span id="cb16-2274"><a href="#cb16-2274" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb16-2275"><a href="#cb16-2275" aria-hidden="true" tabindex="-1"></a>        tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Alphaproteobacteria"</span>) {</span>
<span id="cb16-2276"><a href="#cb16-2276" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Alphaproteobacteria"</span>)</span>
<span id="cb16-2277"><a href="#cb16-2277" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-2278"><a href="#cb16-2278" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb16-2279"><a href="#cb16-2279" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Gammaproteobacteria"</span>) {</span>
<span id="cb16-2280"><a href="#cb16-2280" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Gammaproteobacteria"</span>)</span>
<span id="cb16-2281"><a href="#cb16-2281" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-2282"><a href="#cb16-2282" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb16-2283"><a href="#cb16-2283" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Zetaproteobacteria"</span>) {</span>
<span id="cb16-2284"><a href="#cb16-2284" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Zetaproteobacteria"</span>)</span>
<span id="cb16-2285"><a href="#cb16-2285" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-2286"><a href="#cb16-2286" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb16-2287"><a href="#cb16-2287" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"p_Proteobacteria"</span>) {</span>
<span id="cb16-2288"><a href="#cb16-2288" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p_Proteobacteria"</span>)</span>
<span id="cb16-2289"><a href="#cb16-2289" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-2290"><a href="#cb16-2290" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-2291"><a href="#cb16-2291" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-2292"><a href="#cb16-2292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(tmp_get) <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_clean)</span>
<span id="cb16-2293"><a href="#cb16-2293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rank_names</span>(tmp_get)</span>
<span id="cb16-2294"><a href="#cb16-2294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_get)</span>
<span id="cb16-2295"><a href="#cb16-2295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(tmp_name, tmp_get))</span>
<span id="cb16-2296"><a href="#cb16-2296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">length</span>(</span>
<span id="cb16-2297"><a href="#cb16-2297" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_taxa_unique</span>(</span>
<span id="cb16-2298"><a href="#cb16-2298" aria-hidden="true" tabindex="-1"></a>      tmp_get,</span>
<span id="cb16-2299"><a href="#cb16-2299" aria-hidden="true" tabindex="-1"></a>      <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">2</span>],</span>
<span id="cb16-2300"><a href="#cb16-2300" aria-hidden="true" tabindex="-1"></a>      <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb16-2301"><a href="#cb16-2301" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2302"><a href="#cb16-2302" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb16-2303"><a href="#cb16-2303" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/som/"</span>)</span>
<span id="cb16-2304"><a href="#cb16-2304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(tmp_get, <span class="fu">paste</span>(tmp_path, j, <span class="st">"_clean.rds"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb16-2305"><a href="#cb16-2305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2306"><a href="#cb16-2306" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2307"><a href="#cb16-2307" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(class, order, phylum)</span>
<span id="cb16-2308"><a href="#cb16-2308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2309"><a href="#cb16-2309" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) In order to use `microeco`, we need to add the rank designation as a prefix to each taxa. </span></span>
<span id="cb16-2310"><a href="#cb16-2310" aria-hidden="true" tabindex="-1"></a><span class="do">## For example, `Actinobacteriota` is changed to `p__Actinobacteriota`. </span></span>
<span id="cb16-2311"><a href="#cb16-2311" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2312"><a href="#cb16-2312" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>)))</span>
<span id="cb16-2313"><a href="#cb16-2313" aria-hidden="true" tabindex="-1"></a>  tmp_sam_data <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(tmp_get)</span>
<span id="cb16-2314"><a href="#cb16-2314" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb16-2315"><a href="#cb16-2315" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Phylum <span class="ot">&lt;-</span></span>
<span id="cb16-2316"><a href="#cb16-2316" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"p_Proteobacteria"</span>, <span class="st">"Proteobacteria"</span>, tmp_tax_data<span class="sc">$</span>Phylum)</span>
<span id="cb16-2317"><a href="#cb16-2317" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2318"><a href="#cb16-2318" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span></span>
<span id="cb16-2319"><a href="#cb16-2319" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-2320"><a href="#cb16-2320" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2321"><a href="#cb16-2321" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data[] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-2322"><a href="#cb16-2322" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(</span>
<span id="cb16-2323"><a href="#cb16-2323" aria-hidden="true" tabindex="-1"></a>      tmp_tax_data,</span>
<span id="cb16-2324"><a href="#cb16-2324" aria-hidden="true" tabindex="-1"></a>      gsub,</span>
<span id="cb16-2325"><a href="#cb16-2325" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">"^[k | p | c | o | f]_.*"</span>,</span>
<span id="cb16-2326"><a href="#cb16-2326" aria-hidden="true" tabindex="-1"></a>      <span class="at">replacement =</span> <span class="st">""</span>,</span>
<span id="cb16-2327"><a href="#cb16-2327" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixed =</span> <span class="cn">FALSE</span></span>
<span id="cb16-2328"><a href="#cb16-2328" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2329"><a href="#cb16-2329" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-2330"><a href="#cb16-2330" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Kingdom <span class="ot">&lt;-</span></span>
<span id="cb16-2331"><a href="#cb16-2331" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"k__"</span>, tmp_tax_data<span class="sc">$</span>Kingdom, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2332"><a href="#cb16-2332" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Phylum <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"p__"</span>, tmp_tax_data<span class="sc">$</span>Phylum, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2333"><a href="#cb16-2333" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"c__"</span>, tmp_tax_data<span class="sc">$</span>Class, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2334"><a href="#cb16-2334" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Order <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"o__"</span>, tmp_tax_data<span class="sc">$</span>Order, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2335"><a href="#cb16-2335" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Family <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"f__"</span>, tmp_tax_data<span class="sc">$</span>Family, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2336"><a href="#cb16-2336" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Genus <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"g__"</span>, tmp_tax_data<span class="sc">$</span>Genus, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2337"><a href="#cb16-2337" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax_data)</span>
<span id="cb16-2338"><a href="#cb16-2338" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2339"><a href="#cb16-2339" aria-hidden="true" tabindex="-1"></a>  tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(tmp_get),</span>
<span id="cb16-2340"><a href="#cb16-2340" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">phy_tree</span>(tmp_get),</span>
<span id="cb16-2341"><a href="#cb16-2341" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">tax_table</span>(tmp_tax_data),</span>
<span id="cb16-2342"><a href="#cb16-2342" aria-hidden="true" tabindex="-1"></a>                     tmp_sam_data)</span>
<span id="cb16-2343"><a href="#cb16-2343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_ps)</span>
<span id="cb16-2344"><a href="#cb16-2344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2345"><a href="#cb16-2345" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2346"><a href="#cb16-2346" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_proteo_clean"</span>))</span>
<span id="cb16-2347"><a href="#cb16-2347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2348"><a href="#cb16-2348" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Next, we need to covert each `phyloseq object` to a `microtable class`.  </span></span>
<span id="cb16-2349"><a href="#cb16-2349" aria-hidden="true" tabindex="-1"></a><span class="do">## The microtable class is the basic data structure for the `microeco` package </span></span>
<span id="cb16-2350"><a href="#cb16-2350" aria-hidden="true" tabindex="-1"></a><span class="do">## and designed to store basic information from all the downstream analyses </span></span>
<span id="cb16-2351"><a href="#cb16-2351" aria-hidden="true" tabindex="-1"></a><span class="do">## (e.g, alpha diversity, beta diversity, etc.). </span></span>
<span id="cb16-2352"><a href="#cb16-2352" aria-hidden="true" tabindex="-1"></a><span class="do">## We use the [file2meco](https://github.com/ChiLiubio/file2meco) to read the phyloseq </span></span>
<span id="cb16-2353"><a href="#cb16-2353" aria-hidden="true" tabindex="-1"></a><span class="do">## object and convert into a microtable object. We can add `_me` as a suffix </span></span>
<span id="cb16-2354"><a href="#cb16-2354" aria-hidden="true" tabindex="-1"></a><span class="do">## to each object to distiguish it from its' phyloseq counterpart. </span></span>
<span id="cb16-2355"><a href="#cb16-2355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2356"><a href="#cb16-2356" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2357"><a href="#cb16-2357" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2358"><a href="#cb16-2358" aria-hidden="true" tabindex="-1"></a>  tmp_otu_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb16-2359"><a href="#cb16-2359" aria-hidden="true" tabindex="-1"></a>  tmp_sample_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb16-2360"><a href="#cb16-2360" aria-hidden="true" tabindex="-1"></a>  tmp_taxonomy_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb16-2361"><a href="#cb16-2361" aria-hidden="true" tabindex="-1"></a>  tmp_phylo_tree <span class="ot">&lt;-</span> <span class="fu">phy_tree</span>(tmp_get)</span>
<span id="cb16-2362"><a href="#cb16-2362" aria-hidden="true" tabindex="-1"></a>  tmp_taxonomy_table <span class="sc">%&lt;&gt;%</span> tidy_taxonomy</span>
<span id="cb16-2363"><a href="#cb16-2363" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> microtable<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb16-2364"><a href="#cb16-2364" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_table =</span> tmp_sample_info,</span>
<span id="cb16-2365"><a href="#cb16-2365" aria-hidden="true" tabindex="-1"></a>    <span class="at">otu_table =</span> tmp_otu_table,</span>
<span id="cb16-2366"><a href="#cb16-2366" aria-hidden="true" tabindex="-1"></a>    <span class="at">tax_table =</span> tmp_taxonomy_table,</span>
<span id="cb16-2367"><a href="#cb16-2367" aria-hidden="true" tabindex="-1"></a>    <span class="at">phylo_tree =</span> tmp_phylo_tree</span>
<span id="cb16-2368"><a href="#cb16-2368" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-2369"><a href="#cb16-2369" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb16-2370"><a href="#cb16-2370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb16-2371"><a href="#cb16-2371" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span>tax_table <span class="sc">%&lt;&gt;%</span> base<span class="sc">::</span><span class="fu">subset</span>(Kingdom <span class="sc">==</span> <span class="st">"k__Archaea"</span> <span class="sc">|</span></span>
<span id="cb16-2372"><a href="#cb16-2372" aria-hidden="true" tabindex="-1"></a>                                            Kingdom <span class="sc">==</span> <span class="st">"k__Bacteria"</span>)</span>
<span id="cb16-2373"><a href="#cb16-2373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb16-2374"><a href="#cb16-2374" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">filter_pollution</span>(<span class="at">taxa =</span> <span class="fu">c</span>(<span class="st">"mitochondria"</span>, <span class="st">"chloroplast"</span>))</span>
<span id="cb16-2375"><a href="#cb16-2375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb16-2376"><a href="#cb16-2376" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb16-2377"><a href="#cb16-2377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb16-2378"><a href="#cb16-2378" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>))</span>
<span id="cb16-2379"><a href="#cb16-2379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_dataset)</span>
<span id="cb16-2380"><a href="#cb16-2380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2381"><a href="#cb16-2381" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb16-2382"><a href="#cb16-2382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2383"><a href="#cb16-2383" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ssu18_ps_work_me, <span class="st">"include/pub/som/ssu18_ps_work_me.rds"</span>)</span>
<span id="cb16-2384"><a href="#cb16-2384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2385"><a href="#cb16-2385" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Now, we calculate the taxa abundance at each taxonomic rank using </span></span>
<span id="cb16-2386"><a href="#cb16-2386" aria-hidden="true" tabindex="-1"></a><span class="do">## `cal_abund()`. This function return a list called `taxa_abund` containing </span></span>
<span id="cb16-2387"><a href="#cb16-2387" aria-hidden="true" tabindex="-1"></a><span class="do">## several data frame of the abundance information at each taxonomic rank. </span></span>
<span id="cb16-2388"><a href="#cb16-2388" aria-hidden="true" tabindex="-1"></a><span class="do">## The list is stored in the microtable object automatically. </span></span>
<span id="cb16-2389"><a href="#cb16-2389" aria-hidden="true" tabindex="-1"></a><span class="do">## Itâ€™s worth noting that the `cal_abund()` function can be used to solve </span></span>
<span id="cb16-2390"><a href="#cb16-2390" aria-hidden="true" tabindex="-1"></a><span class="do">## some complex cases, such as supporting both the relative and absolute </span></span>
<span id="cb16-2391"><a href="#cb16-2391" aria-hidden="true" tabindex="-1"></a><span class="do">## abundance calculation and selecting the partial taxonomic columns. More </span></span>
<span id="cb16-2392"><a href="#cb16-2392" aria-hidden="true" tabindex="-1"></a><span class="do">## information can be found in the description of the </span></span>
<span id="cb16-2393"><a href="#cb16-2393" aria-hidden="true" tabindex="-1"></a><span class="do">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span></span>
<span id="cb16-2394"><a href="#cb16-2394" aria-hidden="true" tabindex="-1"></a><span class="do">## In the same loop we also create a `trans_abund` class, which is used to </span></span>
<span id="cb16-2395"><a href="#cb16-2395" aria-hidden="true" tabindex="-1"></a><span class="do">## transform taxonomic abundance data for plotting.</span></span>
<span id="cb16-2396"><a href="#cb16-2396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2397"><a href="#cb16-2397" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2398"><a href="#cb16-2398" aria-hidden="true" tabindex="-1"></a>  tmp_me <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb16-2399"><a href="#cb16-2399" aria-hidden="true" tabindex="-1"></a>  tmp_me<span class="sc">$</span><span class="fu">cal_abund</span>()</span>
<span id="cb16-2400"><a href="#cb16-2400" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund <span class="ot">&lt;-</span></span>
<span id="cb16-2401"><a href="#cb16-2401" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_me,</span>
<span id="cb16-2402"><a href="#cb16-2402" aria-hidden="true" tabindex="-1"></a>                    <span class="at">taxrank =</span> <span class="st">"Phylum"</span>,</span>
<span id="cb16-2403"><a href="#cb16-2403" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ntaxa =</span> <span class="dv">12</span>)</span>
<span id="cb16-2404"><a href="#cb16-2404" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb16-2405"><a href="#cb16-2405" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-2406"><a href="#cb16-2406" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr <span class="ot">&lt;-</span></span>
<span id="cb16-2407"><a href="#cb16-2407" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb16-2408"><a href="#cb16-2408" aria-hidden="true" tabindex="-1"></a>      <span class="at">dataset =</span> tmp_me,</span>
<span id="cb16-2409"><a href="#cb16-2409" aria-hidden="true" tabindex="-1"></a>      <span class="at">taxrank =</span> <span class="st">"Phylum"</span>,</span>
<span id="cb16-2410"><a href="#cb16-2410" aria-hidden="true" tabindex="-1"></a>      <span class="at">ntaxa =</span> <span class="dv">12</span>,</span>
<span id="cb16-2411"><a href="#cb16-2411" aria-hidden="true" tabindex="-1"></a>      <span class="at">groupmean =</span> <span class="st">"TEMP"</span></span>
<span id="cb16-2412"><a href="#cb16-2412" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2413"><a href="#cb16-2413" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb16-2414"><a href="#cb16-2414" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-2415"><a href="#cb16-2415" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>))</span>
<span id="cb16-2416"><a href="#cb16-2416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_me_abund)</span>
<span id="cb16-2417"><a href="#cb16-2417" aria-hidden="true" tabindex="-1"></a>  tmp_name_gr <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>))</span>
<span id="cb16-2418"><a href="#cb16-2418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_gr, tmp_me_abund_gr)</span>
<span id="cb16-2419"><a href="#cb16-2419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2420"><a href="#cb16-2420" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2421"><a href="#cb16-2421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2422"><a href="#cb16-2422" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) I prefer to specify the order of taxa in these kinds of plots. </span></span>
<span id="cb16-2423"><a href="#cb16-2423" aria-hidden="true" tabindex="-1"></a><span class="do">## We can look the top `ntaxa` (defined above) by accessing the </span></span>
<span id="cb16-2424"><a href="#cb16-2424" aria-hidden="true" tabindex="-1"></a><span class="do">## `data_taxanames` character vector of each microtable object.</span></span>
<span id="cb16-2425"><a href="#cb16-2425" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we can define the order. Once we do that, we will override the </span></span>
<span id="cb16-2426"><a href="#cb16-2426" aria-hidden="true" tabindex="-1"></a><span class="do">## `data_taxanames` character vectors with the reordered vectors.</span></span>
<span id="cb16-2427"><a href="#cb16-2427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2428"><a href="#cb16-2428" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_tax_ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alphaproteobacteria"</span>, <span class="st">"Gammaproteobacteria"</span>, </span>
<span id="cb16-2429"><a href="#cb16-2429" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, </span>
<span id="cb16-2430"><a href="#cb16-2430" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Myxococcota"</span>, </span>
<span id="cb16-2431"><a href="#cb16-2431" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Verrucomicrobiota"</span>, <span class="st">"Chloroflexi"</span>, </span>
<span id="cb16-2432"><a href="#cb16-2432" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Planctomycetota"</span>, <span class="st">"Methylomirabilota"</span>, </span>
<span id="cb16-2433"><a href="#cb16-2433" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Crenarchaeota"</span>)</span>
<span id="cb16-2434"><a href="#cb16-2434" aria-hidden="true" tabindex="-1"></a><span class="do">## 7) And one more little step before plotting. </span></span>
<span id="cb16-2435"><a href="#cb16-2435" aria-hidden="true" tabindex="-1"></a><span class="do">## Here we  **a**) specify a custom color palette and  </span></span>
<span id="cb16-2436"><a href="#cb16-2436" aria-hidden="true" tabindex="-1"></a><span class="do">## **b**) specify the sample order. </span></span>
<span id="cb16-2437"><a href="#cb16-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2438"><a href="#cb16-2438" aria-hidden="true" tabindex="-1"></a>top_level <span class="ot">&lt;-</span> <span class="st">"Phylum"</span></span>
<span id="cb16-2439"><a href="#cb16-2439" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-2440"><a href="#cb16-2440" aria-hidden="true" tabindex="-1"></a>ssu18_colvec.tax <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#00463C"</span>,<span class="st">"#FFD5FD"</span>,<span class="st">"#00A51C"</span>,<span class="st">"#C80B2A"</span>,<span class="st">"#00C7F9"</span>,</span>
<span id="cb16-2441"><a href="#cb16-2441" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#FFA035"</span>, <span class="st">"#ED0DFD"</span>,<span class="st">"#0063E5"</span>,<span class="st">"#5FFFDE"</span>,<span class="st">"#C00B6F"</span>,</span>
<span id="cb16-2442"><a href="#cb16-2442" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#00A090"</span>,<span class="st">"#FF95BA"</span>)</span>
<span id="cb16-2443"><a href="#cb16-2443" aria-hidden="true" tabindex="-1"></a>ssu18_samp_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, </span>
<span id="cb16-2444"><a href="#cb16-2444" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, </span>
<span id="cb16-2445"><a href="#cb16-2445" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P05_D00_010_W3C"</span>, <span class="st">"P07_D00_010_W3D"</span>, </span>
<span id="cb16-2446"><a href="#cb16-2446" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P09_D00_010_W3E"</span>, <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, </span>
<span id="cb16-2447"><a href="#cb16-2447" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P05_D00_010_W8C"</span>, <span class="st">"P07_D00_010_W8D"</span>, <span class="st">"P09_D00_010_W8E"</span>)</span>
<span id="cb16-2448"><a href="#cb16-2448" aria-hidden="true" tabindex="-1"></a><span class="do">## 8) Now we can generate plots (in a loop) for each faceted data set.</span></span>
<span id="cb16-2449"><a href="#cb16-2449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2450"><a href="#cb16-2450" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2451"><a href="#cb16-2451" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>)))</span>
<span id="cb16-2452"><a href="#cb16-2452" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb16-2453"><a href="#cb16-2453" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb16-2454"><a href="#cb16-2454" aria-hidden="true" tabindex="-1"></a>  tmp_facet_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2455"><a href="#cb16-2455" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb16-2456"><a href="#cb16-2456" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> ssu18_colvec.tax,</span>
<span id="cb16-2457"><a href="#cb16-2457" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb16-2458"><a href="#cb16-2458" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb16-2459"><a href="#cb16-2459" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-2460"><a href="#cb16-2460" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2461"><a href="#cb16-2461" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2462"><a href="#cb16-2462" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">6</span>,</span>
<span id="cb16-2463"><a href="#cb16-2463" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span>,</span>
<span id="cb16-2464"><a href="#cb16-2464" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_x =</span> ssu18_samp_order</span>
<span id="cb16-2465"><a href="#cb16-2465" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2466"><a href="#cb16-2466" aria-hidden="true" tabindex="-1"></a>  tmp_facet_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>))</span>
<span id="cb16-2467"><a href="#cb16-2467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_facet_name, tmp_facet_plot)</span>
<span id="cb16-2468"><a href="#cb16-2468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2469"><a href="#cb16-2469" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2470"><a href="#cb16-2470" aria-hidden="true" tabindex="-1"></a><span class="do">## Then add a little formatting to the faceted plots.</span></span>
<span id="cb16-2471"><a href="#cb16-2471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2472"><a href="#cb16-2472" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work_facet_plot"</span>)</span>
<span id="cb16-2473"><a href="#cb16-2473" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb16-2474"><a href="#cb16-2474" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2475"><a href="#cb16-2475" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb16-2476"><a href="#cb16-2476" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-2477"><a href="#cb16-2477" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb16-2478"><a href="#cb16-2478" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> top_level,</span>
<span id="cb16-2479"><a href="#cb16-2479" aria-hidden="true" tabindex="-1"></a>      <span class="at">reverse =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2480"><a href="#cb16-2480" aria-hidden="true" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fl">0.7</span>,</span>
<span id="cb16-2481"><a href="#cb16-2481" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fl">0.7</span></span>
<span id="cb16-2482"><a href="#cb16-2482" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb16-2483"><a href="#cb16-2483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Sample"</span>) <span class="sc">+</span></span>
<span id="cb16-2484"><a href="#cb16-2484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-2485"><a href="#cb16-2485" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2486"><a href="#cb16-2486" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2487"><a href="#cb16-2487" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2488"><a href="#cb16-2488" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2489"><a href="#cb16-2489" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb16-2490"><a href="#cb16-2490" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb16-2491"><a href="#cb16-2491" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb16-2492"><a href="#cb16-2492" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb16-2493"><a href="#cb16-2493" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb16-2494"><a href="#cb16-2494" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb16-2495"><a href="#cb16-2495" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb16-2496"><a href="#cb16-2496" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb16-2497"><a href="#cb16-2497" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-2498"><a href="#cb16-2498" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb16-2499"><a href="#cb16-2499" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb16-2500"><a href="#cb16-2500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb16-2501"><a href="#cb16-2501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2502"><a href="#cb16-2502" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2503"><a href="#cb16-2503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2504"><a href="#cb16-2504" aria-hidden="true" tabindex="-1"></a><span class="do">## And now plots for the group-means sets. We can use the same </span></span>
<span id="cb16-2505"><a href="#cb16-2505" aria-hidden="true" tabindex="-1"></a><span class="do">## taxa order since that should not have changed.</span></span>
<span id="cb16-2506"><a href="#cb16-2506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2507"><a href="#cb16-2507" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work_group_plot"</span>)</span>
<span id="cb16-2508"><a href="#cb16-2508" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2509"><a href="#cb16-2509" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>)))</span>
<span id="cb16-2510"><a href="#cb16-2510" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb16-2511"><a href="#cb16-2511" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb16-2512"><a href="#cb16-2512" aria-hidden="true" tabindex="-1"></a>  tmp_group_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2513"><a href="#cb16-2513" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb16-2514"><a href="#cb16-2514" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> ssu18_colvec.tax,</span>
<span id="cb16-2515"><a href="#cb16-2515" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb16-2516"><a href="#cb16-2516" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-2517"><a href="#cb16-2517" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-2518"><a href="#cb16-2518" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2519"><a href="#cb16-2519" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">10</span>,</span>
<span id="cb16-2520"><a href="#cb16-2520" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span></span>
<span id="cb16-2521"><a href="#cb16-2521" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2522"><a href="#cb16-2522" aria-hidden="true" tabindex="-1"></a>  tmp_group_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>))</span>
<span id="cb16-2523"><a href="#cb16-2523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_group_name, tmp_group_plot)</span>
<span id="cb16-2524"><a href="#cb16-2524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2525"><a href="#cb16-2525" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2526"><a href="#cb16-2526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2527"><a href="#cb16-2527" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's also add a little formatting to the groupmean plots.</span></span>
<span id="cb16-2528"><a href="#cb16-2528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2529"><a href="#cb16-2529" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb16-2530"><a href="#cb16-2530" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2531"><a href="#cb16-2531" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb16-2532"><a href="#cb16-2532" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-2533"><a href="#cb16-2533" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative Abundance (% total reads)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Temperature"</span>) <span class="sc">+</span></span>
<span id="cb16-2534"><a href="#cb16-2534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-2535"><a href="#cb16-2535" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2536"><a href="#cb16-2536" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2537"><a href="#cb16-2537" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2538"><a href="#cb16-2538" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2539"><a href="#cb16-2539" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb16-2540"><a href="#cb16-2540" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb16-2541"><a href="#cb16-2541" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb16-2542"><a href="#cb16-2542" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb16-2543"><a href="#cb16-2543" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-2544"><a href="#cb16-2544" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb16-2545"><a href="#cb16-2545" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2546"><a href="#cb16-2546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb16-2547"><a href="#cb16-2547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2548"><a href="#cb16-2548" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2549"><a href="#cb16-2549" aria-hidden="true" tabindex="-1"></a><span class="do">## 10) Finally we use the `patchwork` package to combine the </span></span>
<span id="cb16-2550"><a href="#cb16-2550" aria-hidden="true" tabindex="-1"></a><span class="do">## two plots and customize the look.</span></span>
<span id="cb16-2551"><a href="#cb16-2551" aria-hidden="true" tabindex="-1"></a><span class="do">## single index that acts as an index for referencing elements (variables) in a list</span></span>
<span id="cb16-2552"><a href="#cb16-2552" aria-hidden="true" tabindex="-1"></a><span class="do">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span></span>
<span id="cb16-2553"><a href="#cb16-2553" aria-hidden="true" tabindex="-1"></a>var_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">var1 =</span> ssu18_data_sets,</span>
<span id="cb16-2554"><a href="#cb16-2554" aria-hidden="true" tabindex="-1"></a>                 <span class="at">var2 =</span> <span class="fu">c</span>(<span class="st">"FULL"</span>))</span>
<span id="cb16-2555"><a href="#cb16-2555" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(var_list<span class="sc">$</span>var1)) {</span>
<span id="cb16-2556"><a href="#cb16-2556" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final_name <span class="ot">&lt;-</span></span>
<span id="cb16-2557"><a href="#cb16-2557" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level, <span class="st">"_plot_final"</span>))</span>
<span id="cb16-2558"><a href="#cb16-2558" aria-hidden="true" tabindex="-1"></a>  tmp_set_type <span class="ot">&lt;-</span> var_list<span class="sc">$</span>var2[j]</span>
<span id="cb16-2559"><a href="#cb16-2559" aria-hidden="true" tabindex="-1"></a>  tmp_p_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2560"><a href="#cb16-2560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>)))</span>
<span id="cb16-2561"><a href="#cb16-2561" aria-hidden="true" tabindex="-1"></a>  tmp_m_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2562"><a href="#cb16-2562" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>)))</span>
<span id="cb16-2563"><a href="#cb16-2563" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_p_plot <span class="sc">+</span> tmp_m_plot</span>
<span id="cb16-2564"><a href="#cb16-2564" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_plot_final <span class="sc">+</span></span>
<span id="cb16-2565"><a href="#cb16-2565" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"a"</span>) <span class="sc">+</span></span>
<span id="cb16-2566"><a href="#cb16-2566" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb16-2567"><a href="#cb16-2567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-2568"><a href="#cb16-2568" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb16-2569"><a href="#cb16-2569" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb16-2570"><a href="#cb16-2570" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb16-2571"><a href="#cb16-2571" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb16-2572"><a href="#cb16-2572" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb16-2573"><a href="#cb16-2573" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2574"><a href="#cb16-2574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plot_final_name, tmp_plot_final)</span>
<span id="cb16-2575"><a href="#cb16-2575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2576"><a href="#cb16-2576" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2577"><a href="#cb16-2577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2578"><a href="#cb16-2578" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-2579"><a href="#cb16-2579" aria-hidden="true" tabindex="-1"></a>   tmp_plot_final <span class="ot">&lt;-</span> </span>
<span id="cb16-2580"><a href="#cb16-2580" aria-hidden="true" tabindex="-1"></a>     <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level,  <span class="st">"_plot_final"</span>)))</span>
<span id="cb16-2581"><a href="#cb16-2581" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-2582"><a href="#cb16-2582" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb16-2583"><a href="#cb16-2583" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/som/"</span>, i, <span class="st">"_tax_div_bar_plots.png"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-2584"><a href="#cb16-2584" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-2585"><a href="#cb16-2585" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-2586"><a href="#cb16-2586" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb16-2587"><a href="#cb16-2587" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/som/"</span>, i, <span class="st">"_tax_div_bar_plots.pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-2588"><a href="#cb16-2588" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-2589"><a href="#cb16-2589" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2590"><a href="#cb16-2590" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2591"><a href="#cb16-2591" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/som/ssu18_ps_work_tax_div_bar_plots.png"</span>, </span>
<span id="cb16-2592"><a href="#cb16-2592" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/som/Supplementary_Figure_1.png"</span>)</span>
<span id="cb16-2593"><a href="#cb16-2593" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/som/ssu18_ps_work_tax_div_bar_plots.pdf"</span>, </span>
<span id="cb16-2594"><a href="#cb16-2594" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/som/Supplementary_Figure_1.pdf"</span>)</span>
<span id="cb16-2595"><a href="#cb16-2595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-2596"><a href="#cb16-2596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2597"><a href="#cb16-2597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2598"><a href="#cb16-2598" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 2</span></span>
<span id="cb16-2599"><a href="#cb16-2599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2600"><a href="#cb16-2600" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-2601"><a href="#cb16-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2602"><a href="#cb16-2602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-2603"><a href="#cb16-2603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2604"><a href="#cb16-2604" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb16-2605"><a href="#cb16-2605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2606"><a href="#cb16-2606" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2607"><a href="#cb16-2607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2608"><a href="#cb16-2608" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-2609"><a href="#cb16-2609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2610"><a href="#cb16-2610" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-2611"><a href="#cb16-2611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2612"><a href="#cb16-2612" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_2.png)</span></span>
<span id="cb16-2613"><a href="#cb16-2613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2614"><a href="#cb16-2614" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-2615"><a href="#cb16-2615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2616"><a href="#cb16-2616" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_main_its.png)</span></span>
<span id="cb16-2617"><a href="#cb16-2617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2618"><a href="#cb16-2618" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2619"><a href="#cb16-2619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2620"><a href="#cb16-2620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2621"><a href="#cb16-2621" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-2622"><a href="#cb16-2622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2623"><a href="#cb16-2623" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-2624"><a href="#cb16-2624" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/its18_ps_work.rds)</span>  </span>
<span id="cb16-2625"><a href="#cb16-2625" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2626"><a href="#cb16-2626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2627"><a href="#cb16-2627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2628"><a href="#cb16-2628" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-2629"><a href="#cb16-2629" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Supplementary_Figure_2.pdf)</span></span>
<span id="cb16-2630"><a href="#cb16-2630" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2631"><a href="#cb16-2631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2632"><a href="#cb16-2632" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2633"><a href="#cb16-2633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2634"><a href="#cb16-2634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2637"><a href="#cb16-2637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-2638"><a href="#cb16-2638" aria-hidden="true" tabindex="-1"></a>its18_ps_work <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/som/its18_ps_work.rds"</span>)</span>
<span id="cb16-2639"><a href="#cb16-2639" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-2640"><a href="#cb16-2640" aria-hidden="true" tabindex="-1"></a>its18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_work"</span>)</span>
<span id="cb16-2641"><a href="#cb16-2641" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Choose the **number** of taxa to display and the </span></span>
<span id="cb16-2642"><a href="#cb16-2642" aria-hidden="true" tabindex="-1"></a><span class="do">## taxonomic **level**. Aggregate the rest into "Other".</span></span>
<span id="cb16-2643"><a href="#cb16-2643" aria-hidden="true" tabindex="-1"></a>top_hits <span class="ot">&lt;-</span> <span class="dv">14</span></span>
<span id="cb16-2644"><a href="#cb16-2644" aria-hidden="true" tabindex="-1"></a>top_level <span class="ot">&lt;-</span> <span class="st">"Order"</span></span>
<span id="cb16-2645"><a href="#cb16-2645" aria-hidden="true" tabindex="-1"></a><span class="do">## As above, in order to use `microeco`, we need to add the rank </span></span>
<span id="cb16-2646"><a href="#cb16-2646" aria-hidden="true" tabindex="-1"></a><span class="do">## designation as a prefix to each taxa. For example, `Basidiomycota` </span></span>
<span id="cb16-2647"><a href="#cb16-2647" aria-hidden="true" tabindex="-1"></a><span class="do">## is changed to `p__Basidiomycota`. </span></span>
<span id="cb16-2648"><a href="#cb16-2648" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-2649"><a href="#cb16-2649" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2650"><a href="#cb16-2650" aria-hidden="true" tabindex="-1"></a>  tmp_sam_data <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(tmp_get)</span>
<span id="cb16-2651"><a href="#cb16-2651" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb16-2652"><a href="#cb16-2652" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span></span>
<span id="cb16-2653"><a href="#cb16-2653" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-2654"><a href="#cb16-2654" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2655"><a href="#cb16-2655" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Kingdom <span class="ot">&lt;-</span></span>
<span id="cb16-2656"><a href="#cb16-2656" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"k__"</span>, tmp_tax_data<span class="sc">$</span>Kingdom, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2657"><a href="#cb16-2657" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Phylum <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"p__"</span>, tmp_tax_data<span class="sc">$</span>Phylum, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2658"><a href="#cb16-2658" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"c__"</span>, tmp_tax_data<span class="sc">$</span>Class, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2659"><a href="#cb16-2659" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Order <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"o__"</span>, tmp_tax_data<span class="sc">$</span>Order, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2660"><a href="#cb16-2660" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Family <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"f__"</span>, tmp_tax_data<span class="sc">$</span>Family, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2661"><a href="#cb16-2661" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Genus <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"g__"</span>, tmp_tax_data<span class="sc">$</span>Genus, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-2662"><a href="#cb16-2662" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax_data)</span>
<span id="cb16-2663"><a href="#cb16-2663" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2664"><a href="#cb16-2664" aria-hidden="true" tabindex="-1"></a>  tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(tmp_get),</span>
<span id="cb16-2665"><a href="#cb16-2665" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">tax_table</span>(tmp_tax_data),</span>
<span id="cb16-2666"><a href="#cb16-2666" aria-hidden="true" tabindex="-1"></a>                     tmp_sam_data)</span>
<span id="cb16-2667"><a href="#cb16-2667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_ps)</span>
<span id="cb16-2668"><a href="#cb16-2668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2669"><a href="#cb16-2669" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2670"><a href="#cb16-2670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2671"><a href="#cb16-2671" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-2672"><a href="#cb16-2672" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2673"><a href="#cb16-2673" aria-hidden="true" tabindex="-1"></a>  tmp_otu_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb16-2674"><a href="#cb16-2674" aria-hidden="true" tabindex="-1"></a>  tmp_sample_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb16-2675"><a href="#cb16-2675" aria-hidden="true" tabindex="-1"></a>  tmp_taxonomy_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb16-2676"><a href="#cb16-2676" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> microtable<span class="sc">$</span><span class="fu">new</span>(<span class="at">sample_table =</span> tmp_sample_info,</span>
<span id="cb16-2677"><a href="#cb16-2677" aria-hidden="true" tabindex="-1"></a>                                <span class="at">otu_table =</span> tmp_otu_table,</span>
<span id="cb16-2678"><a href="#cb16-2678" aria-hidden="true" tabindex="-1"></a>                                <span class="at">tax_table =</span> tmp_taxonomy_table)</span>
<span id="cb16-2679"><a href="#cb16-2679" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb16-2680"><a href="#cb16-2680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb16-2681"><a href="#cb16-2681" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span>tax_table <span class="sc">%&lt;&gt;%</span> base<span class="sc">::</span><span class="fu">subset</span>(Kingdom <span class="sc">==</span> <span class="st">"k__Fungi"</span>)</span>
<span id="cb16-2682"><a href="#cb16-2682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb16-2683"><a href="#cb16-2683" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb16-2684"><a href="#cb16-2684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb16-2685"><a href="#cb16-2685" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>))</span>
<span id="cb16-2686"><a href="#cb16-2686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_dataset)</span>
<span id="cb16-2687"><a href="#cb16-2687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2688"><a href="#cb16-2688" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb16-2689"><a href="#cb16-2689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2690"><a href="#cb16-2690" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(its18_ps_work_me, <span class="st">"include/pub/som/its18_ps_work_me.rds"</span>)</span>
<span id="cb16-2691"><a href="#cb16-2691" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Now, we calculate the taxa abundance at each taxonomic </span></span>
<span id="cb16-2692"><a href="#cb16-2692" aria-hidden="true" tabindex="-1"></a><span class="do">## rank using `cal_abund()`. This function return a list called </span></span>
<span id="cb16-2693"><a href="#cb16-2693" aria-hidden="true" tabindex="-1"></a><span class="do">## `taxa_abund` containing several data frame of the abundance </span></span>
<span id="cb16-2694"><a href="#cb16-2694" aria-hidden="true" tabindex="-1"></a><span class="do">## information at each taxonomic rank. The list is stored in the </span></span>
<span id="cb16-2695"><a href="#cb16-2695" aria-hidden="true" tabindex="-1"></a><span class="do">## microtable object automatically. Itâ€™s worth noting that the </span></span>
<span id="cb16-2696"><a href="#cb16-2696" aria-hidden="true" tabindex="-1"></a><span class="do">## `cal_abund()` function can be used to solve some complex cases, </span></span>
<span id="cb16-2697"><a href="#cb16-2697" aria-hidden="true" tabindex="-1"></a><span class="do">## such as supporting both the relative and absolute abundance </span></span>
<span id="cb16-2698"><a href="#cb16-2698" aria-hidden="true" tabindex="-1"></a><span class="do">## calculation and selecting the partial taxonomic columns. </span></span>
<span id="cb16-2699"><a href="#cb16-2699" aria-hidden="true" tabindex="-1"></a><span class="do">## More information can be found in the description of the </span></span>
<span id="cb16-2700"><a href="#cb16-2700" aria-hidden="true" tabindex="-1"></a><span class="do">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span></span>
<span id="cb16-2701"><a href="#cb16-2701" aria-hidden="true" tabindex="-1"></a><span class="do">## In the same loop we also create a `trans_abund` class, which </span></span>
<span id="cb16-2702"><a href="#cb16-2702" aria-hidden="true" tabindex="-1"></a><span class="do">## is used to transform taxonomic abundance data for plotting.</span></span>
<span id="cb16-2703"><a href="#cb16-2703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2704"><a href="#cb16-2704" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-2705"><a href="#cb16-2705" aria-hidden="true" tabindex="-1"></a>  tmp_me <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb16-2706"><a href="#cb16-2706" aria-hidden="true" tabindex="-1"></a>  tmp_me<span class="sc">$</span><span class="fu">cal_abund</span>()</span>
<span id="cb16-2707"><a href="#cb16-2707" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund <span class="ot">&lt;-</span></span>
<span id="cb16-2708"><a href="#cb16-2708" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_me,</span>
<span id="cb16-2709"><a href="#cb16-2709" aria-hidden="true" tabindex="-1"></a>                    <span class="at">taxrank =</span> top_level,</span>
<span id="cb16-2710"><a href="#cb16-2710" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ntaxa =</span> top_hits)</span>
<span id="cb16-2711"><a href="#cb16-2711" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb16-2712"><a href="#cb16-2712" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-2713"><a href="#cb16-2713" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr <span class="ot">&lt;-</span></span>
<span id="cb16-2714"><a href="#cb16-2714" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb16-2715"><a href="#cb16-2715" aria-hidden="true" tabindex="-1"></a>      <span class="at">dataset =</span> tmp_me,</span>
<span id="cb16-2716"><a href="#cb16-2716" aria-hidden="true" tabindex="-1"></a>      <span class="at">taxrank =</span> top_level,</span>
<span id="cb16-2717"><a href="#cb16-2717" aria-hidden="true" tabindex="-1"></a>      <span class="at">ntaxa =</span> top_hits,</span>
<span id="cb16-2718"><a href="#cb16-2718" aria-hidden="true" tabindex="-1"></a>      <span class="at">groupmean =</span> <span class="st">"TEMP"</span></span>
<span id="cb16-2719"><a href="#cb16-2719" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2720"><a href="#cb16-2720" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb16-2721"><a href="#cb16-2721" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-2722"><a href="#cb16-2722" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>))</span>
<span id="cb16-2723"><a href="#cb16-2723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_me_abund)</span>
<span id="cb16-2724"><a href="#cb16-2724" aria-hidden="true" tabindex="-1"></a>  tmp_name_gr <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>))</span>
<span id="cb16-2725"><a href="#cb16-2725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_gr, tmp_me_abund_gr)</span>
<span id="cb16-2726"><a href="#cb16-2726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2727"><a href="#cb16-2727" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2728"><a href="#cb16-2728" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) I prefer to specify the order of taxa in these kinds of plots. </span></span>
<span id="cb16-2729"><a href="#cb16-2729" aria-hidden="true" tabindex="-1"></a><span class="do">## We can look the top `ntaxa` (defined above) by accessing the </span></span>
<span id="cb16-2730"><a href="#cb16-2730" aria-hidden="true" tabindex="-1"></a><span class="do">## `data_taxanames` character vector of each microtable object.</span></span>
<span id="cb16-2731"><a href="#cb16-2731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2732"><a href="#cb16-2732" aria-hidden="true" tabindex="-1"></a>its18_ps_work_tax_ord <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(</span>
<span id="cb16-2733"><a href="#cb16-2733" aria-hidden="true" tabindex="-1"></a>  <span class="st">"k_Fungi"</span>,  <span class="st">"p_Ascomycota"</span>,  <span class="st">"c_Agaricomycetes"</span>, <span class="st">"Agaricales"</span>,  </span>
<span id="cb16-2734"><a href="#cb16-2734" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Archaeorhizomycetales"</span>,  <span class="st">"Capnodiales"</span>,  <span class="st">"Eurotiales"</span>,  <span class="st">"Geastrales"</span>,  </span>
<span id="cb16-2735"><a href="#cb16-2735" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Glomerales"</span>,  <span class="st">"Helotiales"</span>, <span class="st">"Hypocreales"</span>,  <span class="st">"Saccharomycetales"</span>,  </span>
<span id="cb16-2736"><a href="#cb16-2736" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Trichosporonales"</span>,  <span class="st">"Xylariales"</span>))   </span>
<span id="cb16-2737"><a href="#cb16-2737" aria-hidden="true" tabindex="-1"></a><span class="do">## And one more little step before plotting. Here we  </span></span>
<span id="cb16-2738"><a href="#cb16-2738" aria-hidden="true" tabindex="-1"></a><span class="do">## **a**) specify a custom color palette and  </span></span>
<span id="cb16-2739"><a href="#cb16-2739" aria-hidden="true" tabindex="-1"></a><span class="do">## **b**) specify the sample order. </span></span>
<span id="cb16-2740"><a href="#cb16-2740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2741"><a href="#cb16-2741" aria-hidden="true" tabindex="-1"></a>its18_colvec.tax <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"#323232"</span>, <span class="st">"#004949"</span>, <span class="st">"#924900"</span>, <span class="st">"#490092"</span>, </span>
<span id="cb16-2742"><a href="#cb16-2742" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#6db6ff"</span>, <span class="st">"#920000"</span>, <span class="st">"#ffb6db"</span>, <span class="st">"#24ff24"</span>, </span>
<span id="cb16-2743"><a href="#cb16-2743" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#006ddb"</span>, <span class="st">"#db6d00"</span>, <span class="st">"#b66dff"</span>, <span class="st">"#ffff6d"</span>, </span>
<span id="cb16-2744"><a href="#cb16-2744" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#009292"</span>, <span class="st">"#b6dbff"</span>, <span class="st">"#ff6db6"</span>))</span>
<span id="cb16-2745"><a href="#cb16-2745" aria-hidden="true" tabindex="-1"></a>its18_samp_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, </span>
<span id="cb16-2746"><a href="#cb16-2746" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, </span>
<span id="cb16-2747"><a href="#cb16-2747" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P07_D00_010_W3D"</span>, <span class="st">"P09_D00_010_W3E"</span>, </span>
<span id="cb16-2748"><a href="#cb16-2748" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, <span class="st">"P05_D00_010_W8C"</span>, </span>
<span id="cb16-2749"><a href="#cb16-2749" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P07_D00_010_W8D"</span>)</span>
<span id="cb16-2750"><a href="#cb16-2750" aria-hidden="true" tabindex="-1"></a><span class="do">## 8) Now we can generate plots (in a loop) for each faceted data set.</span></span>
<span id="cb16-2751"><a href="#cb16-2751" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-2752"><a href="#cb16-2752" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>)))</span>
<span id="cb16-2753"><a href="#cb16-2753" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb16-2754"><a href="#cb16-2754" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb16-2755"><a href="#cb16-2755" aria-hidden="true" tabindex="-1"></a>  tmp_facet_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2756"><a href="#cb16-2756" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb16-2757"><a href="#cb16-2757" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> its18_colvec.tax,</span>
<span id="cb16-2758"><a href="#cb16-2758" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb16-2759"><a href="#cb16-2759" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb16-2760"><a href="#cb16-2760" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-2761"><a href="#cb16-2761" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2762"><a href="#cb16-2762" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2763"><a href="#cb16-2763" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">6</span>,</span>
<span id="cb16-2764"><a href="#cb16-2764" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span>,</span>
<span id="cb16-2765"><a href="#cb16-2765" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_x =</span> its18_samp_order</span>
<span id="cb16-2766"><a href="#cb16-2766" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2767"><a href="#cb16-2767" aria-hidden="true" tabindex="-1"></a>  tmp_facet_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>))</span>
<span id="cb16-2768"><a href="#cb16-2768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_facet_name, tmp_facet_plot)</span>
<span id="cb16-2769"><a href="#cb16-2769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2770"><a href="#cb16-2770" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2771"><a href="#cb16-2771" aria-hidden="true" tabindex="-1"></a><span class="do">## Then add a little formatting to the faceted plots.</span></span>
<span id="cb16-2772"><a href="#cb16-2772" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_work_facet_plot"</span>)</span>
<span id="cb16-2773"><a href="#cb16-2773" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb16-2774"><a href="#cb16-2774" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2775"><a href="#cb16-2775" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb16-2776"><a href="#cb16-2776" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-2777"><a href="#cb16-2777" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb16-2778"><a href="#cb16-2778" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> top_level,</span>
<span id="cb16-2779"><a href="#cb16-2779" aria-hidden="true" tabindex="-1"></a>      <span class="at">reverse =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2780"><a href="#cb16-2780" aria-hidden="true" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fl">0.7</span>,</span>
<span id="cb16-2781"><a href="#cb16-2781" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fl">0.7</span></span>
<span id="cb16-2782"><a href="#cb16-2782" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb16-2783"><a href="#cb16-2783" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Sample"</span>) <span class="sc">+</span></span>
<span id="cb16-2784"><a href="#cb16-2784" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-2785"><a href="#cb16-2785" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2786"><a href="#cb16-2786" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2787"><a href="#cb16-2787" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2788"><a href="#cb16-2788" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2789"><a href="#cb16-2789" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb16-2790"><a href="#cb16-2790" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb16-2791"><a href="#cb16-2791" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb16-2792"><a href="#cb16-2792" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb16-2793"><a href="#cb16-2793" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb16-2794"><a href="#cb16-2794" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb16-2795"><a href="#cb16-2795" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb16-2796"><a href="#cb16-2796" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb16-2797"><a href="#cb16-2797" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb16-2798"><a href="#cb16-2798" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb16-2799"><a href="#cb16-2799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb16-2800"><a href="#cb16-2800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2801"><a href="#cb16-2801" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2802"><a href="#cb16-2802" aria-hidden="true" tabindex="-1"></a><span class="do">## And now plots for the groupmeans sets. </span></span>
<span id="cb16-2803"><a href="#cb16-2803" aria-hidden="true" tabindex="-1"></a><span class="do">## We can use the same taxa order since that </span></span>
<span id="cb16-2804"><a href="#cb16-2804" aria-hidden="true" tabindex="-1"></a><span class="do">## should not have changed.</span></span>
<span id="cb16-2805"><a href="#cb16-2805" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_work_group_plot"</span>)</span>
<span id="cb16-2806"><a href="#cb16-2806" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-2807"><a href="#cb16-2807" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>)))</span>
<span id="cb16-2808"><a href="#cb16-2808" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb16-2809"><a href="#cb16-2809" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb16-2810"><a href="#cb16-2810" aria-hidden="true" tabindex="-1"></a>  tmp_group_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2811"><a href="#cb16-2811" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb16-2812"><a href="#cb16-2812" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> its18_colvec.tax,</span>
<span id="cb16-2813"><a href="#cb16-2813" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb16-2814"><a href="#cb16-2814" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-2815"><a href="#cb16-2815" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-2816"><a href="#cb16-2816" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-2817"><a href="#cb16-2817" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">10</span>,</span>
<span id="cb16-2818"><a href="#cb16-2818" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span></span>
<span id="cb16-2819"><a href="#cb16-2819" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2820"><a href="#cb16-2820" aria-hidden="true" tabindex="-1"></a>  tmp_group_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>))</span>
<span id="cb16-2821"><a href="#cb16-2821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_group_name, tmp_group_plot)</span>
<span id="cb16-2822"><a href="#cb16-2822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2823"><a href="#cb16-2823" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2824"><a href="#cb16-2824" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's also add a little formatting to the groupmean plots.</span></span>
<span id="cb16-2825"><a href="#cb16-2825" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb16-2826"><a href="#cb16-2826" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-2827"><a href="#cb16-2827" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb16-2828"><a href="#cb16-2828" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-2829"><a href="#cb16-2829" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative Abundance (% total reads)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Temperature"</span>) <span class="sc">+</span></span>
<span id="cb16-2830"><a href="#cb16-2830" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-2831"><a href="#cb16-2831" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2832"><a href="#cb16-2832" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-2833"><a href="#cb16-2833" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2834"><a href="#cb16-2834" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-2835"><a href="#cb16-2835" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb16-2836"><a href="#cb16-2836" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb16-2837"><a href="#cb16-2837" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb16-2838"><a href="#cb16-2838" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb16-2839"><a href="#cb16-2839" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-2840"><a href="#cb16-2840" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb16-2841"><a href="#cb16-2841" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2842"><a href="#cb16-2842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb16-2843"><a href="#cb16-2843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2844"><a href="#cb16-2844" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2845"><a href="#cb16-2845" aria-hidden="true" tabindex="-1"></a><span class="do">## 10) Finally we use the `patchwork` package to combine the </span></span>
<span id="cb16-2846"><a href="#cb16-2846" aria-hidden="true" tabindex="-1"></a><span class="do">## two plots and customize the look.</span></span>
<span id="cb16-2847"><a href="#cb16-2847" aria-hidden="true" tabindex="-1"></a><span class="do">## single index that acts as an index for referencing elements (variables) in a list</span></span>
<span id="cb16-2848"><a href="#cb16-2848" aria-hidden="true" tabindex="-1"></a><span class="do">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span></span>
<span id="cb16-2849"><a href="#cb16-2849" aria-hidden="true" tabindex="-1"></a>var_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">var1 =</span> its18_data_sets,</span>
<span id="cb16-2850"><a href="#cb16-2850" aria-hidden="true" tabindex="-1"></a>                 <span class="at">var2 =</span> <span class="fu">c</span>(<span class="st">"FULL"</span>))</span>
<span id="cb16-2851"><a href="#cb16-2851" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(var_list<span class="sc">$</span>var1)) {</span>
<span id="cb16-2852"><a href="#cb16-2852" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final_name <span class="ot">&lt;-</span></span>
<span id="cb16-2853"><a href="#cb16-2853" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level, <span class="st">"_plot_final"</span>))</span>
<span id="cb16-2854"><a href="#cb16-2854" aria-hidden="true" tabindex="-1"></a>  tmp_set_type <span class="ot">&lt;-</span> var_list<span class="sc">$</span>var2[j]</span>
<span id="cb16-2855"><a href="#cb16-2855" aria-hidden="true" tabindex="-1"></a>  tmp_p_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2856"><a href="#cb16-2856" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>)))</span>
<span id="cb16-2857"><a href="#cb16-2857" aria-hidden="true" tabindex="-1"></a>  tmp_m_plot <span class="ot">&lt;-</span></span>
<span id="cb16-2858"><a href="#cb16-2858" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>)))</span>
<span id="cb16-2859"><a href="#cb16-2859" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_p_plot <span class="sc">+</span> tmp_m_plot</span>
<span id="cb16-2860"><a href="#cb16-2860" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_plot_final <span class="sc">+</span></span>
<span id="cb16-2861"><a href="#cb16-2861" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"a"</span>) <span class="sc">+</span></span>
<span id="cb16-2862"><a href="#cb16-2862" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb16-2863"><a href="#cb16-2863" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-2864"><a href="#cb16-2864" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb16-2865"><a href="#cb16-2865" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb16-2866"><a href="#cb16-2866" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb16-2867"><a href="#cb16-2867" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb16-2868"><a href="#cb16-2868" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb16-2869"><a href="#cb16-2869" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-2870"><a href="#cb16-2870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plot_final_name, tmp_plot_final)</span>
<span id="cb16-2871"><a href="#cb16-2871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2872"><a href="#cb16-2872" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2873"><a href="#cb16-2873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2874"><a href="#cb16-2874" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb16-2875"><a href="#cb16-2875" aria-hidden="true" tabindex="-1"></a>   tmp_plot_final <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level,  <span class="st">"_plot_final"</span>)))</span>
<span id="cb16-2876"><a href="#cb16-2876" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-2877"><a href="#cb16-2877" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb16-2878"><a href="#cb16-2878" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/som/"</span>, i, <span class="st">"_tax_div_bar_plots.png"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-2879"><a href="#cb16-2879" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-2880"><a href="#cb16-2880" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-2881"><a href="#cb16-2881" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb16-2882"><a href="#cb16-2882" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/som/"</span>, i, <span class="st">"_tax_div_bar_plots.pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-2883"><a href="#cb16-2883" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb16-2884"><a href="#cb16-2884" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-2885"><a href="#cb16-2885" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2886"><a href="#cb16-2886" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/som/its18_ps_work_tax_div_bar_plots.png"</span>, </span>
<span id="cb16-2887"><a href="#cb16-2887" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/som/Supplementary_Figure_2.png"</span>)</span>
<span id="cb16-2888"><a href="#cb16-2888" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/som/its18_ps_work_tax_div_bar_plots.pdf"</span>, </span>
<span id="cb16-2889"><a href="#cb16-2889" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/som/Supplementary_Figure_2.pdf"</span>)</span>
<span id="cb16-2890"><a href="#cb16-2890" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-2891"><a href="#cb16-2891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2892"><a href="#cb16-2892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2893"><a href="#cb16-2893" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 3</span></span>
<span id="cb16-2894"><a href="#cb16-2894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2895"><a href="#cb16-2895" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-2896"><a href="#cb16-2896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2897"><a href="#cb16-2897" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-2898"><a href="#cb16-2898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2899"><a href="#cb16-2899" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<span class="in">`*`</span>). </span>
<span id="cb16-2900"><a href="#cb16-2900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2901"><a href="#cb16-2901" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2902"><a href="#cb16-2902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2903"><a href="#cb16-2903" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-2904"><a href="#cb16-2904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2905"><a href="#cb16-2905" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-2906"><a href="#cb16-2906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2907"><a href="#cb16-2907" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_3.png)</span></span>
<span id="cb16-2908"><a href="#cb16-2908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2909"><a href="#cb16-2909" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-2910"><a href="#cb16-2910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2911"><a href="#cb16-2911" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/ssu_supp_alpha_div.png)</span></span>
<span id="cb16-2912"><a href="#cb16-2912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2913"><a href="#cb16-2913" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2914"><a href="#cb16-2914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2915"><a href="#cb16-2915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2916"><a href="#cb16-2916" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-2917"><a href="#cb16-2917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2918"><a href="#cb16-2918" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-2919"><a href="#cb16-2919" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/ssu_alpha_diversity.rdata)</span>  </span>
<span id="cb16-2920"><a href="#cb16-2920" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2921"><a href="#cb16-2921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2922"><a href="#cb16-2922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2923"><a href="#cb16-2923" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-2924"><a href="#cb16-2924" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Supplementary_Figure_3.pdf)</span></span>
<span id="cb16-2925"><a href="#cb16-2925" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2926"><a href="#cb16-2926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2927"><a href="#cb16-2927" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-2928"><a href="#cb16-2928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2931"><a href="#cb16-2931" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-2932"><a href="#cb16-2932" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb16-2933"><a href="#cb16-2933" aria-hidden="true" tabindex="-1"></a>alpha_ds</span>
<span id="cb16-2934"><a href="#cb16-2934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-2935"><a href="#cb16-2935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2936"><a href="#cb16-2936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2939"><a href="#cb16-2939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-2940"><a href="#cb16-2940" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-2941"><a href="#cb16-2941" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/som/ssu_alpha_diversity.rdata"</span>)</span>
<span id="cb16-2942"><a href="#cb16-2942" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-2943"><a href="#cb16-2943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2944"><a href="#cb16-2944" aria-hidden="true" tabindex="-1"></a>div_test_plot_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (divtest, chart, colour, posthoc, threshold) </span>
<span id="cb16-2945"><a href="#cb16-2945" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-2946"><a href="#cb16-2946" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(chart)) {</span>
<span id="cb16-2947"><a href="#cb16-2947" aria-hidden="true" tabindex="-1"></a>        chart <span class="ot">=</span> <span class="st">"box"</span></span>
<span id="cb16-2948"><a href="#cb16-2948" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-2949"><a href="#cb16-2949" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(posthoc)) {</span>
<span id="cb16-2950"><a href="#cb16-2950" aria-hidden="true" tabindex="-1"></a>        posthoc <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb16-2951"><a href="#cb16-2951" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-2952"><a href="#cb16-2952" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">names</span>(divtest)[<span class="dv">1</span>] <span class="sc">!=</span> <span class="st">"data"</span>) <span class="sc">&amp;</span> (<span class="fu">names</span>(divtest)[<span class="dv">2</span>] <span class="sc">!=</span> </span>
<span id="cb16-2953"><a href="#cb16-2953" aria-hidden="true" tabindex="-1"></a>        <span class="st">"normality.pvalue"</span>)) </span>
<span id="cb16-2954"><a href="#cb16-2954" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"The input object does not seem to be a div_test output."</span>)</span>
<span id="cb16-2955"><a href="#cb16-2955" aria-hidden="true" tabindex="-1"></a>    divtestdata <span class="ot">&lt;-</span> divtest<span class="sc">$</span>data</span>
<span id="cb16-2956"><a href="#cb16-2956" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(divtestdata<span class="sc">$</span>Group)</span>
<span id="cb16-2957"><a href="#cb16-2957" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(divtestdata<span class="sc">$</span>Group, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(divtestdata<span class="sc">$</span>Group)))</span>
<span id="cb16-2958"><a href="#cb16-2958" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(colour) <span class="sc">||</span> (<span class="fu">length</span>(colour) <span class="sc">&lt;</span> divtest<span class="sc">$</span>groups)) {</span>
<span id="cb16-2959"><a href="#cb16-2959" aria-hidden="true" tabindex="-1"></a>        getPalette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(divtest<span class="sc">$</span>groups, </span>
<span id="cb16-2960"><a href="#cb16-2960" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Paired"</span>))</span>
<span id="cb16-2961"><a href="#cb16-2961" aria-hidden="true" tabindex="-1"></a>        colour <span class="ot">&lt;-</span> <span class="fu">getPalette</span>(divtest<span class="sc">$</span>groups)</span>
<span id="cb16-2962"><a href="#cb16-2962" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-2963"><a href="#cb16-2963" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-2964"><a href="#cb16-2964" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">names</span>(divtest)[<span class="dv">7</span>])) </span>
<span id="cb16-2965"><a href="#cb16-2965" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span id="cb16-2966"><a href="#cb16-2966" aria-hidden="true" tabindex="-1"></a><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span>)</span>
<span id="cb16-2967"><a href="#cb16-2967" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Tukey post-hoc test"</span>) {</span>
<span id="cb16-2968"><a href="#cb16-2968" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb16-2969"><a href="#cb16-2969" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb16-2970"><a href="#cb16-2970" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-2971"><a href="#cb16-2971" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">4</span>], <span class="dv">3</span>)</span>
<span id="cb16-2972"><a href="#cb16-2972" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb16-2973"><a href="#cb16-2973" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb16-2974"><a href="#cb16-2974" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb16-2975"><a href="#cb16-2975" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb16-2976"><a href="#cb16-2976" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-2977"><a href="#cb16-2977" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span>) {</span>
<span id="cb16-2978"><a href="#cb16-2978" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb16-2979"><a href="#cb16-2979" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb16-2980"><a href="#cb16-2980" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-2981"><a href="#cb16-2981" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">3</span>], <span class="dv">3</span>)</span>
<span id="cb16-2982"><a href="#cb16-2982" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb16-2983"><a href="#cb16-2983" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb16-2984"><a href="#cb16-2984" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb16-2985"><a href="#cb16-2985" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb16-2986"><a href="#cb16-2986" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-2987"><a href="#cb16-2987" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">1</span>])</span>
<span id="cb16-2988"><a href="#cb16-2988" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">2</span>])</span>
<span id="cb16-2989"><a href="#cb16-2989" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(pairwisetable[, </span>
<span id="cb16-2990"><a href="#cb16-2990" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>]))</span>
<span id="cb16-2991"><a href="#cb16-2991" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(threshold)) {</span>
<span id="cb16-2992"><a href="#cb16-2992" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> pairwisetable[<span class="fu">which</span>(pairwisetable<span class="sc">$</span>p <span class="sc">&lt;</span> </span>
<span id="cb16-2993"><a href="#cb16-2993" aria-hidden="true" tabindex="-1"></a>                threshold), ]</span>
<span id="cb16-2994"><a href="#cb16-2994" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-2995"><a href="#cb16-2995" aria-hidden="true" tabindex="-1"></a>        sortedgroups <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(pairwisetable<span class="sc">$</span>group1, pairwisetable<span class="sc">$</span>group2)))</span>
<span id="cb16-2996"><a href="#cb16-2996" aria-hidden="true" tabindex="-1"></a>        datamax <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">max</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb16-2997"><a href="#cb16-2997" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb16-2998"><a href="#cb16-2998" aria-hidden="true" tabindex="-1"></a>        datamin <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">min</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb16-2999"><a href="#cb16-2999" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb16-3000"><a href="#cb16-3000" aria-hidden="true" tabindex="-1"></a>        datarange <span class="ot">&lt;-</span> datamax <span class="sc">-</span> datamin</span>
<span id="cb16-3001"><a href="#cb16-3001" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">&lt;-</span> datarange <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb16-3002"><a href="#cb16-3002" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">&lt;-</span> datamax</span>
<span id="cb16-3003"><a href="#cb16-3003" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">&lt;-</span> min <span class="sc">+</span> (by <span class="sc">*</span> <span class="fu">nrow</span>(pairwisetable))</span>
<span id="cb16-3004"><a href="#cb16-3004" aria-hidden="true" tabindex="-1"></a>        ypos <span class="ot">&lt;-</span> <span class="fu">seq</span>(min, max, by)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb16-3005"><a href="#cb16-3005" aria-hidden="true" tabindex="-1"></a>        pairwisetable<span class="sc">$</span>ypos <span class="ot">&lt;-</span> ypos</span>
<span id="cb16-3006"><a href="#cb16-3006" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3007"><a href="#cb16-3007" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"box"</span>) {</span>
<span id="cb16-3008"><a href="#cb16-3008" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">outlier.size =</span> <span class="dv">3</span>,</span>
<span id="cb16-3009"><a href="#cb16-3009" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb16-3010"><a href="#cb16-3010" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-3011"><a href="#cb16-3011" aria-hidden="true" tabindex="-1"></a>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span id="cb16-3012"><a href="#cb16-3012" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb16-3013"><a href="#cb16-3013" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-3014"><a href="#cb16-3014" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_linetype_manual</span>()</span>
<span id="cb16-3015"><a href="#cb16-3015" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-3016"><a href="#cb16-3016" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-3017"><a href="#cb16-3017" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-3018"><a href="#cb16-3018" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3019"><a href="#cb16-3019" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(plot)</span>
<span id="cb16-3020"><a href="#cb16-3020" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3021"><a href="#cb16-3021" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"jitter"</span>) {</span>
<span id="cb16-3022"><a href="#cb16-3022" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb16-3023"><a href="#cb16-3023" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb16-3024"><a href="#cb16-3024" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-3025"><a href="#cb16-3025" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-3026"><a href="#cb16-3026" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>))</span>
<span id="cb16-3027"><a href="#cb16-3027" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-3028"><a href="#cb16-3028" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-3029"><a href="#cb16-3029" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-3030"><a href="#cb16-3030" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3031"><a href="#cb16-3031" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb16-3032"><a href="#cb16-3032" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3033"><a href="#cb16-3033" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"violin"</span>) {</span>
<span id="cb16-3034"><a href="#cb16-3034" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggviolin</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb16-3035"><a href="#cb16-3035" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb16-3036"><a href="#cb16-3036" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-3037"><a href="#cb16-3037" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-3038"><a href="#cb16-3038" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-3039"><a href="#cb16-3039" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>))</span>
<span id="cb16-3040"><a href="#cb16-3040" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-3041"><a href="#cb16-3041" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-3042"><a href="#cb16-3042" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-3043"><a href="#cb16-3043" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3044"><a href="#cb16-3044" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb16-3045"><a href="#cb16-3045" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3046"><a href="#cb16-3046" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3047"><a href="#cb16-3047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3048"><a href="#cb16-3048" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb16-3049"><a href="#cb16-3049" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb16-3050"><a href="#cb16-3050" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb16-3051"><a href="#cb16-3051" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-3052"><a href="#cb16-3052" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get,</span>
<span id="cb16-3053"><a href="#cb16-3053" aria-hidden="true" tabindex="-1"></a>                              <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb16-3054"><a href="#cb16-3054" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colour    =</span> swel_col,</span>
<span id="cb16-3055"><a href="#cb16-3055" aria-hidden="true" tabindex="-1"></a>                              <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3056"><a href="#cb16-3056" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb16-3057"><a href="#cb16-3057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-3058"><a href="#cb16-3058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-3059"><a href="#cb16-3059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3060"><a href="#cb16-3060" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3061"><a href="#cb16-3061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3062"><a href="#cb16-3062" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>)) {</span>
<span id="cb16-3063"><a href="#cb16-3063" aria-hidden="true" tabindex="-1"></a>  tmp_split <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(i, <span class="st">"_"</span>)</span>
<span id="cb16-3064"><a href="#cb16-3064" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3065"><a href="#cb16-3065" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"work"</span>) {</span>
<span id="cb16-3066"><a href="#cb16-3066" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"f"</span></span>
<span id="cb16-3067"><a href="#cb16-3067" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FULL"</span></span>
<span id="cb16-3068"><a href="#cb16-3068" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"filt"</span>) {</span>
<span id="cb16-3069"><a href="#cb16-3069" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"l"</span></span>
<span id="cb16-3070"><a href="#cb16-3070" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FILT"</span></span>
<span id="cb16-3071"><a href="#cb16-3071" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"perfect"</span>) {</span>
<span id="cb16-3072"><a href="#cb16-3072" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"r"</span></span>
<span id="cb16-3073"><a href="#cb16-3073" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb16-3074"><a href="#cb16-3074" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"pime"</span>) {</span>
<span id="cb16-3075"><a href="#cb16-3075" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"p"</span></span>
<span id="cb16-3076"><a href="#cb16-3076" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PIME"</span></span>
<span id="cb16-3077"><a href="#cb16-3077" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-3078"><a href="#cb16-3078" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3079"><a href="#cb16-3079" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q0"</span>) {</span>
<span id="cb16-3080"><a href="#cb16-3080" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"0"</span></span>
<span id="cb16-3081"><a href="#cb16-3081" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb16-3082"><a href="#cb16-3082" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q1"</span>) {</span>
<span id="cb16-3083"><a href="#cb16-3083" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb16-3084"><a href="#cb16-3084" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb16-3085"><a href="#cb16-3085" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q2"</span>) {</span>
<span id="cb16-3086"><a href="#cb16-3086" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"2"</span></span>
<span id="cb16-3087"><a href="#cb16-3087" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb16-3088"><a href="#cb16-3088" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-3089"><a href="#cb16-3089" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3090"><a href="#cb16-3090" aria-hidden="true" tabindex="-1"></a>  tmp_var <span class="ot">&lt;-</span></span>
<span id="cb16-3091"><a href="#cb16-3091" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_split[[<span class="dv">1</span>]][<span class="dv">1</span>], <span class="st">"_asv"</span>, tmp_ds, tmp_hill, <span class="st">"_lab"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-3092"><a href="#cb16-3092" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(tmp_name1, <span class="st">" ("</span>, tmp_name2, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-3093"><a href="#cb16-3093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_var, tmp_name)</span>
<span id="cb16-3094"><a href="#cb16-3094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3095"><a href="#cb16-3095" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3096"><a href="#cb16-3096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3097"><a href="#cb16-3097" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_work_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3098"><a href="#cb16-3098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3099"><a href="#cb16-3099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvf0_lab) <span class="sc">+</span></span>
<span id="cb16-3100"><a href="#cb16-3100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3101"><a href="#cb16-3101" aria-hidden="true" tabindex="-1"></a>ssu18_ps_filt_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_filt_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3102"><a href="#cb16-3102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3103"><a href="#cb16-3103" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3104"><a href="#cb16-3104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvl0_lab) <span class="sc">+</span></span>
<span id="cb16-3105"><a href="#cb16-3105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3106"><a href="#cb16-3106" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3107"><a href="#cb16-3107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3108"><a href="#cb16-3108" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3109"><a href="#cb16-3109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvr0_lab) <span class="sc">+</span></span>
<span id="cb16-3110"><a href="#cb16-3110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3111"><a href="#cb16-3111" aria-hidden="true" tabindex="-1"></a>ssu18_ps_pime_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_pime_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3112"><a href="#cb16-3112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3113"><a href="#cb16-3113" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3114"><a href="#cb16-3114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvp0_lab) <span class="sc">+</span></span>
<span id="cb16-3115"><a href="#cb16-3115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3116"><a href="#cb16-3116" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb16-3117"><a href="#cb16-3117" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_work_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3118"><a href="#cb16-3118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3119"><a href="#cb16-3119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvf1_lab) <span class="sc">+</span></span>
<span id="cb16-3120"><a href="#cb16-3120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3121"><a href="#cb16-3121" aria-hidden="true" tabindex="-1"></a>ssu18_ps_filt_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_filt_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3122"><a href="#cb16-3122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3123"><a href="#cb16-3123" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3124"><a href="#cb16-3124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvl1_lab) <span class="sc">+</span></span>
<span id="cb16-3125"><a href="#cb16-3125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3126"><a href="#cb16-3126" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3127"><a href="#cb16-3127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3128"><a href="#cb16-3128" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3129"><a href="#cb16-3129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvr1_lab) <span class="sc">+</span></span>
<span id="cb16-3130"><a href="#cb16-3130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3131"><a href="#cb16-3131" aria-hidden="true" tabindex="-1"></a>ssu18_ps_pime_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_pime_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3132"><a href="#cb16-3132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3133"><a href="#cb16-3133" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3134"><a href="#cb16-3134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvp1_lab) <span class="sc">+</span></span>
<span id="cb16-3135"><a href="#cb16-3135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3136"><a href="#cb16-3136" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb16-3137"><a href="#cb16-3137" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_work_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3138"><a href="#cb16-3138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvf2_lab) <span class="sc">+</span></span>
<span id="cb16-3139"><a href="#cb16-3139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3140"><a href="#cb16-3140" aria-hidden="true" tabindex="-1"></a>ssu18_ps_filt_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_filt_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3141"><a href="#cb16-3141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3142"><a href="#cb16-3142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvl2_lab) <span class="sc">+</span></span>
<span id="cb16-3143"><a href="#cb16-3143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3144"><a href="#cb16-3144" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3145"><a href="#cb16-3145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3146"><a href="#cb16-3146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvr2_lab) <span class="sc">+</span></span>
<span id="cb16-3147"><a href="#cb16-3147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3148"><a href="#cb16-3148" aria-hidden="true" tabindex="-1"></a>ssu18_ps_pime_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_pime_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3149"><a href="#cb16-3149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3150"><a href="#cb16-3150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvp2_lab) <span class="sc">+</span></span>
<span id="cb16-3151"><a href="#cb16-3151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3152"><a href="#cb16-3152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3153"><a href="#cb16-3153" aria-hidden="true" tabindex="-1"></a>ssu18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb16-3154"><a href="#cb16-3154" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_work_q0_adt_plot,</span>
<span id="cb16-3155"><a href="#cb16-3155" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_filt_q0_adt_plot,</span>
<span id="cb16-3156"><a href="#cb16-3156" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q0_adt_plot,</span>
<span id="cb16-3157"><a href="#cb16-3157" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_pime_q0_adt_plot,</span>
<span id="cb16-3158"><a href="#cb16-3158" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_work_q1_adt_plot,</span>
<span id="cb16-3159"><a href="#cb16-3159" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_filt_q1_adt_plot,</span>
<span id="cb16-3160"><a href="#cb16-3160" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q1_adt_plot,</span>
<span id="cb16-3161"><a href="#cb16-3161" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_pime_q1_adt_plot,</span>
<span id="cb16-3162"><a href="#cb16-3162" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_work_q2_adt_plot,</span>
<span id="cb16-3163"><a href="#cb16-3163" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_filt_q2_adt_plot,</span>
<span id="cb16-3164"><a href="#cb16-3164" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q2_adt_plot,</span>
<span id="cb16-3165"><a href="#cb16-3165" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_pime_q2_adt_plot,</span>
<span id="cb16-3166"><a href="#cb16-3166" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb16-3167"><a href="#cb16-3167" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span></span>
<span id="cb16-3168"><a href="#cb16-3168" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3169"><a href="#cb16-3169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3170"><a href="#cb16-3170" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3171"><a href="#cb16-3171" aria-hidden="true" tabindex="-1"></a>  ssu18_alph_div_plots_asv,</span>
<span id="cb16-3172"><a href="#cb16-3172" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.png"</span>,</span>
<span id="cb16-3173"><a href="#cb16-3173" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb16-3174"><a href="#cb16-3174" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb16-3175"><a href="#cb16-3175" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3176"><a href="#cb16-3176" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3177"><a href="#cb16-3177" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3178"><a href="#cb16-3178" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3179"><a href="#cb16-3179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3180"><a href="#cb16-3180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3181"><a href="#cb16-3181" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3182"><a href="#cb16-3182" aria-hidden="true" tabindex="-1"></a>  ssu18_alph_div_plots_asv,</span>
<span id="cb16-3183"><a href="#cb16-3183" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb16-3184"><a href="#cb16-3184" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb16-3185"><a href="#cb16-3185" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb16-3186"><a href="#cb16-3186" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3187"><a href="#cb16-3187" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3188"><a href="#cb16-3188" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3189"><a href="#cb16-3189" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3190"><a href="#cb16-3190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3191"><a href="#cb16-3191" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3192"><a href="#cb16-3192" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.png"</span>,</span>
<span id="cb16-3193"><a href="#cb16-3193" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_3.png"</span></span>
<span id="cb16-3194"><a href="#cb16-3194" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3195"><a href="#cb16-3195" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3196"><a href="#cb16-3196" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/ssu18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb16-3197"><a href="#cb16-3197" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_3.pdf"</span></span>
<span id="cb16-3198"><a href="#cb16-3198" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3199"><a href="#cb16-3199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-3200"><a href="#cb16-3200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3201"><a href="#cb16-3201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3202"><a href="#cb16-3202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 4</span></span>
<span id="cb16-3203"><a href="#cb16-3203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3204"><a href="#cb16-3204" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-3205"><a href="#cb16-3205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3206"><a href="#cb16-3206" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-3207"><a href="#cb16-3207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3208"><a href="#cb16-3208" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<span class="in">`*`</span>). </span>
<span id="cb16-3209"><a href="#cb16-3209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3210"><a href="#cb16-3210" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3211"><a href="#cb16-3211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3212"><a href="#cb16-3212" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-3213"><a href="#cb16-3213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3214"><a href="#cb16-3214" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-3215"><a href="#cb16-3215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3216"><a href="#cb16-3216" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_4.png)</span></span>
<span id="cb16-3217"><a href="#cb16-3217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3218"><a href="#cb16-3218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-3219"><a href="#cb16-3219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3220"><a href="#cb16-3220" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/its_supp_alpha_div.png)</span></span>
<span id="cb16-3221"><a href="#cb16-3221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3222"><a href="#cb16-3222" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3223"><a href="#cb16-3223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3224"><a href="#cb16-3224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3225"><a href="#cb16-3225" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-3226"><a href="#cb16-3226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3227"><a href="#cb16-3227" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-3228"><a href="#cb16-3228" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/its_alpha_diversity.rdata)</span>  </span>
<span id="cb16-3229"><a href="#cb16-3229" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3230"><a href="#cb16-3230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3231"><a href="#cb16-3231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3232"><a href="#cb16-3232" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-3233"><a href="#cb16-3233" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Supplementary_Figure_4.pdf)</span></span>
<span id="cb16-3234"><a href="#cb16-3234" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3235"><a href="#cb16-3235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3236"><a href="#cb16-3236" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3237"><a href="#cb16-3237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3240"><a href="#cb16-3240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-3241"><a href="#cb16-3241" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-3242"><a href="#cb16-3242" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/som/its_alpha_diversity.rdata"</span>)</span>
<span id="cb16-3243"><a href="#cb16-3243" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb16-3244"><a href="#cb16-3244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3245"><a href="#cb16-3245" aria-hidden="true" tabindex="-1"></a>div_test_plot_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (divtest, chart, colour, posthoc, threshold) </span>
<span id="cb16-3246"><a href="#cb16-3246" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-3247"><a href="#cb16-3247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(chart)) {</span>
<span id="cb16-3248"><a href="#cb16-3248" aria-hidden="true" tabindex="-1"></a>        chart <span class="ot">=</span> <span class="st">"box"</span></span>
<span id="cb16-3249"><a href="#cb16-3249" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3250"><a href="#cb16-3250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(posthoc)) {</span>
<span id="cb16-3251"><a href="#cb16-3251" aria-hidden="true" tabindex="-1"></a>        posthoc <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb16-3252"><a href="#cb16-3252" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3253"><a href="#cb16-3253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">names</span>(divtest)[<span class="dv">1</span>] <span class="sc">!=</span> <span class="st">"data"</span>) <span class="sc">&amp;</span> (<span class="fu">names</span>(divtest)[<span class="dv">2</span>] <span class="sc">!=</span> </span>
<span id="cb16-3254"><a href="#cb16-3254" aria-hidden="true" tabindex="-1"></a>        <span class="st">"normality.pvalue"</span>)) </span>
<span id="cb16-3255"><a href="#cb16-3255" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"The input object does not seem to be a div_test output."</span>)</span>
<span id="cb16-3256"><a href="#cb16-3256" aria-hidden="true" tabindex="-1"></a>    divtestdata <span class="ot">&lt;-</span> divtest<span class="sc">$</span>data</span>
<span id="cb16-3257"><a href="#cb16-3257" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(divtestdata<span class="sc">$</span>Group)</span>
<span id="cb16-3258"><a href="#cb16-3258" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(divtestdata<span class="sc">$</span>Group, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(divtestdata<span class="sc">$</span>Group)))</span>
<span id="cb16-3259"><a href="#cb16-3259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(colour) <span class="sc">||</span> (<span class="fu">length</span>(colour) <span class="sc">&lt;</span> divtest<span class="sc">$</span>groups)) {</span>
<span id="cb16-3260"><a href="#cb16-3260" aria-hidden="true" tabindex="-1"></a>        getPalette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(divtest<span class="sc">$</span>groups, </span>
<span id="cb16-3261"><a href="#cb16-3261" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Paired"</span>))</span>
<span id="cb16-3262"><a href="#cb16-3262" aria-hidden="true" tabindex="-1"></a>        colour <span class="ot">&lt;-</span> <span class="fu">getPalette</span>(divtest<span class="sc">$</span>groups)</span>
<span id="cb16-3263"><a href="#cb16-3263" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3264"><a href="#cb16-3264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-3265"><a href="#cb16-3265" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">names</span>(divtest)[<span class="dv">7</span>])) </span>
<span id="cb16-3266"><a href="#cb16-3266" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span id="cb16-3267"><a href="#cb16-3267" aria-hidden="true" tabindex="-1"></a><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span>)</span>
<span id="cb16-3268"><a href="#cb16-3268" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Tukey post-hoc test"</span>) {</span>
<span id="cb16-3269"><a href="#cb16-3269" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb16-3270"><a href="#cb16-3270" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb16-3271"><a href="#cb16-3271" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3272"><a href="#cb16-3272" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">4</span>], <span class="dv">3</span>)</span>
<span id="cb16-3273"><a href="#cb16-3273" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb16-3274"><a href="#cb16-3274" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb16-3275"><a href="#cb16-3275" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb16-3276"><a href="#cb16-3276" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb16-3277"><a href="#cb16-3277" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3278"><a href="#cb16-3278" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span>) {</span>
<span id="cb16-3279"><a href="#cb16-3279" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb16-3280"><a href="#cb16-3280" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb16-3281"><a href="#cb16-3281" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3282"><a href="#cb16-3282" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">3</span>], <span class="dv">3</span>)</span>
<span id="cb16-3283"><a href="#cb16-3283" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb16-3284"><a href="#cb16-3284" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb16-3285"><a href="#cb16-3285" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb16-3286"><a href="#cb16-3286" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb16-3287"><a href="#cb16-3287" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3288"><a href="#cb16-3288" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">1</span>])</span>
<span id="cb16-3289"><a href="#cb16-3289" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">2</span>])</span>
<span id="cb16-3290"><a href="#cb16-3290" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(pairwisetable[, </span>
<span id="cb16-3291"><a href="#cb16-3291" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>]))</span>
<span id="cb16-3292"><a href="#cb16-3292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(threshold)) {</span>
<span id="cb16-3293"><a href="#cb16-3293" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> pairwisetable[<span class="fu">which</span>(pairwisetable<span class="sc">$</span>p <span class="sc">&lt;</span> </span>
<span id="cb16-3294"><a href="#cb16-3294" aria-hidden="true" tabindex="-1"></a>                threshold), ]</span>
<span id="cb16-3295"><a href="#cb16-3295" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3296"><a href="#cb16-3296" aria-hidden="true" tabindex="-1"></a>        sortedgroups <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(pairwisetable<span class="sc">$</span>group1, pairwisetable<span class="sc">$</span>group2)))</span>
<span id="cb16-3297"><a href="#cb16-3297" aria-hidden="true" tabindex="-1"></a>        datamax <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">max</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb16-3298"><a href="#cb16-3298" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb16-3299"><a href="#cb16-3299" aria-hidden="true" tabindex="-1"></a>        datamin <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">min</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb16-3300"><a href="#cb16-3300" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb16-3301"><a href="#cb16-3301" aria-hidden="true" tabindex="-1"></a>        datarange <span class="ot">&lt;-</span> datamax <span class="sc">-</span> datamin</span>
<span id="cb16-3302"><a href="#cb16-3302" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">&lt;-</span> datarange <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb16-3303"><a href="#cb16-3303" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">&lt;-</span> datamax</span>
<span id="cb16-3304"><a href="#cb16-3304" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">&lt;-</span> min <span class="sc">+</span> (by <span class="sc">*</span> <span class="fu">nrow</span>(pairwisetable))</span>
<span id="cb16-3305"><a href="#cb16-3305" aria-hidden="true" tabindex="-1"></a>        ypos <span class="ot">&lt;-</span> <span class="fu">seq</span>(min, max, by)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb16-3306"><a href="#cb16-3306" aria-hidden="true" tabindex="-1"></a>        pairwisetable<span class="sc">$</span>ypos <span class="ot">&lt;-</span> ypos</span>
<span id="cb16-3307"><a href="#cb16-3307" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3308"><a href="#cb16-3308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"box"</span>) {</span>
<span id="cb16-3309"><a href="#cb16-3309" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">outlier.size =</span> <span class="dv">3</span>,</span>
<span id="cb16-3310"><a href="#cb16-3310" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb16-3311"><a href="#cb16-3311" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-3312"><a href="#cb16-3312" aria-hidden="true" tabindex="-1"></a>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span id="cb16-3313"><a href="#cb16-3313" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb16-3314"><a href="#cb16-3314" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-3315"><a href="#cb16-3315" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_linetype_manual</span>()</span>
<span id="cb16-3316"><a href="#cb16-3316" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-3317"><a href="#cb16-3317" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-3318"><a href="#cb16-3318" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-3319"><a href="#cb16-3319" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3320"><a href="#cb16-3320" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(plot)</span>
<span id="cb16-3321"><a href="#cb16-3321" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3322"><a href="#cb16-3322" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"jitter"</span>) {</span>
<span id="cb16-3323"><a href="#cb16-3323" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb16-3324"><a href="#cb16-3324" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb16-3325"><a href="#cb16-3325" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-3326"><a href="#cb16-3326" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-3327"><a href="#cb16-3327" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>))</span>
<span id="cb16-3328"><a href="#cb16-3328" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-3329"><a href="#cb16-3329" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-3330"><a href="#cb16-3330" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-3331"><a href="#cb16-3331" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3332"><a href="#cb16-3332" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb16-3333"><a href="#cb16-3333" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3334"><a href="#cb16-3334" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"violin"</span>) {</span>
<span id="cb16-3335"><a href="#cb16-3335" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggviolin</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb16-3336"><a href="#cb16-3336" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb16-3337"><a href="#cb16-3337" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb16-3338"><a href="#cb16-3338" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-3339"><a href="#cb16-3339" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb16-3340"><a href="#cb16-3340" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>))</span>
<span id="cb16-3341"><a href="#cb16-3341" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb16-3342"><a href="#cb16-3342" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb16-3343"><a href="#cb16-3343" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb16-3344"><a href="#cb16-3344" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3345"><a href="#cb16-3345" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb16-3346"><a href="#cb16-3346" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3347"><a href="#cb16-3347" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3348"><a href="#cb16-3348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3349"><a href="#cb16-3349" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb16-3350"><a href="#cb16-3350" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb16-3351"><a href="#cb16-3351" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb16-3352"><a href="#cb16-3352" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-3353"><a href="#cb16-3353" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get,</span>
<span id="cb16-3354"><a href="#cb16-3354" aria-hidden="true" tabindex="-1"></a>                              <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb16-3355"><a href="#cb16-3355" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colour    =</span> swel_col,</span>
<span id="cb16-3356"><a href="#cb16-3356" aria-hidden="true" tabindex="-1"></a>                              <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3357"><a href="#cb16-3357" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb16-3358"><a href="#cb16-3358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-3359"><a href="#cb16-3359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-3360"><a href="#cb16-3360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3361"><a href="#cb16-3361" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3362"><a href="#cb16-3362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3363"><a href="#cb16-3363" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>)) {</span>
<span id="cb16-3364"><a href="#cb16-3364" aria-hidden="true" tabindex="-1"></a>  tmp_split <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(i, <span class="st">"_"</span>)</span>
<span id="cb16-3365"><a href="#cb16-3365" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3366"><a href="#cb16-3366" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"work"</span>) {</span>
<span id="cb16-3367"><a href="#cb16-3367" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"f"</span></span>
<span id="cb16-3368"><a href="#cb16-3368" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FULL"</span></span>
<span id="cb16-3369"><a href="#cb16-3369" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"filt"</span>) {</span>
<span id="cb16-3370"><a href="#cb16-3370" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"l"</span></span>
<span id="cb16-3371"><a href="#cb16-3371" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FILT"</span></span>
<span id="cb16-3372"><a href="#cb16-3372" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"perfect"</span>) {</span>
<span id="cb16-3373"><a href="#cb16-3373" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"r"</span></span>
<span id="cb16-3374"><a href="#cb16-3374" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb16-3375"><a href="#cb16-3375" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"pime"</span>) {</span>
<span id="cb16-3376"><a href="#cb16-3376" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"p"</span></span>
<span id="cb16-3377"><a href="#cb16-3377" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PIME"</span></span>
<span id="cb16-3378"><a href="#cb16-3378" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-3379"><a href="#cb16-3379" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3380"><a href="#cb16-3380" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q0"</span>) {</span>
<span id="cb16-3381"><a href="#cb16-3381" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"0"</span></span>
<span id="cb16-3382"><a href="#cb16-3382" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb16-3383"><a href="#cb16-3383" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q1"</span>) {</span>
<span id="cb16-3384"><a href="#cb16-3384" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb16-3385"><a href="#cb16-3385" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb16-3386"><a href="#cb16-3386" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q2"</span>) {</span>
<span id="cb16-3387"><a href="#cb16-3387" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"2"</span></span>
<span id="cb16-3388"><a href="#cb16-3388" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb16-3389"><a href="#cb16-3389" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-3390"><a href="#cb16-3390" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3391"><a href="#cb16-3391" aria-hidden="true" tabindex="-1"></a>  tmp_var <span class="ot">&lt;-</span></span>
<span id="cb16-3392"><a href="#cb16-3392" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_split[[<span class="dv">1</span>]][<span class="dv">1</span>], <span class="st">"_asv"</span>, tmp_ds, tmp_hill, <span class="st">"_lab"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-3393"><a href="#cb16-3393" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(tmp_name1, <span class="st">" ("</span>, tmp_name2, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-3394"><a href="#cb16-3394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_var, tmp_name)</span>
<span id="cb16-3395"><a href="#cb16-3395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3396"><a href="#cb16-3396" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3397"><a href="#cb16-3397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3398"><a href="#cb16-3398" aria-hidden="true" tabindex="-1"></a>its18_ps_work_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_work_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3399"><a href="#cb16-3399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3400"><a href="#cb16-3400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvf0_lab) <span class="sc">+</span></span>
<span id="cb16-3401"><a href="#cb16-3401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3402"><a href="#cb16-3402" aria-hidden="true" tabindex="-1"></a>its18_ps_filt_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_filt_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3403"><a href="#cb16-3403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3404"><a href="#cb16-3404" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3405"><a href="#cb16-3405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvl0_lab) <span class="sc">+</span></span>
<span id="cb16-3406"><a href="#cb16-3406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3407"><a href="#cb16-3407" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3408"><a href="#cb16-3408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3409"><a href="#cb16-3409" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3410"><a href="#cb16-3410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvr0_lab) <span class="sc">+</span></span>
<span id="cb16-3411"><a href="#cb16-3411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3412"><a href="#cb16-3412" aria-hidden="true" tabindex="-1"></a>its18_ps_pime_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_pime_q0_adt_plot <span class="sc">+</span></span>
<span id="cb16-3413"><a href="#cb16-3413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3414"><a href="#cb16-3414" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3415"><a href="#cb16-3415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvp0_lab) <span class="sc">+</span></span>
<span id="cb16-3416"><a href="#cb16-3416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3417"><a href="#cb16-3417" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb16-3418"><a href="#cb16-3418" aria-hidden="true" tabindex="-1"></a>its18_ps_work_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_work_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3419"><a href="#cb16-3419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3420"><a href="#cb16-3420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvf1_lab) <span class="sc">+</span></span>
<span id="cb16-3421"><a href="#cb16-3421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3422"><a href="#cb16-3422" aria-hidden="true" tabindex="-1"></a>its18_ps_filt_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_filt_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3423"><a href="#cb16-3423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3424"><a href="#cb16-3424" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3425"><a href="#cb16-3425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvl1_lab) <span class="sc">+</span></span>
<span id="cb16-3426"><a href="#cb16-3426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3427"><a href="#cb16-3427" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3428"><a href="#cb16-3428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3429"><a href="#cb16-3429" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3430"><a href="#cb16-3430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvr1_lab) <span class="sc">+</span></span>
<span id="cb16-3431"><a href="#cb16-3431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3432"><a href="#cb16-3432" aria-hidden="true" tabindex="-1"></a>its18_ps_pime_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_pime_q1_adt_plot <span class="sc">+</span></span>
<span id="cb16-3433"><a href="#cb16-3433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3434"><a href="#cb16-3434" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3435"><a href="#cb16-3435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvp1_lab) <span class="sc">+</span></span>
<span id="cb16-3436"><a href="#cb16-3436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3437"><a href="#cb16-3437" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb16-3438"><a href="#cb16-3438" aria-hidden="true" tabindex="-1"></a>its18_ps_work_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_work_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3439"><a href="#cb16-3439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvf2_lab) <span class="sc">+</span></span>
<span id="cb16-3440"><a href="#cb16-3440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3441"><a href="#cb16-3441" aria-hidden="true" tabindex="-1"></a>its18_ps_filt_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_filt_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3442"><a href="#cb16-3442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3443"><a href="#cb16-3443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvl2_lab) <span class="sc">+</span></span>
<span id="cb16-3444"><a href="#cb16-3444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3445"><a href="#cb16-3445" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3446"><a href="#cb16-3446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3447"><a href="#cb16-3447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvr2_lab) <span class="sc">+</span></span>
<span id="cb16-3448"><a href="#cb16-3448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3449"><a href="#cb16-3449" aria-hidden="true" tabindex="-1"></a>its18_ps_pime_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_pime_q2_adt_plot <span class="sc">+</span></span>
<span id="cb16-3450"><a href="#cb16-3450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb16-3451"><a href="#cb16-3451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvp2_lab) <span class="sc">+</span></span>
<span id="cb16-3452"><a href="#cb16-3452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb16-3453"><a href="#cb16-3453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3454"><a href="#cb16-3454" aria-hidden="true" tabindex="-1"></a>its18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb16-3455"><a href="#cb16-3455" aria-hidden="true" tabindex="-1"></a>  its18_ps_work_q0_adt_plot,</span>
<span id="cb16-3456"><a href="#cb16-3456" aria-hidden="true" tabindex="-1"></a>  its18_ps_filt_q0_adt_plot,</span>
<span id="cb16-3457"><a href="#cb16-3457" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q0_adt_plot,</span>
<span id="cb16-3458"><a href="#cb16-3458" aria-hidden="true" tabindex="-1"></a>  its18_ps_pime_q0_adt_plot,</span>
<span id="cb16-3459"><a href="#cb16-3459" aria-hidden="true" tabindex="-1"></a>  its18_ps_work_q1_adt_plot,</span>
<span id="cb16-3460"><a href="#cb16-3460" aria-hidden="true" tabindex="-1"></a>  its18_ps_filt_q1_adt_plot,</span>
<span id="cb16-3461"><a href="#cb16-3461" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q1_adt_plot,</span>
<span id="cb16-3462"><a href="#cb16-3462" aria-hidden="true" tabindex="-1"></a>  its18_ps_pime_q1_adt_plot,</span>
<span id="cb16-3463"><a href="#cb16-3463" aria-hidden="true" tabindex="-1"></a>  its18_ps_work_q2_adt_plot,</span>
<span id="cb16-3464"><a href="#cb16-3464" aria-hidden="true" tabindex="-1"></a>  its18_ps_filt_q2_adt_plot,</span>
<span id="cb16-3465"><a href="#cb16-3465" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q2_adt_plot,</span>
<span id="cb16-3466"><a href="#cb16-3466" aria-hidden="true" tabindex="-1"></a>  its18_ps_pime_q2_adt_plot,</span>
<span id="cb16-3467"><a href="#cb16-3467" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb16-3468"><a href="#cb16-3468" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span></span>
<span id="cb16-3469"><a href="#cb16-3469" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3470"><a href="#cb16-3470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3471"><a href="#cb16-3471" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3472"><a href="#cb16-3472" aria-hidden="true" tabindex="-1"></a>  its18_alph_div_plots_asv,</span>
<span id="cb16-3473"><a href="#cb16-3473" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/its18_alph_div_plots_asv.png"</span>,</span>
<span id="cb16-3474"><a href="#cb16-3474" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb16-3475"><a href="#cb16-3475" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb16-3476"><a href="#cb16-3476" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3477"><a href="#cb16-3477" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3478"><a href="#cb16-3478" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3479"><a href="#cb16-3479" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3480"><a href="#cb16-3480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3481"><a href="#cb16-3481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3482"><a href="#cb16-3482" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3483"><a href="#cb16-3483" aria-hidden="true" tabindex="-1"></a>  its18_alph_div_plots_asv,</span>
<span id="cb16-3484"><a href="#cb16-3484" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/its18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb16-3485"><a href="#cb16-3485" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb16-3486"><a href="#cb16-3486" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb16-3487"><a href="#cb16-3487" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3488"><a href="#cb16-3488" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3489"><a href="#cb16-3489" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3490"><a href="#cb16-3490" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3491"><a href="#cb16-3491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3492"><a href="#cb16-3492" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3493"><a href="#cb16-3493" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/its18_alph_div_plots_asv.png"</span>,</span>
<span id="cb16-3494"><a href="#cb16-3494" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_4.png"</span></span>
<span id="cb16-3495"><a href="#cb16-3495" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3496"><a href="#cb16-3496" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3497"><a href="#cb16-3497" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/its18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb16-3498"><a href="#cb16-3498" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_4.pdf"</span></span>
<span id="cb16-3499"><a href="#cb16-3499" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3500"><a href="#cb16-3500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-3501"><a href="#cb16-3501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3502"><a href="#cb16-3502" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 5</span></span>
<span id="cb16-3503"><a href="#cb16-3503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3504"><a href="#cb16-3504" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-3505"><a href="#cb16-3505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3506"><a href="#cb16-3506" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-3507"><a href="#cb16-3507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3508"><a href="#cb16-3508" aria-hidden="true" tabindex="-1"></a>No post processing performed.</span>
<span id="cb16-3509"><a href="#cb16-3509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3510"><a href="#cb16-3510" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3511"><a href="#cb16-3511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3512"><a href="#cb16-3512" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-3513"><a href="#cb16-3513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3514"><a href="#cb16-3514" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-3515"><a href="#cb16-3515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3516"><a href="#cb16-3516" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_5.png)</span></span>
<span id="cb16-3517"><a href="#cb16-3517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3518"><a href="#cb16-3518" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-3519"><a href="#cb16-3519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3520"><a href="#cb16-3520" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/ssu18_auto_cor_combo.png)</span></span>
<span id="cb16-3521"><a href="#cb16-3521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3522"><a href="#cb16-3522" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3523"><a href="#cb16-3523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3524"><a href="#cb16-3524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3525"><a href="#cb16-3525" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-3526"><a href="#cb16-3526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3527"><a href="#cb16-3527" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-3528"><a href="#cb16-3528" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/ssu18_select_mc_norm_split.rds)</span>  </span>
<span id="cb16-3529"><a href="#cb16-3529" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3530"><a href="#cb16-3530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3531"><a href="#cb16-3531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3532"><a href="#cb16-3532" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-3533"><a href="#cb16-3533" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Supplementary_Figure_5.pdf)</span></span>
<span id="cb16-3534"><a href="#cb16-3534" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3535"><a href="#cb16-3535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3536"><a href="#cb16-3536" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3537"><a href="#cb16-3537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3540"><a href="#cb16-3540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-3541"><a href="#cb16-3541" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-3542"><a href="#cb16-3542" aria-hidden="true" tabindex="-1"></a>ssu18_select_mc_norm_split <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb16-3543"><a href="#cb16-3543" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/ssu18_select_mc_norm_split.rds"</span></span>
<span id="cb16-3544"><a href="#cb16-3544" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-3545"><a href="#cb16-3545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-3546"><a href="#cb16-3546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3549"><a href="#cb16-3549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-3550"><a href="#cb16-3550" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor <span class="ot">&lt;-</span> ssu18_select_mc_norm_split<span class="sc">$</span>edaphic</span>
<span id="cb16-3551"><a href="#cb16-3551" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-3552"><a href="#cb16-3552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3553"><a href="#cb16-3553" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor <span class="ot">&lt;-</span> ssu18_select_mc_norm_split<span class="sc">$</span>soil_funct</span>
<span id="cb16-3554"><a href="#cb16-3554" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-3555"><a href="#cb16-3555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3556"><a href="#cb16-3556" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor <span class="ot">&lt;-</span> ssu18_select_mc_norm_split<span class="sc">$</span>temp_adapt</span>
<span id="cb16-3557"><a href="#cb16-3557" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-3558"><a href="#cb16-3558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3559"><a href="#cb16-3559" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_cor$"</span>)) {</span>
<span id="cb16-3560"><a href="#cb16-3560" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-3561"><a href="#cb16-3561" aria-hidden="true" tabindex="-1"></a>  tmp_cormat <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(tmp_get), <span class="dv">2</span>)</span>
<span id="cb16-3562"><a href="#cb16-3562" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_cormat)</span>
<span id="cb16-3563"><a href="#cb16-3563" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3564"><a href="#cb16-3564" aria-hidden="true" tabindex="-1"></a>  tmp_get_lower_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb16-3565"><a href="#cb16-3565" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">upper.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-3566"><a href="#cb16-3566" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb16-3567"><a href="#cb16-3567" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3568"><a href="#cb16-3568" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get upper triangle of the correlation matrix</span></span>
<span id="cb16-3569"><a href="#cb16-3569" aria-hidden="true" tabindex="-1"></a>  tmp_get_upper_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb16-3570"><a href="#cb16-3570" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">lower.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-3571"><a href="#cb16-3571" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb16-3572"><a href="#cb16-3572" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3573"><a href="#cb16-3573" aria-hidden="true" tabindex="-1"></a>  tmp_upper_tri <span class="ot">&lt;-</span> <span class="fu">tmp_get_upper_tri</span>(tmp_cormat)</span>
<span id="cb16-3574"><a href="#cb16-3574" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_upper_tri, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3575"><a href="#cb16-3575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb16-3576"><a href="#cb16-3576" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>()</span>
<span id="cb16-3577"><a href="#cb16-3577" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3578"><a href="#cb16-3578" aria-hidden="true" tabindex="-1"></a>  tmp_ggheatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(Var2, Var1, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb16-3579"><a href="#cb16-3579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-3580"><a href="#cb16-3580" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, </span>
<span id="cb16-3581"><a href="#cb16-3581" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">space =</span> <span class="st">"Lab"</span>, </span>
<span id="cb16-3582"><a href="#cb16-3582" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name=</span><span class="st">"Pearson</span><span class="sc">\n</span><span class="st">Correlation"</span>) <span class="sc">+</span></span>
<span id="cb16-3583"><a href="#cb16-3583" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb16-3584"><a href="#cb16-3584" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, </span>
<span id="cb16-3585"><a href="#cb16-3585" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb16-3586"><a href="#cb16-3586" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb16-3587"><a href="#cb16-3587" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb16-3588"><a href="#cb16-3588" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(Var2, Var1, <span class="at">label =</span> value), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.75</span>) <span class="sc">+</span></span>
<span id="cb16-3589"><a href="#cb16-3589" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-3590"><a href="#cb16-3590" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3591"><a href="#cb16-3591" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3592"><a href="#cb16-3592" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3593"><a href="#cb16-3593" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3594"><a href="#cb16-3594" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3595"><a href="#cb16-3595" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3596"><a href="#cb16-3596" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb16-3597"><a href="#cb16-3597" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>),</span>
<span id="cb16-3598"><a href="#cb16-3598" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb16-3599"><a href="#cb16-3599" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="dv">7</span>, <span class="at">barheight =</span> <span class="dv">1</span>,</span>
<span id="cb16-3600"><a href="#cb16-3600" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.position =</span> <span class="st">"top"</span>, </span>
<span id="cb16-3601"><a href="#cb16-3601" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb16-3602"><a href="#cb16-3602" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_ggheatmap"</span>))</span>
<span id="cb16-3603"><a href="#cb16-3603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_ggheatmap)</span>
<span id="cb16-3604"><a href="#cb16-3604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-3605"><a href="#cb16-3605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3606"><a href="#cb16-3606" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb16-3607"><a href="#cb16-3607" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_ggheatmap"</span>)</span>
<span id="cb16-3608"><a href="#cb16-3608" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor_ggheatmap</span>
<span id="cb16-3609"><a href="#cb16-3609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3610"><a href="#cb16-3610" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3611"><a href="#cb16-3611" aria-hidden="true" tabindex="-1"></a>  edaphic_norm_cor_ggheatmap,</span>
<span id="cb16-3612"><a href="#cb16-3612" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"include/pub/som/"</span>,</span>
<span id="cb16-3613"><a href="#cb16-3613" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"ssu_auto_cor_edaphic.png"</span>,</span>
<span id="cb16-3614"><a href="#cb16-3614" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3615"><a href="#cb16-3615" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3616"><a href="#cb16-3616" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3617"><a href="#cb16-3617" aria-hidden="true" tabindex="-1"></a>  soil_funct_norm_cor_ggheatmap,</span>
<span id="cb16-3618"><a href="#cb16-3618" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"include/pub/som/"</span>,</span>
<span id="cb16-3619"><a href="#cb16-3619" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"ssu_auto_cor_functional.png"</span>,</span>
<span id="cb16-3620"><a href="#cb16-3620" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3621"><a href="#cb16-3621" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3622"><a href="#cb16-3622" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3623"><a href="#cb16-3623" aria-hidden="true" tabindex="-1"></a>  temp_adapt_norm_cor_ggheatmap,</span>
<span id="cb16-3624"><a href="#cb16-3624" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"include/pub/som/"</span>,</span>
<span id="cb16-3625"><a href="#cb16-3625" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"ssu_auto_cor_temperature.png"</span>,</span>
<span id="cb16-3626"><a href="#cb16-3626" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3627"><a href="#cb16-3627" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3628"><a href="#cb16-3628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3629"><a href="#cb16-3629" aria-hidden="true" tabindex="-1"></a>auto_cor_figs <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb16-3630"><a href="#cb16-3630" aria-hidden="true" tabindex="-1"></a>  edaphic_norm_cor_ggheatmap,</span>
<span id="cb16-3631"><a href="#cb16-3631" aria-hidden="true" tabindex="-1"></a>  soil_funct_norm_cor_ggheatmap,</span>
<span id="cb16-3632"><a href="#cb16-3632" aria-hidden="true" tabindex="-1"></a>  temp_adapt_norm_cor_ggheatmap,</span>
<span id="cb16-3633"><a href="#cb16-3633" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb16-3634"><a href="#cb16-3634" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb16-3635"><a href="#cb16-3635" aria-hidden="true" tabindex="-1"></a>  <span class="at">common.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb16-3636"><a href="#cb16-3636" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3637"><a href="#cb16-3637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3638"><a href="#cb16-3638" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3639"><a href="#cb16-3639" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb16-3640"><a href="#cb16-3640" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/ssu18_auto_cor_figs.png"</span>,</span>
<span id="cb16-3641"><a href="#cb16-3641" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb16-3642"><a href="#cb16-3642" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb16-3643"><a href="#cb16-3643" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3644"><a href="#cb16-3644" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3645"><a href="#cb16-3645" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3646"><a href="#cb16-3646" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3647"><a href="#cb16-3647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3648"><a href="#cb16-3648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3649"><a href="#cb16-3649" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3650"><a href="#cb16-3650" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb16-3651"><a href="#cb16-3651" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/ssu18_auto_cor_figs.pdf"</span>,</span>
<span id="cb16-3652"><a href="#cb16-3652" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb16-3653"><a href="#cb16-3653" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb16-3654"><a href="#cb16-3654" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3655"><a href="#cb16-3655" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3656"><a href="#cb16-3656" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3657"><a href="#cb16-3657" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3658"><a href="#cb16-3658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3659"><a href="#cb16-3659" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3660"><a href="#cb16-3660" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/ssu18_auto_cor_figs.png"</span>,</span>
<span id="cb16-3661"><a href="#cb16-3661" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_5.png"</span></span>
<span id="cb16-3662"><a href="#cb16-3662" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3663"><a href="#cb16-3663" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3664"><a href="#cb16-3664" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/ssu18_auto_cor_figs.pdf"</span>,</span>
<span id="cb16-3665"><a href="#cb16-3665" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_5.pdf"</span></span>
<span id="cb16-3666"><a href="#cb16-3666" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3667"><a href="#cb16-3667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-3668"><a href="#cb16-3668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3669"><a href="#cb16-3669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3670"><a href="#cb16-3670" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 6</span></span>
<span id="cb16-3671"><a href="#cb16-3671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3672"><a href="#cb16-3672" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-3673"><a href="#cb16-3673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3674"><a href="#cb16-3674" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-3675"><a href="#cb16-3675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3676"><a href="#cb16-3676" aria-hidden="true" tabindex="-1"></a>No post processing performed.</span>
<span id="cb16-3677"><a href="#cb16-3677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3678"><a href="#cb16-3678" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3679"><a href="#cb16-3679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3680"><a href="#cb16-3680" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-3681"><a href="#cb16-3681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3682"><a href="#cb16-3682" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb16-3683"><a href="#cb16-3683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3684"><a href="#cb16-3684" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_6.png)</span></span>
<span id="cb16-3685"><a href="#cb16-3685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3686"><a href="#cb16-3686" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb16-3687"><a href="#cb16-3687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3688"><a href="#cb16-3688" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/its18_auto_cor_combo.png)</span></span>
<span id="cb16-3689"><a href="#cb16-3689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3690"><a href="#cb16-3690" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3691"><a href="#cb16-3691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3692"><a href="#cb16-3692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3693"><a href="#cb16-3693" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb16-3694"><a href="#cb16-3694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3695"><a href="#cb16-3695" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-3696"><a href="#cb16-3696" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/its18_select_mc_norm_split.rds)</span>  </span>
<span id="cb16-3697"><a href="#cb16-3697" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3698"><a href="#cb16-3698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3699"><a href="#cb16-3699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3700"><a href="#cb16-3700" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-3701"><a href="#cb16-3701" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw figure (.pdf)</span><span class="co">](include/pub/som/Supplementary_Figure_6.pdf)</span></span>
<span id="cb16-3702"><a href="#cb16-3702" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3703"><a href="#cb16-3703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3704"><a href="#cb16-3704" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3705"><a href="#cb16-3705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3708"><a href="#cb16-3708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-3709"><a href="#cb16-3709" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-3710"><a href="#cb16-3710" aria-hidden="true" tabindex="-1"></a>its18_select_mc_norm_split <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/som/its18_select_mc_norm_split.rds"</span>)</span>
<span id="cb16-3711"><a href="#cb16-3711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3712"><a href="#cb16-3712" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor <span class="ot">&lt;-</span> its18_select_mc_norm_split<span class="sc">$</span>edaphic</span>
<span id="cb16-3713"><a href="#cb16-3713" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-3714"><a href="#cb16-3714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3715"><a href="#cb16-3715" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor <span class="ot">&lt;-</span> its18_select_mc_norm_split<span class="sc">$</span>soil_funct</span>
<span id="cb16-3716"><a href="#cb16-3716" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-3717"><a href="#cb16-3717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3718"><a href="#cb16-3718" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor <span class="ot">&lt;-</span> its18_select_mc_norm_split<span class="sc">$</span>temp_adapt</span>
<span id="cb16-3719"><a href="#cb16-3719" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-3720"><a href="#cb16-3720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3721"><a href="#cb16-3721" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_cor$"</span>)) {</span>
<span id="cb16-3722"><a href="#cb16-3722" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-3723"><a href="#cb16-3723" aria-hidden="true" tabindex="-1"></a>  tmp_cormat <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(tmp_get), <span class="dv">2</span>)</span>
<span id="cb16-3724"><a href="#cb16-3724" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_cormat)</span>
<span id="cb16-3725"><a href="#cb16-3725" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3726"><a href="#cb16-3726" aria-hidden="true" tabindex="-1"></a>  tmp_get_lower_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb16-3727"><a href="#cb16-3727" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">upper.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-3728"><a href="#cb16-3728" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb16-3729"><a href="#cb16-3729" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3730"><a href="#cb16-3730" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get upper triangle of the correlation matrix</span></span>
<span id="cb16-3731"><a href="#cb16-3731" aria-hidden="true" tabindex="-1"></a>  tmp_get_upper_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb16-3732"><a href="#cb16-3732" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">lower.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-3733"><a href="#cb16-3733" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb16-3734"><a href="#cb16-3734" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3735"><a href="#cb16-3735" aria-hidden="true" tabindex="-1"></a>  tmp_upper_tri <span class="ot">&lt;-</span> <span class="fu">tmp_get_upper_tri</span>(tmp_cormat)</span>
<span id="cb16-3736"><a href="#cb16-3736" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_upper_tri, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3737"><a href="#cb16-3737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb16-3738"><a href="#cb16-3738" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>()</span>
<span id="cb16-3739"><a href="#cb16-3739" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3740"><a href="#cb16-3740" aria-hidden="true" tabindex="-1"></a>  tmp_ggheatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(Var2, Var1, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb16-3741"><a href="#cb16-3741" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-3742"><a href="#cb16-3742" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, </span>
<span id="cb16-3743"><a href="#cb16-3743" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">space =</span> <span class="st">"Lab"</span>, </span>
<span id="cb16-3744"><a href="#cb16-3744" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name=</span><span class="st">"Pearson</span><span class="sc">\n</span><span class="st">Correlation"</span>) <span class="sc">+</span></span>
<span id="cb16-3745"><a href="#cb16-3745" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb16-3746"><a href="#cb16-3746" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, </span>
<span id="cb16-3747"><a href="#cb16-3747" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb16-3748"><a href="#cb16-3748" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb16-3749"><a href="#cb16-3749" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb16-3750"><a href="#cb16-3750" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(Var2, Var1, <span class="at">label =</span> value), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.75</span>) <span class="sc">+</span></span>
<span id="cb16-3751"><a href="#cb16-3751" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-3752"><a href="#cb16-3752" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3753"><a href="#cb16-3753" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3754"><a href="#cb16-3754" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3755"><a href="#cb16-3755" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3756"><a href="#cb16-3756" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3757"><a href="#cb16-3757" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-3758"><a href="#cb16-3758" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb16-3759"><a href="#cb16-3759" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>),</span>
<span id="cb16-3760"><a href="#cb16-3760" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb16-3761"><a href="#cb16-3761" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="dv">7</span>, <span class="at">barheight =</span> <span class="dv">1</span>,</span>
<span id="cb16-3762"><a href="#cb16-3762" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.position =</span> <span class="st">"top"</span>, </span>
<span id="cb16-3763"><a href="#cb16-3763" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb16-3764"><a href="#cb16-3764" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_ggheatmap"</span>))</span>
<span id="cb16-3765"><a href="#cb16-3765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_ggheatmap)</span>
<span id="cb16-3766"><a href="#cb16-3766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-3767"><a href="#cb16-3767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3768"><a href="#cb16-3768" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb16-3769"><a href="#cb16-3769" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_ggheatmap"</span>)</span>
<span id="cb16-3770"><a href="#cb16-3770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3771"><a href="#cb16-3771" aria-hidden="true" tabindex="-1"></a>auto_cor_figs <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb16-3772"><a href="#cb16-3772" aria-hidden="true" tabindex="-1"></a>  edaphic_norm_cor_ggheatmap, </span>
<span id="cb16-3773"><a href="#cb16-3773" aria-hidden="true" tabindex="-1"></a>  soil_funct_norm_cor_ggheatmap, </span>
<span id="cb16-3774"><a href="#cb16-3774" aria-hidden="true" tabindex="-1"></a>  temp_adapt_norm_cor_ggheatmap,</span>
<span id="cb16-3775"><a href="#cb16-3775" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">common.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-3776"><a href="#cb16-3776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3777"><a href="#cb16-3777" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3778"><a href="#cb16-3778" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb16-3779"><a href="#cb16-3779" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/its18_auto_cor_figs.png"</span>,</span>
<span id="cb16-3780"><a href="#cb16-3780" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb16-3781"><a href="#cb16-3781" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb16-3782"><a href="#cb16-3782" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3783"><a href="#cb16-3783" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3784"><a href="#cb16-3784" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3785"><a href="#cb16-3785" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3786"><a href="#cb16-3786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3787"><a href="#cb16-3787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3788"><a href="#cb16-3788" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-3789"><a href="#cb16-3789" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb16-3790"><a href="#cb16-3790" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/som/its18_auto_cor_figs.pdf"</span>,</span>
<span id="cb16-3791"><a href="#cb16-3791" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb16-3792"><a href="#cb16-3792" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb16-3793"><a href="#cb16-3793" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-3794"><a href="#cb16-3794" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-3795"><a href="#cb16-3795" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-3796"><a href="#cb16-3796" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3797"><a href="#cb16-3797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3798"><a href="#cb16-3798" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3799"><a href="#cb16-3799" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/its18_auto_cor_figs.png"</span>,</span>
<span id="cb16-3800"><a href="#cb16-3800" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_6.png"</span></span>
<span id="cb16-3801"><a href="#cb16-3801" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3802"><a href="#cb16-3802" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-3803"><a href="#cb16-3803" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/its18_auto_cor_figs.pdf"</span>,</span>
<span id="cb16-3804"><a href="#cb16-3804" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_6.pdf"</span></span>
<span id="cb16-3805"><a href="#cb16-3805" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3806"><a href="#cb16-3806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-3807"><a href="#cb16-3807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3808"><a href="#cb16-3808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3809"><a href="#cb16-3809" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figures 7--14</span></span>
<span id="cb16-3810"><a href="#cb16-3810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3811"><a href="#cb16-3811" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-3812"><a href="#cb16-3812" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the data pack</span><span class="co">](include/pub/som/ssu18_ps_work.rds)</span>  </span>
<span id="cb16-3813"><a href="#cb16-3813" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-3814"><a href="#cb16-3814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3817"><a href="#cb16-3817" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-3818"><a href="#cb16-3818" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb16-3819"><a href="#cb16-3819" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/som/ssu18_ps_work.rds"</span>)</span>
<span id="cb16-3820"><a href="#cb16-3820" aria-hidden="true" tabindex="-1"></a>ssu18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work"</span>)</span>
<span id="cb16-3821"><a href="#cb16-3821" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-3822"><a href="#cb16-3822" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_proteo"</span>))</span>
<span id="cb16-3823"><a href="#cb16-3823" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb16-3824"><a href="#cb16-3824" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">subset_taxa</span>(tmp_get, Phylum <span class="sc">==</span> <span class="st">"Proteobacteria"</span>)</span>
<span id="cb16-3825"><a href="#cb16-3825" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-3826"><a href="#cb16-3826" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb16-3827"><a href="#cb16-3827" aria-hidden="true" tabindex="-1"></a>     tmp_get_taxa <span class="ot">&lt;-</span> <span class="fu">get_taxa_unique</span>(tmp_df,</span>
<span id="cb16-3828"><a href="#cb16-3828" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_df)[<span class="dv">3</span>],</span>
<span id="cb16-3829"><a href="#cb16-3829" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">errorIfNULL=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-3830"><a href="#cb16-3830" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_get_taxa)</span>
<span id="cb16-3831"><a href="#cb16-3831" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3832"><a href="#cb16-3832" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_proteo"</span>))</span>
<span id="cb16-3833"><a href="#cb16-3833" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3834"><a href="#cb16-3834" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span id="cb16-3835"><a href="#cb16-3835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3836"><a href="#cb16-3836" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb16-3837"><a href="#cb16-3837" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>))</span>
<span id="cb16-3838"><a href="#cb16-3838" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb16-3839"><a href="#cb16-3839" aria-hidden="true" tabindex="-1"></a>  tmp_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb16-3840"><a href="#cb16-3840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3841"><a href="#cb16-3841" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tmp_clean)){</span>
<span id="cb16-3842"><a href="#cb16-3842" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Alphaproteobacteria"</span>){</span>
<span id="cb16-3843"><a href="#cb16-3843" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Alphaproteobacteria"</span>)</span>
<span id="cb16-3844"><a href="#cb16-3844" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-3845"><a href="#cb16-3845" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Gammaproteobacteria"</span>){</span>
<span id="cb16-3846"><a href="#cb16-3846" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Gammaproteobacteria"</span>)</span>
<span id="cb16-3847"><a href="#cb16-3847" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-3848"><a href="#cb16-3848" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Zetaproteobacteria"</span>){</span>
<span id="cb16-3849"><a href="#cb16-3849" aria-hidden="true" tabindex="-1"></a>              phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Zetaproteobacteria"</span>)</span>
<span id="cb16-3850"><a href="#cb16-3850" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-3851"><a href="#cb16-3851" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"p_Proteobacteria"</span>){</span>
<span id="cb16-3852"><a href="#cb16-3852" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p_Proteobacteria"</span>)</span>
<span id="cb16-3853"><a href="#cb16-3853" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb16-3854"><a href="#cb16-3854" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb16-3855"><a href="#cb16-3855" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb16-3856"><a href="#cb16-3856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(tmp_get) <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_clean)</span>
<span id="cb16-3857"><a href="#cb16-3857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rank_names</span>(tmp_get)</span>
<span id="cb16-3858"><a href="#cb16-3858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_get)</span>
<span id="cb16-3859"><a href="#cb16-3859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(tmp_name, tmp_get))</span>
<span id="cb16-3860"><a href="#cb16-3860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">length</span>(<span class="fu">get_taxa_unique</span>(tmp_get,</span>
<span id="cb16-3861"><a href="#cb16-3861" aria-hidden="true" tabindex="-1"></a>                               <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">2</span>],</span>
<span id="cb16-3862"><a href="#cb16-3862" aria-hidden="true" tabindex="-1"></a>                               <span class="at">errorIfNULL=</span><span class="cn">TRUE</span>)))</span>
<span id="cb16-3863"><a href="#cb16-3863" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/som/"</span>)</span>
<span id="cb16-3864"><a href="#cb16-3864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(tmp_get, <span class="fu">paste</span>(tmp_path, j, <span class="st">"_clean.rds"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb16-3865"><a href="#cb16-3865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3866"><a href="#cb16-3866" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3867"><a href="#cb16-3867" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(class, order, phylum)</span>
<span id="cb16-3868"><a href="#cb16-3868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3869"><a href="#cb16-3869" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="st">"ssu18_ps_work"</span></span>
<span id="cb16-3870"><a href="#cb16-3870" aria-hidden="true" tabindex="-1"></a>tax_group <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-3871"><a href="#cb16-3871" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alphaproteobacteria"</span>,</span>
<span id="cb16-3872"><a href="#cb16-3872" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gammaproteobacteria"</span>,</span>
<span id="cb16-3873"><a href="#cb16-3873" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Acidobacteriota"</span>,</span>
<span id="cb16-3874"><a href="#cb16-3874" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Actinobacteriota"</span>,</span>
<span id="cb16-3875"><a href="#cb16-3875" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bacteroidota"</span>,</span>
<span id="cb16-3876"><a href="#cb16-3876" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Firmicutes"</span>,</span>
<span id="cb16-3877"><a href="#cb16-3877" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Myxococcota"</span>,</span>
<span id="cb16-3878"><a href="#cb16-3878" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Verrucomicrobiota"</span></span>
<span id="cb16-3879"><a href="#cb16-3879" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-3880"><a href="#cb16-3880" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> set_to_plot) {</span>
<span id="cb16-3881"><a href="#cb16-3881" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> tax_group) {</span>
<span id="cb16-3882"><a href="#cb16-3882" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>)))</span>
<span id="cb16-3883"><a href="#cb16-3883" aria-hidden="true" tabindex="-1"></a>    tmp_sub <span class="ot">&lt;-</span> <span class="fu">subset_taxa</span>(tmp_get, Phylum <span class="sc">==</span> j)</span>
<span id="cb16-3884"><a href="#cb16-3884" aria-hidden="true" tabindex="-1"></a>    tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_"</span>, j))</span>
<span id="cb16-3885"><a href="#cb16-3885" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(tmp_name, tmp_sub)</span>
<span id="cb16-3886"><a href="#cb16-3886" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3887"><a href="#cb16-3887" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-3888"><a href="#cb16-3888" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3889"><a href="#cb16-3889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3890"><a href="#cb16-3890" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-3891"><a href="#cb16-3891" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i)))</span>
<span id="cb16-3892"><a href="#cb16-3892" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span>  <span class="fu">get_taxa_unique</span>(tmp_get, <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">5</span>], <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3893"><a href="#cb16-3893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3894"><a href="#cb16-3894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"####################################################"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3895"><a href="#cb16-3895" aria-hidden="true" tabindex="-1"></a>  tmp_print <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unique taxa:"</span>, i)</span>
<span id="cb16-3896"><a href="#cb16-3896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(tmp_print, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3897"><a href="#cb16-3897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"####################################################"</span>)</span>
<span id="cb16-3898"><a href="#cb16-3898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3899"><a href="#cb16-3899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_list)</span>
<span id="cb16-3900"><a href="#cb16-3900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3901"><a href="#cb16-3901" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3902"><a href="#cb16-3902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3903"><a href="#cb16-3903" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Choose the **number** of taxa to display and the taxonomic **level**. </span></span>
<span id="cb16-3904"><a href="#cb16-3904" aria-hidden="true" tabindex="-1"></a><span class="do">## Aggregate the rest into "Other".</span></span>
<span id="cb16-3905"><a href="#cb16-3905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3906"><a href="#cb16-3906" aria-hidden="true" tabindex="-1"></a>aggregate_top_taxa <span class="ot">&lt;-</span> <span class="cf">function</span> (x, top, level) {</span>
<span id="cb16-3907"><a href="#cb16-3907" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">aggregate_taxa</span>(x, level)</span>
<span id="cb16-3908"><a href="#cb16-3908" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3909"><a href="#cb16-3909" aria-hidden="true" tabindex="-1"></a>  tops <span class="ot">&lt;-</span> <span class="fu">top_taxa</span>(x, top)</span>
<span id="cb16-3910"><a href="#cb16-3910" aria-hidden="true" tabindex="-1"></a>  tax <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(x)</span>
<span id="cb16-3911"><a href="#cb16-3911" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3912"><a href="#cb16-3912" aria-hidden="true" tabindex="-1"></a>  inds <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">rownames</span>(tax) <span class="sc">%in%</span> tops)</span>
<span id="cb16-3913"><a href="#cb16-3913" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3914"><a href="#cb16-3914" aria-hidden="true" tabindex="-1"></a>  tax[inds, level] <span class="ot">&lt;-</span> <span class="st">"Other"</span></span>
<span id="cb16-3915"><a href="#cb16-3915" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3916"><a href="#cb16-3916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(x) <span class="ot">&lt;-</span> tax</span>
<span id="cb16-3917"><a href="#cb16-3917" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3918"><a href="#cb16-3918" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(x)[, level]</span>
<span id="cb16-3919"><a href="#cb16-3919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(x) <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(tt)</span>
<span id="cb16-3920"><a href="#cb16-3920" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3921"><a href="#cb16-3921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aggregate_taxa</span>(x, level)</span>
<span id="cb16-3922"><a href="#cb16-3922" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3923"><a href="#cb16-3923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3924"><a href="#cb16-3924" aria-hidden="true" tabindex="-1"></a>top_hits <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb16-3925"><a href="#cb16-3925" aria-hidden="true" tabindex="-1"></a>top_level <span class="ot">&lt;-</span> <span class="st">"Family"</span></span>
<span id="cb16-3926"><a href="#cb16-3926" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-3927"><a href="#cb16-3927" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i)))</span>
<span id="cb16-3928"><a href="#cb16-3928" aria-hidden="true" tabindex="-1"></a>  tmp_otu <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb16-3929"><a href="#cb16-3929" aria-hidden="true" tabindex="-1"></a>  tmp_otu[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tmp_otu, as.numeric)</span>
<span id="cb16-3930"><a href="#cb16-3930" aria-hidden="true" tabindex="-1"></a>  tmp_otu <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_otu)</span>
<span id="cb16-3931"><a href="#cb16-3931" aria-hidden="true" tabindex="-1"></a>  tmp_tax <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get)))</span>
<span id="cb16-3932"><a href="#cb16-3932" aria-hidden="true" tabindex="-1"></a>  tmp_samples <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb16-3933"><a href="#cb16-3933" aria-hidden="true" tabindex="-1"></a>  tmp_clean_df <span class="ot">&lt;-</span></span>
<span id="cb16-3934"><a href="#cb16-3934" aria-hidden="true" tabindex="-1"></a>    <span class="fu">merge_phyloseq</span>(</span>
<span id="cb16-3935"><a href="#cb16-3935" aria-hidden="true" tabindex="-1"></a>      <span class="fu">otu_table</span>(tmp_otu, <span class="at">taxa_are_rows =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-3936"><a href="#cb16-3936" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tax_table</span>(tmp_tax),</span>
<span id="cb16-3937"><a href="#cb16-3937" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sample_data</span>(tmp_samples)</span>
<span id="cb16-3938"><a href="#cb16-3938" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-3939"><a href="#cb16-3939" aria-hidden="true" tabindex="-1"></a>  tmp_agg_df <span class="ot">&lt;-</span> <span class="fu">aggregate_top_taxa</span>(tmp_clean_df,</span>
<span id="cb16-3940"><a href="#cb16-3940" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">top =</span> top_hits,</span>
<span id="cb16-3941"><a href="#cb16-3941" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">level =</span> top_level)</span>
<span id="cb16-3942"><a href="#cb16-3942" aria-hidden="true" tabindex="-1"></a>  tmp_agg_name <span class="ot">&lt;-</span></span>
<span id="cb16-3943"><a href="#cb16-3943" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg"</span>))</span>
<span id="cb16-3944"><a href="#cb16-3944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_agg_name, tmp_agg_df)</span>
<span id="cb16-3945"><a href="#cb16-3945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_sep_agg"</span>))</span>
<span id="cb16-3946"><a href="#cb16-3946" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3947"><a href="#cb16-3947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3948"><a href="#cb16-3948" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group){</span>
<span id="cb16-3949"><a href="#cb16-3949" aria-hidden="true" tabindex="-1"></a>  tmp_data <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg"</span>))</span>
<span id="cb16-3950"><a href="#cb16-3950" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_data)</span>
<span id="cb16-3951"><a href="#cb16-3951" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span> <span class="fu">get_taxa_unique</span>(tmp_get, <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">2</span>],</span>
<span id="cb16-3952"><a href="#cb16-3952" aria-hidden="true" tabindex="-1"></a>                        <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3953"><a href="#cb16-3953" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(tmp_data, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_order"</span>))</span>
<span id="cb16-3954"><a href="#cb16-3954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_list)</span>
<span id="cb16-3955"><a href="#cb16-3955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3956"><a href="#cb16-3956" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3957"><a href="#cb16-3957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3958"><a href="#cb16-3958" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-3959"><a href="#cb16-3959" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg_order"</span>)))</span>
<span id="cb16-3960"><a href="#cb16-3960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3961"><a href="#cb16-3961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"#########"</span>, i, <span class="st">"########"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3962"><a href="#cb16-3962" aria-hidden="true" tabindex="-1"></a>  tmp_print <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_get)</span>
<span id="cb16-3963"><a href="#cb16-3963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(tmp_print, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3964"><a href="#cb16-3964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"####################################################"</span>)</span>
<span id="cb16-3965"><a href="#cb16-3965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb16-3966"><a href="#cb16-3966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-3967"><a href="#cb16-3967" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3968"><a href="#cb16-3968" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(i, j)</span>
<span id="cb16-3969"><a href="#cb16-3969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3970"><a href="#cb16-3970" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Alphaproteobacteria"</span>, <span class="st">"o_Elsterales"</span>, </span>
<span id="cb16-3971"><a href="#cb16-3971" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Azospirillales"</span>, <span class="st">"Rhizobiales_Incertae_Sedis"</span>, </span>
<span id="cb16-3972"><a href="#cb16-3972" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Xanthobacteraceae"</span>, <span class="st">"Sphingomonadaceae"</span>, <span class="st">"Rhizobiaceae"</span>, </span>
<span id="cb16-3973"><a href="#cb16-3973" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Micropepsaceae"</span>, <span class="st">"Methyloligellaceae"</span>, <span class="st">"KF-JG30-B3"</span>, </span>
<span id="cb16-3974"><a href="#cb16-3974" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Hyphomicrobiaceae"</span>, <span class="st">"Dongiaceae"</span>))</span>
<span id="cb16-3975"><a href="#cb16-3975" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Alphaproteobacteria"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-3976"><a href="#cb16-3976" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-3977"><a href="#cb16-3977" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-3978"><a href="#cb16-3978" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Gammaproteobacteria"</span>, <span class="st">"o_PLTA13"</span>, <span class="st">"o_CCD24"</span>, </span>
<span id="cb16-3979"><a href="#cb16-3979" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Unknown_Family"</span>, <span class="st">"Xanthomonadaceae"</span>, <span class="st">"TRA3-20"</span>, </span>
<span id="cb16-3980"><a href="#cb16-3980" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Steroidobacteraceae"</span>, <span class="st">"SC-I-84"</span>, <span class="st">"Nitrosomonadaceae"</span>, </span>
<span id="cb16-3981"><a href="#cb16-3981" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Comamonadaceae"</span>, <span class="st">"Burkholderiaceae"</span>, <span class="st">"B1-7BS"</span>))</span>
<span id="cb16-3982"><a href="#cb16-3982" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-3983"><a href="#cb16-3983" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-3984"><a href="#cb16-3984" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-3985"><a href="#cb16-3985" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Subgroup_22"</span>, <span class="st">"c_Subgroup_25"</span>, <span class="st">"c_Subgroup_5"</span>, </span>
<span id="cb16-3986"><a href="#cb16-3986" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Vicinamibacterales"</span>, <span class="st">"o_11-24"</span>, <span class="st">"o_Subgroup_17"</span>, </span>
<span id="cb16-3987"><a href="#cb16-3987" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Subgroup_2"</span>, <span class="st">"o_Subgroup_7"</span>, <span class="st">"o_Acidobacteriales"</span>, </span>
<span id="cb16-3988"><a href="#cb16-3988" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Vicinamibacteraceae"</span>, <span class="st">"Solibacteraceae"</span>, <span class="st">"Pyrinomonadaceae"</span>))</span>
<span id="cb16-3989"><a href="#cb16-3989" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Acidobacteriota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-3990"><a href="#cb16-3990" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-3991"><a href="#cb16-3991" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-3992"><a href="#cb16-3992" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_MB-A2-108"</span>, <span class="st">"o_IMCC26256"</span>, <span class="st">"o_Gaiellales"</span>, </span>
<span id="cb16-3993"><a href="#cb16-3993" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Frankiales"</span>, <span class="st">"Streptomycetaceae"</span>, <span class="st">"Solirubrobacteraceae"</span>, </span>
<span id="cb16-3994"><a href="#cb16-3994" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Nocardioidaceae"</span>, <span class="st">"Mycobacteriaceae"</span>, <span class="st">"Micromonosporaceae"</span>, </span>
<span id="cb16-3995"><a href="#cb16-3995" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Gaiellaceae"</span>, <span class="st">"Acidothermaceae"</span>, <span class="st">"67-14"</span>))</span>
<span id="cb16-3996"><a href="#cb16-3996" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-3997"><a href="#cb16-3997" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-3998"><a href="#cb16-3998" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-3999"><a href="#cb16-3999" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_SJA-28"</span>, <span class="st">"o_Chitinophagales"</span>, <span class="st">"Sphingobacteriaceae"</span>, </span>
<span id="cb16-4000"><a href="#cb16-4000" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Saprospiraceae"</span>, <span class="st">"Microscillaceae"</span>, <span class="st">"Hymenobacteraceae"</span>, </span>
<span id="cb16-4001"><a href="#cb16-4001" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Flavobacteriaceae"</span>, <span class="st">"Cytophagaceae"</span>, <span class="st">"Chitinophagaceae"</span>, </span>
<span id="cb16-4002"><a href="#cb16-4002" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"BSV26"</span>, <span class="st">"env.OPS_17"</span>, <span class="st">"AKYH767"</span>))</span>
<span id="cb16-4003"><a href="#cb16-4003" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Bacteroidota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-4004"><a href="#cb16-4004" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-4005"><a href="#cb16-4005" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-4006"><a href="#cb16-4006" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"p_Firmicutes"</span>, <span class="st">"c_Bacilli"</span>, <span class="st">"o_Bacillales"</span>, </span>
<span id="cb16-4007"><a href="#cb16-4007" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Thermoactinomycetaceae"</span>, <span class="st">"type_III"</span>, <span class="st">"Paenibacillaceae"</span>, </span>
<span id="cb16-4008"><a href="#cb16-4008" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Lachnospiraceae"</span>, <span class="st">"Hungateiclostridiaceae"</span>, <span class="st">"Clostridiaceae"</span>, </span>
<span id="cb16-4009"><a href="#cb16-4009" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Bacillaceae"</span>, <span class="st">"Alicyclobacillaceae"</span>, <span class="st">"Planococcaceae"</span>))</span>
<span id="cb16-4010"><a href="#cb16-4010" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-4011"><a href="#cb16-4011" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-4012"><a href="#cb16-4012" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-4013"><a href="#cb16-4013" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"p_Myxococcota"</span>, <span class="st">"c_bacteriap25"</span>, <span class="st">"c_Polyangia"</span>, </span>
<span id="cb16-4014"><a href="#cb16-4014" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_mle1-27"</span>, <span class="st">"o_MSB-4B10"</span>, <span class="st">"Sandaracinaceae"</span>, <span class="st">"Polyangiaceae"</span>, </span>
<span id="cb16-4015"><a href="#cb16-4015" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Phaselicystidaceae"</span>, <span class="st">"Myxococcaceae"</span>, <span class="st">"Haliangiaceae"</span>, </span>
<span id="cb16-4016"><a href="#cb16-4016" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"BIrii41"</span>, <span class="st">"Anaeromyxobacteraceae"</span>))</span>
<span id="cb16-4017"><a href="#cb16-4017" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Myxococcota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-4018"><a href="#cb16-4018" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-4019"><a href="#cb16-4019" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-4020"><a href="#cb16-4020" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Verrucomicrobiae"</span>, <span class="st">"o_Chlamydiales"</span>, <span class="st">"o_LD1-PA32"</span>, </span>
<span id="cb16-4021"><a href="#cb16-4021" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_S-BQ2-57_soil_group"</span>, <span class="st">"Xiphinematobacteraceae"</span>, </span>
<span id="cb16-4022"><a href="#cb16-4022" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Simkaniaceae"</span>, <span class="st">"Pedosphaeraceae"</span>, <span class="st">"Parachlamydiaceae"</span>, </span>
<span id="cb16-4023"><a href="#cb16-4023" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Opitutaceae"</span>, <span class="st">"Omnitrophaceae"</span>, <span class="st">"cvE6"</span>, <span class="st">"Chthoniobacteraceae"</span>))</span>
<span id="cb16-4024"><a href="#cb16-4024" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Verrucomicrobiota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb16-4025"><a href="#cb16-4025" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb16-4026"><a href="#cb16-4026" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb16-4027"><a href="#cb16-4027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4028"><a href="#cb16-4028" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Now, transform the data to relative abundance.</span></span>
<span id="cb16-4029"><a href="#cb16-4029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4030"><a href="#cb16-4030" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-4031"><a href="#cb16-4031" aria-hidden="true" tabindex="-1"></a>  tmp_agg <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg"</span>))</span>
<span id="cb16-4032"><a href="#cb16-4032" aria-hidden="true" tabindex="-1"></a>  tmp_order <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(tmp_agg, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_order"</span>))</span>
<span id="cb16-4033"><a href="#cb16-4033" aria-hidden="true" tabindex="-1"></a>  tmp_get_agg <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_agg)</span>
<span id="cb16-4034"><a href="#cb16-4034" aria-hidden="true" tabindex="-1"></a>  tmp_get_order <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_order)</span>
<span id="cb16-4035"><a href="#cb16-4035" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> tmp_get_agg <span class="sc">%&gt;%</span></span>
<span id="cb16-4036"><a href="#cb16-4036" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transform_sample_counts</span>(<span class="cf">function</span>(x) {</span>
<span id="cb16-4037"><a href="#cb16-4037" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">/</span> <span class="fu">sum</span>(x)</span>
<span id="cb16-4038"><a href="#cb16-4038" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span></span>
<span id="cb16-4039"><a href="#cb16-4039" aria-hidden="true" tabindex="-1"></a>    <span class="fu">psmelt</span>()</span>
<span id="cb16-4040"><a href="#cb16-4040" aria-hidden="true" tabindex="-1"></a>  tmp_df[[top_level]] <span class="ot">&lt;-</span> gdata<span class="sc">::</span><span class="fu">reorder.factor</span>(tmp_df[[top_level]],</span>
<span id="cb16-4041"><a href="#cb16-4041" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">new.order =</span> <span class="fu">rev</span>(tmp_get_order))</span>
<span id="cb16-4042"><a href="#cb16-4042" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">get</span>(top_level))</span>
<span id="cb16-4043"><a href="#cb16-4043" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(tmp_agg, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax"</span>))</span>
<span id="cb16-4044"><a href="#cb16-4044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb16-4045"><a href="#cb16-4045" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(c(i, tmp_name, tmp_agg))</span></span>
<span id="cb16-4046"><a href="#cb16-4046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-4047"><a href="#cb16-4047" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-4048"><a href="#cb16-4048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4049"><a href="#cb16-4049" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-4050"><a href="#cb16-4050" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span></span>
<span id="cb16-4051"><a href="#cb16-4051" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg_tax"</span>)))</span>
<span id="cb16-4052"><a href="#cb16-4052" aria-hidden="true" tabindex="-1"></a>  tmp_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(tmp_get[[top_level]])</span>
<span id="cb16-4053"><a href="#cb16-4053" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(i, tmp_levels))</span>
<span id="cb16-4054"><a href="#cb16-4054" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-4055"><a href="#cb16-4055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4056"><a href="#cb16-4056" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Plot the data for a single phyloseq object. Here you use an aggregated tax file.</span></span>
<span id="cb16-4057"><a href="#cb16-4057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4058"><a href="#cb16-4058" aria-hidden="true" tabindex="-1"></a>ssu18_colvec.tax <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-4059"><a href="#cb16-4059" aria-hidden="true" tabindex="-1"></a><span class="st">"#3D3C04"</span>,</span>
<span id="cb16-4060"><a href="#cb16-4060" aria-hidden="true" tabindex="-1"></a><span class="st">"#FF95BA"</span>,</span>
<span id="cb16-4061"><a href="#cb16-4061" aria-hidden="true" tabindex="-1"></a><span class="st">"#00A090"</span>,</span>
<span id="cb16-4062"><a href="#cb16-4062" aria-hidden="true" tabindex="-1"></a><span class="st">"#C00B6F"</span>,</span>
<span id="cb16-4063"><a href="#cb16-4063" aria-hidden="true" tabindex="-1"></a><span class="st">"#5FFFDE"</span>,</span>
<span id="cb16-4064"><a href="#cb16-4064" aria-hidden="true" tabindex="-1"></a><span class="st">"#0063E5"</span>,</span>
<span id="cb16-4065"><a href="#cb16-4065" aria-hidden="true" tabindex="-1"></a><span class="st">"#ED0DFD"</span>,</span>
<span id="cb16-4066"><a href="#cb16-4066" aria-hidden="true" tabindex="-1"></a><span class="st">"#FFA035"</span>,</span>
<span id="cb16-4067"><a href="#cb16-4067" aria-hidden="true" tabindex="-1"></a><span class="st">"#00C7F9"</span>,</span>
<span id="cb16-4068"><a href="#cb16-4068" aria-hidden="true" tabindex="-1"></a><span class="st">"#C80B2A"</span>,</span>
<span id="cb16-4069"><a href="#cb16-4069" aria-hidden="true" tabindex="-1"></a><span class="st">"#00A51C"</span>,</span>
<span id="cb16-4070"><a href="#cb16-4070" aria-hidden="true" tabindex="-1"></a><span class="st">"#FFD5FD"</span>,</span>
<span id="cb16-4071"><a href="#cb16-4071" aria-hidden="true" tabindex="-1"></a><span class="st">"#00463C"</span></span>
<span id="cb16-4072"><a href="#cb16-4072" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4073"><a href="#cb16-4073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4074"><a href="#cb16-4074" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-4075"><a href="#cb16-4075" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span></span>
<span id="cb16-4076"><a href="#cb16-4076" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg_tax"</span>)))</span>
<span id="cb16-4077"><a href="#cb16-4077" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_get, <span class="fu">aes</span>(</span>
<span id="cb16-4078"><a href="#cb16-4078" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">factor</span>(TEMP),</span>
<span id="cb16-4079"><a href="#cb16-4079" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> Abundance,</span>
<span id="cb16-4080"><a href="#cb16-4080" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">get</span>(top_level)</span>
<span id="cb16-4081"><a href="#cb16-4081" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb16-4082"><a href="#cb16-4082" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb16-4083"><a href="#cb16-4083" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> ssu18_colvec.tax) <span class="sc">+</span></span>
<span id="cb16-4084"><a href="#cb16-4084" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-4085"><a href="#cb16-4085" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> top_level)) <span class="sc">+</span></span>
<span id="cb16-4086"><a href="#cb16-4086" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative Abundance (% total reads)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Temperature"</span>) <span class="sc">+</span></span>
<span id="cb16-4087"><a href="#cb16-4087" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-4088"><a href="#cb16-4088" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-4089"><a href="#cb16-4089" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-4090"><a href="#cb16-4090" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-4091"><a href="#cb16-4091" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-4092"><a href="#cb16-4092" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb16-4093"><a href="#cb16-4093" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb16-4094"><a href="#cb16-4094" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-4095"><a href="#cb16-4095" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span></span>
<span id="cb16-4096"><a href="#cb16-4096" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot"</span>))</span>
<span id="cb16-4097"><a href="#cb16-4097" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb16-4098"><a href="#cb16-4098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-4099"><a href="#cb16-4099" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-4100"><a href="#cb16-4100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4101"><a href="#cb16-4101" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) Plot the data for multiple taxa. Here again you use an aggregated tax file. </span></span>
<span id="cb16-4102"><a href="#cb16-4102" aria-hidden="true" tabindex="-1"></a><span class="do">## This code can be used to generate plots for multiple data frames by adding the </span></span>
<span id="cb16-4103"><a href="#cb16-4103" aria-hidden="true" tabindex="-1"></a><span class="do">## base  phyloseq names to the `ssu18_split_df` variable. This code will also </span></span>
<span id="cb16-4104"><a href="#cb16-4104" aria-hidden="true" tabindex="-1"></a><span class="do">## facet the plots by a metadata variable. If you do not want to facet remove </span></span>
<span id="cb16-4105"><a href="#cb16-4105" aria-hidden="true" tabindex="-1"></a><span class="do">## the line beginning with `facet_grid`.</span></span>
<span id="cb16-4106"><a href="#cb16-4106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4107"><a href="#cb16-4107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-4108"><a href="#cb16-4108" aria-hidden="true" tabindex="-1"></a>  tmp_level_get <span class="ot">&lt;-</span></span>
<span id="cb16-4109"><a href="#cb16-4109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, .)))</span>
<span id="cb16-4110"><a href="#cb16-4110" aria-hidden="true" tabindex="-1"></a>  tmp_level <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_level_get))</span>
<span id="cb16-4111"><a href="#cb16-4111" aria-hidden="true" tabindex="-1"></a>  tmp_level <span class="ot">&lt;-</span> tmp_level[<span class="fu">order</span>(tmp_level<span class="sc">$</span>TEMP),]</span>
<span id="cb16-4112"><a href="#cb16-4112" aria-hidden="true" tabindex="-1"></a>  tmp_level <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(tmp_level<span class="sc">$</span>SamName)</span>
<span id="cb16-4113"><a href="#cb16-4113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4114"><a href="#cb16-4114" aria-hidden="true" tabindex="-1"></a>  tmp_agg_name <span class="ot">&lt;-</span></span>
<span id="cb16-4115"><a href="#cb16-4115" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, .,  <span class="st">"_agg_tax"</span>))</span>
<span id="cb16-4116"><a href="#cb16-4116" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_agg_name)</span>
<span id="cb16-4117"><a href="#cb16-4117" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span></span>
<span id="cb16-4118"><a href="#cb16-4118" aria-hidden="true" tabindex="-1"></a>    reshape<span class="sc">::</span><span class="fu">melt</span>(tmp_get, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"Sample"</span>, <span class="st">"TEMP"</span>, <span class="st">"Abundance"</span>, <span class="st">"Family"</span>))</span>
<span id="cb16-4119"><a href="#cb16-4119" aria-hidden="true" tabindex="-1"></a>  tmp_plot_name <span class="ot">&lt;-</span></span>
<span id="cb16-4120"><a href="#cb16-4120" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot_melt"</span>))</span>
<span id="cb16-4121"><a href="#cb16-4121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4122"><a href="#cb16-4122" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df,</span>
<span id="cb16-4123"><a href="#cb16-4123" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(</span>
<span id="cb16-4124"><a href="#cb16-4124" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x =</span> Sample,</span>
<span id="cb16-4125"><a href="#cb16-4125" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> Abundance,</span>
<span id="cb16-4126"><a href="#cb16-4126" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> <span class="fu">get</span>(top_level)</span>
<span id="cb16-4127"><a href="#cb16-4127" aria-hidden="true" tabindex="-1"></a>                     )) <span class="sc">+</span></span>
<span id="cb16-4128"><a href="#cb16-4128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(. <span class="sc">~</span> TEMP, <span class="at">scale =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb16-4129"><a href="#cb16-4129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>)  <span class="sc">+</span></span>
<span id="cb16-4130"><a href="#cb16-4130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> ssu18_colvec.tax) <span class="sc">+</span></span>
<span id="cb16-4131"><a href="#cb16-4131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-4132"><a href="#cb16-4132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb16-4133"><a href="#cb16-4133" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> top_level,</span>
<span id="cb16-4134"><a href="#cb16-4134" aria-hidden="true" tabindex="-1"></a>      <span class="at">reverse =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-4135"><a href="#cb16-4135" aria-hidden="true" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fl">0.7</span>,</span>
<span id="cb16-4136"><a href="#cb16-4136" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fl">0.7</span></span>
<span id="cb16-4137"><a href="#cb16-4137" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb16-4138"><a href="#cb16-4138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb16-4139"><a href="#cb16-4139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-4140"><a href="#cb16-4140" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-4141"><a href="#cb16-4141" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-4142"><a href="#cb16-4142" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-4143"><a href="#cb16-4143" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-4144"><a href="#cb16-4144" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb16-4145"><a href="#cb16-4145" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb16-4146"><a href="#cb16-4146" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb16-4147"><a href="#cb16-4147" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb16-4148"><a href="#cb16-4148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span>
<span id="cb16-4149"><a href="#cb16-4149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4150"><a href="#cb16-4150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plot_name, tmp_plot)</span>
<span id="cb16-4151"><a href="#cb16-4151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-4152"><a href="#cb16-4152" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-4153"><a href="#cb16-4153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4154"><a href="#cb16-4154" aria-hidden="true" tabindex="-1"></a><span class="do">## 7) Finally we use the `patchwork` package to combine the two </span></span>
<span id="cb16-4155"><a href="#cb16-4155" aria-hidden="true" tabindex="-1"></a><span class="do">## plots and customize the look.</span></span>
<span id="cb16-4156"><a href="#cb16-4156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4157"><a href="#cb16-4157" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb16-4158"><a href="#cb16-4158" aria-hidden="true" tabindex="-1"></a>  tmp_plot_main <span class="ot">&lt;-</span></span>
<span id="cb16-4159"><a href="#cb16-4159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot"</span>)))</span>
<span id="cb16-4160"><a href="#cb16-4160" aria-hidden="true" tabindex="-1"></a>  tmp_plot_melt <span class="ot">&lt;-</span></span>
<span id="cb16-4161"><a href="#cb16-4161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot_melt"</span>)))</span>
<span id="cb16-4162"><a href="#cb16-4162" aria-hidden="true" tabindex="-1"></a>  tmp_final <span class="ot">&lt;-</span> tmp_plot_main <span class="sc">+</span> tmp_plot_melt</span>
<span id="cb16-4163"><a href="#cb16-4163" aria-hidden="true" tabindex="-1"></a>  tmp_final <span class="ot">&lt;-</span> tmp_final <span class="sc">+</span></span>
<span id="cb16-4164"><a href="#cb16-4164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb16-4165"><a href="#cb16-4165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb16-4166"><a href="#cb16-4166" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb16-4167"><a href="#cb16-4167" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb16-4168"><a href="#cb16-4168" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb16-4169"><a href="#cb16-4169" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb16-4170"><a href="#cb16-4170" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb16-4171"><a href="#cb16-4171" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb16-4172"><a href="#cb16-4172" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb16-4173"><a href="#cb16-4173" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb16-4174"><a href="#cb16-4174" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-4175"><a href="#cb16-4175" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span></span>
<span id="cb16-4176"><a href="#cb16-4176" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_final_plot"</span>))</span>
<span id="cb16-4177"><a href="#cb16-4177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_final)</span>
<span id="cb16-4178"><a href="#cb16-4178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb16-4179"><a href="#cb16-4179" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-4180"><a href="#cb16-4180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4181"><a href="#cb16-4181" aria-hidden="true" tabindex="-1"></a>taxa_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"Alphaproteobacteria"</span>, </span>
<span id="cb16-4182"><a href="#cb16-4182" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"Myxococcota"</span>, </span>
<span id="cb16-4183"><a href="#cb16-4183" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Verrucomicrobiota"</span>)</span>
<span id="cb16-4184"><a href="#cb16-4184" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> taxa_to_plot) {</span>
<span id="cb16-4185"><a href="#cb16-4185" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span></span>
<span id="cb16-4186"><a href="#cb16-4186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb16-4187"><a href="#cb16-4187" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ssu18_ps_work_"</span>, i, <span class="st">"_final_plot"</span>, <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb16-4188"><a href="#cb16-4188" aria-hidden="true" tabindex="-1"></a>    )))</span>
<span id="cb16-4189"><a href="#cb16-4189" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-4190"><a href="#cb16-4190" aria-hidden="true" tabindex="-1"></a>    tmp_get,</span>
<span id="cb16-4191"><a href="#cb16-4191" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/som/"</span>, i, <span class="st">"_tax_div_bar_plots.png"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb16-4192"><a href="#cb16-4192" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">2415</span>,</span>
<span id="cb16-4193"><a href="#cb16-4193" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6350</span>,</span>
<span id="cb16-4194"><a href="#cb16-4194" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-4195"><a href="#cb16-4195" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-4196"><a href="#cb16-4196" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-4197"><a href="#cb16-4197" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-4198"><a href="#cb16-4198" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb16-4199"><a href="#cb16-4199" aria-hidden="true" tabindex="-1"></a>    tmp_get,</span>
<span id="cb16-4200"><a href="#cb16-4200" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/som/"</span>, i, <span class="st">"_tax_div_bar_plots.pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb16-4201"><a href="#cb16-4201" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">2415</span>,</span>
<span id="cb16-4202"><a href="#cb16-4202" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6350</span>,</span>
<span id="cb16-4203"><a href="#cb16-4203" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb16-4204"><a href="#cb16-4204" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-4205"><a href="#cb16-4205" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-4206"><a href="#cb16-4206" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-4207"><a href="#cb16-4207" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-4208"><a href="#cb16-4208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4209"><a href="#cb16-4209" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4210"><a href="#cb16-4210" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Acidobacteriota_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4211"><a href="#cb16-4211" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_7.png"</span></span>
<span id="cb16-4212"><a href="#cb16-4212" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4213"><a href="#cb16-4213" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4214"><a href="#cb16-4214" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Actinobacteriota_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4215"><a href="#cb16-4215" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_8.png"</span></span>
<span id="cb16-4216"><a href="#cb16-4216" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4217"><a href="#cb16-4217" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4218"><a href="#cb16-4218" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Alphaproteobacteria_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4219"><a href="#cb16-4219" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_9.png"</span></span>
<span id="cb16-4220"><a href="#cb16-4220" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4221"><a href="#cb16-4221" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4222"><a href="#cb16-4222" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Gammaproteobacteria_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4223"><a href="#cb16-4223" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_10.png"</span></span>
<span id="cb16-4224"><a href="#cb16-4224" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4225"><a href="#cb16-4225" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4226"><a href="#cb16-4226" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Bacteroidota_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4227"><a href="#cb16-4227" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_11.png"</span></span>
<span id="cb16-4228"><a href="#cb16-4228" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4229"><a href="#cb16-4229" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4230"><a href="#cb16-4230" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Firmicutes_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4231"><a href="#cb16-4231" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_12.png"</span></span>
<span id="cb16-4232"><a href="#cb16-4232" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4233"><a href="#cb16-4233" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4234"><a href="#cb16-4234" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Myxococcota_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4235"><a href="#cb16-4235" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_13.png"</span></span>
<span id="cb16-4236"><a href="#cb16-4236" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4237"><a href="#cb16-4237" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4238"><a href="#cb16-4238" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Verrucomicrobiota_tax_div_bar_plots.png"</span>,</span>
<span id="cb16-4239"><a href="#cb16-4239" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_14.png"</span></span>
<span id="cb16-4240"><a href="#cb16-4240" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4241"><a href="#cb16-4241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4242"><a href="#cb16-4242" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4243"><a href="#cb16-4243" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Acidobacteriota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4244"><a href="#cb16-4244" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_7.pdf"</span></span>
<span id="cb16-4245"><a href="#cb16-4245" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4246"><a href="#cb16-4246" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4247"><a href="#cb16-4247" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Actinobacteriota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4248"><a href="#cb16-4248" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_8.pdf"</span></span>
<span id="cb16-4249"><a href="#cb16-4249" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4250"><a href="#cb16-4250" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4251"><a href="#cb16-4251" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Alphaproteobacteria_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4252"><a href="#cb16-4252" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_9.pdf"</span></span>
<span id="cb16-4253"><a href="#cb16-4253" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4254"><a href="#cb16-4254" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4255"><a href="#cb16-4255" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Gammaproteobacteria_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4256"><a href="#cb16-4256" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_10.pdf"</span></span>
<span id="cb16-4257"><a href="#cb16-4257" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4258"><a href="#cb16-4258" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4259"><a href="#cb16-4259" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Bacteroidota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4260"><a href="#cb16-4260" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_11.pdf"</span></span>
<span id="cb16-4261"><a href="#cb16-4261" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4262"><a href="#cb16-4262" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4263"><a href="#cb16-4263" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Firmicutes_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4264"><a href="#cb16-4264" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_12.pdf"</span></span>
<span id="cb16-4265"><a href="#cb16-4265" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4266"><a href="#cb16-4266" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4267"><a href="#cb16-4267" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Myxococcota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4268"><a href="#cb16-4268" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_13.pdf"</span></span>
<span id="cb16-4269"><a href="#cb16-4269" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4270"><a href="#cb16-4270" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb16-4271"><a href="#cb16-4271" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Verrucomicrobiota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb16-4272"><a href="#cb16-4272" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/som/Supplementary_Figure_14.pdf"</span></span>
<span id="cb16-4273"><a href="#cb16-4273" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-4274"><a href="#cb16-4274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-4275"><a href="#cb16-4275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4276"><a href="#cb16-4276" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb16-4277"><a href="#cb16-4277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4278"><a href="#cb16-4278" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb16-4279"><a href="#cb16-4279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4280"><a href="#cb16-4280" aria-hidden="true" tabindex="-1"></a>Post prossessing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb16-4281"><a href="#cb16-4281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4282"><a href="#cb16-4282" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4283"><a href="#cb16-4283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4284"><a href="#cb16-4284" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4285"><a href="#cb16-4285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4286"><a href="#cb16-4286" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF7)</span></span>
<span id="cb16-4287"><a href="#cb16-4287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4288"><a href="#cb16-4288" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_7.png)</span></span>
<span id="cb16-4289"><a href="#cb16-4289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4290"><a href="#cb16-4290" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF7)</span></span>
<span id="cb16-4291"><a href="#cb16-4291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4292"><a href="#cb16-4292" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Acido.png)</span></span>
<span id="cb16-4293"><a href="#cb16-4293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4294"><a href="#cb16-4294" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4295"><a href="#cb16-4295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4296"><a href="#cb16-4296" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4297"><a href="#cb16-4297" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S7</span><span class="co">](include/pub/som/Supplementary_Figure_7.pdf)</span></span>
<span id="cb16-4298"><a href="#cb16-4298" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4299"><a href="#cb16-4299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4300"><a href="#cb16-4300" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4301"><a href="#cb16-4301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4302"><a href="#cb16-4302" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF8)</span></span>
<span id="cb16-4303"><a href="#cb16-4303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4304"><a href="#cb16-4304" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_8.png)</span></span>
<span id="cb16-4305"><a href="#cb16-4305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4306"><a href="#cb16-4306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF8)</span></span>
<span id="cb16-4307"><a href="#cb16-4307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4308"><a href="#cb16-4308" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Actino.png)</span></span>
<span id="cb16-4309"><a href="#cb16-4309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4310"><a href="#cb16-4310" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4311"><a href="#cb16-4311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4312"><a href="#cb16-4312" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4313"><a href="#cb16-4313" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S8</span><span class="co">](include/pub/som/Supplementary_Figure_8.pdf)</span></span>
<span id="cb16-4314"><a href="#cb16-4314" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4315"><a href="#cb16-4315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4316"><a href="#cb16-4316" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4317"><a href="#cb16-4317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4318"><a href="#cb16-4318" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF9)</span></span>
<span id="cb16-4319"><a href="#cb16-4319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4320"><a href="#cb16-4320" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_9.png)</span></span>
<span id="cb16-4321"><a href="#cb16-4321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4322"><a href="#cb16-4322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF9)</span></span>
<span id="cb16-4323"><a href="#cb16-4323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4324"><a href="#cb16-4324" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Alpha.png)</span></span>
<span id="cb16-4325"><a href="#cb16-4325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4326"><a href="#cb16-4326" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4327"><a href="#cb16-4327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4328"><a href="#cb16-4328" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4329"><a href="#cb16-4329" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S9</span><span class="co">](include/pub/som/Supplementary_Figure_9.pdf)</span></span>
<span id="cb16-4330"><a href="#cb16-4330" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4331"><a href="#cb16-4331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4332"><a href="#cb16-4332" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4333"><a href="#cb16-4333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4334"><a href="#cb16-4334" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF10)</span></span>
<span id="cb16-4335"><a href="#cb16-4335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4336"><a href="#cb16-4336" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_10.png)</span></span>
<span id="cb16-4337"><a href="#cb16-4337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4338"><a href="#cb16-4338" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF10)</span></span>
<span id="cb16-4339"><a href="#cb16-4339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4340"><a href="#cb16-4340" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Gamma.png)</span></span>
<span id="cb16-4341"><a href="#cb16-4341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4342"><a href="#cb16-4342" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4343"><a href="#cb16-4343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4344"><a href="#cb16-4344" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4345"><a href="#cb16-4345" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S10</span><span class="co">](include/pub/som/Supplementary_Figure_10.pdf)</span></span>
<span id="cb16-4346"><a href="#cb16-4346" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4347"><a href="#cb16-4347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4348"><a href="#cb16-4348" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4349"><a href="#cb16-4349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4350"><a href="#cb16-4350" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF11) </span></span>
<span id="cb16-4351"><a href="#cb16-4351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4352"><a href="#cb16-4352" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_11.png)</span></span>
<span id="cb16-4353"><a href="#cb16-4353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4354"><a href="#cb16-4354" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF11)</span></span>
<span id="cb16-4355"><a href="#cb16-4355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4356"><a href="#cb16-4356" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Bacter.png)</span></span>
<span id="cb16-4357"><a href="#cb16-4357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4358"><a href="#cb16-4358" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4359"><a href="#cb16-4359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4360"><a href="#cb16-4360" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4361"><a href="#cb16-4361" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S11</span><span class="co">](include/pub/som/Supplementary_Figure_11.pdf)</span></span>
<span id="cb16-4362"><a href="#cb16-4362" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4363"><a href="#cb16-4363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4364"><a href="#cb16-4364" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4365"><a href="#cb16-4365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4366"><a href="#cb16-4366" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original  (SF12)</span></span>
<span id="cb16-4367"><a href="#cb16-4367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4368"><a href="#cb16-4368" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_12.png)</span></span>
<span id="cb16-4369"><a href="#cb16-4369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4370"><a href="#cb16-4370" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF12)</span></span>
<span id="cb16-4371"><a href="#cb16-4371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4372"><a href="#cb16-4372" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Firm.png)</span></span>
<span id="cb16-4373"><a href="#cb16-4373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4374"><a href="#cb16-4374" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4375"><a href="#cb16-4375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4376"><a href="#cb16-4376" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4377"><a href="#cb16-4377" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S12</span><span class="co">](include/pub/som/Supplementary_Figure_12.pdf)</span></span>
<span id="cb16-4378"><a href="#cb16-4378" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4379"><a href="#cb16-4379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4380"><a href="#cb16-4380" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4381"><a href="#cb16-4381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4382"><a href="#cb16-4382" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF13) </span></span>
<span id="cb16-4383"><a href="#cb16-4383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4384"><a href="#cb16-4384" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_13.png)</span></span>
<span id="cb16-4385"><a href="#cb16-4385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4386"><a href="#cb16-4386" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF13)</span></span>
<span id="cb16-4387"><a href="#cb16-4387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4388"><a href="#cb16-4388" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Myxo.png)</span></span>
<span id="cb16-4389"><a href="#cb16-4389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4390"><a href="#cb16-4390" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4391"><a href="#cb16-4391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4392"><a href="#cb16-4392" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4393"><a href="#cb16-4393" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S13</span><span class="co">](include/pub/som/Supplementary_Figure_13.pdf)</span></span>
<span id="cb16-4394"><a href="#cb16-4394" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4395"><a href="#cb16-4395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4396"><a href="#cb16-4396" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb16-4397"><a href="#cb16-4397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4398"><a href="#cb16-4398" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF14)</span></span>
<span id="cb16-4399"><a href="#cb16-4399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4400"><a href="#cb16-4400" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/som/Supplementary_Figure_14.png)</span></span>
<span id="cb16-4401"><a href="#cb16-4401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4402"><a href="#cb16-4402" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF14)</span></span>
<span id="cb16-4403"><a href="#cb16-4403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4404"><a href="#cb16-4404" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Verruco.png)</span></span>
<span id="cb16-4405"><a href="#cb16-4405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4406"><a href="#cb16-4406" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-4407"><a href="#cb16-4407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4408"><a href="#cb16-4408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4409"><a href="#cb16-4409" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb16-4410"><a href="#cb16-4410" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download the raw pdf file of  Figure S14</span><span class="co">](include/pub/som/Supplementary_Figure_14.pdf)</span></span>
<span id="cb16-4411"><a href="#cb16-4411" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">Â© Copyright 2022 <a href="https://metacrobe.github.io/">metacrobe</a> &amp; The SWELTR Project. Site constructed using <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>