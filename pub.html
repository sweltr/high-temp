<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Workflows to reproduce all Main, Extended Data, and Supplementary figures in the publication.">
<title>SWELTR - Code for Publication Figures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./about.html" rel="prev">
<link href="./assets/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><style>
    .quarto-title-block .quarto-title-banner {
      background: #113858;
    }
    </style>
<link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./assets/icon.png" alt="" class="navbar-logo"></a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item compact">
    <a class="nav-link" href="./index.html"><i class="bi bi-home" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-a.-processing" role="button" data-bs-toggle="dropdown" aria-expanded="false">A. Processing</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-a.-processing">
<li class="dropdown-header">Workflows</li>
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./dada2.html">
 <span class="dropdown-text">1. DADA2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./data-prep.html">
 <span class="dropdown-text">2. Data Set Prep</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./filtering.html">
 <span class="dropdown-text">3. Filtering</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-b.-diversity" role="button" data-bs-toggle="dropdown" aria-expanded="false">B. Diversity</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-b.-diversity">
<li class="dropdown-header">Workflows</li>
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./taxa.html">
 <span class="dropdown-text">4. Taxonomic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./alpha.html">
 <span class="dropdown-text">5. Alpha Diversity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./beta.html">
 <span class="dropdown-text">6. Beta Diversity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./da.html">
 <span class="dropdown-text">7. DA ASVs &amp; Taxa</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./metadata.html">
 <span class="dropdown-text">8. Metadata</span></a>
  </li>  
    </ul>
</li>
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./data-availability.html">DATA</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./pub.html" aria-current="page">PAPER</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./som.html">SOM</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sweltr/high-temp/"><i class="bi bi-github" role="img" aria-label="Agua Salud GitHub">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="./about.html"><i class="bi bi-question" role="img">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">Code for Publication Figures</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          <p>Workflows to reproduce all Main, Extended Data, and Supplementary figures in the publication.</p>
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
<li>
<a href="#main-paper" id="toc-main-paper" class="nav-link active" data-scroll-target="#main-paper">Main Paper</a>
  <ul class="collapse">
<li><a href="#figure-1" id="toc-figure-1" class="nav-link" data-scroll-target="#figure-1">Figure 1</a></li>
  <li><a href="#figure-2" id="toc-figure-2" class="nav-link" data-scroll-target="#figure-2">Figure 2</a></li>
  <li><a href="#figure-3" id="toc-figure-3" class="nav-link" data-scroll-target="#figure-3">Figure 3</a></li>
  </ul>
</li>
  <li>
<a href="#extended-data" id="toc-extended-data" class="nav-link" data-scroll-target="#extended-data">Extended Data</a>
  <ul class="collapse">
<li><a href="#extended-data-figure-2" id="toc-extended-data-figure-2" class="nav-link" data-scroll-target="#extended-data-figure-2">Extended Data Figure 2</a></li>
  <li><a href="#extended-data-figure-3" id="toc-extended-data-figure-3" class="nav-link" data-scroll-target="#extended-data-figure-3">Extended Data Figure 3</a></li>
  <li><a href="#extended-data-figure-4" id="toc-extended-data-figure-4" class="nav-link" data-scroll-target="#extended-data-figure-4">Extended Data Figure 4</a></li>
  <li><a href="#extended-data-figure-5" id="toc-extended-data-figure-5" class="nav-link" data-scroll-target="#extended-data-figure-5">Extended Data Figure 5</a></li>
  <li><a href="#extended-data-figure-6" id="toc-extended-data-figure-6" class="nav-link" data-scroll-target="#extended-data-figure-6">Extended Data Figure 6</a></li>
  <li><a href="#extended-data-figure-7" id="toc-extended-data-figure-7" class="nav-link" data-scroll-target="#extended-data-figure-7">Extended Data Figure 7</a></li>
  </ul>
</li>
  <li>
<a href="#supplementary-material" id="toc-supplementary-material" class="nav-link" data-scroll-target="#supplementary-material">Supplementary Material</a>
  <ul class="collapse">
<li><a href="#supplementary-figure-1" id="toc-supplementary-figure-1" class="nav-link" data-scroll-target="#supplementary-figure-1">Supplementary Figure 1</a></li>
  <li><a href="#supplementary-figure-2" id="toc-supplementary-figure-2" class="nav-link" data-scroll-target="#supplementary-figure-2">Supplementary Figure 2</a></li>
  <li><a href="#supplementary-figure-3" id="toc-supplementary-figure-3" class="nav-link" data-scroll-target="#supplementary-figure-3">Supplementary Figure 3</a></li>
  <li><a href="#supplementary-figure-4" id="toc-supplementary-figure-4" class="nav-link" data-scroll-target="#supplementary-figure-4">Supplementary Figure 4</a></li>
  <li><a href="#supplementary-figure-5" id="toc-supplementary-figure-5" class="nav-link" data-scroll-target="#supplementary-figure-5">Supplementary Figure 5</a></li>
  <li><a href="#supplementary-figure-6" id="toc-supplementary-figure-6" class="nav-link" data-scroll-target="#supplementary-figure-6">Supplementary Figure 6</a></li>
  <li><a href="#supplementary-figures-714" id="toc-supplementary-figures-714" class="nav-link" data-scroll-target="#supplementary-figures-714">Supplementary Figures 7–14</a></li>
  </ul>
</li>
  <li><a href="#r-session-information" id="toc-r-session-information" class="nav-link" data-scroll-target="#r-session-information">R Session Information</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/sweltr/high-temp/edit/main/pub.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/sweltr/high-temp/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content"><div class="cell">
<details><summary>Click here for packages used on this page.</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">phyloseq</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"phyloseq"</span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">magrittr</span>, <span class="va">file2meco</span>, <span class="va">microbiomeMarker</span>,</span>
<span>               <span class="va">microeco</span>, <span class="va">cowplot</span>, <span class="va">hilldiv</span>, <span class="va">ggpubr</span>, <span class="va">vegan</span>, <span class="va">Matrix</span>,</span>
<span>               <span class="va">patchwork</span>, <span class="va">microbiome</span>,</span>
<span>               install <span class="op">=</span> <span class="cn">FALSE</span>, update <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_current</a></span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"cache"</span>,</span>
<span>  <span class="st">"cache.path"</span>,</span>
<span>  <span class="st">"cache.rebuild"</span>,</span>
<span>  <span class="st">"dependson"</span>,</span>
<span>  <span class="st">"autodep"</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<style>

details {
    background-color: #F6F6F6;
    border: 1px solid  #B22271;

}

pre.sourceCode.r {
    font-size: 0.85em;
}

.step #download-button {
  margin-top: 0;
  padding-top: 0;
}

</style>
<hr>
<iframe src="https://widgets.figshare.com/articles/20263857/embed?show_title=1" width="100%" height="351" allowfullscreen="" frameborder="0">
</iframe>
<p>For most figures we include the raw figure generated in R, the post-processed figure, plus the code and data needed to generate the figure.</p>
<section id="main-paper" class="level1"><h1>Main Paper</h1>
<section id="figure-1" class="level2"><h2 class="anchored" data-anchor-id="figure-1">Figure 1</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include rotating combining 16S rRNA and ITS plots, dendrogram branches, changing color palettes, sample and variable renaming, and adding legend.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Final</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><img src="paper/MAIN/FIGURES/Figure_1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/MAIN/Figure_1.rdata">Download Figure 1 data pack</a></p>
</div>
</div>
</div>
<div class="cell">
<details><summary>This code is run in R</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/Figure_1.rdata"</span><span class="op">)</span></span>
<span><span class="va">samp_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_pime"</span><span class="op">)</span></span>
<span><span class="va">samp_ps_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_pime"</span>, <span class="st">"ssu18_ps_work"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 1) Get all Class-level Proteobacteria names</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps_all</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">subset_taxa</span><span class="op">(</span><span class="va">tmp_get</span>, <span class="va">Phylum</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get_taxa</span> <span class="op">&lt;-</span> <span class="fu">get_taxa_unique</span><span class="op">(</span><span class="va">tmp_df</span>,</span>
<span>                                     taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                                     errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_get_taxa</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="co">#rm(list = ls(pattern = "_proteo"))</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">samp_ps_all</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>        <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Alphaproteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Alphaproteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Gammaproteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gammaproteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Zetaproteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Zetaproteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p_Proteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p_Proteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span></span>
<span>  <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">j</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">j</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span></span>
<span>    <span class="fu">get_taxa_unique</span><span class="op">(</span></span>
<span>      <span class="va">tmp_get</span>,</span>
<span>      taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>      errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">order</span>, <span class="va">phylum</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualizing DA ASVs in Anvi’o</span></span>
<span></span>
<span><span class="co">## Here, we combine the results of the ISA and LEfSe analyses with the </span></span>
<span><span class="co">## distribution of ASVs across each sample. We are going to do the analysis </span></span>
<span><span class="co">## in [anvi’o](https://github.com/merenlab/anvio)---an advanced analysis </span></span>
<span><span class="co">## and visualization platform for ‘omics data [@eren2015anvi]---using the </span></span>
<span><span class="co">## `anvi-interactive` command. Anvi’o likes databases but it also </span></span>
<span><span class="co">## understands that sometimes you do not have a database. So it offers a </span></span>
<span><span class="co">## manual mode. If you type this command you can have a look at the </span></span>
<span><span class="co">## relevant pieces we need for the visualization, specifically those under </span></span>
<span><span class="co">## the headings MANUAL INPUTS and ADDITIONAL STUFF.</span></span>
<span></span>
<span><span class="co">## There are also a few files we generate that cannot be loaded directly. </span></span>
<span><span class="co">## So, in addition to the files that can be loaded when running the interactive, </span></span>
<span><span class="co">## we also have files that must be added to the database created by anvi’o.</span></span>
<span></span>
<span></span>
<span><span class="co">## 1. View data: in our case, a sample by ASV abundance matrix.</span></span>
<span><span class="co">## 2. Additional info about each ASV.</span></span>
<span><span class="co">## 3. Additional info about each sample.</span></span>
<span><span class="co">## 4. Taxa abundance data for each sample at some rank.</span></span>
<span><span class="co">## 5. Dendrograms ordering the ASVs and samples (based on view data).</span></span>
<span><span class="co">## 6. Fasta file of all ASVs in the analysis.</span></span>
<span></span>
<span><span class="co">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span><span class="co">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span><span class="co">## ## ## Main Steps  ## ## ## ## ## </span></span>
<span><span class="co">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span><span class="co">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 1. View data  #####################</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Let’s start with the `-d` or `--view-data` file. This file needs to be </span></span>
<span><span class="co">## an ASV by sample matrix of read counts. To simplify the visualization, </span></span>
<span><span class="co">## we will use ***all*** ASVs represented by 100 or more total reads, </span></span>
<span><span class="co">## including those identified as differentially abundant by the ISA and/or LEfSe. </span></span>
<span></span>
<span><span class="va">trim_val</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">prune_taxa</span><span class="op">(</span><span class="fu">taxa_sums</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">trim_val</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps_all</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"data.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Or export a table of transformed data.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_trans</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">transform_sample_counts</span><span class="op">(</span><span class="va">tmp_get</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="fl">1e5</span> <span class="op">*</span> <span class="op">{</span></span>
<span>        <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_trans</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp_df</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"data_trans.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    quote <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 2. Additional Layers for ASVs  ####</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Next, we need some additional data **about the ASVs** to overlay on the </span></span>
<span><span class="co">## visual. This can be anything however what I specifically want are the details </span></span>
<span><span class="co">## of the ISA analysis, total reads, and lineage info. </span></span>
<span><span class="co">## I warn you; this code will get ugly and I urge you to find a better way.</span></span>
<span></span>
<span><span class="co">## Start with an ASV + lineage table for the ASVs in the new phyloseq object.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get_indval</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_indval_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_indval</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_get_indval</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"Group"</span> <span class="op">=</span> <span class="st">"ASV_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"enrich_indval"</span> <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"test_indval"</span> <span class="op">=</span> <span class="st">"indval"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"pval_indval"</span> <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_indval</span> <span class="op">&lt;-</span> <span class="va">tmp_get_indval</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">tmp_get_lefse</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_lefse_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_lefse</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_get_lefse</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"Group"</span> <span class="op">=</span> <span class="st">"ASV_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"enrich_lefse"</span> <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"test_lefse"</span> <span class="op">=</span> <span class="st">"lda"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"pval_lefse"</span> <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_lefse</span> <span class="op">&lt;-</span> <span class="va">tmp_get_lefse</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_otu_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_total</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tmp_otu_df</span>, total_reads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tmp_otu_df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">tmp_total</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">tmp_total</span> <span class="op">&lt;-</span> <span class="va">tmp_total</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_df</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">tmp_tax_df</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="va">tmp_tax_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_tax_df</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_add_lay</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_tax_df</span>, <span class="va">tmp_total</span>, by <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_get_indval</span>, by <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_get_lefse</span>, by <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_add_lay</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="va">tmp_add_lay</span><span class="op">$</span><span class="va">Group</span></span>
<span>  <span class="va">tmp_add_lay</span> <span class="op">&lt;-</span> <span class="va">tmp_add_lay</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">11</span>, <span class="fl">13</span><span class="op">:</span><span class="fl">15</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp_add_lay</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"additional_layers.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    quote <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    na <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 3. Additional Views for Samples  ##</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Now we want some general data **about the samples** to overlay on the </span></span>
<span><span class="co">## visual. Again, this can be anything. How about a table of alpha diversity </span></span>
<span><span class="co">## metrics? We actually have such a table that was generated way back up the </span></span>
<span><span class="co">## road. Just need to fix the column names.</span></span>
<span></span>
<span><span class="va">metadata_tab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"no_asvs"</span> <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">readcount</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_rc</span> <span class="op">&lt;-</span> <span class="va">tmp_rc</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_rc</span> <span class="op">&lt;-</span> <span class="va">tmp_rc</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"no_reads"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>     <span class="va">tmp_merge</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_df</span>, <span class="va">tmp_rc</span><span class="op">)</span></span>
<span>     <span class="va">tmp_merge</span> <span class="op">&lt;-</span> <span class="va">tmp_merge</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">10</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span></span>
<span>     <span class="va">tmp_final</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_merge</span>, <span class="va">metadata_tab</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"Sample_ID"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_final</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"additional_views.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 4. Taxon rank abundance by sample #</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Turned out this was a little tricky to figure out, but thanks to a </span></span>
<span><span class="co">## [little nifty block of code](https://github.com/joey711/phyloseq/issues/418#issuecomment-262637034) </span></span>
<span><span class="co">## written by [guoyanzhao](https://github.com/guoyanzhao) on the phyloseq </span></span>
<span><span class="co">## Issues forum, it was a piece of cake. The code can be altered to take any </span></span>
<span><span class="co">## rank. See the post for an explanation.</span></span>
<span></span>
<span><span class="co">## Anyway, the goal is to sum each taxon at some rank and present that as a </span></span>
<span><span class="co">## bar chart for each sample in the visualization. Anvi'o has a specific format </span></span>
<span><span class="co">## it needs where each row is a sample and each column is a taxon. Taxa names </span></span>
<span><span class="co">## need the prefix `t_&lt;RANK&gt;!`. For example, `t_class!` should be added for </span></span>
<span><span class="co">## Class rank.</span></span>
<span></span>
<span><span class="va">pick_rank</span> <span class="op">&lt;-</span> <span class="st">"Phylum"</span></span>
<span><span class="va">pick_rank_l</span> <span class="op">&lt;-</span> <span class="st">"phylum"</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps_all</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># Make the table</span></span>
<span>    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="va">tmp_glom</span> <span class="op">&lt;-</span> <span class="fu">tax_glom</span><span class="op">(</span><span class="va">tmp_get</span>, taxrank <span class="op">=</span> <span class="va">pick_rank</span><span class="op">)</span></span>
<span>    <span class="va">tmp_melt</span> <span class="op">&lt;-</span> <span class="fu">psmelt</span><span class="op">(</span><span class="va">tmp_glom</span><span class="op">)</span></span>
<span>    <span class="va">tmp_melt</span><span class="op">[[</span><span class="va">pick_rank</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_melt</span><span class="op">[[</span><span class="va">pick_rank</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">Abundance</span> <span class="op">~</span> <span class="va">Sample</span> <span class="op">+</span> <span class="va">tmp_melt</span><span class="op">[[</span><span class="va">pick_rank</span><span class="op">]</span><span class="op">]</span>, <span class="va">tmp_melt</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_abund</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"tax_rank"</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">reshape</span><span class="fu">::</span><span class="fu">cast</span><span class="op">(</span><span class="va">tmp_abund</span>, <span class="va">Sample</span> <span class="op">~</span> <span class="va">tax_rank</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">remove_rownames</a></span><span class="op">(</span><span class="va">tmp_abund</span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="va">tmp_abund</span>, <span class="st">"Sample"</span><span class="op">)</span></span>
<span><span class="co"># Reorder table column by sum</span></span>
<span>    <span class="va">tmp_layers</span> <span class="op">&lt;-</span> <span class="va">tmp_abund</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">tmp_abund</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Add the prefix</span></span>
<span>    <span class="va">tmp_layers</span> <span class="op">&lt;-</span> <span class="va">tmp_layers</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_all</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"t_"</span>, <span class="va">pick_rank_l</span>,<span class="st">"!"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp_layers</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span> <span class="op">(</span><span class="va">tmp_layers</span>, <span class="st">"taxon"</span><span class="op">)</span></span>
<span><span class="co"># save the dataframe</span></span>
<span>    <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_taxa"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_layers</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## REORDER TAXA</span></span>
<span><span class="va">ssu18_ps_work_taxa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">ssu18_ps_work_taxa</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"t_phylum!Alphaproteobacteria"</span>, </span>
<span>  <span class="st">"t_phylum!Gammaproteobacteria"</span>, </span>
<span>  <span class="st">"t_phylum!Acidobacteriota"</span>, </span>
<span>  <span class="st">"t_phylum!Actinobacteriota"</span>, </span>
<span>  <span class="st">"t_phylum!Bacteroidota"</span>, </span>
<span>  <span class="st">"t_phylum!Firmicutes"</span>,</span>
<span>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span>  <span class="st">"t_phylum!Verrucomicrobiota"</span>,</span>
<span>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span>  <span class="st">"t_phylum!Chloroflexi"</span>,</span>
<span>  <span class="st">"t_phylum!Planctomycetota"</span>,</span>
<span>  <span class="st">"t_phylum!Methylomirabilota"</span>,</span>
<span>  <span class="st">"t_phylum!Crenarchaeota"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  .after <span class="op">=</span> <span class="st">"taxon"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">ssu18_ps_work_taxa</span>, <span class="st">"include/pub/MAIN/anvio/ssu/ssu18_ps_work/tax_layers_mod.txt"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span></span>
<span><span class="va">ssu18_ps_pime_taxa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">ssu18_ps_pime_taxa</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"t_phylum!Alphaproteobacteria"</span>, </span>
<span>  <span class="st">"t_phylum!Gammaproteobacteria"</span>, </span>
<span>  <span class="st">"t_phylum!Acidobacteriota"</span>, </span>
<span>  <span class="st">"t_phylum!Actinobacteriota"</span>, </span>
<span>  <span class="st">"t_phylum!Bacteroidota"</span>, </span>
<span>  <span class="st">"t_phylum!Firmicutes"</span>,</span>
<span>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span>  <span class="st">"t_phylum!Verrucomicrobiota"</span>,</span>
<span>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span>  <span class="st">"t_phylum!Chloroflexi"</span>,</span>
<span>  <span class="st">"t_phylum!Planctomycetota"</span>,</span>
<span>  <span class="st">"t_phylum!Methylomirabilota"</span>,</span>
<span>  <span class="st">"t_phylum!Crenarchaeota"</span></span>
<span>   <span class="op">)</span>, .after <span class="op">=</span> <span class="st">"taxon"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">ssu18_ps_pime_taxa</span>, <span class="st">"include/pub/MAIN/anvio/ssu/ssu18_ps_pime/tax_layers_mod.txt"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">### 5. Construct Dendrograms #</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="co">## The last piece we need is to generate dendrograms that order the ASVs </span></span>
<span><span class="co">## by their distribution in the samples and the samples by their ASV composition. </span></span>
<span><span class="co">## For this task we will use anvi'o.</span></span>
<span></span>
<span><span class="co">## The first command reads the view data we generated above and uses </span></span>
<span><span class="co">## Euclidean distance and Ward linkage for hierarchical clustering of the ASVs. </span></span>
<span><span class="co">## The second command transposes the view data table and then does the same for </span></span>
<span><span class="co">## the samples. There are several distance metrics and linkage methods available. </span></span>
<span><span class="co">## See the help menu for the command by typing `anvi-matrix-to-newick -h`.  Boom.</span></span>
<span></span>
<span><span class="co">#bash_commands &lt;- c() USE this to combine all commands</span></span>
<span><span class="co"># including in loop creates separate files</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_asv</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span>                                                <span class="st">"asv.tre"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_asv</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_samp</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span>                                                <span class="st">"sample.tre --transpose"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_samp</span><span class="op">)</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/write.html">write</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"tre.sh"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># FOR TANSFORMED DATA</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_asv</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span>                                                <span class="st">"asv_trans.tre"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_asv</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_samp</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span>                                                <span class="st">"sample_trans.tre --transpose"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_samp</span><span class="op">)</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/write.html">write</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"tre_transformed.sh"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>This code is run in anvi’o via a bash script</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following commands NEED to run in anvio from base dir</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> include/pub/MAIN/anvio/ssu</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ssu18_ps_pime</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre.sh</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre_transformed.sh</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>This code is run in R</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Alternatively, we can generate dendrograms using `phyloseq::distance` and `hclust`. </span></span>
<span><span class="va">pick_dist</span> <span class="op">&lt;-</span> <span class="st">"bray"</span></span>
<span><span class="va">pick_clust</span> <span class="op">&lt;-</span> <span class="st">"complete"</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># Make the table</span></span>
<span>    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu">distance</span><span class="op">(</span>physeq <span class="op">=</span> <span class="va">tmp_get</span>, method <span class="op">=</span> <span class="va">pick_dist</span>, type <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">tmp_dist</span>, method <span class="op">=</span> <span class="va">pick_clust</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tmp_dend</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">as.phylo</span><span class="op">(</span><span class="va">tmp_dend</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>    <span class="fu">write.tree</span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tmp_tree</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_"</span>, <span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pick_dist_asv</span> <span class="op">&lt;-</span> <span class="st">"euclidean"</span></span>
<span><span class="va">pick_clust_asv</span> <span class="op">&lt;-</span> <span class="st">"ward"</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># Make the table</span></span>
<span>    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu">distance</span><span class="op">(</span>physeq <span class="op">=</span> <span class="va">tmp_get</span>, method <span class="op">=</span> <span class="va">pick_dist_asv</span>, type <span class="op">=</span> <span class="st">"taxa"</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">tmp_dist</span>, method <span class="op">=</span> <span class="va">pick_clust_asv</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tmp_dend</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">as.phylo</span><span class="op">(</span><span class="va">tmp_dend</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>    <span class="fu">write.tree</span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tmp_tree</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"asv_"</span>, <span class="va">pick_dist_asv</span>, <span class="st">"_"</span>, <span class="va">pick_clust_asv</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">read_file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[\r\n]"</span>, <span class="st">""</span>, <span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bray_complete"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newick"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_item</span>, <span class="va">tmp_type</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">%&gt;%</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu">remove_empty</span><span class="op">(</span><span class="st">"rows"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_tab</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\t"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">read_file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>,<span class="st">"sample_trans.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[\r\n]"</span>, <span class="st">""</span>, <span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bray_complete"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newick"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_item</span>, <span class="va">tmp_type</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">%&gt;%</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu">remove_empty</span><span class="op">(</span><span class="st">"rows"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_tab</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_trans.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\t"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># FOR HCLUST TREE</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">read_file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_"</span>, <span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[\r\n]"</span>, <span class="st">""</span>, <span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">"_hclust"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newick"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_item</span>, <span class="va">tmp_type</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">%&gt;%</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu">remove_empty</span><span class="op">(</span><span class="st">"rows"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_tab</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_"</span>, <span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\t"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">### 6. Make a fasta file #####</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="co">## We don't need to add a fasta file, but it is a nice way to keep </span></span>
<span><span class="co">## everything in one place. Plus, you can do BLAST searches directly </span></span>
<span><span class="co">## in the interface by right clicking on the ASV of interest, so it is nice </span></span>
<span><span class="co">## to have the sequences.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>       <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>       <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="va">tmp_tab</span><span class="op">[</span>, <span class="fl">7</span><span class="op">]</span></span>
<span>       <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span>, <span class="va">tmp_tab</span><span class="op">)</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ASV_ID"</span>, <span class="st">"ASV_SEQ"</span><span class="op">)</span></span>
<span>       <span class="va">tmp_df</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^"</span>, <span class="st">"&gt;"</span>, <span class="va">tmp_df</span><span class="op">$</span><span class="va">ASV_ID</span><span class="op">)</span></span>
<span>       <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/ssu/"</span><span class="op">)</span></span>
<span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="va">i</span>, <span class="st">".fasta"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\n"</span>, col.names <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, fileEncoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>This code is run in anvi’o</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Building the Profile Database</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Time to put all of these pieces together. This gets a little tricky since </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">## we do not have a database to start with because some of these files can be </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">## loaded directly in the interface but some need to be added to a database. </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">## When we fire up the interactive in `--manual` mode, we ***must*** give </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">## anvi'o the name of a database and it will *create* that database for us. </span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Then we can shut down the interactive, add the necessary data files, </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">## and start back up.</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ssu18_ps_pime</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">## Now we have a new profile database that we can add the sample metadata </span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">## (`additional_layers.txt`) and the sample dendrogram (sample.tre) using the </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">## command `anvi-import-misc-data`. These commands add the table to the new </span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">## `profile.db`. First, kill the interactive.</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> additional_views.txt <span class="dt">\</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> sample.tre <span class="dt">\</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layer_orders</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">## One last this is to get the table with the taxonomy total by sample </span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">## (`tax_layers.txt`) into the profile database. We will run the same command </span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">## we just used.</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> ../ssu18_ps_work/tax_layers_mod.txt <span class="dt">\</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">## In fact, we could just as easily append the taxonomy total data onto the </span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co">## `additional_layers.txt` and import in one command. But we didn't.</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co">## Interactive Interface</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co">## With a populated database in hand, we can now begin modifying the </span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co">## visual by running the interactive command again.</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>                 <span class="ex">--fasta-file</span> ssu18_ps_pime.fasta <span class="dt">\</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>This code is run in R</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## The ITS version of the anvi'o workflow is basically a carbon copy of the </span></span>
<span><span class="co">## workflow presented above. It is included here for posterity.</span></span>
<span></span>
<span><span class="co">## 1. View data: in our case, a sample by ASV abundance matrix.</span></span>
<span><span class="co">## 2. Additional info about each ASV.</span></span>
<span><span class="co">## 3. Additional info about each sample.</span></span>
<span><span class="co">## 4. Taxa abundance data for each sample at some rank.</span></span>
<span><span class="co">## 5. Dendrograms ordering the ASVs and samples (based on view data).</span></span>
<span><span class="co">## 6. Fasta file of all ASVs in the analysis.</span></span>
<span></span>
<span><span class="co">### Main steps</span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 1. View data  #####################</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Let’s start with the `-d` or `--view-data` file. This file needs to be </span></span>
<span><span class="co">## an ASV by sample matrix of read counts. To simplify the visualization, </span></span>
<span><span class="co">## we will use ***all*** ASVs represented by 100 or more total reads, </span></span>
<span><span class="co">## including those identified as differentially abundant by the ISA and/or LEfSe. </span></span>
<span></span>
<span><span class="va">samp_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_pime"</span><span class="op">)</span></span>
<span><span class="va">samp_ps_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_pime"</span>, <span class="st">"its18_ps_work"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trim_val</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">prune_taxa</span><span class="op">(</span><span class="fu">taxa_sums</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">trim_val</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps_all</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"data.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Or export a table of transformed data.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_trans</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">transform_sample_counts</span><span class="op">(</span><span class="va">tmp_get</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="fl">1e5</span> <span class="op">*</span> <span class="op">{</span></span>
<span>        <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_trans</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp_df</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"data_trans.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    quote <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 2. Additional Layers for ASVs  ####</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Next, we need some additional data **about the ASVs** to overlay on the </span></span>
<span><span class="co">## visual. This can be anything however what I specifically want are the </span></span>
<span><span class="co">## details of the ISA analysis, total reads, and lineage info. I warn you; </span></span>
<span><span class="co">## this code will get ugly and I urge you to find a better way.</span></span>
<span></span>
<span><span class="co">## Start with an ASV + lineage table for the ASVs in the new phyloseq object.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get_indval</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_indval_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_indval</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_get_indval</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"Group"</span> <span class="op">=</span> <span class="st">"ASV_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"enrich_indval"</span> <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"test_indval"</span> <span class="op">=</span> <span class="st">"indval"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"pval_indval"</span> <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_indval</span> <span class="op">&lt;-</span> <span class="va">tmp_get_indval</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">tmp_get_lefse</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_lefse_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_lefse</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_get_lefse</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"Group"</span> <span class="op">=</span> <span class="st">"ASV_ID"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"enrich_lefse"</span> <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"test_lefse"</span> <span class="op">=</span> <span class="st">"lda"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"pval_lefse"</span> <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_lefse</span> <span class="op">&lt;-</span> <span class="va">tmp_get_lefse</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_otu_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_total</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tmp_otu_df</span>, total_reads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tmp_otu_df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">tmp_total</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">tmp_total</span> <span class="op">&lt;-</span> <span class="va">tmp_total</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_df</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">tmp_tax_df</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="va">tmp_tax_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_tax_df</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_add_lay</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_tax_df</span>, <span class="va">tmp_total</span>, by <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_get_indval</span>, by <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_get_lefse</span>, by <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_add_lay</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="va">tmp_add_lay</span><span class="op">$</span><span class="va">Group</span></span>
<span>  <span class="va">tmp_add_lay</span> <span class="op">&lt;-</span> <span class="va">tmp_add_lay</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">11</span>, <span class="fl">13</span><span class="op">:</span><span class="fl">15</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp_add_lay</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"additional_layers.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    quote <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    na <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 3. Additional Views for Samples  ##</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Now we want some general data **about the samples** to overlay on the visual. </span></span>
<span><span class="co">## Again, this can be anything. How about a table of alpha diversity metrics? </span></span>
<span><span class="co">## We actually have such a table that was generated way back up the road. </span></span>
<span><span class="co">## Just need to fix the column names.</span></span>
<span></span>
<span><span class="va">metadata_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"files/metadata/tables/metadata.txt"</span>,</span>
<span>                           header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"files/alpha/rdata/its18_ps_pime.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">metadata_tab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"no_asvs"</span> <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">readcount</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_rc</span> <span class="op">&lt;-</span> <span class="va">tmp_rc</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></span>
<span>     <span class="va">tmp_rc</span> <span class="op">&lt;-</span> <span class="va">tmp_rc</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"no_reads"</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>     <span class="co">#identical(tmp_df$id, tmp_rc$id)</span></span>
<span>     <span class="va">tmp_merge</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_df</span>, <span class="va">tmp_rc</span><span class="op">)</span></span>
<span>     <span class="va">tmp_merge</span> <span class="op">&lt;-</span> <span class="va">tmp_merge</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">10</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span></span>
<span>     <span class="va">tmp_final</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_merge</span>, <span class="va">metadata_tab</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"Sample_ID"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_final</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"additional_views.txt"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">metadata_tab</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#######################################</span></span>
<span><span class="co">### 4. Taxon rank abundance by sample #</span></span>
<span><span class="co">#######################################</span></span>
<span></span>
<span><span class="co">## Turned out this was a little tricky to figure out, but thanks to a </span></span>
<span><span class="co">## [little nifty block of code](https://github.com/joey711/phyloseq/iitses/418#iitsecomment-262637034) </span></span>
<span><span class="co">## written by [guoyanzhao](https://github.com/guoyanzhao) on the phyloseq </span></span>
<span><span class="co">## Issues forum, it was a piece of cake. The code can be altered to take any </span></span>
<span><span class="co">## rank. See the post for an explanation.</span></span>
<span></span>
<span><span class="co">## Anyway, the goal is to sum each taxon at some rank and present that as a </span></span>
<span><span class="co">## bar chart for each sample in the visualization. Anvi'o has a specific </span></span>
<span><span class="co">## format it needs where each row is a sample and each column is a taxon. </span></span>
<span><span class="co">## Taxa names need the prefix `t_&lt;RANK&gt;!`. For example, `t_class!` should be </span></span>
<span><span class="co">## added for Class rank.</span></span>
<span></span>
<span></span>
<span><span class="co">#| code-fold: true</span></span>
<span><span class="va">pick_rank</span> <span class="op">&lt;-</span> <span class="st">"Order"</span></span>
<span><span class="va">pick_rank_l</span> <span class="op">&lt;-</span> <span class="st">"order"</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps_all</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># Make the table</span></span>
<span>    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="va">tmp_glom</span> <span class="op">&lt;-</span> <span class="fu">tax_glom</span><span class="op">(</span><span class="va">tmp_get</span>, taxrank <span class="op">=</span> <span class="va">pick_rank</span><span class="op">)</span></span>
<span>    <span class="va">tmp_melt</span> <span class="op">&lt;-</span> <span class="fu">psmelt</span><span class="op">(</span><span class="va">tmp_glom</span><span class="op">)</span></span>
<span>    <span class="va">tmp_melt</span><span class="op">[[</span><span class="va">pick_rank</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_melt</span><span class="op">[[</span><span class="va">pick_rank</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">Abundance</span> <span class="op">~</span> <span class="va">Sample</span> <span class="op">+</span> <span class="va">tmp_melt</span><span class="op">[[</span><span class="va">pick_rank</span><span class="op">]</span><span class="op">]</span>, <span class="va">tmp_melt</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_abund</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"tax_rank"</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">reshape</span><span class="fu">::</span><span class="fu">cast</span><span class="op">(</span><span class="va">tmp_abund</span>, <span class="va">Sample</span> <span class="op">~</span> <span class="va">tax_rank</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">remove_rownames</a></span><span class="op">(</span><span class="va">tmp_abund</span><span class="op">)</span></span>
<span>    <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="va">tmp_abund</span>, <span class="st">"Sample"</span><span class="op">)</span></span>
<span><span class="co"># Reorder table column by sum</span></span>
<span>    <span class="va">tmp_layers</span> <span class="op">&lt;-</span> <span class="va">tmp_abund</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">tmp_abund</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Add the prefix</span></span>
<span>    <span class="va">tmp_layers</span> <span class="op">&lt;-</span> <span class="va">tmp_layers</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_all</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"t_"</span>, <span class="va">pick_rank_l</span>,<span class="st">"!"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp_layers</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span> <span class="op">(</span><span class="va">tmp_layers</span>, <span class="st">"taxon"</span><span class="op">)</span></span>
<span><span class="co">#  save the dataframe</span></span>
<span>    <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_taxa"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_layers</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">its18_ps_work_taxa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">its18_ps_pime_taxa</span><span class="op">)</span></span>
<span><span class="co">## REORDER TAXA</span></span>
<span><span class="va">its18_ps_work_taxa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">its18_ps_work_taxa</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"t_order!Geastrales"</span>, </span>
<span>  <span class="st">"t_order!Glomerales"</span>, </span>
<span>  <span class="st">"t_order!Helotiales"</span>, </span>
<span>  <span class="st">"t_order!Hypocreales"</span>, </span>
<span>  <span class="st">"t_order!Saccharomycetales"</span>, </span>
<span>  <span class="st">"t_order!Trichosporonales"</span>, </span>
<span>  <span class="st">"t_order!Xylariales"</span>, </span>
<span>  <span class="st">"t_order!Eurotiales"</span>, </span>
<span>  <span class="st">"t_order!Capnodiales"</span>, </span>
<span>  <span class="st">"t_order!Archaeorhizomycetales"</span>, </span>
<span>  <span class="st">"t_order!Agaricales"</span>, </span>
<span>  <span class="st">"t_order!c_Agaricomycetes"</span>, </span>
<span>  <span class="st">"t_order!p_Ascomycota"</span>, </span>
<span>  <span class="st">"t_order!k_Fungi"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  .after <span class="op">=</span> <span class="st">"taxon"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">its18_ps_work_taxa</span>, <span class="st">"include/pub/MAIN/anvio/its/its18_ps_work/tax_layers_mod.txt"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span></span>
<span><span class="va">its18_ps_pime_taxa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">its18_ps_pime_taxa</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"t_order!Geastrales"</span>, </span>
<span>  <span class="st">"t_order!Glomerales"</span>, </span>
<span>  <span class="st">"t_order!Helotiales"</span>, </span>
<span>  <span class="st">"t_order!Hypocreales"</span>, </span>
<span>  <span class="st">"t_order!Saccharomycetales"</span>, </span>
<span>  <span class="st">"t_order!Trichosporonales"</span>, </span>
<span>  <span class="st">"t_order!Xylariales"</span>, </span>
<span>  <span class="st">"t_order!Eurotiales"</span>, </span>
<span>  <span class="st">"t_order!Capnodiales"</span>, </span>
<span>  <span class="st">"t_order!Archaeorhizomycetales"</span>, </span>
<span>  <span class="st">"t_order!Agaricales"</span>, </span>
<span>  <span class="st">"t_order!c_Agaricomycetes"</span>, </span>
<span>  <span class="st">"t_order!p_Ascomycota"</span>, </span>
<span>  <span class="st">"t_order!k_Fungi"</span></span>
<span>   <span class="op">)</span>, .after <span class="op">=</span> <span class="st">"taxon"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">its18_ps_pime_taxa</span>, </span>
<span>            <span class="st">"include/pub/MAIN/anvio/its/its18_ps_pime/tax_layers_mod.txt"</span>, </span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">### 5. Construct Dendrograms #</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="co">## The last piece we need is to generate dendrograms that order the ASVs </span></span>
<span><span class="co">## by their distribution in the samples and the samples by their </span></span>
<span><span class="co">## ASV composition. For this task we will use anvi'o.</span></span>
<span></span>
<span><span class="co">#bash_commands &lt;- c() USE this to combine all commands</span></span>
<span><span class="co"># including in loop creates separate files</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_asv</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span>                                                <span class="st">"asv.tre"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_asv</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_samp</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span>                                                <span class="st">"sample.tre --transpose"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_samp</span><span class="op">)</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/write.html">write</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"tre.sh"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_asv</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span>                                                <span class="st">"asv_trans.tre"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_asv</span><span class="op">)</span></span>
<span>      <span class="va">tmp_command_samp</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span>                                                <span class="st">"sample_trans.tre --transpose"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">bash_commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="va">tmp_command_samp</span><span class="op">)</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/write.html">write</a></span><span class="op">(</span><span class="va">bash_commands</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"tre_transformed.sh"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>This code is run in anvi’o via a bash script</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#NEED to run in anvio from base dir</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> its18_ps_pime</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre.sh</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre_transformed.sh</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>This code is run in R</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Alternatively, we can generate dendrograms using `phyloseq::distance` and `hclust`. </span></span>
<span></span>
<span><span class="va">pick_dist</span> <span class="op">&lt;-</span> <span class="st">"bray"</span></span>
<span><span class="va">pick_clust</span> <span class="op">&lt;-</span> <span class="st">"complete"</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># Make the table</span></span>
<span>    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu">distance</span><span class="op">(</span>physeq <span class="op">=</span> <span class="va">tmp_get</span>, method <span class="op">=</span> <span class="va">pick_dist</span>, type <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">tmp_dist</span>, method <span class="op">=</span> <span class="va">pick_clust</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tmp_dend</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">as.phylo</span><span class="op">(</span><span class="va">tmp_dend</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>    <span class="fu">write.tree</span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tmp_tree</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_"</span>, <span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pick_dist_asv</span> <span class="op">&lt;-</span> <span class="st">"euclidean"</span></span>
<span><span class="va">pick_clust_asv</span> <span class="op">&lt;-</span> <span class="st">"ward"</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># Make the table</span></span>
<span>    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu">distance</span><span class="op">(</span>physeq <span class="op">=</span> <span class="va">tmp_get</span>, method <span class="op">=</span> <span class="va">pick_dist_asv</span>, type <span class="op">=</span> <span class="st">"taxa"</span><span class="op">)</span></span>
<span>    <span class="va">tmp_dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">tmp_dist</span>, method <span class="op">=</span> <span class="va">pick_clust_asv</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tmp_dend</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">as.phylo</span><span class="op">(</span><span class="va">tmp_dend</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>    <span class="fu">write.tree</span><span class="op">(</span>phy <span class="op">=</span> <span class="va">tmp_tree</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"asv_"</span>, <span class="va">pick_dist_asv</span>, <span class="st">"_"</span>, <span class="va">pick_clust_asv</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">read_file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[\r\n]"</span>, <span class="st">""</span>, <span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bray_complete"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newick"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_item</span>, <span class="va">tmp_type</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">%&gt;%</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu">remove_empty</span><span class="op">(</span><span class="st">"rows"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_tab</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\t"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># FOR TRANSFORMED DATA</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">read_file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>,<span class="st">"sample_trans.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[\r\n]"</span>, <span class="st">""</span>, <span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bray_complete"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newick"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_item</span>, <span class="va">tmp_type</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">%&gt;%</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu">remove_empty</span><span class="op">(</span><span class="st">"rows"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_tab</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_trans.tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\t"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu">read_file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_"</span>, <span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[\r\n]"</span>, <span class="st">""</span>, <span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_item</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">"_hclust"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newick"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_tree</span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_item</span>, <span class="va">tmp_type</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span>      <span class="va">tmp_tab</span> <span class="op">%&gt;%</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu">remove_empty</span><span class="op">(</span><span class="st">"rows"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_tab</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="st">"sample_"</span>, <span class="va">pick_dist</span>, <span class="st">"_"</span>, <span class="va">pick_clust</span>, <span class="st">".tre"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\t"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">### 6. Make a fasta file #####</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="co">## We don't need to add a fasta file, but it is a nice way to keep </span></span>
<span><span class="co">## everything in one place. Plus, you can do BLAST searches directly </span></span>
<span><span class="co">## in the interface by right clicking on the ASV of interest, so it is nice </span></span>
<span><span class="co">## to have the sequences.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">samp_ps</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_trim"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>       <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>       <span class="va">tmp_tab</span> <span class="op">&lt;-</span> <span class="va">tmp_tab</span><span class="op">[</span>, <span class="fl">7</span><span class="op">]</span></span>
<span>       <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tab</span><span class="op">)</span>, <span class="va">tmp_tab</span><span class="op">)</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ASV_ID"</span>, <span class="st">"ASV_SEQ"</span><span class="op">)</span></span>
<span>       <span class="va">tmp_df</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"^"</span>, <span class="st">"&gt;"</span>, <span class="va">tmp_df</span><span class="op">$</span><span class="va">ASV_ID</span><span class="op">)</span></span>
<span>       <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/anvio/its/"</span><span class="op">)</span></span>
<span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_path</span>, <span class="va">i</span>, <span class="st">"/"</span>, <span class="va">i</span>, <span class="st">".fasta"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>            sep <span class="op">=</span> <span class="st">"\n"</span>, col.names <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            quote <span class="op">=</span> <span class="cn">FALSE</span>, fileEncoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>This code is run in anvi’o</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">### Building the Profile Database</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Time to put all of these pieces together. This gets a little tricky </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">## since we do not have a database to start with because some of these </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">## files can be loaded directly in the interface but some need to be added </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">## to a database. When we fire up the interactive in `--manual` mode, we </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">## ***must*** give anvi'o the name of a database and it will *create* that </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">## database for us. Then we can shut down the interactive, add the necessary </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">## data files, and start back up.</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">## Now we have a new profile database that we can add the sample metadata </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">## (`additional_layers.txt`) and the sample dendrogram (sample.tre) using the </span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">## command `anvi-import-misc-data`. These commands add the table to the new </span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">## `profile.db`. First, kill the interactive.</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> additional_views.txt <span class="dt">\</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> sample.tre <span class="dt">\</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layer_orders</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">## One last this is to get the table with the taxonomy total by sample </span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">## (`tax_layers.txt`) into the profile database. We will run the same </span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">## command we just used.</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> tax_layers.txt <span class="dt">\</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">## In fact, we could just as easily append the taxonomy total data onto </span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">## the `additional_layers.txt` and import in one command. But we didn't.</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">### Interactive Interface</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">## With a populated database in hand, we can now begin modifying the </span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">## visual by running the interactive command again.</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                 <span class="ex">--fasta-file</span> anvio.fasta <span class="dt">\</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="figure-2" class="level2"><h2 class="anchored" data-anchor-id="figure-2">Figure 2</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p><img src="include/pub/MAIN/Figure_2.png" class="img-fluid"></p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p><img src="paper/MAIN/FIGURES/Figure_2.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/MAIN/Figure_2.rdata">Download Figure 2 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/MAIN/Figure_2.pdf">Download Figure 2 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Figure 2</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">###################### For composite figure main text Tmin and Xylanase Vmax</span></span>
<span><span class="co">#load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/Figure_2.rdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Box plots Tmin and Xylanase (use mean vals by plot from metadata)</span></span>
<span><span class="va">diversity_meta.TminXyl</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">diversity_meta.long</span>,  <span class="va">measure</span> <span class="op">==</span> <span class="st">"Tmin"</span> <span class="op">|</span></span>
<span>           <span class="va">measure</span> <span class="op">==</span> <span class="st">"XYL_micC"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot.Tminxyl</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">diversity_meta.TminXyl</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TREAT</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">diversity_meta.TminXyl</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">TREAT</span>, <span class="va">value</span> , fill <span class="op">=</span> <span class="va">TREAT</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    outlier.colour <span class="op">=</span> <span class="st">"grey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span></span>
<span>    facets <span class="op">=</span>  <span class="va">.</span> <span class="op">~</span> <span class="va">measure</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Tmin <span class="op">=</span> <span class="st">"Tmin (°C)"</span>, XYL_micC <span class="op">=</span> <span class="st">"β-xylanase Vmax per micC at AST"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">1.5</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">18</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plot.Tminxyl</span></span>
<span></span>
<span><span class="co">#Scatter plots Tmin and Xylanase</span></span>
<span></span>
<span><span class="co">#rename levels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Tmindata</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Tmindata</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span> <span class="op">==</span>  <span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Control"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Tmindata</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Tmindata</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+3°C"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Tmindata</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">Tmindata</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W8"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+8°C"</span></span>
<span></span>
<span><span class="co">#Xylanase plot</span></span>
<span><span class="va">enzvmax.XY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">enzvmax</span>, <span class="va">enzyme</span> <span class="op">==</span> <span class="st">"XYase"</span><span class="op">)</span></span>
<span><span class="va">enzvmax.XY</span><span class="op">$</span><span class="va">Vmax.log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">enzvmax.XY</span><span class="op">$</span><span class="va">Vmax</span><span class="op">)</span></span>
<span><span class="va">enzvmax.XY</span><span class="op">$</span><span class="va">Vmax.SQRT</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">enzvmax.XY</span><span class="op">$</span><span class="va">Vmax</span><span class="op">)</span> <span class="op">^</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="va">plot.vmax.XY</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">enzvmax.XY</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">assayT</span>, y <span class="op">=</span> <span class="va">Vmax.SQRT</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">assayT</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Vmax.SQRT</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Treat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co">## forcats::fct_relevel(Treat, "Control", "+3°C", "+8°C")  </span></span>
<span><span class="co">## Added by JJS to order facets  </span></span>
<span><span class="co">## Changed color order as well  </span></span>
<span>  </span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">Treat</span>, <span class="st">"Control"</span>, <span class="st">"+3°C"</span>, <span class="st">"+8°C"</span><span class="op">)</span> <span class="op">~</span> <span class="va">enzyme</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>             ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#2271b2"</span>  <span class="co"># blue</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#2271b2"</span> <span class="co"># blue</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_cl_normal</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"errorbar"</span>,</span>
<span>    fun.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span></span>
<span>    se <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    method <span class="op">=</span> <span class="va">lm</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey20"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'B-Xylanase Vmax [SQRT(nmol MU/g/min)]'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'Temperature (°C)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#Tmin plot</span></span>
<span><span class="va">plot.Tmin_forVmax</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">Tmindata</span> , <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">temp_av</span>, y <span class="op">=</span> <span class="va">SQRT_activity</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">temp_av</span>,</span>
<span>    y <span class="op">=</span> <span class="va">SQRT_activity</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">treat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.8</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">temp_av</span>,</span>
<span>    y <span class="op">=</span> <span class="va">SQRT_activity_inline</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">treat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="va">.</span> <span class="op">~</span> <span class="va">treat</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>             nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_smooth</span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">temp_av</span>,</span>
<span>      y <span class="op">=</span> <span class="va">SQRT_activity_inline</span>,</span>
<span>      group <span class="op">=</span> <span class="va">treat</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">treat</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">T</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_cl_normal</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"errorbar"</span>,</span>
<span>    fun.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'Bacterial growth [SQRT (dpm/h)]'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'Temperature (°C)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">450</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, color <span class="op">=</span> <span class="st">"black"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#composite plot</span></span>
<span><span class="va">composite.plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">plot.Tmin_forVmax</span>, <span class="va">plot.vmax.XY</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">composite.plot</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## CAPSCALE PLOTS </span></span>
<span></span>
<span><span class="co">## SAME AS Extended_Data_Figure_5 but only using TEMP adaptation </span></span>
<span><span class="co">## 1) Run `rankindex` to compare metadata and community dissimilarity indices </span></span>
<span><span class="co">## for gradient detection. This will help us select the best dissimilarity </span></span>
<span><span class="co">## metric to use.</span></span>
<span><span class="co">## 2) Run `capscale` for distance-based redundancy analysis.</span></span>
<span><span class="co">## 3) Run `envfit` to fit environmental parameters onto the ordination. </span></span>
<span><span class="co">## This function basically calculates correlation scores between the metadata </span></span>
<span><span class="co">## parameters and the ordination axes. </span></span>
<span><span class="co">## 4) Select metadata parameters significant for `bioenv` (see above) </span></span>
<span><span class="co">## and/or `envfit` analyses.</span></span>
<span><span class="co">## 5) Run `envfit` on ASVs.</span></span>
<span><span class="co">## 6) Plot the ordination and vector overlays. </span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">### 16S rRNA Temperature Adaptation #</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="co">### </span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">temp_adapt</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span><span class="co">## Let's run `capscale` using Bray-Curtis. </span></span>
<span></span>
<span><span class="co">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span><span class="co">## * Autocorrelated removed: NUE, PUE, SI</span></span>
<span><span class="co">## * Remove for capscale: NONE</span></span>
<span></span>
<span><span class="va">temp_adapt_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">AG_Q10</span> <span class="op">+</span> <span class="va">BG_Q10</span> <span class="op">+</span> <span class="va">BP_Q10</span> <span class="op">+</span> <span class="va">CE_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">P_Q10</span> <span class="op">+</span> <span class="va">N_Q10</span> <span class="op">+</span> <span class="va">S_Q10</span> <span class="op">+</span> <span class="va">XY_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">LP_Q10</span> <span class="op">+</span> <span class="va">PX_Q10</span> <span class="op">+</span> <span class="va">CUEcn</span> <span class="op">+</span> <span class="va">CUEcp</span> <span class="op">+</span> <span class="va">Tmin</span>, </span>
<span>                             <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">temp_adapt_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, </span>
<span>                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                               <span class="va">temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and  bioenv."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span></span>
<span></span>
<span><span class="va">new_temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_sig_diff</span></span>
<span><span class="va">temp_adapt_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                   <span class="va">new_temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span><span class="op">[</span><span class="va">temp_adapt_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                 <span class="va">temp_adapt_asv_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">temp_adapt_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">temp_adapt_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">temp_adapt_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_all</span>, <span class="va">temp_adapt_asv_signif</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                  <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                   <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">###### 16S rRNA plot code ###</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">temp_adapt_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">temp_adapt_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span></span>
<span>    aspect.ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">ssu18_temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">###### ITS Temperature Adaptation ###</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">temp_adapt</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's run `capscale` using Bray-Curtis. </span></span>
<span></span>
<span><span class="co">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span><span class="co">## * Autocorrelated removed: NUE, PUE, P_Q10, SI                                                                        </span></span>
<span><span class="co">## * Remove for capscale: S_Q10</span></span>
<span></span>
<span><span class="va">temp_adapt_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">AG_Q10</span> <span class="op">+</span> <span class="va">BG_Q10</span> <span class="op">+</span> <span class="va">BP_Q10</span> <span class="op">+</span> <span class="va">CE_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">N_Q10</span> <span class="op">+</span> <span class="va">XY_Q10</span> <span class="op">+</span> <span class="va">LP_Q10</span> <span class="op">+</span> <span class="va">PX_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">CUEcn</span> <span class="op">+</span> <span class="va">CUEcp</span> <span class="op">+</span> <span class="va">Tmin</span>, </span>
<span>                           <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">temp_adapt_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, </span>
<span>                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                               <span class="va">temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and  bioenv."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span></span>
<span></span>
<span><span class="va">new_temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_sig_diff</span></span>
<span><span class="va">temp_adapt_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                   <span class="va">new_temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span><span class="op">[</span><span class="va">temp_adapt_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                 <span class="va">temp_adapt_asv_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">temp_adapt_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">temp_adapt_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">temp_adapt_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_all</span>, <span class="va">temp_adapt_asv_signif</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                  <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                   <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">###### ITS plot code ###</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">temp_adapt_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">temp_adapt_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span></span>
<span>    aspect.ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">its18_temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span></span>
<span></span>
<span><span class="va">plot.Tmin_forVmax</span>  <span class="op">&lt;-</span> <span class="va">plot.Tmin_forVmax</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>strip.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">###### COMBO plot code ##############</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">layout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">11</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">11</span>, l <span class="op">=</span> <span class="fl">3</span>, r <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">12</span>, b <span class="op">=</span> <span class="fl">14</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">13</span>, l <span class="op">=</span> <span class="fl">5</span>, r <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">layout</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combo_plot</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">plot.Tmin_forVmax</span> <span class="op">+</span> <span class="va">plot.vmax.XY</span> <span class="op">+</span> <span class="va">plot.Tminxyl</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">ssu18_temp_adapt_plot</span> <span class="op">/</span>  <span class="va">its18_temp_adapt_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>design <span class="op">=</span> <span class="va">layout</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span>                filename <span class="op">=</span>  <span class="st">"Figure_2.png"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">7485</span>, width <span class="op">=</span> <span class="fl">9100</span>, units <span class="op">=</span> <span class="st">'px'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span>                </span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span>                filename <span class="op">=</span> <span class="st">"Figure_2.pdf"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">7485</span>, width <span class="op">=</span> <span class="fl">9100</span>, units <span class="op">=</span> <span class="st">'px'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="figure-3" class="level2"><h2 class="anchored" data-anchor-id="figure-3">Figure 3</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p><img src="include/pub/MAIN/Figure_3.png" class="img-fluid"></p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p><img src="paper/MAIN/FIGURES/Figure_3.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/MAIN/Figure_3.rdata">Download Figure 3 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/MAIN/Figure_3.pdf">Download Figure 3 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Figure 3</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#clear workspace</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># template for blank plot</span></span>
<span><span class="va">blankPlot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_blank</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># load data </span></span>
<span><span class="co"># Predicted fluxes calculated using Tmin model per treatment, </span></span>
<span><span class="co">## calculated using CO2 flux at ambient temperature (control plots)</span></span>
<span><span class="co">#Tmin_CO2pred &lt;-</span></span>
<span><span class="co">#  read.csv("include/pub/MAIN/Fig3_CO2predict.csv", header = T)</span></span>
<span><span class="co">#CO2c_fullgrad &lt;-</span></span>
<span><span class="co">#  read.csv("include/pub/MAIN/Fig3_CO2observed.csv", header = T)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/MAIN/Figure_3.rdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#determine mean values, measured data</span></span>
<span><span class="va">CO2c_fullgrad.means</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu">ddply</span><span class="op">(</span></span>
<span>    <span class="va">CO2c_fullgrad</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Treat"</span>, <span class="st">"Plot"</span><span class="op">)</span>,</span>
<span>    <span class="va">summarise</span>,</span>
<span>    NCO2    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">CO2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    CO2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">CO2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    sdCO2   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">CO2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    seCO2   <span class="op">=</span> <span class="va">sdCO2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">NCO2</span><span class="op">)</span>,</span>
<span>    NTemp    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Temp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    sdTemp   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Temp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    seTemp   <span class="op">=</span> <span class="va">sdTemp</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">NTemp</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#subsets, predicted data</span></span>
<span><span class="va">Tmin_CO2pred.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Tmin_CO2pred</span>, <span class="va">treat</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">Tmin_CO2pred.W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Tmin_CO2pred</span>, <span class="va">treat</span> <span class="op">==</span> <span class="st">"W3"</span><span class="op">)</span></span>
<span><span class="va">Tmin_CO2pred.W8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Tmin_CO2pred</span>, <span class="va">treat</span> <span class="op">==</span> <span class="st">"W8"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># data in long format , predicted data</span></span>
<span><span class="va">CO2predict.C.long</span> <span class="op">&lt;-</span> <span class="va">Tmin_CO2pred.C</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span></span>
<span>    key <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    value <span class="op">=</span> <span class="va">value</span>,<span class="op">-</span><span class="va">treat</span>,</span>
<span>    <span class="op">-</span><span class="va">ID</span>,</span>
<span>    <span class="op">-</span><span class="va">depth</span>,</span>
<span>    <span class="op">-</span><span class="va">year</span>,</span>
<span>    <span class="op">-</span><span class="va">Tmin</span>,</span>
<span>    <span class="op">-</span><span class="va">Tambient</span>,</span>
<span>    <span class="op">-</span><span class="va">CO2.at.Tmin_SQRT</span>,</span>
<span>    <span class="op">-</span><span class="va">CO2.at.Tambient_SQRT</span>,</span>
<span>    <span class="op">-</span><span class="va">slope</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">measure</span><span class="op">)</span></span>
<span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu">revalue</span><span class="op">(</span></span>
<span>    <span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">measure</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"CO2_predict29"</span> <span class="op">=</span> <span class="fl">29</span>,</span>
<span>      <span class="st">"CO2_predict34"</span> <span class="op">=</span> <span class="fl">34</span>,</span>
<span>      <span class="st">"CO2.at.Tambient"</span> <span class="op">=</span> <span class="fl">25.93395</span>,</span>
<span>      <span class="st">"CO2.at.Tmin"</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">measure</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">temp.predict.C</span> <span class="op">&lt;-</span> <span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">measure</span></span>
<span><span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">co2.predict.C</span> <span class="op">&lt;-</span> <span class="va">CO2predict.C.long</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#repeat for W3 adaptation</span></span>
<span><span class="va">CO2predict.W3.long</span> <span class="op">&lt;-</span> <span class="va">Tmin_CO2pred.W3</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span></span>
<span>    key <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    value <span class="op">=</span> <span class="va">value</span>,<span class="op">-</span><span class="va">treat</span>,</span>
<span>    <span class="op">-</span><span class="va">ID</span>,</span>
<span>    <span class="op">-</span><span class="va">depth</span>,</span>
<span>    <span class="op">-</span><span class="va">year</span>,</span>
<span>    <span class="op">-</span><span class="va">Tmin</span>,</span>
<span>    <span class="op">-</span><span class="va">Tambient</span>,</span>
<span>    <span class="op">-</span><span class="va">CO2.at.Tmin_SQRT</span>,</span>
<span>    <span class="op">-</span><span class="va">CO2.at.Tambient_SQRT</span>,</span>
<span>    <span class="op">-</span><span class="va">slope</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">measure</span><span class="op">)</span></span>
<span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu">revalue</span><span class="op">(</span></span>
<span>    <span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">measure</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"CO2_predict29"</span> <span class="op">=</span> <span class="fl">29</span>,</span>
<span>      <span class="st">"CO2_predict34"</span> <span class="op">=</span> <span class="fl">34</span>,</span>
<span>      <span class="st">"CO2.at.Tambient"</span> <span class="op">=</span> <span class="fl">25.93395</span>,</span>
<span>      <span class="st">"CO2.at.Tmin"</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">measure</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">temp.predict.W3</span> <span class="op">&lt;-</span> <span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">measure</span></span>
<span><span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">co2.predict.W3</span> <span class="op">&lt;-</span> <span class="va">CO2predict.W3.long</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#repeat for W8 adaptation</span></span>
<span><span class="va">CO2predict.W8.long</span> <span class="op">&lt;-</span> <span class="va">Tmin_CO2pred.W8</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span></span>
<span>    key <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    value <span class="op">=</span> <span class="va">value</span>,<span class="op">-</span><span class="va">treat</span>,</span>
<span>    <span class="op">-</span><span class="va">ID</span>,</span>
<span>    <span class="op">-</span><span class="va">depth</span>,</span>
<span>    <span class="op">-</span><span class="va">year</span>,</span>
<span>    <span class="op">-</span><span class="va">Tmin</span>,</span>
<span>    <span class="op">-</span><span class="va">Tambient</span>,</span>
<span>    <span class="op">-</span><span class="va">CO2.at.Tmin_SQRT</span>,</span>
<span>    <span class="op">-</span><span class="va">CO2.at.Tambient_SQRT</span>,</span>
<span>    <span class="op">-</span><span class="va">slope</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">measure</span><span class="op">)</span></span>
<span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">plyr</span><span class="fu">::</span><span class="fu">revalue</span><span class="op">(</span></span>
<span>    <span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">measure</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"CO2_predict29"</span> <span class="op">=</span> <span class="fl">29</span>,</span>
<span>      <span class="st">"CO2_predict34"</span> <span class="op">=</span> <span class="fl">34</span>,</span>
<span>      <span class="st">"CO2.at.Tambient"</span> <span class="op">=</span> <span class="fl">25.93395</span>,</span>
<span>      <span class="st">"CO2.at.Tmin"</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">measure</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">temp.predict.W8</span> <span class="op">&lt;-</span> <span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">measure</span></span>
<span><span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">co2.predict.W8</span> <span class="op">&lt;-</span> <span class="va">CO2predict.W8.long</span><span class="op">$</span><span class="va">value</span></span>
<span></span>
<span><span class="co">#subset</span></span>
<span><span class="va">CO2c_fullgrad_sub_full</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">CO2c_fullgrad</span>, <span class="va">Treat</span> <span class="op">==</span> <span class="st">"C"</span> <span class="op">|</span> <span class="va">Treat</span> <span class="op">==</span> <span class="st">"W3"</span> <span class="op">|</span> <span class="va">Treat</span> <span class="op">==</span> <span class="st">"W8"</span><span class="op">)</span></span>
<span><span class="va">CO2c_fullgrad_sub</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">CO2c_fullgrad.means</span>, <span class="va">Treat</span> <span class="op">==</span> <span class="st">"C"</span> <span class="op">|</span></span>
<span>           <span class="va">Treat</span> <span class="op">==</span> <span class="st">"W3"</span> <span class="op">|</span> <span class="va">Treat</span> <span class="op">==</span> <span class="st">"W8"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">############ scatter plot CO2 with fit #################################</span></span>
<span><span class="va">plot.CO2byT_gr</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">CO2c_fullgrad</span>, <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Temp</span>,</span>
<span>    y <span class="op">=</span> <span class="va">CO2</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Treat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_smooth</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2c_fullgrad</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Temp</span>, y <span class="op">=</span> <span class="va">CO2</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    se <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'Soil'</span> <span class="op">~</span> <span class="va">CO</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="st">'efflux ('</span> <span class="op">*</span> <span class="va">mu</span> <span class="op">~</span> <span class="st">'mol'</span> <span class="op">~</span> <span class="va">CO</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="va">m</span> <span class="op">^</span> <span class="op">-</span><span class="fl">2</span> <span class="op">~</span></span>
<span>                <span class="va">s</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="st">')'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">' Soil temperature (°C)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">############boxplot CO2, means</span></span>
<span><span class="va">plot_CO2_box_full</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">CO2c_fullgrad_sub_full</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Treat</span>, y <span class="op">=</span> <span class="va">CO2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2c_fullgrad_sub_full</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">Treat</span>, <span class="va">CO2</span>, fill <span class="op">=</span> <span class="va">Treat</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    outlier.colour <span class="op">=</span> <span class="st">"grey80"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">4.736140</span>    ,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">8.427807</span>   ,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">15.984643</span>    ,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">############boxplot soilT, means</span></span>
<span><span class="va">plot_T_box</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">CO2c_fullgrad_sub</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Treat</span>, y <span class="op">=</span> <span class="va">Temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2c_fullgrad_sub</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">Treat</span>, <span class="va">Temp</span>, fill <span class="op">=</span> <span class="va">Treat</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    outlier.colour <span class="op">=</span> <span class="st">"grey80"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">41</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">26.07722</span>  ,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">28.53902</span> ,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="fl">33.84000</span>   ,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#  overlay fitted prediction plots onto CO2 scatter</span></span>
<span><span class="va">plot.CO2byT_gr_withpredict</span> <span class="op">&lt;-</span> <span class="va">plot.CO2byT_gr</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2predict.C.long</span>,</span>
<span>    <span class="fu">aes</span> <span class="op">(</span>x <span class="op">=</span> <span class="va">temp.predict.C</span>, y <span class="op">=</span> <span class="va">co2.predict.C</span><span class="op">)</span> ,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#2271b2"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_smooth</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2predict.C.long</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">temp.predict.C</span>, y <span class="op">=</span> <span class="va">co2.predict.C</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    se <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"#2271b2"</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2predict.W3.long</span>,</span>
<span>    <span class="fu">aes</span> <span class="op">(</span>x <span class="op">=</span> <span class="va">temp.predict.W3</span>, y <span class="op">=</span> <span class="va">co2.predict.W3</span><span class="op">)</span> ,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#71b222"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_smooth</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2predict.W3.long</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">temp.predict.W3</span>, y <span class="op">=</span> <span class="va">co2.predict.W3</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    se <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"grey20"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"#71b222"</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2predict.W8.long</span>,</span>
<span>    <span class="fu">aes</span> <span class="op">(</span>x <span class="op">=</span> <span class="va">temp.predict.W8</span>, y <span class="op">=</span> <span class="va">co2.predict.W8</span><span class="op">)</span> ,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"#b22271"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_smooth</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">CO2predict.W8.long</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">temp.predict.W8</span>, y <span class="op">=</span> <span class="va">co2.predict.W8</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    se <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"#b22271"</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># composite plot</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">plot_T_box</span>, <span class="va">blankPlot</span>, <span class="va">plot.CO2byT_gr_withpredict</span>, <span class="va">plot_CO2_box_full</span>, </span>
<span>        ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.4</span><span class="op">)</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">layout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">11</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">12</span>, b <span class="op">=</span> <span class="fl">14</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">11</span>, l <span class="op">=</span> <span class="fl">5</span>, r <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">layout</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combo_plot</span> <span class="op">&lt;-</span> <span class="va">plot.CO2byT_gr_withpredict</span> <span class="op">+</span> <span class="va">plot_T_box</span> <span class="op">+</span> <span class="va">plot_CO2_box_full</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>design <span class="op">=</span> <span class="va">layout</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co">#combo_plot &lt;- </span></span>
<span><span class="co">#  plot.Tmin_forVmax + plot.vmax.XY + plot.Tminxyl + ((ssu18_temp_adapt_plot /  its18_temp_adapt_plot)) + </span></span>
<span><span class="co">#  plot_layout(design = layout)  </span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span>                filename <span class="op">=</span>  <span class="st">"Figure_3.png"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">19.33</span>, width <span class="op">=</span> <span class="fl">18.51</span>, units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span>                </span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span>                filename <span class="op">=</span> <span class="st">"Figure_3.pdf"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">19.33</span>, width <span class="op">=</span> <span class="fl">18.51</span>, units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="extended-data" class="level1"><h1>Extended Data</h1>
<section id="extended-data-figure-2" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-2">Extended Data Figure 2</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include axes and label resizing, removing non-significant (NS) values from plots, changing significant p-values to asterisks (<code>*</code>), creating a legend, and enlarging outlier points.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p><img src="include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.png" class="img-fluid"></p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_2.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.rdata">Download Extended Data Figure 2 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.pdf">Download Extended Data Figure 2 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<section id="alpha-diversity-plot-code" class="level3"><h3 class="anchored" data-anchor-id="alpha-diversity-plot-code">Alpha diversity plot code</h3>
<div class="cell">
<details><summary>Access the code for Extended Data Figure 2 a &amp; d</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.rdata"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">### 16S rRNA ALPHA DIV PLOTS ########</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">tmp_objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tmp_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>     <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">homogeneity.pvalue</span></span>
<span>          <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">normality.pvalue</span></span>
<span>          <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">method</span></span>
<span>          <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_method</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span>          <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">tmp_metric</span>, <span class="va">tmp_qvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_n_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_h_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_method</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_phoc_method</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"metric"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"q-value"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"normality p-value"</span> <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                <span class="st">"homogeneity p-value"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"method"</span> <span class="op">=</span> <span class="fl">5</span>, <span class="st">"posthoc method"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_sig_tab"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span></span>
<span><span class="co">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span></span>
<span></span>
<span><span class="va">tmp_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="va">ssu18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="va">ssu18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_sig_tab</span>, <span class="va">tmp_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"posthoc p-value"</span> <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span></span>
<span><span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">lineage</span> <span class="op">&lt;-</span> <span class="st">"No"</span></span>
<span><span class="va">ssu18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_sig_tab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">ssu18_sig_tab_all</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_sig_tab</span></span>
<span></span>
<span><span class="co">## PostHoc Analyses </span></span>
<span></span>
<span><span class="co">## First let's check the results of each posthoc analysis.</span></span>
<span><span class="co">### Observed (q-value = 0)</span></span>
<span><span class="va">ssu18_asvr0_lab</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span></span>
<span><span class="va">ssu18_asvr0_lab</span></span>
<span><span class="va">ssu18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu18_asvr1_lab</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span><span class="va">ssu18_asvr1_lab</span></span>
<span><span class="va">ssu18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu18_asvr2_lab</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span><span class="va">ssu18_asvr2_lab</span></span>
<span><span class="va">ssu18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span></span>
<span><span class="co">## Now we can plot the results from the posthoc analyses for each metric </span></span>
<span><span class="co">## and data set using the function `div_test_plot_jjs`. </span></span>
<span><span class="co">## I modified the original function (`div_test_plot`) to control a </span></span>
<span><span class="co">## little of the formatting.</span></span>
<span></span>
<span><span class="co">## The command is as follows:</span></span>
<span></span>
<span></span>
<span><span class="co">## div_test_plot(divtest = x, chart = "type", colour = col.pal, </span></span>
<span><span class="co">##               posthoc = TRUE, threshold = value))</span></span>
<span></span>
<span><span class="co">## where `x` is the results from the `div_test` function, `"type"` is </span></span>
<span><span class="co">## chart type (box, jitter, or violin), `colour` is is a color palette, </span></span>
<span><span class="co">## `posthoc` indicates whether to run posthoc pairwise analyses, and `value` </span></span>
<span><span class="co">## is the maximum p-value to show in pairwise posthoc results. </span></span>
<span><span class="co">## **WARNING** if none of the posthoc results are below the specified </span></span>
<span><span class="co">## threshold, the function will throw an error. Therefore, until this is </span></span>
<span><span class="co">## fixed, all posthoc values are shown.</span></span>
<span></span>
<span><span class="va">div_test_plot_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">divtest</span>, <span class="va">chart</span>, <span class="va">colour</span>, <span class="va">posthoc</span>, <span class="va">threshold</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">chart</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">chart</span> <span class="op">=</span> <span class="st">"box"</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">posthoc</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> </span>
<span>        <span class="st">"normality.pvalue"</span><span class="op">)</span><span class="op">)</span> </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input object does not seem to be a div_test output."</span><span class="op">)</span></span>
<span>    <span class="va">divtestdata</span> <span class="op">&lt;-</span> <span class="va">divtest</span><span class="op">$</span><span class="va">data</span></span>
<span>    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span>
<span>    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">getPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span>, </span>
<span>            <span class="st">"Paired"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">colour</span> <span class="op">&lt;-</span> <span class="fu">getPalette</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Tukey post-hoc test"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, </span>
<span>                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, </span>
<span>                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span>                <span class="st">"p"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, </span>
<span>                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, </span>
<span>                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span>                <span class="st">"p"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, </span>
<span>            <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="va">pairwisetable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;</span> </span>
<span>                <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">sortedgroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">group1</span>, <span class="va">pairwisetable</span><span class="op">$</span><span class="va">group2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datamax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datamin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datarange</span> <span class="op">&lt;-</span> <span class="va">datamax</span> <span class="op">-</span> <span class="va">datamin</span></span>
<span>        <span class="va">by</span> <span class="op">&lt;-</span> <span class="va">datarange</span> <span class="op">*</span> <span class="fl">0.1</span></span>
<span>        <span class="va">min</span> <span class="op">&lt;-</span> <span class="va">datamax</span></span>
<span>        <span class="va">max</span> <span class="op">&lt;-</span> <span class="va">min</span> <span class="op">+</span> <span class="op">(</span><span class="va">by</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min</span>, <span class="va">max</span>, <span class="va">by</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">$</span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">ypos</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"box"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, outlier.size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span>            <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">scale_linetype_manual</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"jitter"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, width <span class="op">=</span> <span class="fl">0</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>                <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"violin"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggviolin</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>                <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>            <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>, chart <span class="op">=</span> <span class="st">"box"</span>,</span>
<span>                                 colour <span class="op">=</span> <span class="va">swel_col</span>, posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">+</span></span>
<span>                             <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Effective no. of Taxon Units"</span>, x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">+</span></span>
<span>                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">+</span></span>
<span>                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span></span>
<span>  <span class="va">ssu18_ps_perfect_q0_adt_plot</span>, </span>
<span>  <span class="va">ssu18_ps_perfect_q1_adt_plot</span>, </span>
<span>  <span class="va">ssu18_ps_perfect_q2_adt_plot</span>, </span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ssu18_alph_div_plots_asv</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">### ITS ALPHA DIV PLOTS #############</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">tmp_objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tmp_objects</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>     <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">homogeneity.pvalue</span></span>
<span>          <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_h_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_h_pvalue</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">normality.pvalue</span></span>
<span>          <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_n_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_n_pvalue</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">method</span></span>
<span>          <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_method</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">qvalue</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_q"</span>, <span class="va">j</span>, <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span>          <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="va">tmp_phoc_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tmp_phoc_method</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">tmp_metric</span>, <span class="va">tmp_qvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_n_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_h_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_method</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_phoc_method</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"metric"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"q-value"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"normality p-value"</span> <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                <span class="st">"homogeneity p-value"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"method"</span> <span class="op">=</span> <span class="fl">5</span>, <span class="st">"posthoc method"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_sig_tab"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span></span>
<span><span class="co">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span></span>
<span></span>
<span><span class="va">tmp_pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="va">its18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="va">its18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">test</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">its18_ps_perfect_sig_tab</span>, <span class="va">tmp_pvalue</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"posthoc p-value"</span> <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">its18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span></span>
<span><span class="va">its18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">its18_ps_perfect_sig_tab</span><span class="op">$</span><span class="va">lineage</span> <span class="op">&lt;-</span> <span class="st">"No"</span></span>
<span><span class="va">its18_ps_perfect_sig_tab</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_sig_tab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">its18_sig_tab_all</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_sig_tab</span></span>
<span></span>
<span><span class="co">## PostHoc Analyses </span></span>
<span></span>
<span><span class="co">## First let's check the results of each posthoc analysis.</span></span>
<span><span class="co">### Observed (q-value = 0)</span></span>
<span><span class="va">its18_asvr0_lab</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span></span>
<span><span class="va">its18_asvr0_lab</span></span>
<span><span class="va">its18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q0_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">its18_asvr1_lab</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span><span class="va">its18_asvr1_lab</span></span>
<span><span class="va">its18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q1_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">its18_asvr2_lab</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span><span class="va">its18_asvr2_lab</span></span>
<span><span class="va">its18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc.method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its18_ps_perfect_q2_adt</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>, chart <span class="op">=</span> <span class="st">"box"</span>,</span>
<span>                                 colour <span class="op">=</span> <span class="va">swel_col</span>, posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">+</span></span>
<span>                             <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Effective no. of Taxon Units"</span>, x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">+</span></span>
<span>                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">+</span></span>
<span>                             <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>                             <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                             <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span></span>
<span>  <span class="va">its18_ps_perfect_q0_adt_plot</span>, </span>
<span>  <span class="va">its18_ps_perfect_q1_adt_plot</span>, </span>
<span>  <span class="va">its18_ps_perfect_q2_adt_plot</span>, </span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">its18_alph_div_plots_asv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="beta-diversity-plot-code" class="level3"><h3 class="anchored" data-anchor-id="beta-diversity-plot-code">Beta diversity plot code</h3>
<div class="cell">
<details><summary>Access the code for Extended Data Figure 2 b, c, e, &amp; f</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">### 16S rRNA BETA DIV PLOTS #########</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">## First the code for ordination implementation in `phyloseq`. </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span><span class="op">)</span></span>
<span><span class="va">ssu_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"unifrac"</span>, <span class="st">"wunifrac"</span><span class="op">)</span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">samp_ps</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="va">ssu_dist</span><span class="op">)</span><span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_prop"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">ord_meths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PCoA"</span><span class="op">)</span> <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span></span>
<span>     <span class="va">tmp_plist</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu">llply</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">ord_meths</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">physeq</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">ordi</span> <span class="op">=</span> <span class="fu">ordinate</span><span class="op">(</span><span class="va">physeq</span>, method <span class="op">=</span> <span class="va">i</span>, distance <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span>        <span class="fu">plot_ordination</span><span class="op">(</span><span class="va">physeq</span>, <span class="va">ordi</span>, <span class="st">"samples"</span>, color <span class="op">=</span> <span class="st">"TEMP"</span><span class="op">)</span></span>
<span>   <span class="op">}</span>, <span class="va">tmp_get</span>, <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_plist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ord_meths</span></span>
<span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu">ldply</span><span class="op">(</span><span class="va">tmp_plist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"method"</span></span>
<span>  </span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Axis_1</span>, <span class="va">Axis_2</span>, color <span class="op">=</span> <span class="va">TEMP</span>, fill <span class="op">=</span> <span class="va">TEMP</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">method</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_df_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plist_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plist"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"tmp_df_name"</span> <span class="op">=</span> <span class="va">tmp_df</span>, tmp_plist_name <span class="op">=</span> <span class="va">tmp_plist</span>, tmp_plot_name <span class="op">=</span> <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>,  <span class="va">d</span>, <span class="st">"_ord_results"</span><span class="op">)</span>, <span class="va">tmp_list</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_tmp"</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plist_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_ord_results"</span><span class="op">)</span></span>
<span><span class="co">#plot_num &lt;- c(1,2,3,4)</span></span>
<span><span class="va">plot_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">plist_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">plot_num</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="va">tmp_get_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">tmp_plist_name</span></span>
<span>       <span class="va">tmp_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_get_i</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>       <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"ord_results"</span>, <span class="va">tmp_ord</span><span class="op">)</span></span>
<span>       <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="st">"ssu18_ps_perfect_"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_ord</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span><span class="op">)</span></span>
<span>       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_get_i</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span></span>
<span>       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>               panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>               panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>               panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>               axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span>       <span class="va">tmp_plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="st">"TEMP"</span></span>
<span>       </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"unifrac"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Unweighted Unifrac"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"wunifrac"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Weighted Unifrac"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>    <span class="op">}</span></span>
<span>   <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_dist_name</span><span class="op">)</span></span>
<span>       </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## And now the code for ordination implementation in `microeco`. </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span></span>
<span><span class="va">plot_group_distance_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">choose_data</span>, <span class="va">plot_group_order</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">color_values</span> <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">8</span>, </span>
<span>    <span class="st">"Dark2"</span><span class="op">)</span>, <span class="va">distance_pair_stat</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">hide_ns</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">hide_ns_more</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="va">pair_compare_filter_match</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">pair_compare_filter_select</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="va">pair_compare_method</span> <span class="op">=</span> <span class="st">"wilcox.test"</span>, <span class="va">plot_distance_xtype</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="va">self</span> <span class="op">&lt;-</span> <span class="va">choose_data</span></span>
<span>    <span class="va">group_distance</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">res_group_distance</span></span>
<span>    <span class="va">group</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">group</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">measure</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"wei_unifrac"</span>, <span class="st">"unwei_unifrac"</span>, <span class="st">"bray"</span>, </span>
<span>        <span class="st">"jaccard"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">titlename</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html">switch</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">measure</span>, wei_unifrac <span class="op">=</span> <span class="st">"Weighted Unifrac"</span>, </span>
<span>            unwei_unifrac <span class="op">=</span> <span class="st">"Unweighted Unifrac"</span>, bray <span class="op">=</span> <span class="st">"Bray-Curtis"</span>, </span>
<span>            jaccard <span class="op">=</span> <span class="st">"Jaccard"</span><span class="op">)</span></span>
<span>        <span class="va">ylabname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">titlename</span>, <span class="st">" distance"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">ylabname</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">measure</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">plot_group_order</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">group_distance</span><span class="op">[</span>, <span class="va">group</span><span class="op">]</span> <span class="op">%&lt;&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">.</span>, levels <span class="op">=</span> <span class="va">plot_group_order</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">group_distance</span><span class="op">[</span>, <span class="va">group</span><span class="op">]</span> <span class="op">%&lt;&gt;%</span> <span class="va">as.factor</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"The ordered groups are "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">group_distance</span><span class="op">[</span>, </span>
<span>        <span class="va">group</span><span class="op">]</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>, <span class="st">" ..."</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">group_distance</span>, <span class="fu">aes_string</span><span class="op">(</span>x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="st">"value"</span>, </span>
<span>        color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu">geom_boxplot</span><span class="op">(</span>outlier.size <span class="op">=</span> <span class="fl">1</span>, width <span class="op">=</span> <span class="fl">0.6</span>, linetype <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu">stat_summary</span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"mean"</span>, geom <span class="op">=</span> <span class="st">"point"</span>, shape <span class="op">=</span> <span class="fl">20</span>, </span>
<span>            size <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="va">ylabname</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu">theme</span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>, </span>
<span>        legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">color_values</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">plot_distance_xtype</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="va">plot_distance_xtype</span>, </span>
<span>            colour <span class="op">=</span> <span class="st">"black"</span>, vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">distance_pair_stat</span> <span class="op">==</span> <span class="cn">T</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">comparisons_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">group_distance</span><span class="op">[</span>, <span class="va">group</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/utils/combn.html">combn</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">hide_ns</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">pre_filter</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu">compare_means</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/delete.response.html">reformulate</a></span><span class="op">(</span><span class="va">group</span>, </span>
<span>                <span class="st">"value"</span><span class="op">)</span>, <span class="va">group_distance</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">hide_ns_more</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">filter_mark</span> <span class="op">&lt;-</span> <span class="st">"ns"</span></span>
<span>            <span class="op">}</span></span>
<span>            <span class="kw">else</span> <span class="op">{</span></span>
<span>                <span class="va">filter_mark</span> <span class="op">&lt;-</span> <span class="va">hide_ns_more</span></span>
<span>            <span class="op">}</span></span>
<span>            <span class="va">comparisons_list</span> <span class="op">%&lt;&gt;%</span> <span class="va">.</span><span class="op">[</span>, <span class="op">!</span><span class="op">(</span><span class="va">pre_filter</span><span class="op">$</span><span class="va">p.signif</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                <span class="va">filter_mark</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">pair_compare_filter_match</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">pair_compare_filter_select</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The parameter pair_compare_filter_select and pair_compare_filter_match can not be both used together!"</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">pair_compare_filter_match</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">comparisons_list</span> <span class="op">%&lt;&gt;%</span> <span class="op">{</span></span>
<span>                  <span class="va">.</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="va">pair_compare_filter_match</span>, </span>
<span>                    <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">pair_compare_filter_select</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">pair_compare_filter_select</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The parameter pair_compare_filter_select must be numeric !"</span><span class="op">)</span></span>
<span>                <span class="op">}</span></span>
<span>                <span class="va">messages_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">comparisons_list</span><span class="op">[</span>, </span>
<span>                  <span class="va">pair_compare_filter_select</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">x</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span>                  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Selected groups are "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">messages_use</span>, </span>
<span>                  collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>, <span class="st">" ..."</span><span class="op">)</span></span>
<span>                <span class="va">comparisons_list</span> <span class="op">%&lt;&gt;%</span> <span class="va">.</span><span class="op">[</span>, <span class="va">pair_compare_filter_select</span>, </span>
<span>                  drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">comparisons_list</span> <span class="op">%&lt;&gt;%</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">.</span><span class="op">[</span>, <span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu">stat_compare_means</span><span class="op">(</span>comparisons <span class="op">=</span> <span class="va">my_comparisons</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">p</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"3"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"8"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"3"</span>, <span class="st">"8"</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">microeco_path</span> <span class="op">&lt;-</span> <span class="st">"include/pub/EXD/"</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">cal_betadiv</span><span class="op">(</span>unifrac <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Here I made a custom "function" to run the analysis, plot the graphs, </span></span>
<span><span class="co">## save graph objects, and save plots (as `.png` and `.pdf` files). </span></span>
<span><span class="co">## I am sure an actual programmer would be shocked, but it works. </span></span>
<span><span class="va">microeco_beta_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">choose_input</span>, <span class="va">choose_metric</span>, <span class="va">choose_ord</span><span class="op">)</span> <span class="op">{</span>  </span>
<span>  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_t1</span> <span class="op">&lt;-</span> <span class="va">trans_beta</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_dataset</span>, group <span class="op">=</span> <span class="st">"TEMP"</span>, measure <span class="op">=</span> <span class="va">choose_metric</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_ordination</span><span class="op">(</span>ordination <span class="op">=</span> <span class="va">choose_ord</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_ordination</span><span class="op">(</span>plot_color <span class="op">=</span> <span class="st">"TEMP"</span>, </span>
<span>                                            plot_shape <span class="op">=</span> <span class="st">"TEMP"</span>, </span>
<span>                                            color_values <span class="op">=</span> <span class="va">swel_col</span>, </span>
<span>                                            shape_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                       <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>          panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>          panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>          panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>          axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"unwei_unifrac"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Unweighted Unifrac"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"wei_unifrac"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Weighted Unifrac"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>    <span class="op">}</span></span>
<span>   <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_ord_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="va">plot_group_distance_jjs</span> <span class="op">&lt;-</span> <span class="va">plot_group_distance_jjs</span></span>
<span></span>
<span>  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance_jjs</span><span class="op">(</span>choose_data <span class="op">=</span> <span class="va">tmp_t1</span>, distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_within_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="va">res_group_distance</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span>within_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance_jjs</span><span class="op">(</span>choose_data <span class="op">=</span> <span class="va">tmp_t1</span>, distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###### SET names</span></span>
<span>  <span class="va">tmp_name_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name_wg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_wg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_bg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_ord</span>, <span class="va">tmp_t1_ord_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_wg</span>, <span class="va">tmp_t1_within_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_bg</span>, <span class="va">tmp_t1_btwn_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_PCoA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu">microeco_beta_plot</span><span class="op">(</span>choose_input <span class="op">=</span> <span class="st">"ssu18_ps_perfect"</span>, choose_metric <span class="op">=</span> <span class="va">tmp_metric</span>, choose_ord <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ssu18_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_unifrac_PCoA</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">ssu18_wunifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_wunifrac_PCoA</span>  <span class="op">+</span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_me_wg_unwei_unifrac_PCoA</span></span>
<span><span class="va">ssu18_wg_wei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_me_wg_wei_unifrac_PCoA</span></span>
<span></span>
<span><span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span></span>
<span><span class="va">ssu18_wg_wei_unifrac</span> <span class="op">&lt;-</span> <span class="va">ssu18_wg_wei_unifrac</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">### ITS  BETA DIV PLOTS #############</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span></span>
<span></span>
<span><span class="va">its18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span><span class="op">)</span></span>
<span><span class="va">its_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"jsd"</span>, <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">samp_ps</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="va">its_dist</span><span class="op">)</span><span class="op">{</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_prop"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">ord_meths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PCoA"</span><span class="op">)</span> <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span></span>
<span>     <span class="va">tmp_plist</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu">llply</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">ord_meths</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">physeq</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">ordi</span> <span class="op">=</span> <span class="fu">ordinate</span><span class="op">(</span><span class="va">physeq</span>, method <span class="op">=</span> <span class="va">i</span>, distance <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span>        <span class="fu">plot_ordination</span><span class="op">(</span><span class="va">physeq</span>, <span class="va">ordi</span>, <span class="st">"samples"</span>, color <span class="op">=</span> <span class="st">"TEMP"</span><span class="op">)</span></span>
<span>   <span class="op">}</span>, <span class="va">tmp_get</span>, <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_plist</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ord_meths</span></span>
<span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu">ldply</span><span class="op">(</span><span class="va">tmp_plist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"method"</span></span>
<span>  </span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tmp_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Axis_1</span>, <span class="va">Axis_2</span>, color <span class="op">=</span> <span class="va">TEMP</span>, fill <span class="op">=</span> <span class="va">TEMP</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">method</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_df_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plist_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plist"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">d</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_dist_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"tmp_df_name"</span> <span class="op">=</span> <span class="va">tmp_df</span>, tmp_plist_name <span class="op">=</span> <span class="va">tmp_plist</span>, tmp_plot_name <span class="op">=</span> <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">samp_ps</span>, <span class="st">"_"</span>,  <span class="va">d</span>, <span class="st">"_ord_results"</span><span class="op">)</span>, <span class="va">tmp_list</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_tmp"</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plist_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_ord_results"</span><span class="op">)</span></span>
<span><span class="co">#plot_num &lt;- c(1,2,3,4)</span></span>
<span><span class="va">plot_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">plist_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">plot_num</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="va">tmp_get_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">tmp_plist_name</span></span>
<span>       <span class="va">tmp_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tmp_get_i</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>       <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"ord_results"</span>, <span class="va">tmp_ord</span><span class="op">)</span></span>
<span>       <span class="va">tmp_dist</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="st">"its18_ps_perfect_"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">tmp_ord</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span><span class="op">)</span></span>
<span>       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_get_i</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span></span>
<span>       <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>         <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>               panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>               panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>               panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>               axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span>       <span class="va">tmp_plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="st">"TEMP"</span></span>
<span>       </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"jsd"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Jensen-Shannon"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_dist</span> <span class="op">==</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">"Bray-Curtis"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_dist_name</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>    <span class="op">}</span></span>
<span>   <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_dist_name</span><span class="op">)</span></span>
<span>       </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## And now the code for ordination implementation in `microeco`. </span></span>
<span><span class="va">my_comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"3"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"8"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"3"</span>, <span class="st">"8"</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">microeco_path</span> <span class="op">&lt;-</span> <span class="st">"include/pub/EXD/"</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">cal_betadiv</span><span class="op">(</span>unifrac <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#### CODE TO ADD JSD DISTANCE ####  </span></span>
<span>  <span class="va">tmp_jsd</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="fu">::</span><span class="fu">distance</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"jsd"</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_jsd</span> <span class="op">&lt;-</span> <span class="fu">forceSymmetric</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_jsd</span><span class="op">)</span>, uplo <span class="op">=</span> <span class="st">"L"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_jsd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_jsd</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">$</span><span class="va">jsd</span> <span class="op">&lt;-</span> <span class="va">tmp_jsd</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>    </span>
<span></span>
<span><span class="co">## Here I made a custom "function" to run the analysis, plot the graphs, </span></span>
<span><span class="co">## save graph objects, and save plots (as `.png` and `.pdf` files). </span></span>
<span><span class="co">## I am sure an actual programmer would be shocked, but it works. </span></span>
<span></span>
<span><span class="va">microeco_beta_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">choose_input</span>, <span class="va">choose_metric</span>, <span class="va">choose_ord</span><span class="op">)</span> <span class="op">{</span>  </span>
<span>  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1</span> <span class="op">&lt;-</span> <span class="va">trans_beta</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_dataset</span>, group <span class="op">=</span> <span class="st">"TEMP"</span>, measure <span class="op">=</span> <span class="va">choose_metric</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_ordination</span><span class="op">(</span>ordination <span class="op">=</span> <span class="va">choose_ord</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_ordination</span><span class="op">(</span>plot_color <span class="op">=</span> <span class="st">"TEMP"</span>, </span>
<span>                                            plot_shape <span class="op">=</span> <span class="st">"TEMP"</span>, </span>
<span>                                            color_values <span class="op">=</span> <span class="va">swel_col</span>, </span>
<span>                                            shape_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                       <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>          panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>          panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>          panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>          axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"jsd"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Jensen-Shannon"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">choose_metric</span> <span class="op">==</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">"Bray-Curtis"</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">tmp_plt_name</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>    <span class="op">}</span></span>
<span>   <span class="va">tmp_t1_ord_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_ord_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="va">plot_group_distance_jjs</span> <span class="op">&lt;-</span> <span class="va">plot_group_distance_jjs</span></span>
<span></span>
<span>  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance_jjs</span><span class="op">(</span>choose_data <span class="op">=</span> <span class="va">tmp_t1</span>, distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1_within_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_within_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="va">res_group_distance</span></span>
<span>  <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">cal_group_distance</span><span class="op">(</span>within_group <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1</span><span class="op">$</span><span class="fu">plot_group_distance_jjs</span><span class="op">(</span>choose_data <span class="op">=</span> <span class="va">tmp_t1</span>, distance_pair_stat <span class="op">=</span> <span class="cn">TRUE</span>, color_values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_t1_btwn_group_plot</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">tmp_plt_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###### SET names</span></span>
<span>  <span class="va">tmp_name_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name_wg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_wg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">choose_input</span>, <span class="st">"_me_bg_"</span>, <span class="va">choose_metric</span>, <span class="st">"_"</span>, <span class="va">choose_ord</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_ord</span>, <span class="va">tmp_t1_ord_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_wg</span>, <span class="va">tmp_t1_within_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_bg</span>, <span class="va">tmp_t1_btwn_group_plot</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_PCoA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">beta_diversity</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu">microeco_beta_plot</span><span class="op">(</span>choose_input <span class="op">=</span> <span class="st">"its18_ps_perfect"</span>, choose_metric <span class="op">=</span> <span class="va">tmp_metric</span>, choose_ord <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">its18_jsd</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_jsd_PCoA</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">its18_bray</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_bray_PCoA</span>  <span class="op">+</span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">its18_wg_jsd</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_me_wg_jsd_PCoA</span></span>
<span><span class="va">its18_wg_bray</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_me_wg_bray_PCoA</span></span>
<span></span>
<span><span class="va">its18_wg_jsd</span> <span class="op">&lt;-</span> <span class="va">its18_wg_jsd</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span></span>
<span><span class="va">its18_wg_bray</span> <span class="op">&lt;-</span> <span class="va">its18_wg_bray</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">### CREATE combo plot using PATCHWORK</span></span>
<span></span>
<span><span class="va">layout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">15</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">17</span>, b <span class="op">=</span> <span class="fl">31</span>, l <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">17</span>, b <span class="op">=</span> <span class="fl">31</span>, l <span class="op">=</span> <span class="fl">10</span>, r <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">16</span>, b <span class="op">=</span> <span class="fl">23</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">24</span>, b <span class="op">=</span> <span class="fl">31</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">32</span>, b <span class="op">=</span> <span class="fl">46</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">48</span>, b <span class="op">=</span> <span class="fl">62</span>, l <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">48</span>, b <span class="op">=</span> <span class="fl">62</span>, l <span class="op">=</span> <span class="fl">10</span>, r <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">47</span>, b <span class="op">=</span> <span class="fl">54</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">55</span>, b <span class="op">=</span> <span class="fl">62</span>, l <span class="op">=</span> <span class="fl">18</span>, r <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">layout</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combo_plot</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ssu18_alph_div_plots_asv</span> <span class="op">+</span> </span>
<span>           <span class="va">ssu18_unifrac</span> <span class="op">+</span> <span class="va">ssu18_wunifrac</span> <span class="op">+</span>  </span>
<span>           <span class="va">ssu18_wg_unwei_unifrac</span> <span class="op">+</span> <span class="va">ssu18_wg_wei_unifrac</span> <span class="op">+</span> </span>
<span>  <span class="va">its18_alph_div_plots_asv</span> <span class="op">+</span> </span>
<span>           <span class="va">its18_jsd</span> <span class="op">+</span> <span class="va">its18_bray</span> <span class="op">+</span>  </span>
<span>           <span class="va">its18_wg_jsd</span> <span class="op">+</span> <span class="va">its18_wg_bray</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>design <span class="op">=</span> <span class="va">layout</span><span class="op">)</span>  </span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_2/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_2.png"</span>, height <span class="op">=</span> <span class="fl">56</span>, width <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_2/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_2.pdf"</span>, height <span class="op">=</span> <span class="fl">56</span>, width <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="extended-data-figure-3" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-3">Extended Data Figure 3</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include axes renaming, removing non-significant (NS) values from plots, changing significant p-values to asterisks (<code>*</code>), removing gridlines, and enlarging outlier points.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p><img src="include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.png" class="img-fluid"></p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_3.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.rds">Download Extended Data Figure 3 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.pdf">Download Extended Data Figure 3 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Extended Data Figure 3</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## In this section of the workflow we use the </span></span>
<span><span class="co">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span></span>
<span><span class="co">## to assess the response of taxonomic lineages to soil warming. </span></span>
<span><span class="co">## In the first step we need to fix the selected data set to make it </span></span>
<span><span class="co">## compatible with the various functions. For this analysis we use the </span></span>
<span><span class="co">## PERfect filtered data set.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_perfect_rf_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## FIX ps object</span></span>
<span><span class="va">ssu_ps</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_rf_all</span></span>
<span><span class="va">tmp_tax1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_rn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmp_tax1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\(|)"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tmp_rn</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ps_tax_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span></span>
<span><span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span>,</span>
<span>                   <span class="fu">phy_tree</span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span>,</span>
<span>                   <span class="fu">tax_table</span><span class="op">(</span><span class="va">ps_tax_new</span><span class="op">)</span>,</span>
<span>                   <span class="fu">sample_data</span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu_ps</span> <span class="op">&lt;-</span> <span class="va">tmp_ps</span></span>
<span><span class="fu">phyloseq</span><span class="fu">::</span><span class="fu">rank_names</span><span class="op">(</span><span class="va">ssu_ps</span><span class="op">)</span></span>
<span><span class="co">## Next we run a statistical test for multiple groups</span></span>
<span><span class="co">## using the `run_test_multiple_groups` function.</span></span>
<span></span>
<span><span class="va">ssu_group_anova</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">run_test_multiple_groups</span><span class="op">(</span><span class="va">ssu_ps</span>,</span>
<span>                           group <span class="op">=</span> <span class="st">"TEMP"</span>,</span>
<span>                           taxa_rank <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                           method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span></span>
<span><span class="va">ssu_group_anova</span><span class="op">@</span><span class="va">marker_table</span></span>
<span><span class="fu">marker_table</span><span class="op">(</span><span class="va">ssu_group_anova</span><span class="op">)</span></span>
<span><span class="co">## And then conduct post hoc pairwise comparisons for multiple</span></span>
<span><span class="co">## groups test using the `run_posthoc_test` function.</span></span>
<span></span>
<span><span class="va">ssu_default_pht</span> <span class="op">&lt;-</span> <span class="fu">run_posthoc_test</span><span class="op">(</span><span class="va">ssu_ps</span>,</span>
<span>                                    group <span class="op">=</span> <span class="st">"TEMP"</span>,</span>
<span>                                    method <span class="op">=</span> <span class="st">"tukey"</span>,</span>
<span>                                    transform <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## We can filter out a select taxa and plot the results.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu_default_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>,</span>
<span>  <span class="va">group_name</span> <span class="op">==</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">plot_postHocTest</span><span class="op">(</span><span class="va">ssu_default_pht</span>, feature <span class="op">=</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## But what we really want to do is get all of the markers that are</span></span>
<span><span class="co">## significant from the analysis, excluding any significant ASVs so we can</span></span>
<span><span class="co">## look at high taxa ranks.</span></span>
<span></span>
<span><span class="va">ssu_pht</span> <span class="op">&lt;-</span> <span class="va">ssu_default_pht</span></span>
<span><span class="va">ssu18_pht_filt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"ASV"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ssu_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">ssu18_pht_filt</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ssu18_pht_filt</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[a-z]__$"</span>, <span class="va">ssu18_pht_filt</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">ssu18_pht_filt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">ssu18_pht_filt</span>, <span class="va">group_name</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ssu18_pht_filt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_postHocTest_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">pht</span>, <span class="va">feature</span>, <span class="va">step_increase</span> <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="va">pht</span><span class="op">@</span><span class="va">abundance</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">.data</span><span class="op">$</span><span class="va">group</span>, </span>
<span>        names_to <span class="op">=</span> <span class="st">"feat"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">feature</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">abd_long</span>, <span class="va">.data</span><span class="op">$</span><span class="va">feat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">feature</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu">get_sig_annotation</span><span class="op">(</span><span class="va">pht</span>, step_increase <span class="op">=</span> <span class="va">step_increase</span><span class="op">)</span></span>
<span>    <span class="va">p_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu">ggplot</span><span class="op">(</span><span class="va">abd_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">group</span>, </span>
<span>        y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggsignif</span><span class="fu">::</span><span class="fu">geom_signif</span><span class="op">(</span>data <span class="op">=</span> <span class="va">annotation</span><span class="op">[</span><span class="va">annotation</span><span class="op">$</span><span class="va">feature</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>        <span class="va">feature</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmax</span>, </span>
<span>        annotations <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">annotation</span>, y_position <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">y_position</span><span class="op">)</span>, </span>
<span>        manual <span class="op">=</span> <span class="cn">TRUE</span>, textsize <span class="op">=</span> <span class="fl">3</span>, vjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>        y <span class="op">=</span> <span class="st">"Abundance"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">test_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pht</span><span class="op">@</span><span class="va">result</span><span class="op">[[</span><span class="va">feature</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">p_test</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">test_res</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">comparions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_lower</span>, </span>
<span>        ymax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">diff_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"95% confidence intervals"</span><span class="op">)</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html">wrap_plots</a></span><span class="op">(</span><span class="va">p_box</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">plot_postHocTest_jjs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html">asNamespace</a></span><span class="op">(</span><span class="st">'microbiomeMarker'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu_select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span><span class="st">"k__Bacteria|p__Acidobacteriota|c__Acidobacteriae|o__Subgroup_2"</span>, </span>
<span><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Chitinophagales|f__Saprospiraceae"</span>, </span>
<span><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Cytophagales"</span>, </span>
<span><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Flavobacteriales"</span>, </span>
<span><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Sphingobacteriales"</span>, </span>
<span><span class="st">"k__Bacteria|p__Myxococcota|c__Polyangia|o__mle1-27"</span>, </span>
<span><span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Comamonadaceae|g__Rubrivivax"</span>, </span>
<span><span class="st">"k__Bacteria|p__Actinobacteriota|c__Acidimicrobiia|o__Microtrichales"</span>, </span>
<span><span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span>, </span>
<span><span class="st">"k__Bacteria|p__Firmicutes|c__Bacilli|o__Bacillales"</span>, </span>
<span><span class="st">"k__Bacteria|p__Myxococcota|c__Myxococcia|o__Myxococcales|f__Myxococcaceae|g__Corallococcus"</span>, </span>
<span><span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Burkholderiaceae|g__Ralstonia"</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu_select</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_select_feat</span> <span class="op">&lt;-</span> <span class="va">i</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span><span class="op">(</span><span class="va">ssu_pht</span>, feature <span class="op">=</span> <span class="va">tmp_select_feat</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative abundance (% total reads)"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="va">ssu_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span><span class="st">"Subgroup_2 (Acidobacteriota)"</span>, </span>
<span><span class="st">"Saprospiraceae (Bacteroidota)"</span>, </span>
<span><span class="st">"Cytophagales (Bacteroidota)"</span>, </span>
<span><span class="st">"Flavobacteriales (Bacteroidota)"</span>, </span>
<span><span class="st">"Sphingobacteriales (Bacteroidota)"</span>, </span>
<span><span class="st">"mle1-27 (Myxococcota)"</span>, </span>
<span><span class="st">"Rubrivivax (Proteobacteria)"</span>, </span>
<span><span class="st">"Microtrichales (Actinobacteriota)"</span>, </span>
<span><span class="st">"Gaiellales (Actinobacteriota)"</span>, </span>
<span><span class="st">"Bacillales (Firmicutes)"</span>, </span>
<span><span class="st">"Corallococcus (Myxococcota)"</span>, </span>
<span><span class="st">"Ralstonia (Proteobacteria)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu_plt_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lineage <span class="op">=</span> <span class="va">ssu_select</span>, label <span class="op">=</span> <span class="va">ssu_title</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ssu_plt_info</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"plot_"</span>, <span class="va">i</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">ssu_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>  </span>
<span><span class="va">ssu_taxa_combo_plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">plot_1</span> <span class="op">+</span> <span class="va">plot_2</span> <span class="op">+</span> <span class="va">plot_3</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_4</span> <span class="op">+</span> <span class="va">plot_5</span> <span class="op">+</span> <span class="va">plot_6</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_7</span> <span class="op">+</span> <span class="va">plot_8</span> <span class="op">+</span> <span class="va">plot_9</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_10</span> <span class="op">+</span> <span class="va">plot_11</span> <span class="op">+</span> <span class="va">plot_12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">ssu_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_3/"</span>, </span>
<span>                filename <span class="op">=</span>  <span class="st">"Extended_Data_Figure_3.png"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, </span>
<span>                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span>                </span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">ssu_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_3/"</span>, </span>
<span>                filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_3.pdf"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, </span>
<span>                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="extended-data-figure-4" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-4">Extended Data Figure 4</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include axes renaming, removing non-significant (NS) values from plots, changing significant p-values to asterisks (<code>*</code>), removing gridlines, and enlarging outlier points.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p><img src="include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.png" class="img-fluid"></p>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_4.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.rds">Download Extended Data Figure 4data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.pdf">Download Extended Data Figure 4 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Extended Data Figure 4</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## In this section of the workflow we use the </span></span>
<span><span class="co">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span></span>
<span><span class="co">## to assess the response of taxonomic lineages to soil warming. </span></span>
<span><span class="co">## In the first step we need to fix the selected data set to make it </span></span>
<span><span class="co">## compatible with the various functions. For this analysis we use the </span></span>
<span><span class="co">## PERfect filtered data set.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_perfect_rf_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## FIX ps object</span></span>
<span><span class="va">its_ps</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_rf_all</span></span>
<span><span class="va">tmp_tax1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp_tax1</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_rn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span></span>
<span><span class="va">tmp_tax</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmp_tax1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\(|)"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tmp_rn</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tmp_tax1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ps_tax_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span></span>
<span><span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span>,</span>
<span>                   <span class="fu">tax_table</span><span class="op">(</span><span class="va">ps_tax_new</span><span class="op">)</span>,</span>
<span>                   <span class="fu">sample_data</span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its_ps</span> <span class="op">&lt;-</span> <span class="va">tmp_ps</span></span>
<span><span class="fu">phyloseq</span><span class="fu">::</span><span class="fu">rank_names</span><span class="op">(</span><span class="va">its_ps</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Next we run a statistical test for multiple groups</span></span>
<span><span class="co">## using the `run_test_multiple_groups` function.</span></span>
<span></span>
<span><span class="va">its_group_anova</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">run_test_multiple_groups</span><span class="op">(</span><span class="va">its_ps</span>,</span>
<span>                           group <span class="op">=</span> <span class="st">"TEMP"</span>,</span>
<span>                           taxa_rank <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                           method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span></span>
<span><span class="va">its_group_anova</span><span class="op">@</span><span class="va">marker_table</span></span>
<span><span class="fu">marker_table</span><span class="op">(</span><span class="va">its_group_anova</span><span class="op">)</span></span>
<span><span class="co">## And then conduct post hoc pairwise comparisons for multiple</span></span>
<span><span class="co">## groups test using the `run_posthoc_test` function.</span></span>
<span></span>
<span><span class="va">its_default_pht</span> <span class="op">&lt;-</span> <span class="fu">run_posthoc_test</span><span class="op">(</span><span class="va">its_ps</span>,</span>
<span>                                    group <span class="op">=</span> <span class="st">"TEMP"</span>,</span>
<span>                                    method <span class="op">=</span> <span class="st">"tukey"</span>,</span>
<span>                                    transform <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## But what we really want to do is get all of the markers that are</span></span>
<span><span class="co">## significant from the analysis, excluding any significant ASVs so we can</span></span>
<span><span class="co">## look at high taxa ranks.</span></span>
<span></span>
<span><span class="va">its_pht</span> <span class="op">&lt;-</span> <span class="va">its_default_pht</span></span>
<span><span class="va">its18_pht_filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"ASV"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">its_pht</span><span class="op">@</span><span class="va">result</span><span class="op">)</span>, <span class="va">pvalue</span> <span class="op">&lt;=</span> <span class="st">"0.05"</span><span class="op">)</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">its18_pht_filt</span> <span class="op">&lt;-</span> <span class="va">its18_pht_filt</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[a-z]__$"</span>, <span class="va">its18_pht_filt</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">its18_pht_filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">its18_pht_filt</span><span class="op">$</span><span class="va">group_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_postHocTest_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">pht</span>, <span class="va">feature</span>, <span class="va">step_increase</span> <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="va">pht</span><span class="op">@</span><span class="va">abundance</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">.data</span><span class="op">$</span><span class="va">group</span>, </span>
<span>        names_to <span class="op">=</span> <span class="st">"feat"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">feature</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">abd_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">abd_long</span>, <span class="va">.data</span><span class="op">$</span><span class="va">feat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">feature</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu">get_sig_annotation</span><span class="op">(</span><span class="va">pht</span>, step_increase <span class="op">=</span> <span class="va">step_increase</span><span class="op">)</span></span>
<span>    <span class="va">p_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu">ggplot</span><span class="op">(</span><span class="va">abd_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">group</span>, </span>
<span>        y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggsignif</span><span class="fu">::</span><span class="fu">geom_signif</span><span class="op">(</span>data <span class="op">=</span> <span class="va">annotation</span><span class="op">[</span><span class="va">annotation</span><span class="op">$</span><span class="va">feature</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>        <span class="va">feature</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">xmax</span>, </span>
<span>        annotations <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">annotation</span>, y_position <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">y_position</span><span class="op">)</span>, </span>
<span>        manual <span class="op">=</span> <span class="cn">TRUE</span>, textsize <span class="op">=</span> <span class="fl">3</span>, vjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>        y <span class="op">=</span> <span class="st">"Abundance"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">test_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pht</span><span class="op">@</span><span class="va">result</span><span class="op">[[</span><span class="va">feature</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">p_test</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">test_res</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">comparions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_lower</span>, </span>
<span>        ymax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">diff_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"95% confidence intervals"</span><span class="op">)</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html">wrap_plots</a></span><span class="op">(</span><span class="va">p_box</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="va">plot_postHocTest_jjs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html">asNamespace</a></span><span class="op">(</span><span class="st">'microbiomeMarker'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">its_select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span><span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Xylariales|f__Microdochiaceae"</span>, </span>
<span><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Entolomataceae"</span>, </span>
<span><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Clavariaceae"</span>, </span>
<span><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales"</span>, </span>
<span><span class="st">"k__Fungi|p__Basidiomycota|c__Microbotryomycetes|o__Sporidiobolales"</span>, </span>
<span><span class="st">"k__Fungi|p__Rozellomycota|c__Rozellomycotina_cls_Incertae_sedis"</span>, </span>
<span><span class="st">"k__Fungi|p__Ascomycota|c__Eurotiomycetes|o__Eurotiales|f__Trichocomaceae|g__Talaromyces"</span>, </span>
<span><span class="st">"k__Fungi|p__Ascomycota|c__Pezizomycetes|o__Pezizales|f__Pyronemataceae"</span>, </span>
<span><span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Hypocreales|f__Nectriaceae|g__Fusarium"</span>, </span>
<span><span class="st">"k__Fungi|p__Ascomycota|c__Saccharomycetes|o__Saccharomycetales|f__Metschnikowiaceae"</span>, </span>
<span><span class="st">"k__Fungi|p__Glomeromycota|c__Glomeromycetes|o__Glomerales"</span>, </span>
<span><span class="st">"k__Fungi|p__Mortierellomycota|c__Mortierellomycetes|o__Mortierellales"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its_select</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_select_feat</span> <span class="op">&lt;-</span> <span class="va">i</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span><span class="op">(</span><span class="va">its_pht</span>, feature <span class="op">=</span> <span class="va">tmp_select_feat</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_plot</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative abundance (% total reads)"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="va">its_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span><span class="st">"Microdochiaceae (Ascomycota)"</span>, </span>
<span><span class="st">"Entolomataceae (Basidiomycota)"</span>, </span>
<span><span class="st">"Clavariaceae (Basidiomycota)"</span>, </span>
<span><span class="st">"Agaricales (Basidiomycota)"</span>, </span>
<span><span class="st">"Sporidiobolales (Basidiomycota)"</span>, </span>
<span><span class="st">"Rozellomycotina (Rozellomycota)"</span>, </span>
<span><span class="st">"Talaromyces (Ascomycota)"</span>, </span>
<span><span class="st">"Pyronemataceae (Ascomycota)"</span>, </span>
<span><span class="st">"Fusarium (Ascomycota)"</span>, </span>
<span><span class="st">"Metschnikowiaceae (Ascomycota)"</span>, </span>
<span><span class="st">"Glomerales (Glomeromycota)"</span>, </span>
<span><span class="st">"Mortierellales (Mortierellomycota)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">its_plt_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lineage <span class="op">=</span> <span class="va">its_select</span>, label <span class="op">=</span> <span class="va">its_title</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">its_plt_info</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"plot_"</span>, <span class="va">i</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">its_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its_plt_info</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>  </span>
<span><span class="va">its_taxa_combo_plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">plot_1</span> <span class="op">+</span> <span class="va">plot_2</span> <span class="op">+</span> <span class="va">plot_3</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_4</span> <span class="op">+</span> <span class="va">plot_5</span> <span class="op">+</span> <span class="va">plot_6</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_7</span> <span class="op">+</span> <span class="va">plot_8</span> <span class="op">+</span> <span class="va">plot_9</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">plot_10</span> <span class="op">+</span> <span class="va">plot_11</span> <span class="op">+</span> <span class="va">plot_12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">its_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_4/"</span>, </span>
<span>                filename <span class="op">=</span>  <span class="st">"Extended_Data_Figure_4.png"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, </span>
<span>                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span>                </span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">its_taxa_combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_4/"</span>, </span>
<span>                filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_4.pdf"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">14157</span>, width <span class="op">=</span> <span class="fl">12186</span>, </span>
<span>                units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="extended-data-figure-5" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-5">Extended Data Figure 5</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include repositioning vector overlay labels, styling legend, and changing font size and style.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p><img src="include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.png" class="img-fluid"></p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_5.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.rdata">Download Extended Data Figure 5 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.pdf">Download Extended Data Figure 5 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Extended Data Figure 5</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.rdata"</span><span class="op">)</span></span>
<span><span class="co">## 1) Run `rankindex` to compare metadata and community dissimilarity indices </span></span>
<span><span class="co">## for gradient detection. This will help us select the best dissimilarity </span></span>
<span><span class="co">## metric to use.</span></span>
<span><span class="co">## 2) Run `capscale` for distance-based redundancy analysis.</span></span>
<span><span class="co">## 3) Run `envfit` to fit environmental parameters onto the ordination. </span></span>
<span><span class="co">## This function basically calculates correlation scores between the metadata </span></span>
<span><span class="co">## parameters and the ordination axes. </span></span>
<span><span class="co">## 4) Select metadata parameters significant for `bioenv` (see above) </span></span>
<span><span class="co">## and/or `envfit` analyses.</span></span>
<span><span class="co">## 5) Run `envfit` on ASVs.</span></span>
<span><span class="co">## 6) Plot the ordination and vector overlays. </span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">### 16S rRNA EDAPHIC PROPERTIES #####</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">edaphic</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Run `capscale` using Bray-Curtis. </span></span>
<span></span>
<span><span class="co">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN</span></span>
<span><span class="co">## * Autocorrelated removed: TEB, DON, Na, Al, Ca</span></span>
<span><span class="co">## 15 total, only works with 13</span></span>
<span><span class="co">## * Remove for capscale: Mg, Mn</span></span>
<span><span class="va">edaphic_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span> <span class="va">AST</span> <span class="op">+</span> <span class="va">H2O</span> <span class="op">+</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">Fe</span> <span class="op">+</span> <span class="va">K</span> <span class="op">+</span> <span class="va">ECEC</span> <span class="op">+</span> </span>
<span>                                   <span class="va">pH</span> <span class="op">+</span> <span class="va">NH4</span> <span class="op">+</span> <span class="va">NO3</span> <span class="op">+</span> <span class="va">PO4</span> <span class="op">+</span> <span class="va">DOC</span> <span class="op">+</span> <span class="va">DOCN</span>, </span>
<span>                        <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="co">## Next, we need to grab capscale scores for the samples and create a </span></span>
<span><span class="co">## data frame of the first two dimensions. We will also need to add some </span></span>
<span><span class="co">## of the sample details to the data frame. For this we use the vegan </span></span>
<span><span class="co">## function `scores` which gets species or site scores from the ordination.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggvegan</span><span class="op">)</span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">edaphic_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="co">## Now we have a new data frame that contains sample details and capscale values. </span></span>
<span></span>
<span><span class="co">## We can then do the same with the metadata vectors. </span></span>
<span><span class="co">## Here though we only need the scores and parameter name. </span></span>
<span></span>
<span><span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's run some quick correlations of metadata with ordination axes to </span></span>
<span><span class="co">## see which parameters are significant. For this we use the vegan function `envfit`.</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_edaphic_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="co">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span></span>
<span><span class="va">edaphic_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">edaphic_sig_diff</span></span>
<span><span class="va">edaphic_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">new_edaphic_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="co">## Check. Next, we run `envfit` for the ASVs.</span></span>
<span></span>
<span><span class="va">envfit_edaphic_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                             <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>                             perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span><span class="op">[</span><span class="va">edaphic_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_asv_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">edaphic_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">edaphic_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">edaphic_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">edaphic_md_signif_all</span>, <span class="va">edaphic_asv_signif</span><span class="op">)</span></span>
<span><span class="co">## The last thing to do is categorize parameters scores and ASV </span></span>
<span><span class="co">## scores into different variable types for plotting.</span></span>
<span></span>
<span><span class="va">edaphic_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, </span>
<span>                                  <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">edaphic_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, </span>
<span>                                   <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span><span class="co">##  code for the plot</span></span>
<span></span>
<span><span class="va">edaphic_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">edaphic_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">edaphic_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span><span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">edaphic_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>, </span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Edaphic properties"</span>, </span>
<span>       x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co"># 16S rRNA Soil Functional Response #</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">soil_funct</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's run `capscale` using Bray-Curtis. </span></span>
<span></span>
<span><span class="co">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span></span>
<span><span class="co">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span></span>
<span><span class="co">## * Remove for capscale: NONE</span></span>
<span><span class="va">soil_funct_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span> <span class="va">micC</span> <span class="op">+</span> <span class="va">micP</span> <span class="op">+</span> <span class="va">micCN</span> <span class="op">+</span> <span class="va">micCP</span> <span class="op">+</span> <span class="va">AG_ase</span> <span class="op">+</span> <span class="va">BG_ase</span> <span class="op">+</span> </span>
<span>                                      <span class="va">S_ase</span> <span class="op">+</span> <span class="va">XY_ase</span> <span class="op">+</span> <span class="va">PX_ase</span> <span class="op">+</span> <span class="va">CO2</span> <span class="op">+</span> <span class="va">enzNP</span>, </span>
<span>                           <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">soil_funct_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, </span>
<span>                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_soil_funct_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                               <span class="va">soil_funct_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span></span>
<span><span class="va">soil_funct_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_sig_diff</span></span>
<span></span>
<span><span class="va">new_soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">soil_funct_sig_diff</span></span>
<span><span class="va">soil_funct_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                   <span class="va">new_soil_funct_md_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">envfit_soil_funct_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, </span>
<span>                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span><span class="op">[</span><span class="va">soil_funct_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                 <span class="va">soil_funct_asv_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">soil_funct_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">soil_funct_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">soil_funct_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_all</span>, <span class="va">soil_funct_asv_signif</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, </span>
<span>                                  <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, </span>
<span>                                   <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## PLOT Code</span></span>
<span></span>
<span><span class="va">soil_funct_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">soil_funct_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">soil_funct_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">soil_funct_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Functional Response"</span>, </span>
<span>       x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">### 16S rRNA Temperature Adaptation #</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="co">### </span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">temp_adapt</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ssu18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span><span class="co">## Let's run `capscale` using Bray-Curtis. </span></span>
<span></span>
<span><span class="co">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span><span class="co">## * Autocorrelated removed: NUE, PUE, SI</span></span>
<span><span class="co">## * Remove for capscale: NONE</span></span>
<span></span>
<span><span class="va">temp_adapt_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">AG_Q10</span> <span class="op">+</span> <span class="va">BG_Q10</span> <span class="op">+</span> <span class="va">BP_Q10</span> <span class="op">+</span> <span class="va">CE_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">P_Q10</span> <span class="op">+</span> <span class="va">N_Q10</span> <span class="op">+</span> <span class="va">S_Q10</span> <span class="op">+</span> <span class="va">XY_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">LP_Q10</span> <span class="op">+</span> <span class="va">PX_Q10</span> <span class="op">+</span> <span class="va">CUEcn</span> <span class="op">+</span> <span class="va">CUEcp</span> <span class="op">+</span> <span class="va">Tmin</span>, </span>
<span>                             <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">temp_adapt_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, </span>
<span>                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                               <span class="va">temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and  bioenv."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span></span>
<span></span>
<span><span class="va">new_temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_sig_diff</span></span>
<span><span class="va">temp_adapt_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                   <span class="va">new_temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span><span class="op">[</span><span class="va">temp_adapt_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                 <span class="va">temp_adapt_asv_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">temp_adapt_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">temp_adapt_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">temp_adapt_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_all</span>, <span class="va">temp_adapt_asv_signif</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                  <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                   <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">temp_adapt_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Temperature Adaptation"</span>,</span>
<span>       x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>aspect.ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_plot"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu18_edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span></span>
<span><span class="va">ssu18_soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span></span>
<span><span class="va">ssu18_temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span></span>
<span><span class="fu">gdata</span><span class="fu">::</span><span class="fu">keep</span><span class="op">(</span><span class="va">ssu18_edaphic_plot</span>, <span class="va">ssu18_soil_funct_plot</span>, <span class="va">ssu18_temp_adapt_plot</span>, <span class="va">its18_edaphic_bioenv_ind_mantel</span>, <span class="va">its18_select_mc_norm_split_no_ac</span>, <span class="va">its18_soil_funct_bioenv_ind_mantel</span>, <span class="va">its18_temp_adapt_bioenv_ind_mantel</span>, <span class="va">ssu18_edaphic_bioenv_ind_mantel</span>, <span class="va">ssu18_select_mc_norm_split_no_ac</span>, <span class="va">ssu18_soil_funct_bioenv_ind_mantel</span>, <span class="va">ssu18_temp_adapt_bioenv_ind_mantel</span>, sure <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">###### ITS EDAPHIC PROPERTIES #######</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">edaphic</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span><span class="co">## Run `capscale` using Bray-Curtis. </span></span>
<span></span>
<span><span class="co">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN.</span></span>
<span><span class="co">## * Autocorrelated removed: TEB, DON, Na, Al, Ca.</span></span>
<span><span class="co">## * Remove for capscale: Mg, Mn, Na, Al, Fe, K</span></span>
<span></span>
<span><span class="va">edaphic_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span> <span class="va">AST</span> <span class="op">+</span> <span class="va">H2O</span> <span class="op">+</span> <span class="va">N</span> <span class="op">+</span> <span class="va">P</span> <span class="op">+</span> <span class="va">ECEC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> </span>
<span>                                   <span class="va">NH4</span> <span class="op">+</span> <span class="va">NO3</span> <span class="op">+</span> <span class="va">PO4</span> <span class="op">+</span> <span class="va">DOC</span> <span class="op">+</span> <span class="va">DOCN</span>, </span>
<span>                        <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="co">## Next, we need to grab capscale scores for the samples and create a </span></span>
<span><span class="co">## data frame of the first two dimensions. We will also need to add some </span></span>
<span><span class="co">## of the sample details to the data frame. For this we use the vegan </span></span>
<span><span class="co">## function `scores` which gets species or site scores from the ordination.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggvegan</span><span class="op">)</span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">edaphic_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">edaphic_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="co">## Now we have a new data frame that contains sample details and capscale values. </span></span>
<span></span>
<span><span class="co">## We can then do the same with the metadata vectors. </span></span>
<span><span class="co">## Here though we only need the scores and parameter name. </span></span>
<span></span>
<span><span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">edaphic_md_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's run some quick correlations of metadata with ordination axes to </span></span>
<span><span class="co">## see which parameters are significant. For this we use the vegan function `envfit`.</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_edaphic_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="co">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span></span>
<span><span class="va">edaphic_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">edaphic_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_edaphic_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_sig_diff</span></span>
<span></span>
<span><span class="va">new_edaphic_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">edaphic_sig_diff</span></span>
<span><span class="va">edaphic_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">edaphic_md_scores</span><span class="op">[</span><span class="va">edaphic_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">new_edaphic_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="co">## Check. Next, we run `envfit` for the ASVs.</span></span>
<span></span>
<span><span class="va">envfit_edaphic_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                             <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>                             perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_scores</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_edaphic_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">edaphic_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">edaphic_asv_signif</span> <span class="op">&lt;-</span> <span class="va">edaphic_asv_scores</span><span class="op">[</span><span class="va">edaphic_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">edaphic_asv_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">edaphic_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">edaphic_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">edaphic_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">edaphic_md_signif_all</span>, <span class="va">edaphic_asv_signif</span><span class="op">)</span></span>
<span><span class="co">## The last thing to do is categorize parameters scores and ASV </span></span>
<span><span class="co">## scores into different variable types for plotting.</span></span>
<span></span>
<span><span class="va">edaphic_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, </span>
<span>                                  <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">edaphic_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">edaphic_bioplot_data</span>, </span>
<span>                                   <span class="va">edaphic_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span><span class="co">##  code for the plot</span></span>
<span></span>
<span><span class="va">edaphic_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edaphic_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">edaphic_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">edaphic_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">edaphic_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">edaphic_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span><span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">edaphic_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">edaphic_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>, </span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">edaphic_plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">###### ITS Soil Functional Response #</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">soil_funct</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's run `capscale` using Bray-Curtis </span></span>
<span><span class="co">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span></span>
<span><span class="co">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span></span>
<span><span class="co">## * Remove for capscale: NONE</span></span>
<span></span>
<span><span class="va">soil_funct_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">micC</span> <span class="op">+</span> <span class="va">micP</span> <span class="op">+</span> <span class="va">micCN</span> <span class="op">+</span> <span class="va">micCP</span> <span class="op">+</span> <span class="va">AG_ase</span> <span class="op">+</span> <span class="va">BG_ase</span> <span class="op">+</span> </span>
<span>                                       <span class="va">S_ase</span> <span class="op">+</span> <span class="va">XY_ase</span> <span class="op">+</span> <span class="va">PX_ase</span> <span class="op">+</span> <span class="va">CO2</span> <span class="op">+</span> <span class="va">enzNP</span>, </span>
<span>                           <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">soil_funct_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">soil_funct_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, </span>
<span>                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">soil_funct_md_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_soil_funct_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                               <span class="va">soil_funct_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and bioenv."</span><span class="op">)</span></span>
<span><span class="va">soil_funct_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">soil_funct_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_soil_funct_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_sig_diff</span></span>
<span></span>
<span><span class="va">new_soil_funct_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">soil_funct_sig_diff</span></span>
<span><span class="va">soil_funct_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">soil_funct_md_scores</span><span class="op">[</span><span class="va">soil_funct_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                   <span class="va">new_soil_funct_md_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">envfit_soil_funct_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, </span>
<span>                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_scores</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_soil_funct_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">soil_funct_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">soil_funct_asv_signif</span> <span class="op">&lt;-</span> <span class="va">soil_funct_asv_scores</span><span class="op">[</span><span class="va">soil_funct_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                 <span class="va">soil_funct_asv_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">soil_funct_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">soil_funct_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">soil_funct_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">soil_funct_md_signif_all</span>, <span class="va">soil_funct_asv_signif</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, </span>
<span>                                  <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">soil_funct_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">soil_funct_bioplot_data</span>, </span>
<span>                                   <span class="va">soil_funct_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## PLOT Code</span></span>
<span></span>
<span><span class="va">soil_funct_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">soil_funct_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">soil_funct_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">soil_funct_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">soil_funct_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">soil_funct_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">soil_funct_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">soil_funct_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">###### ITS Temperature Adaptation ###</span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span></span>
<span><span class="va">tmp_md</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">temp_adapt</span></span>
<span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">$</span><span class="va">TREAT_T</span><span class="op">)</span></span>
<span><span class="va">tmp_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">its18_select_mc_norm_split_no_ac</span><span class="op">$</span><span class="va">data_loaded</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_rank</span> <span class="op">&lt;-</span> <span class="fu">rankindex</span><span class="op">(</span><span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">tmp_md</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp_comm</span>, </span>
<span>          indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span><span class="op">)</span>, </span>
<span>          stepacross <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's run `capscale` using Bray-Curtis. </span></span>
<span></span>
<span><span class="co">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span><span class="co">## * Autocorrelated removed: NUE, PUE, P_Q10, SI                                                                        </span></span>
<span><span class="co">## * Remove for capscale: S_Q10</span></span>
<span></span>
<span></span>
<span><span class="va">temp_adapt_cap</span> <span class="op">&lt;-</span> <span class="fu">capscale</span><span class="op">(</span><span class="va">tmp_comm</span> <span class="op">~</span>  <span class="va">AG_Q10</span> <span class="op">+</span> <span class="va">BG_Q10</span> <span class="op">+</span> <span class="va">BP_Q10</span> <span class="op">+</span> <span class="va">CE_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">N_Q10</span> <span class="op">+</span> <span class="va">XY_Q10</span> <span class="op">+</span> <span class="va">LP_Q10</span> <span class="op">+</span> <span class="va">PX_Q10</span> <span class="op">+</span> </span>
<span>                                       <span class="va">CUEcn</span> <span class="op">+</span> <span class="va">CUEcp</span> <span class="op">+</span> <span class="va">Tmin</span>, </span>
<span>                           <span class="va">tmp_md</span>, dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="va">tmp_auto_plt</span> <span class="op">&lt;-</span> <span class="fu">autoplot</span><span class="op">(</span><span class="va">temp_adapt_cap</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">)</span> <span class="co"># overall test of the significant of the analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"axis"</span>, perm.max <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test axes for significance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span>, by <span class="op">=</span> <span class="st">"terms"</span>, permu <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="co"># test for sign. environ. variables</span></span>
<span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"sites"</span><span class="op">)</span></span>
<span><span class="va">tmp_samp_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">tmp_samp_scores</span> <span class="op">&lt;-</span> <span class="va">tmp_samp_scores</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>SampleID <span class="op">=</span> <span class="va">Label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="va">tmp_md_sub</span> <span class="op">%&gt;%</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tmp_md_sub</span>, <span class="va">tmp_samp_scores</span>, </span>
<span>                                         by <span class="op">=</span> <span class="st">"SampleID"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"biplot"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_md_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot_data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">tmp_samp_scores_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span><span class="op">)</span></span>
<span><span class="va">tmp_param_list</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span></span>
<span></span>
<span><span class="va">tmp_md_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tmp_md</span>,  select <span class="op">=</span>  <span class="va">tmp_param_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_md</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, <span class="va">tmp_md_sub</span>,</span>
<span>                 perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_md</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                               <span class="va">temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from bioenv analysis."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Significant parameters from envfit analysis."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in bioenv but not envfit."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit but not bioenv."</span><span class="op">)</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"_____________________________________"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Found in envfit and  bioenv."</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif</span><span class="op">$</span><span class="va">parameters</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">its18_temp_adapt_bioenv_ind_mantel</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_sig_diff</span></span>
<span></span>
<span><span class="va">new_temp_adapt_md_signif_hits</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_sig_diff</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">temp_adapt_md_signif_all</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_md_scores</span><span class="op">[</span><span class="va">temp_adapt_md_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                   <span class="va">new_temp_adapt_md_signif_hits</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">envfit_temp_adapt_asv</span> <span class="op">&lt;-</span> <span class="fu">envfit</span><span class="op">(</span><span class="va">tmp_samp_scores_sub</span>, </span>
<span>                                <span class="va">tmp_comm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="op">-</span><span class="va">tmp_comm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>                                perm <span class="op">=</span> <span class="fl">1000</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp_auto_plt</span><span class="op">$</span><span class="va">plot_env</span><span class="op">$</span><span class="va">obj</span>, <span class="va">Score</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_asv_scores</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span> <span class="op">%&gt;%</span> </span>
<span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">Label</span>, .before <span class="op">=</span> <span class="va">CAP1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span><span class="op">(</span><span class="st">"Label"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_scores</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span>, </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">pvals</span> </span>
<span>                                  <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">envfit_temp_adapt_asv</span><span class="op">$</span><span class="va">vectors</span><span class="op">$</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif_hits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp_adapt_asv_signif_hits</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_asv_signif</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_asv_scores</span><span class="op">[</span><span class="va">temp_adapt_asv_scores</span><span class="op">$</span><span class="va">parameters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                                 <span class="va">temp_adapt_asv_signif_hits</span>,<span class="op">]</span></span>
<span><span class="va">temp_adapt_md_signif_all</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"metadata"</span></span>
<span><span class="va">temp_adapt_asv_signif</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">&lt;-</span> <span class="st">"ASV"</span></span>
<span><span class="va">temp_adapt_bioplot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp_adapt_md_signif_all</span>, <span class="va">temp_adapt_asv_signif</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_bioplot_data_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                  <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"metadata"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_bioplot_data_asv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temp_adapt_bioplot_data</span>, </span>
<span>                                   <span class="va">temp_adapt_bioplot_data</span><span class="op">$</span><span class="va">variable_type</span> <span class="op">==</span> <span class="st">"ASV"</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">temp_adapt_cap</span><span class="op">$</span><span class="va">CCA</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_cap2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp_adapt_cap_vals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpa1_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP1"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap1</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">cpa2_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"CAP2"</span>, <span class="st">" ("</span>, <span class="va">temp_adapt_cap2</span>, <span class="st">"%)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">temp_adapt_plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>,</span>
<span>                           colour <span class="op">=</span> <span class="va">TREAT_T</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">swel_col</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">CAP1</span>, yend <span class="op">=</span> <span class="va">CAP2</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"#191919"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_adapt_bioplot_data_md</span>, </span>
<span>            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">CAP1</span>, y <span class="op">=</span> <span class="va">CAP2</span>, label <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.1</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cpa1_lab</span>, </span>
<span>       y <span class="op">=</span> <span class="va">cpa2_lab</span><span class="op">)</span></span>
<span><span class="va">temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span> <span class="op">+</span> <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">its18_edaphic_plot</span> <span class="op">&lt;-</span> <span class="va">edaphic_plot</span></span>
<span><span class="va">its18_soil_funct_plot</span> <span class="op">&lt;-</span> <span class="va">soil_funct_plot</span></span>
<span><span class="va">its18_temp_adapt_plot</span> <span class="op">&lt;-</span> <span class="va">temp_adapt_plot</span></span>
<span></span>
<span><span class="co">### BUILD the final Plot</span></span>
<span><span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ssu18_edaphic_plot</span> <span class="op">|</span> <span class="va">ssu18_soil_funct_plot</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">its18_edaphic_plot</span> <span class="op">|</span> <span class="va">its18_soil_funct_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"a"</span>, </span>
<span>                              title <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                              subtitle <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                              caption <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span>
<span><span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_final</span> <span class="op">+</span> </span>
<span>  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,</span>
<span>             plot.tag <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">31</span><span class="op">)</span>, </span>
<span>             axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>, </span>
<span>             axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">tmp_plot_final</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_5/"</span>, </span>
<span>                filename <span class="op">=</span>  <span class="st">"Extended_Data_Figure_5.png"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">8398</span>, width <span class="op">=</span> <span class="fl">7485</span>, units <span class="op">=</span> <span class="st">'px'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span>                </span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">tmp_plot_final</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_5/"</span>, </span>
<span>                filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_5.pdf"</span>, </span>
<span>                height <span class="op">=</span> <span class="fl">8398</span>, width <span class="op">=</span> <span class="fl">7485</span>, units <span class="op">=</span> <span class="st">'px'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="extended-data-figure-6" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-6">Extended Data Figure 6</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://www.lemkesoft.de/en/products/graphicconverter/">Graphic convertor</a>.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p><img src="include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.png" class="img-fluid"></p>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_6.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.csv">Download Extended Data Figure 6 data file</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.pdf">Download Extended Data Figure 6 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Get the code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#clear workspace</span></span>
<span><span class="co">#| code-summary: "Access the code for Extended Data Figure 6"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#load data</span></span>
<span><span class="va">diversity_meta</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.csv"</span>, header <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##################### Function for arranging ggplots. </span></span>
<span><span class="co">## use png(); arrange(p1, p2, ncol=1); dev.off() to save.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="va">vp.layout</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span><span class="op">(</span>layout.pos.row <span class="op">=</span> <span class="va">x</span>, layout.pos.col <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="va">arrange_ggplot2</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">...</span>,</span>
<span>           <span class="va">nrow</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>           <span class="va">ncol</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>           <span class="va">as.table</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dots</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">nrow</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">ncol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">nrow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="va">ncol</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="va">nrow</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">nrow</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">nrow</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="va">ncol</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">ncol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">ncol</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="va">nrow</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co">## NOTE see n2mfrow in grDevices for possible alternative</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grid/viewports.html">pushViewport</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.layout.html">grid.layout</a></span><span class="op">(</span><span class="va">nrow</span>, <span class="va">ncol</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">ii.p</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">ii.row</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nrow</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">ii.table.row</span> <span class="op">&lt;-</span> <span class="va">ii.row</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">as.table</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">ii.table.row</span> <span class="op">&lt;-</span> <span class="va">nrow</span> <span class="op">-</span> <span class="va">ii.table.row</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">ii.col</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">ncol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">ii.table</span> <span class="op">&lt;-</span> <span class="va">ii.p</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">ii.p</span> <span class="op">&gt;</span> <span class="va">n</span><span class="op">)</span></span>
<span>          <span class="kw">break</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">dots</span><span class="op">[[</span><span class="va">ii.table</span><span class="op">]</span><span class="op">]</span>, vp <span class="op">=</span> <span class="fu">vp.layout</span><span class="op">(</span><span class="va">ii.table.row</span>, <span class="va">ii.col</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">ii.p</span> <span class="op">&lt;-</span> <span class="va">ii.p</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co">#######################################################################</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#long format</span></span>
<span><span class="va">diversity_meta.long</span> <span class="op">&lt;-</span> <span class="va">diversity_meta</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather</span><span class="op">(</span></span>
<span>    key <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    value <span class="op">=</span> <span class="va">value</span>,</span>
<span>    <span class="op">-</span><span class="va">index</span>,</span>
<span>    <span class="op">-</span><span class="va">PLOT</span>,</span>
<span>    <span class="op">-</span><span class="va">SEASON</span>,</span>
<span>    <span class="op">-</span><span class="va">TREAT</span>,</span>
<span>    <span class="op">-</span><span class="va">PAIR</span>,</span>
<span>    <span class="op">-</span><span class="va">TEMP_AV_ACROSSPLOTS</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">diversity_meta.long</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">diversity_meta.long</span><span class="op">$</span><span class="va">measure</span><span class="op">)</span></span>
<span><span class="va">diversity_meta.long</span><span class="op">$</span><span class="va">TEMP_AV_ACROSSPLOTS</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">diversity_meta.long</span><span class="op">$</span><span class="va">TEMP_AV_ACROSSPLOTS</span><span class="op">)</span></span>
<span><span class="co">## NEEDed for Figure 2</span></span>
<span><span class="co">#saveRDS(diversity_meta.long, "include/pub/MAIN/diversity_meta.long.rds")</span></span>
<span></span>
<span><span class="co">#subset of long format, with values to plot in facet - in order</span></span>
<span></span>
<span><span class="co">#edaphic metadata</span></span>
<span><span class="va">diversity_meta.env</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>    <span class="va">diversity_meta.long</span>,</span>
<span>    <span class="va">measure</span> <span class="op">==</span> <span class="st">"pH"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"H2O"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"NH4"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"NO3"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"resinP"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"DOC"</span> <span class="op">|</span> <span class="va">measure</span> <span class="op">==</span> <span class="st">"DON"</span> <span class="op">|</span> <span class="va">measure</span> <span class="op">==</span> <span class="st">"ECEC"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#enzymes per mic C</span></span>
<span><span class="va">diversity_meta.enzmic</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>    <span class="va">diversity_meta.long</span>,</span>
<span>    <span class="va">measure</span> <span class="op">==</span> <span class="st">"AG_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"BG_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"BIS_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"CEL_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"MUP_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"NA_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"S_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"XYL_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"LEU_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"POX_micC"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"micC"</span> <span class="op">|</span> <span class="va">measure</span> <span class="op">==</span> <span class="st">"micN"</span> <span class="op">|</span> <span class="va">measure</span> <span class="op">==</span> <span class="st">"micP"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#Temp response- growth and enzymes</span></span>
<span><span class="va">diversity_meta.Tresponse</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span></span>
<span>    <span class="va">diversity_meta.long</span>,</span>
<span>    <span class="va">measure</span> <span class="op">==</span> <span class="st">"Tmin"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"SI"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"CUEcn"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"CUEcp"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"AG_Q10"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"BG_Q10"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"BIS_Q10"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"CEL_Q10"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"MUP_Q10"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"NA_Q10"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"S_Q10"</span> <span class="op">|</span></span>
<span>      <span class="va">measure</span> <span class="op">==</span> <span class="st">"XYL_Q10"</span> <span class="op">|</span> <span class="va">measure</span> <span class="op">==</span> <span class="st">"LEU_Q10"</span> <span class="op">|</span> <span class="va">measure</span> <span class="op">==</span> <span class="st">"POX_Q10"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">diversity_meta.Tresponse</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>    <span class="va">diversity_meta.Tresponse</span><span class="op">$</span><span class="va">measure</span>,</span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Tmin"</span>,</span>
<span>      <span class="st">"SI"</span>,</span>
<span>      <span class="st">"CUEcn"</span>,</span>
<span>      <span class="st">"CUEcp"</span>,</span>
<span>      <span class="st">"AG_Q10"</span>,</span>
<span>      <span class="st">"BG_Q10"</span>,</span>
<span>      <span class="st">"CEL_Q10"</span>,</span>
<span>      <span class="st">"XYL_Q10"</span>,</span>
<span>      <span class="st">"POX_Q10"</span>,</span>
<span>      <span class="st">"NA_Q10"</span>,</span>
<span>      <span class="st">"LEU_Q10"</span>,</span>
<span>      <span class="st">"MUP_Q10"</span>,</span>
<span>      <span class="st">"BIS_Q10"</span>,</span>
<span>      <span class="st">"S_Q10"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#relabel</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.env</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.env</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"control"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.env</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.env</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+3°C"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.env</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.env</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W8"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+8°C"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.Tresponse</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.Tresponse</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"control"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.Tresponse</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.Tresponse</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+3°C"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.Tresponse</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.Tresponse</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W8"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+8°C"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.enzmic</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.enzmic</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"control"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.enzmic</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.enzmic</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+3°C"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.enzmic</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">diversity_meta.enzmic</span> <span class="op">$</span><span class="va">TREAT</span><span class="op">)</span> <span class="op">==</span> <span class="st">"W8"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"+8°C"</span></span>
<span></span>
<span><span class="co">#reorder factor levels for plots</span></span>
<span><span class="va">diversity_meta.env</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>    <span class="va">diversity_meta.env</span><span class="op">$</span><span class="va">measure</span>,</span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"H2O"</span>, <span class="st">"pH"</span>, <span class="st">"ECEC"</span>, <span class="st">"DOC"</span>, <span class="st">"DON"</span>, <span class="st">"NO3"</span>, <span class="st">"NH4"</span>, <span class="st">"resinP"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">diversity_meta.Tresponse</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>    <span class="va">diversity_meta.Tresponse</span><span class="op">$</span><span class="va">measure</span>,</span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Tmin"</span>,</span>
<span>      <span class="st">"SI"</span>,</span>
<span>      <span class="st">"CUEcn"</span>,</span>
<span>      <span class="st">"CUEcp"</span>,</span>
<span>      <span class="st">"AG_Q10"</span>,</span>
<span>      <span class="st">"BG_Q10"</span>,</span>
<span>      <span class="st">"CEL_Q10"</span>,</span>
<span>      <span class="st">"XYL_Q10"</span>,</span>
<span>      <span class="st">"POX_Q10"</span>,</span>
<span>      <span class="st">"NA_Q10"</span>,</span>
<span>      <span class="st">"LEU_Q10"</span>,</span>
<span>      <span class="st">"MUP_Q10"</span>,</span>
<span>      <span class="st">"BIS_Q10"</span>,</span>
<span>      <span class="st">"S_Q10"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">diversity_meta.enzmic</span><span class="op">$</span><span class="va">measure</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>    <span class="va">diversity_meta.enzmic</span><span class="op">$</span><span class="va">measure</span>,</span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"micC"</span>,</span>
<span>      <span class="st">"micN"</span>,</span>
<span>      <span class="st">"micP"</span>,</span>
<span>      <span class="st">"AG_micC"</span>,</span>
<span>      <span class="st">"BG_micC"</span>,</span>
<span>      <span class="st">"CEL_micC"</span>,</span>
<span>      <span class="st">"XYL_micC"</span>,</span>
<span>      <span class="st">"POX_micC"</span>,</span>
<span>      <span class="st">"NA_micC"</span>,</span>
<span>      <span class="st">"LEU_micC"</span>,</span>
<span>      <span class="st">"MUP_micC"</span>,</span>
<span>      <span class="st">"BIS_micC"</span>,</span>
<span>      <span class="st">"S_micC"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plot.diversity_meta.env</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">diversity_meta.env</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TREAT</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">diversity_meta.env</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">TREAT</span>, <span class="va">value</span> , fill <span class="op">=</span> <span class="va">TREAT</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    outlier.colour <span class="op">=</span> <span class="st">"grey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span></span>
<span>    facets <span class="op">=</span>  <span class="va">.</span> <span class="op">~</span> <span class="va">measure</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        H2O <span class="op">=</span> <span class="st">"Soil moisture (g g-1)"</span>,</span>
<span>        pH <span class="op">=</span> <span class="st">"pH"</span>,</span>
<span>        ECEC <span class="op">=</span> <span class="st">"ECEC (cmolc/kg)"</span>,</span>
<span>        NH4 <span class="op">=</span> <span class="st">"NH4 (mg kg-1)"</span>,</span>
<span>        NO3 <span class="op">=</span> <span class="st">"NO3 (mg kg-1)"</span>,</span>
<span>        resinP <span class="op">=</span> <span class="st">"resin P (mg kg-1)"</span>,</span>
<span>        DOC <span class="op">=</span> <span class="st">"DOC (mg kg-1)"</span>,</span>
<span>        DON <span class="op">=</span> <span class="st">"DON (mg kg-1)"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"a) Soil properties"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">1.5</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, color <span class="op">=</span> <span class="st">"black"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## enzyme data per mic C</span></span>
<span><span class="va">plot.diversity_meta.enzmic</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">diversity_meta.enzmic</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TREAT</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">diversity_meta.enzmic</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">TREAT</span>, <span class="va">value</span> , fill <span class="op">=</span> <span class="va">TREAT</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    outlier.colour <span class="op">=</span> <span class="st">"grey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span></span>
<span>    facets <span class="op">=</span>  <span class="va">.</span> <span class="op">~</span> <span class="va">measure</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        micC <span class="op">=</span> <span class="st">"Mic C (mg/kg)"</span>,</span>
<span>        micN <span class="op">=</span> <span class="st">"Mic N (mg/kg)"</span>,</span>
<span>        micP <span class="op">=</span> <span class="st">"Mic P (mg/kg)"</span>,</span>
<span>        AG_micC <span class="op">=</span> <span class="st">"AGase"</span>,</span>
<span>        BG_micC <span class="op">=</span> <span class="st">"BGase"</span>,</span>
<span>        CEL_micC <span class="op">=</span> <span class="st">"CEase"</span>,</span>
<span>        XYL_micC <span class="op">=</span> <span class="st">"XYase"</span>,</span>
<span>        POX_micC <span class="op">=</span> <span class="st">"PXase"</span>,</span>
<span>        NA_micC <span class="op">=</span> <span class="st">"Nase"</span>,</span>
<span>        LEU_micC <span class="op">=</span> <span class="st">"LPase"</span>,</span>
<span>        MUP_micC <span class="op">=</span> <span class="st">"Pase"</span>,</span>
<span>        BIS_micC <span class="op">=</span> <span class="st">"BPase"</span>,</span>
<span>        S_micC <span class="op">=</span> <span class="st">"Sase"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"b) Microbial biomass &amp; enzyme activity per unit microbial C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">1.5</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"black"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.23</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Temp response</span></span>
<span><span class="va">plot.diversity_meta.Tresponse</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">diversity_meta.Tresponse</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TREAT</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">diversity_meta.Tresponse</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">TREAT</span>, <span class="va">value</span> , fill <span class="op">=</span> <span class="va">TREAT</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    outlier.colour <span class="op">=</span> <span class="st">"grey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span></span>
<span>    facets <span class="op">=</span>  <span class="va">.</span> <span class="op">~</span> <span class="va">measure</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        Tmin <span class="op">=</span> <span class="st">"Tmin (°C)"</span>,</span>
<span>        SI <span class="op">=</span> <span class="st">"SI growth"</span>,</span>
<span>        CUEcn <span class="op">=</span> <span class="st">"CUE(C:N)"</span>,</span>
<span>        CUEcp <span class="op">=</span> <span class="st">"CUE(C:P)"</span>,</span>
<span>        AG_Q10 <span class="op">=</span> <span class="st">"AG Q10"</span>,</span>
<span>        BG_Q10 <span class="op">=</span> <span class="st">"BG Q10"</span>,</span>
<span>        CEL_Q10 <span class="op">=</span> <span class="st">"CE Q10"</span>,</span>
<span>        XYL_Q10 <span class="op">=</span> <span class="st">"XY Q10"</span>,</span>
<span>        POX_Q10 <span class="op">=</span> <span class="st">"PX Q10"</span>,</span>
<span>        NA_Q10 <span class="op">=</span> <span class="st">"N Q10"</span>,</span>
<span>        LEU_Q10 <span class="op">=</span> <span class="st">"LP Q10"</span>,</span>
<span>        MUP_Q10 <span class="op">=</span> <span class="st">"P Q10"</span>,</span>
<span>        BIS_Q10 <span class="op">=</span> <span class="st">"BP Q10"</span>,</span>
<span>        S_Q10 <span class="op">=</span> <span class="st">"S Q10"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#71b222"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#b22271"</span>,</span>
<span>    <span class="st">"#2271b2"</span>,</span>
<span>    <span class="st">"#2271b2"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'Treatment: warming level'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"c) Microbial community temperature sensitivity: growth, carbon-use-efficiency &amp; enzyme activity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">15</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">1.5</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"black"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">18</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">##combined plots</span></span>
<span><span class="va">plot.diversity_meta.all</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">arrange_ggplot2</span><span class="op">(</span></span>
<span>    <span class="va">plot.diversity_meta.env</span>,</span>
<span>    <span class="va">plot.diversity_meta.enzmic</span>,</span>
<span>    <span class="va">plot.diversity_meta.Tresponse</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">layout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">12</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">13</span>, b <span class="op">=</span> <span class="fl">24</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">22</span><span class="op">)</span>,</span>
<span>  <span class="fu">area</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">25</span>, b <span class="op">=</span> <span class="fl">36</span>, l <span class="op">=</span> <span class="fl">1</span>, r <span class="op">=</span> <span class="fl">22</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">layout</span><span class="op">)</span></span>
<span><span class="va">combo_plot</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">plot.diversity_meta.env</span> <span class="op">+</span> </span>
<span>           <span class="va">plot.diversity_meta.enzmic</span> <span class="op">+</span> <span class="va">plot.diversity_meta.Tresponse</span>  <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>design <span class="op">=</span> <span class="va">layout</span><span class="op">)</span>  </span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_6/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_6.png"</span>, height <span class="op">=</span> <span class="fl">21.59</span>, width <span class="op">=</span> <span class="fl">27.94</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">combo_plot</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_6/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_6.pdf"</span>, height <span class="op">=</span> <span class="fl">21.59</span>, width <span class="op">=</span> <span class="fl">27.94</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="extended-data-figure-7" class="level2"><h2 class="anchored" data-anchor-id="extended-data-figure-7">Extended Data Figure 7</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://www.lemkesoft.de/en/products/graphicconverter/">Graphic convertor</a>.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p><img src="include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.png" class="img-fluid"></p>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p><img src="paper/Extended_Data/FIGURES/Extended_Data_Fig_7.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.csv">Download Extended Data Figure 7 data file</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.pdf">Download Extended Data Figure 7 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Extended Data Figure 7</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#clear workspace</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##############################################</span></span>
<span><span class="va">enzvmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.csv"</span>, header <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">enzvmax</span><span class="op">$</span><span class="va">Plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">enzvmax</span><span class="op">$</span><span class="va">Plot</span><span class="op">)</span></span>
<span><span class="va">enzvmax</span><span class="op">$</span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">enzvmax</span><span class="op">$</span><span class="va">season</span><span class="op">)</span></span>
<span><span class="va">enzvmax</span><span class="op">$</span><span class="va">Treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">enzvmax</span><span class="op">$</span><span class="va">Treat</span><span class="op">)</span></span>
<span><span class="va">enzvmax</span><span class="op">$</span><span class="va">enzyme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">enzvmax</span><span class="op">$</span><span class="va">enzyme</span><span class="op">)</span></span>
<span></span>
<span><span class="co">############ Plot all enzyme activities (extended data figure 7)</span></span>
<span></span>
<span><span class="va">plot.vmax</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">enzvmax</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">assayT</span>, y <span class="op">=</span> <span class="va">Vmax</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">assayT</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Vmax</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Treat</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co">## forcats::fct_relevel(Treat, "Control", "+3°C", "+8°C")  </span></span>
<span><span class="co">## Added by JJS to order facets  </span></span>
<span><span class="co">## Changed color order as well  </span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span>  <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">Treat</span>, <span class="st">"Control"</span>, <span class="st">"+3°C"</span>, <span class="st">"+8°C"</span><span class="op">)</span> <span class="op">~</span> <span class="va">enzyme</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>             ncol <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#2271b2"</span>  <span class="co"># blue</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span>    <span class="st">"#2271b2"</span> <span class="co"># blue</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_cl_normal</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"errorbar"</span>,</span>
<span>    fun.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_smooth</span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey20"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'Enzyme Vmax'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">'Assay temperature (°C)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    strip.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"black"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>      hjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      vjust <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"plain"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">plot.vmax</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_7/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_7.png"</span>, height <span class="op">=</span> <span class="fl">21.59</span>, width <span class="op">=</span> <span class="fl">27.94</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">plot.vmax</span>, path <span class="op">=</span> <span class="st">"include/pub/EXD/EXD_Figure_7/"</span>, filename <span class="op">=</span> <span class="st">"Extended_Data_Figure_7.pdf"</span>, height <span class="op">=</span> <span class="fl">21.59</span>, width <span class="op">=</span> <span class="fl">27.94</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'cm'</span>, dpi <span class="op">=</span> <span class="fl">600</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="supplementary-material" class="level1"><h1>Supplementary Material</h1>
<section id="supplementary-figure-1" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-1">Supplementary Figure 1</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_1.png" class="img-fluid"></p>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_main_ssu.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_1.rds">Download Supplementary Figure 1 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_1.pdf">Download Supplementary Figure 1 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Supplementary Figure 1</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">119</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_work</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/SOM/Supplementary_Figure_1.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 1) Get all Class-level Proteobacteria names</span></span>
<span><span class="va">ssu18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">subset_taxa</span><span class="op">(</span><span class="va">tmp_get</span>, <span class="va">Phylum</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get_taxa</span> <span class="op">&lt;-</span> <span class="fu">get_taxa_unique</span><span class="op">(</span><span class="va">tmp_df</span>,</span>
<span>                                     taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                                     errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_get_taxa</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>        <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Alphaproteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Alphaproteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Gammaproteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gammaproteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Zetaproteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Zetaproteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span></span>
<span>                 <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p_Proteobacteria"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p_Proteobacteria"</span><span class="op">)</span></span>
<span>      <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span></span>
<span>  <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span></span>
<span>    <span class="fu">get_taxa_unique</span><span class="op">(</span></span>
<span>      <span class="va">tmp_get</span>,</span>
<span>      taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>      errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">order</span>, <span class="va">phylum</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 3) In order to use `microeco`, we need to add the rank designation as a prefix to each taxa. </span></span>
<span><span class="co">## For example, `Actinobacteriota` is changed to `p__Actinobacteriota`. </span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sam_data</span> <span class="op">&lt;-</span> <span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"p_Proteobacteria"</span>, <span class="st">"Proteobacteria"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="va">tmp_tax_data</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span></span>
<span>      <span class="va">tmp_tax_data</span>,</span>
<span>      <span class="va">gsub</span>,</span>
<span>      pattern <span class="op">=</span> <span class="st">"^[k | p | c | o | f]_.*"</span>,</span>
<span>      replacement <span class="op">=</span> <span class="st">""</span>,</span>
<span>      fixed <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"k__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"c__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"o__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"f__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"g__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>,</span>
<span>                     <span class="fu">phy_tree</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>,</span>
<span>                     <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span>,</span>
<span>                     <span class="va">tmp_sam_data</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_ps</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 4) Next, we need to covert each `phyloseq object` to a `microtable class`.  </span></span>
<span><span class="co">## The microtable class is the basic data structure for the `microeco` package </span></span>
<span><span class="co">## and designed to store basic information from all the downstream analyses </span></span>
<span><span class="co">## (e.g, alpha diversity, beta diversity, etc.). </span></span>
<span><span class="co">## We use the [file2meco](https://github.com/ChiLiubio/file2meco) to read the phyloseq </span></span>
<span><span class="co">## object and convert into a microtable object. We can add `_me` as a suffix </span></span>
<span><span class="co">## to each object to distiguish it from its' phyloseq counterpart. </span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_otu_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_taxonomy_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_phylo_tree</span> <span class="op">&lt;-</span> <span class="fu">phy_tree</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="va">tmp_taxonomy_table</span> <span class="op">%&lt;&gt;%</span> <span class="va">tidy_taxonomy</span></span>
<span>  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="va">microtable</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    sample_table <span class="op">=</span> <span class="va">tmp_sample_info</span>,</span>
<span>    otu_table <span class="op">=</span> <span class="va">tmp_otu_table</span>,</span>
<span>    tax_table <span class="op">=</span> <span class="va">tmp_taxonomy_table</span>,</span>
<span>    phylo_tree <span class="op">=</span> <span class="va">tmp_phylo_tree</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="va">tax_table</span> <span class="op">%&lt;&gt;%</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Kingdom</span> <span class="op">==</span> <span class="st">"k__Archaea"</span> <span class="op">|</span></span>
<span>                                            <span class="va">Kingdom</span> <span class="op">==</span> <span class="st">"k__Bacteria"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">filter_pollution</span><span class="op">(</span>taxa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mitochondria"</span>, <span class="st">"chloroplast"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span>
<span></span>
<span><span class="co">## 5) Now, we calculate the taxa abundance at each taxonomic rank using </span></span>
<span><span class="co">## `cal_abund()`. This function return a list called `taxa_abund` containing </span></span>
<span><span class="co">## several data frame of the abundance information at each taxonomic rank. </span></span>
<span><span class="co">## The list is stored in the microtable object automatically. </span></span>
<span><span class="co">## It’s worth noting that the `cal_abund()` function can be used to solve </span></span>
<span><span class="co">## some complex cases, such as supporting both the relative and absolute </span></span>
<span><span class="co">## abundance calculation and selecting the partial taxonomic columns. More </span></span>
<span><span class="co">## information can be found in the description of the </span></span>
<span><span class="co">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span></span>
<span><span class="co">## In the same loop we also create a `trans_abund` class, which is used to </span></span>
<span><span class="co">## transform taxonomic abundance data for plotting.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_me</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_me</span><span class="op">$</span><span class="fu">cal_abund</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">tmp_me_abund</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_me</span>,</span>
<span>                    taxrank <span class="op">=</span> <span class="st">"Phylum"</span>,</span>
<span>                    ntaxa <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>  <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span></span>
<span>  <span class="va">tmp_me_abund_gr</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>      dataset <span class="op">=</span> <span class="va">tmp_me</span>,</span>
<span>      taxrank <span class="op">=</span> <span class="st">"Phylum"</span>,</span>
<span>      ntaxa <span class="op">=</span> <span class="fl">12</span>,</span>
<span>      groupmean <span class="op">=</span> <span class="st">"TEMP"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_me_abund</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name_gr</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_gr</span>, <span class="va">tmp_me_abund_gr</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 6) I prefer to specify the order of taxa in these kinds of plots. </span></span>
<span><span class="co">## We can look the top `ntaxa` (defined above) by accessing the </span></span>
<span><span class="co">## `data_taxanames` character vector of each microtable object.</span></span>
<span><span class="co">## Now we can define the order. Once we do that, we will override the </span></span>
<span><span class="co">## `data_taxanames` character vectors with the reordered vectors.</span></span>
<span></span>
<span><span class="va">ssu18_ps_work_tax_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alphaproteobacteria"</span>, <span class="st">"Gammaproteobacteria"</span>, </span>
<span>                           <span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, </span>
<span>                           <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Myxococcota"</span>, </span>
<span>                           <span class="st">"Verrucomicrobiota"</span>, <span class="st">"Chloroflexi"</span>, </span>
<span>                           <span class="st">"Planctomycetota"</span>, <span class="st">"Methylomirabilota"</span>, </span>
<span>                           <span class="st">"Crenarchaeota"</span><span class="op">)</span></span>
<span><span class="co">## 7) And one more little step before plotting. </span></span>
<span><span class="co">## Here we  **a**) specify a custom color palette and  </span></span>
<span><span class="co">## **b**) specify the sample order. </span></span>
<span></span>
<span><span class="va">top_level</span> <span class="op">&lt;-</span> <span class="st">"Phylum"</span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span><span class="va">ssu18_colvec.tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00463C"</span>,<span class="st">"#FFD5FD"</span>,<span class="st">"#00A51C"</span>,<span class="st">"#C80B2A"</span>,<span class="st">"#00C7F9"</span>,</span>
<span>                      <span class="st">"#FFA035"</span>, <span class="st">"#ED0DFD"</span>,<span class="st">"#0063E5"</span>,<span class="st">"#5FFFDE"</span>,<span class="st">"#C00B6F"</span>,</span>
<span>                      <span class="st">"#00A090"</span>,<span class="st">"#FF95BA"</span><span class="op">)</span></span>
<span><span class="va">ssu18_samp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, </span>
<span>                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, </span>
<span>                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P05_D00_010_W3C"</span>, <span class="st">"P07_D00_010_W3D"</span>, </span>
<span>                      <span class="st">"P09_D00_010_W3E"</span>, <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, </span>
<span>                      <span class="st">"P05_D00_010_W8C"</span>, <span class="st">"P07_D00_010_W8D"</span>, <span class="st">"P09_D00_010_W8E"</span><span class="op">)</span></span>
<span><span class="co">## 8) Now we can generate plots (in a loop) for each faceted data set.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span></span>
<span>  <span class="va">tmp_facet_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span></span>
<span>      color_values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span>,</span>
<span>      others_color <span class="op">=</span> <span class="st">"#323232"</span>,</span>
<span>      facet <span class="op">=</span> <span class="st">"TEMP"</span>,</span>
<span>      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      xtext_type_hor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      xtext_size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span>,</span>
<span>      order_x <span class="op">=</span> <span class="va">ssu18_samp_order</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_facet_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_facet_name</span>, <span class="va">tmp_facet_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Then add a little formatting to the faceted plots.</span></span>
<span></span>
<span><span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work_facet_plot"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="va">top_level</span>,</span>
<span>      reverse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      keywidth <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>      keyheight <span class="op">=</span> <span class="fl">0.7</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>      legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>      axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>      strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## And now plots for the group-means sets. We can use the same </span></span>
<span><span class="co">## taxa order since that should not have changed.</span></span>
<span></span>
<span><span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work_group_plot"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span></span>
<span>  <span class="va">tmp_group_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span></span>
<span>      color_values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span>,</span>
<span>      others_color <span class="op">=</span> <span class="st">"#323232"</span>,</span>
<span>      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      xtext_type_hor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      xtext_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_group_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_group_name</span>, <span class="va">tmp_group_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Let's also add a little formatting to the groupmean plots.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative Abundance (% total reads)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## 10) Finally we use the `patchwork` package to combine the </span></span>
<span><span class="co">## two plots and customize the look.</span></span>
<span><span class="co">## single index that acts as an index for referencing elements (variables) in a list</span></span>
<span><span class="co">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span></span>
<span><span class="va">var_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="va">ssu18_data_sets</span>,</span>
<span>                 var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FULL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span>  <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_plot_final_name</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>, <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_set_type</span> <span class="op">&lt;-</span> <span class="va">var_list</span><span class="op">$</span><span class="va">var2</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">tmp_p_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_m_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_p_plot</span> <span class="op">+</span> <span class="va">tmp_m_plot</span></span>
<span>  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_final</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      plot.tag <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_plot_final_name</span>, <span class="va">tmp_plot_final</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> </span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>,  <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>     <span class="va">tmp_plot_final</span>, </span>
<span>     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.png"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>     <span class="va">tmp_plot_final</span>, </span>
<span>     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.pdf"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/SOM/ssu18_ps_work_tax_div_bar_plots.png"</span>, </span>
<span>            <span class="st">"include/pub/SOM/Supplementary_Figure_1.png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/SOM/ssu18_ps_work_tax_div_bar_plots.pdf"</span>, </span>
<span>            <span class="st">"include/pub/SOM/Supplementary_Figure_1.pdf"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-2" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-2">Supplementary Figure 2</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_2.png" class="img-fluid"></p>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_main_its.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_2.rds">Download Supplementary Figure 2 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_2.pdf">Download Supplementary Figure 2 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Supplementary Figure 2</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">its18_ps_work</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/SOM/Supplementary_Figure_2.rds"</span><span class="op">)</span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span><span class="va">its18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_work"</span><span class="op">)</span></span>
<span><span class="co">## 1) Choose the **number** of taxa to display and the </span></span>
<span><span class="co">## taxonomic **level**. Aggregate the rest into "Other".</span></span>
<span><span class="va">top_hits</span> <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span><span class="va">top_level</span> <span class="op">&lt;-</span> <span class="st">"Order"</span></span>
<span><span class="co">## As above, in order to use `microeco`, we need to add the rank </span></span>
<span><span class="co">## designation as a prefix to each taxa. For example, `Basidiomycota` </span></span>
<span><span class="co">## is changed to `p__Basidiomycota`. </span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sam_data</span> <span class="op">&lt;-</span> <span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_ID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">ASV_SEQ</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"k__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Kingdom</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Phylum</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"c__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Class</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"o__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Order</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"f__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Family</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"g__"</span>, <span class="va">tmp_tax_data</span><span class="op">$</span><span class="va">Genus</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_ps</span> <span class="op">&lt;-</span> <span class="fu">phyloseq</span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>,</span>
<span>                     <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_tax_data</span><span class="op">)</span>,</span>
<span>                     <span class="va">tmp_sam_data</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_ps</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_otu_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_taxonomy_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span> <span class="op">&lt;-</span> <span class="va">microtable</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sample_table <span class="op">=</span> <span class="va">tmp_sample_info</span>,</span>
<span>                                otu_table <span class="op">=</span> <span class="va">tmp_otu_table</span>,</span>
<span>                                tax_table <span class="op">=</span> <span class="va">tmp_taxonomy_table</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="va">tax_table</span> <span class="op">%&lt;&gt;%</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">Kingdom</span> <span class="op">==</span> <span class="st">"k__Fungi"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="va">tmp_dataset</span><span class="op">$</span><span class="fu">tidy_dataset</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_dataset</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span>
<span></span>
<span><span class="co">## 5) Now, we calculate the taxa abundance at each taxonomic </span></span>
<span><span class="co">## rank using `cal_abund()`. This function return a list called </span></span>
<span><span class="co">## `taxa_abund` containing several data frame of the abundance </span></span>
<span><span class="co">## information at each taxonomic rank. The list is stored in the </span></span>
<span><span class="co">## microtable object automatically. It’s worth noting that the </span></span>
<span><span class="co">## `cal_abund()` function can be used to solve some complex cases, </span></span>
<span><span class="co">## such as supporting both the relative and absolute abundance </span></span>
<span><span class="co">## calculation and selecting the partial taxonomic columns. </span></span>
<span><span class="co">## More information can be found in the description of the </span></span>
<span><span class="co">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span></span>
<span><span class="co">## In the same loop we also create a `trans_abund` class, which </span></span>
<span><span class="co">## is used to transform taxonomic abundance data for plotting.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_me</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_me</span><span class="op">$</span><span class="fu">cal_abund</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">tmp_me_abund</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">tmp_me</span>,</span>
<span>                    taxrank <span class="op">=</span> <span class="va">top_level</span>,</span>
<span>                    ntaxa <span class="op">=</span> <span class="va">top_hits</span><span class="op">)</span></span>
<span>  <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_me_abund</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span></span>
<span>  <span class="va">tmp_me_abund_gr</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">trans_abund</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>      dataset <span class="op">=</span> <span class="va">tmp_me</span>,</span>
<span>      taxrank <span class="op">=</span> <span class="va">top_level</span>,</span>
<span>      ntaxa <span class="op">=</span> <span class="va">top_hits</span>,</span>
<span>      groupmean <span class="op">=</span> <span class="st">"TEMP"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_me_abund_gr</span><span class="op">$</span><span class="va">abund_data</span><span class="op">$</span><span class="va">Abundance</span> <span class="op">/</span> <span class="fl">100</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_me_abund</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name_gr</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name_gr</span>, <span class="va">tmp_me_abund_gr</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## 6) I prefer to specify the order of taxa in these kinds of plots. </span></span>
<span><span class="co">## We can look the top `ntaxa` (defined above) by accessing the </span></span>
<span><span class="co">## `data_taxanames` character vector of each microtable object.</span></span>
<span></span>
<span><span class="va">its18_ps_work_tax_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"k_Fungi"</span>,  <span class="st">"p_Ascomycota"</span>,  <span class="st">"c_Agaricomycetes"</span>, <span class="st">"Agaricales"</span>,  </span>
<span>  <span class="st">"Archaeorhizomycetales"</span>,  <span class="st">"Capnodiales"</span>,  <span class="st">"Eurotiales"</span>,  <span class="st">"Geastrales"</span>,  </span>
<span>  <span class="st">"Glomerales"</span>,  <span class="st">"Helotiales"</span>, <span class="st">"Hypocreales"</span>,  <span class="st">"Saccharomycetales"</span>,  </span>
<span>  <span class="st">"Trichosporonales"</span>,  <span class="st">"Xylariales"</span><span class="op">)</span><span class="op">)</span>   </span>
<span><span class="co">## And one more little step before plotting. Here we  </span></span>
<span><span class="co">## **a**) specify a custom color palette and  </span></span>
<span><span class="co">## **b**) specify the sample order. </span></span>
<span></span>
<span><span class="va">its18_colvec.tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#323232"</span>, <span class="st">"#004949"</span>, <span class="st">"#924900"</span>, <span class="st">"#490092"</span>, </span>
<span>                      <span class="st">"#6db6ff"</span>, <span class="st">"#920000"</span>, <span class="st">"#ffb6db"</span>, <span class="st">"#24ff24"</span>, </span>
<span>                      <span class="st">"#006ddb"</span>, <span class="st">"#db6d00"</span>, <span class="st">"#b66dff"</span>, <span class="st">"#ffff6d"</span>, </span>
<span>                      <span class="st">"#009292"</span>, <span class="st">"#b6dbff"</span>, <span class="st">"#ff6db6"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_samp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, </span>
<span>                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, </span>
<span>                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P07_D00_010_W3D"</span>, <span class="st">"P09_D00_010_W3E"</span>, </span>
<span>                      <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, <span class="st">"P05_D00_010_W8C"</span>, </span>
<span>                      <span class="st">"P07_D00_010_W8D"</span><span class="op">)</span></span>
<span><span class="co">## 8) Now we can generate plots (in a loop) for each faceted data set.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span></span>
<span>  <span class="va">tmp_facet_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span></span>
<span>      color_values <span class="op">=</span> <span class="va">its18_colvec.tax</span>,</span>
<span>      others_color <span class="op">=</span> <span class="st">"#323232"</span>,</span>
<span>      facet <span class="op">=</span> <span class="st">"TEMP"</span>,</span>
<span>      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      xtext_type_hor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      xtext_size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span>,</span>
<span>      order_x <span class="op">=</span> <span class="va">its18_samp_order</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_facet_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_facet_name</span>, <span class="va">tmp_facet_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Then add a little formatting to the faceted plots.</span></span>
<span><span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_work_facet_plot"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="va">top_level</span>,</span>
<span>      reverse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      keywidth <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>      keyheight <span class="op">=</span> <span class="fl">0.7</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>      legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>      axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>      strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## And now plots for the groupmeans sets. </span></span>
<span><span class="co">## We can use the same taxa order since that </span></span>
<span><span class="co">## should not have changed.</span></span>
<span><span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"its18_ps_work_group_plot"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_me_abund_group"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax_ord"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_abund</span><span class="op">$</span><span class="va">data_taxanames</span> <span class="op">&lt;-</span> <span class="va">tmp_tax_order</span></span>
<span>  <span class="va">tmp_group_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">tmp_abund</span><span class="op">$</span><span class="fu">plot_bar</span><span class="op">(</span></span>
<span>      color_values <span class="op">=</span> <span class="va">its18_colvec.tax</span>,</span>
<span>      others_color <span class="op">=</span> <span class="st">"#323232"</span>,</span>
<span>      xtext_keep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      xtext_type_hor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      legend_text_italic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      xtext_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      facet_color <span class="op">=</span> <span class="st">"#cccccc"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_group_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_group_name</span>, <span class="va">tmp_group_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## Let's also add a little formatting to the groupmean plots.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="va">tmp_get</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative Abundance (% total reads)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## 10) Finally we use the `patchwork` package to combine the </span></span>
<span><span class="co">## two plots and customize the look.</span></span>
<span><span class="co">## single index that acts as an index for referencing elements (variables) in a list</span></span>
<span><span class="co">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span></span>
<span><span class="va">var_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>var1 <span class="op">=</span> <span class="va">its18_data_sets</span>,</span>
<span>                 var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FULL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span>  <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_plot_final_name</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>, <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_set_type</span> <span class="op">&lt;-</span> <span class="va">var_list</span><span class="op">$</span><span class="va">var2</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">tmp_p_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_group_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_m_plot</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">var_list</span><span class="op">$</span><span class="va">var1</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_facet_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_p_plot</span> <span class="op">+</span> <span class="va">tmp_m_plot</span></span>
<span>  <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_final</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      plot.tag <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_plot_final_name</span>, <span class="va">tmp_plot_final</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">its18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="va">tmp_plot_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">top_level</span>,  <span class="st">"_plot_final"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>     <span class="va">tmp_plot_final</span>, </span>
<span>     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.png"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>     <span class="va">tmp_plot_final</span>, </span>
<span>     file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.pdf"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>     height <span class="op">=</span> <span class="fl">2544</span>, width <span class="op">=</span> <span class="fl">5043</span>, units <span class="op">=</span> <span class="st">'px'</span>, bg <span class="op">=</span> <span class="st">"white"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/SOM/its18_ps_work_tax_div_bar_plots.png"</span>, </span>
<span>            <span class="st">"include/pub/SOM/Supplementary_Figure_2.png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span><span class="st">"include/pub/SOM/its18_ps_work_tax_div_bar_plots.pdf"</span>, </span>
<span>            <span class="st">"include/pub/SOM/Supplementary_Figure_2.pdf"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-3" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-3">Supplementary Figure 3</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<code>*</code>).</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_3.png" class="img-fluid"></p>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<p><img src="paper/ESM/FIGURES/ssu_supp_alpha_div.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_3.rdata">Download Supplementary Figure 3 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_3.pdf">Download Supplementary Figure 3 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Supplementary Figure 3</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/SOM/Supplementary_Figure_3.rdata"</span><span class="op">)</span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">div_test_plot_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">divtest</span>, <span class="va">chart</span>, <span class="va">colour</span>, <span class="va">posthoc</span>, <span class="va">threshold</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">chart</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">chart</span> <span class="op">=</span> <span class="st">"box"</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">posthoc</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> </span>
<span>        <span class="st">"normality.pvalue"</span><span class="op">)</span><span class="op">)</span> </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input object does not seem to be a div_test output."</span><span class="op">)</span></span>
<span>    <span class="va">divtestdata</span> <span class="op">&lt;-</span> <span class="va">divtest</span><span class="op">$</span><span class="va">data</span></span>
<span>    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span>
<span>    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">getPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span>, </span>
<span>            <span class="st">"Paired"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">colour</span> <span class="op">&lt;-</span> <span class="fu">getPalette</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Tukey post-hoc test"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, </span>
<span>                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, </span>
<span>                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span>                <span class="st">"p"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, </span>
<span>                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, </span>
<span>                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span>                <span class="st">"p"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, </span>
<span>            <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="va">pairwisetable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;</span> </span>
<span>                <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">sortedgroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">group1</span>, <span class="va">pairwisetable</span><span class="op">$</span><span class="va">group2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datamax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datamin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datarange</span> <span class="op">&lt;-</span> <span class="va">datamax</span> <span class="op">-</span> <span class="va">datamin</span></span>
<span>        <span class="va">by</span> <span class="op">&lt;-</span> <span class="va">datarange</span> <span class="op">*</span> <span class="fl">0.1</span></span>
<span>        <span class="va">min</span> <span class="op">&lt;-</span> <span class="va">datamax</span></span>
<span>        <span class="va">max</span> <span class="op">&lt;-</span> <span class="va">min</span> <span class="op">+</span> <span class="op">(</span><span class="va">by</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min</span>, <span class="va">max</span>, <span class="va">by</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">$</span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">ypos</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"box"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, outlier.size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span>            <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">scale_linetype_manual</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"jitter"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, width <span class="op">=</span> <span class="fl">0</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>                <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"violin"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggviolin</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>                <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>            <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>,</span>
<span>                              chart <span class="op">=</span> <span class="st">"box"</span>,</span>
<span>                              colour    <span class="op">=</span> <span class="va">swel_col</span>,</span>
<span>                              posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_split</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"work"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"f"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FULL"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"filt"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"l"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FILT"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"perfect"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"r"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"pime"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"p"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PIME"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"0"</span></span>
<span>    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"1"</span></span>
<span>    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q2"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"2"</span></span>
<span>    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">tmp_var</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"_asv"</span>, <span class="va">tmp_ds</span>, <span class="va">tmp_hill</span>, <span class="st">"_lab"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_name1</span>, <span class="st">" ("</span>, <span class="va">tmp_name2</span>, <span class="st">")"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_var</span>, <span class="va">tmp_name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ssu18_ps_work_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_work_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvf0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_filt_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_filt_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvl0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_pime_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_pime_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvp0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#####################</span></span>
<span><span class="va">ssu18_ps_work_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_work_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvf1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_filt_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_filt_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvl1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_pime_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_pime_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvp1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#####################</span></span>
<span><span class="va">ssu18_ps_work_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_work_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvf2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_filt_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_filt_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvl2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_perfect_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_pime_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">ssu18_ps_pime_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">ssu18_asvp2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssu18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span></span>
<span>  <span class="va">ssu18_ps_work_q0_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_filt_q0_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_perfect_q0_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_pime_q0_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_work_q1_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_filt_q1_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_perfect_q1_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_pime_q1_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_work_q2_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_filt_q2_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_perfect_q2_adt_plot</span>,</span>
<span>  <span class="va">ssu18_ps_pime_q2_adt_plot</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">ssu18_alph_div_plots_asv</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.png"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">5852</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7449</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">ssu18_alph_div_plots_asv</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.pdf"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">5852</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7449</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_3.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_3.pdf"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-4" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-4">Supplementary Figure 4</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post processing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<code>*</code>).</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_4.png" class="img-fluid"></p>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<p><img src="paper/ESM/FIGURES/its_supp_alpha_div.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_4.rdata">Download Supplementary Figure 4 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_4.pdf">Download Supplementary Figure 4 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Supplementary Figure 4</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"include/pub/SOM/Supplementary_Figure_4.rdata"</span><span class="op">)</span></span>
<span><span class="va">swel_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">div_test_plot_jjs</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">divtest</span>, <span class="va">chart</span>, <span class="va">colour</span>, <span class="va">posthoc</span>, <span class="va">threshold</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">chart</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">chart</span> <span class="op">=</span> <span class="st">"box"</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">posthoc</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> </span>
<span>        <span class="st">"normality.pvalue"</span><span class="op">)</span><span class="op">)</span> </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input object does not seem to be a div_test output."</span><span class="op">)</span></span>
<span>    <span class="va">divtestdata</span> <span class="op">&lt;-</span> <span class="va">divtest</span><span class="op">$</span><span class="va">data</span></span>
<span>    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span>
<span>    <span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">divtestdata</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">getPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span>, </span>
<span>            <span class="st">"Paired"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">colour</span> <span class="op">&lt;-</span> <span class="fu">getPalette</span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Tukey post-hoc test"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, </span>
<span>                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, </span>
<span>                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span>                <span class="st">"p"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">divtest</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">combinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" $"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^ "</span>, </span>
<span>                <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                  <span class="st">"-"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>            <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">posthoc</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">combinations</span>, </span>
<span>                <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span>                <span class="st">"p"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">[</span>, </span>
<span>            <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">threshold</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">pairwisetable</span> <span class="op">&lt;-</span> <span class="va">pairwisetable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;</span> </span>
<span>                <span class="va">threshold</span><span class="op">)</span>, <span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">sortedgroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">$</span><span class="va">group1</span>, <span class="va">pairwisetable</span><span class="op">$</span><span class="va">group2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datamax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datamin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">divtest</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>            <span class="va">sortedgroups</span><span class="op">)</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">datarange</span> <span class="op">&lt;-</span> <span class="va">datamax</span> <span class="op">-</span> <span class="va">datamin</span></span>
<span>        <span class="va">by</span> <span class="op">&lt;-</span> <span class="va">datarange</span> <span class="op">*</span> <span class="fl">0.1</span></span>
<span>        <span class="va">min</span> <span class="op">&lt;-</span> <span class="va">datamax</span></span>
<span>        <span class="va">max</span> <span class="op">&lt;-</span> <span class="va">min</span> <span class="op">+</span> <span class="op">(</span><span class="va">by</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pairwisetable</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">min</span>, <span class="va">max</span>, <span class="va">by</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">pairwisetable</span><span class="op">$</span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">ypos</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"box"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, outlier.size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span>            <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">scale_linetype_manual</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"jitter"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggboxplot</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, add <span class="op">=</span> <span class="st">"jitter"</span>, width <span class="op">=</span> <span class="fl">0</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>                <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">chart</span> <span class="op">==</span> <span class="st">"violin"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggviolin</span><span class="op">(</span><span class="va">divtestdata</span>, x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"Group"</span>, fill <span class="op">=</span> <span class="st">"Group"</span>, x.text.angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">ylab</span><span class="op">(</span><span class="st">"Effective no. of Taxon Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>                <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, </span>
<span>            <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">posthoc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span> <span class="fu">stat_pvalue_manual</span><span class="op">(</span><span class="va">pairwisetable</span>, </span>
<span>                label <span class="op">=</span> <span class="st">"p"</span>, y.position <span class="op">=</span> <span class="st">"ypos"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">div_test_plot_jjs</span><span class="op">(</span><span class="va">tmp_get</span>,</span>
<span>                              chart <span class="op">=</span> <span class="st">"box"</span>,</span>
<span>                              colour    <span class="op">=</span> <span class="va">swel_col</span>,</span>
<span>                              posthoc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">ggpar</span><span class="op">(</span><span class="va">tmp_df</span>, legend <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_adt_plot"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_split</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"work"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"f"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FULL"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"filt"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"l"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"FILT"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"perfect"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"r"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PERfect"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"pime"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_ds</span> <span class="op">&lt;-</span> <span class="st">"p"</span></span>
<span>    <span class="va">tmp_name1</span> <span class="op">&lt;-</span> <span class="st">"PIME"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"0"</span></span>
<span>    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"1"</span></span>
<span>    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"q2"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_hill</span> <span class="op">&lt;-</span> <span class="st">"2"</span></span>
<span>    <span class="va">tmp_name2</span> <span class="op">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">tmp_var</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"_asv"</span>, <span class="va">tmp_ds</span>, <span class="va">tmp_hill</span>, <span class="st">"_lab"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tmp_name1</span>, <span class="st">" ("</span>, <span class="va">tmp_name2</span>, <span class="st">")"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_var</span>, <span class="va">tmp_name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">its18_ps_work_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_work_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvf0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_filt_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_filt_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvl0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_pime_q0_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_pime_q0_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvp0_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#####################</span></span>
<span><span class="va">its18_ps_work_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_work_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvf1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_filt_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_filt_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvl1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_pime_q1_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_pime_q1_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvp1_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#####################</span></span>
<span><span class="va">its18_ps_work_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_work_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvf2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_filt_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_filt_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvl2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_perfect_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvr2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_ps_pime_q2_adt_plot</span> <span class="op">&lt;-</span> <span class="va">its18_ps_pime_q2_adt_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="va">its18_asvp2_lab</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">its18_alph_div_plots_asv</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span></span>
<span>  <span class="va">its18_ps_work_q0_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_filt_q0_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_perfect_q0_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_pime_q0_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_work_q1_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_filt_q1_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_perfect_q1_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_pime_q1_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_work_q2_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_filt_q2_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_perfect_q2_adt_plot</span>,</span>
<span>  <span class="va">its18_ps_pime_q2_adt_plot</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">its18_alph_div_plots_asv</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.png"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">5852</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7449</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">its18_alph_div_plots_asv</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.pdf"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">5852</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7449</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_4.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_4.pdf"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-5" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-5">Supplementary Figure 5</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>No post processing performed.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_5.png" class="img-fluid"></p>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<p><img src="paper/ESM/FIGURES/ssu18_auto_cor_combo.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_5.rds">Download Supplementary Figure 5 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_5.pdf">Download Supplementary Figure 5 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Supplementary Figure 5</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_select_mc_norm_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_5.rds"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">edaphic_norm_cor</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split</span><span class="op">$</span><span class="va">edaphic</span></span>
<span><span class="va">edaphic_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">soil_funct_norm_cor</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split</span><span class="op">$</span><span class="va">soil_funct</span></span>
<span><span class="va">soil_funct_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">temp_adapt_norm_cor</span> <span class="op">&lt;-</span> <span class="va">ssu18_select_mc_norm_split</span><span class="op">$</span><span class="va">temp_adapt</span></span>
<span><span class="va">temp_adapt_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_cor$"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu">melt</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_get_lower_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="co"># Get upper triangle of the correlation matrix</span></span>
<span>  <span class="va">tmp_get_upper_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="va">tmp_upper_tri</span> <span class="op">&lt;-</span> <span class="fu">tmp_get_upper_tri</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu">melt</span><span class="op">(</span><span class="va">tmp_upper_tri</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Var1</span>, y <span class="op">=</span> <span class="va">Var2</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_ggheatmap</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_tile</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"red"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>                         midpoint <span class="op">=</span> <span class="fl">0</span>, limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, space <span class="op">=</span> <span class="st">"Lab"</span>, </span>
<span>                         name<span class="op">=</span><span class="st">"Pearson\nCorrelation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                     size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>          axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, label <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>      legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">7</span>, barheight <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                   title.position <span class="op">=</span> <span class="st">"top"</span>, </span>
<span>                                   title.hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_ggheatmap"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_ggheatmap</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_ggheatmap"</span><span class="op">)</span></span>
<span><span class="va">edaphic_norm_cor_ggheatmap</span></span>
<span></span>
<span><span class="va">auto_cor_figs</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span></span>
<span>  <span class="va">edaphic_norm_cor_ggheatmap</span>,</span>
<span>  <span class="va">soil_funct_norm_cor_ggheatmap</span>,</span>
<span>  <span class="va">temp_adapt_norm_cor_ggheatmap</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  common.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">auto_cor_figs</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.png"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7500</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">auto_cor_figs</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.pdf"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7500</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_5.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_5.pdf"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figure-6" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figure-6">Supplementary Figure 6</h2>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>No post processing performed.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Original</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Final</a></li>
</ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_6.png" class="img-fluid"></p>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<p><img src="paper/ESM/FIGURES/its18_auto_cor_combo.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_6.rds">Download Supplementary Figure 6 data pack</a></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_6.pdf">Download Supplementary Figure 6 raw pdf</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Supplementary Figure 6</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">its18_select_mc_norm_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/SOM/Supplementary_Figure_6.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edaphic_norm_cor</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split</span><span class="op">$</span><span class="va">edaphic</span></span>
<span><span class="va">edaphic_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">soil_funct_norm_cor</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split</span><span class="op">$</span><span class="va">soil_funct</span></span>
<span><span class="va">soil_funct_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">temp_adapt_norm_cor</span> <span class="op">&lt;-</span> <span class="va">its18_select_mc_norm_split</span><span class="op">$</span><span class="va">temp_adapt</span></span>
<span><span class="va">temp_adapt_norm_cor</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_cor$"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">tmp_cormat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu">melt</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_get_lower_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="co"># Get upper triangle of the correlation matrix</span></span>
<span>  <span class="va">tmp_get_upper_tri</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">tmp_cormat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="va">tmp_upper_tri</span> <span class="op">&lt;-</span> <span class="fu">tmp_get_upper_tri</span><span class="op">(</span><span class="va">tmp_cormat</span><span class="op">)</span></span>
<span>  <span class="va">tmp_melted_cormat</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu">melt</span><span class="op">(</span><span class="va">tmp_upper_tri</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Var1</span>, y <span class="op">=</span> <span class="va">Var2</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_ggheatmap</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp_melted_cormat</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_tile</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"red"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>                         midpoint <span class="op">=</span> <span class="fl">0</span>, limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, space <span class="op">=</span> <span class="st">"Lab"</span>, </span>
<span>                         name<span class="op">=</span><span class="st">"Pearson\nCorrelation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                     size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>          axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">7</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Var2</span>, <span class="va">Var1</span>, label <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>      legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">7</span>, barheight <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                   title.position <span class="op">=</span> <span class="st">"top"</span>, </span>
<span>                                   title.hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_ggheatmap"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_ggheatmap</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">objects</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_ggheatmap"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">auto_cor_figs</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span></span>
<span>  <span class="va">edaphic_norm_cor_ggheatmap</span>, </span>
<span>  <span class="va">soil_funct_norm_cor_ggheatmap</span>, </span>
<span>  <span class="va">temp_adapt_norm_cor_ggheatmap</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">1</span>, common.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">auto_cor_figs</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/its18_auto_cor_figs.png"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7500</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">auto_cor_figs</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"include/pub/SOM/its18_auto_cor_figs.pdf"</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">7500</span>,</span>
<span>  units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>  bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/its18_auto_cor_figs.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_6.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/its18_auto_cor_figs.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_6.pdf"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="supplementary-figures-714" class="level2"><h2 class="anchored" data-anchor-id="supplementary-figures-714">Supplementary Figures 7–14</h2>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_7.rds">Download Supplementary Figures 7-14 data pack</a></p>
</div>
</div>
</div>
<div class="cell">
<details><summary>Access the code for Supplementary Figures 7–14</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">remove</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssu18_ps_work</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"include/pub/SOM/Supplementary_Figure_7.rds"</span><span class="op">)</span></span>
<span><span class="va">ssu18_data_sets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssu18_ps_work"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>     <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="fu">subset_taxa</span><span class="op">(</span><span class="va">tmp_get</span>, <span class="va">Phylum</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_name</span><span class="op">)</span></span>
<span>     <span class="va">tmp_get_taxa</span> <span class="op">&lt;-</span> <span class="fu">get_taxa_unique</span><span class="op">(</span><span class="va">tmp_df</span>,</span>
<span>                                     taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                                     errorIfNULL<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_get_taxa</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_proteo"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">ssu18_data_sets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>  <span class="va">tmp_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>       <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Alphaproteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Alphaproteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Gammaproteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gammaproteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Zetaproteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>              <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Zetaproteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>   <span class="op">}</span>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Proteobacteria"</span> <span class="op">&amp;</span> <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="st">"p_Proteobacteria"</span><span class="op">)</span><span class="op">{</span></span>
<span>           <span class="va">phylum</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p_Proteobacteria"</span><span class="op">)</span></span>
<span>           <span class="va">tmp_clean</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phylum</span></span>
<span>       <span class="op">}</span></span>
<span>     <span class="op">}</span></span>
<span>  <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_clean</span><span class="op">)</span></span>
<span>  <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu">get_taxa_unique</span><span class="op">(</span><span class="va">tmp_get</span>,</span>
<span>                               taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                               errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">order</span>, <span class="va">phylum</span><span class="op">)</span></span>
<span></span>
<span><span class="va">set_to_plot</span> <span class="op">&lt;-</span> <span class="st">"ssu18_ps_work"</span></span>
<span><span class="va">tax_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Alphaproteobacteria"</span>,</span>
<span>  <span class="st">"Gammaproteobacteria"</span>,</span>
<span>  <span class="st">"Acidobacteriota"</span>,</span>
<span>  <span class="st">"Actinobacteriota"</span>,</span>
<span>  <span class="st">"Bacteroidota"</span>,</span>
<span>  <span class="st">"Firmicutes"</span>,</span>
<span>  <span class="st">"Myxococcota"</span>,</span>
<span>  <span class="st">"Verrucomicrobiota"</span></span>
<span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">set_to_plot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_proteo_clean"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp_sub</span> <span class="op">&lt;-</span> <span class="fu">subset_taxa</span><span class="op">(</span><span class="va">tmp_get</span>, <span class="va">Phylum</span> <span class="op">==</span> <span class="va">j</span><span class="op">)</span></span>
<span>    <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_sub</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_list</span> <span class="op">&lt;-</span>  <span class="fu">get_taxa_unique</span><span class="op">(</span><span class="va">tmp_get</span>, taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"####################################################"</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_print</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Unique taxa:"</span>, <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">tmp_print</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"####################################################"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tmp_list</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 3) Choose the **number** of taxa to display and the taxonomic **level**. </span></span>
<span><span class="co">## Aggregate the rest into "Other".</span></span>
<span></span>
<span><span class="va">aggregate_top_taxa</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">top</span>, <span class="va">level</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">aggregate_taxa</span><span class="op">(</span><span class="va">x</span>, <span class="va">level</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tops</span> <span class="op">&lt;-</span> <span class="fu">microbiome</span><span class="fu">::</span><span class="fu">top_taxa</span><span class="op">(</span><span class="va">x</span>, <span class="va">top</span><span class="op">)</span></span>
<span>  <span class="va">tax</span> <span class="op">&lt;-</span> <span class="fu">tax_table</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">tax</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">tops</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tax</span><span class="op">[</span><span class="va">inds</span>, <span class="va">level</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Other"</span></span>
<span>  </span>
<span>  <span class="fu">tax_table</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tax</span></span>
<span>  </span>
<span>  <span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu">tax_table</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span>, <span class="va">level</span><span class="op">]</span></span>
<span>  <span class="fu">tax_table</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">tax_table</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">aggregate_taxa</span><span class="op">(</span><span class="va">x</span>, <span class="va">level</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">top_hits</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">top_level</span> <span class="op">&lt;-</span> <span class="st">"Family"</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_otu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_otu</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmp_otu</span>, <span class="va">as.numeric</span><span class="op">)</span></span>
<span>  <span class="va">tmp_otu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tmp_otu</span><span class="op">)</span></span>
<span>  <span class="va">tmp_tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_clean_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">merge_phyloseq</span><span class="op">(</span></span>
<span>      <span class="fu">otu_table</span><span class="op">(</span><span class="va">tmp_otu</span>, taxa_are_rows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="fu">tax_table</span><span class="op">(</span><span class="va">tmp_tax</span><span class="op">)</span>,</span>
<span>      <span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_samples</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_agg_df</span> <span class="op">&lt;-</span> <span class="fu">aggregate_top_taxa</span><span class="op">(</span><span class="va">tmp_clean_df</span>,</span>
<span>                                   top <span class="op">=</span> <span class="va">top_hits</span>,</span>
<span>                                   level <span class="op">=</span> <span class="va">top_level</span><span class="op">)</span></span>
<span>  <span class="va">tmp_agg_name</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_agg_name</span>, <span class="va">tmp_agg_df</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_sep_agg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tmp_data</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_data</span><span class="op">)</span></span>
<span>  <span class="va">tmp_list</span> <span class="op">&lt;-</span> <span class="fu">get_taxa_unique</span><span class="op">(</span><span class="va">tmp_get</span>, taxonomic.rank <span class="op">=</span> <span class="fu">rank_names</span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                        errorIfNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">tmp_data</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_order"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_list</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg_order"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"#########"</span>, <span class="va">i</span>, <span class="st">"########"</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">tmp_print</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">tmp_print</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"####################################################"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Alphaproteobacteria"</span>, <span class="st">"o_Elsterales"</span>, </span>
<span>                   <span class="st">"o_Azospirillales"</span>, <span class="st">"Rhizobiales_Incertae_Sedis"</span>, </span>
<span>                   <span class="st">"Xanthobacteraceae"</span>, <span class="st">"Sphingomonadaceae"</span>, <span class="st">"Rhizobiaceae"</span>, </span>
<span>                   <span class="st">"Micropepsaceae"</span>, <span class="st">"Methyloligellaceae"</span>, <span class="st">"KF-JG30-B3"</span>, </span>
<span>                   <span class="st">"Hyphomicrobiaceae"</span>, <span class="st">"Dongiaceae"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Alphaproteobacteria"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Gammaproteobacteria"</span>, <span class="st">"o_PLTA13"</span>, <span class="st">"o_CCD24"</span>, </span>
<span>                   <span class="st">"Unknown_Family"</span>, <span class="st">"Xanthomonadaceae"</span>, <span class="st">"TRA3-20"</span>, </span>
<span>                   <span class="st">"Steroidobacteraceae"</span>, <span class="st">"SC-I-84"</span>, <span class="st">"Nitrosomonadaceae"</span>, </span>
<span>                   <span class="st">"Comamonadaceae"</span>, <span class="st">"Burkholderiaceae"</span>, <span class="st">"B1-7BS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Subgroup_22"</span>, <span class="st">"c_Subgroup_25"</span>, <span class="st">"c_Subgroup_5"</span>, </span>
<span>                   <span class="st">"o_Vicinamibacterales"</span>, <span class="st">"o_11-24"</span>, <span class="st">"o_Subgroup_17"</span>, </span>
<span>                   <span class="st">"o_Subgroup_2"</span>, <span class="st">"o_Subgroup_7"</span>, <span class="st">"o_Acidobacteriales"</span>, </span>
<span>                   <span class="st">"Vicinamibacteraceae"</span>, <span class="st">"Solibacteraceae"</span>, <span class="st">"Pyrinomonadaceae"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Acidobacteriota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_MB-A2-108"</span>, <span class="st">"o_IMCC26256"</span>, <span class="st">"o_Gaiellales"</span>, </span>
<span>                   <span class="st">"o_Frankiales"</span>, <span class="st">"Streptomycetaceae"</span>, <span class="st">"Solirubrobacteraceae"</span>, </span>
<span>                   <span class="st">"Nocardioidaceae"</span>, <span class="st">"Mycobacteriaceae"</span>, <span class="st">"Micromonosporaceae"</span>, </span>
<span>                   <span class="st">"Gaiellaceae"</span>, <span class="st">"Acidothermaceae"</span>, <span class="st">"67-14"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_SJA-28"</span>, <span class="st">"o_Chitinophagales"</span>, <span class="st">"Sphingobacteriaceae"</span>, </span>
<span>                   <span class="st">"Saprospiraceae"</span>, <span class="st">"Microscillaceae"</span>, <span class="st">"Hymenobacteraceae"</span>, </span>
<span>                   <span class="st">"Flavobacteriaceae"</span>, <span class="st">"Cytophagaceae"</span>, <span class="st">"Chitinophagaceae"</span>, </span>
<span>                   <span class="st">"BSV26"</span>, <span class="st">"env.OPS_17"</span>, <span class="st">"AKYH767"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Bacteroidota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"p_Firmicutes"</span>, <span class="st">"c_Bacilli"</span>, <span class="st">"o_Bacillales"</span>, </span>
<span>                   <span class="st">"Thermoactinomycetaceae"</span>, <span class="st">"type_III"</span>, <span class="st">"Paenibacillaceae"</span>, </span>
<span>                   <span class="st">"Lachnospiraceae"</span>, <span class="st">"Hungateiclostridiaceae"</span>, <span class="st">"Clostridiaceae"</span>, </span>
<span>                   <span class="st">"Bacillaceae"</span>, <span class="st">"Alicyclobacillaceae"</span>, <span class="st">"Planococcaceae"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"p_Myxococcota"</span>, <span class="st">"c_bacteriap25"</span>, <span class="st">"c_Polyangia"</span>, </span>
<span>                   <span class="st">"o_mle1-27"</span>, <span class="st">"o_MSB-4B10"</span>, <span class="st">"Sandaracinaceae"</span>, <span class="st">"Polyangiaceae"</span>, </span>
<span>                   <span class="st">"Phaselicystidaceae"</span>, <span class="st">"Myxococcaceae"</span>, <span class="st">"Haliangiaceae"</span>, </span>
<span>                   <span class="st">"BIrii41"</span>, <span class="st">"Anaeromyxobacteraceae"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Myxococcota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span><span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"c_Verrucomicrobiae"</span>, <span class="st">"o_Chlamydiales"</span>, <span class="st">"o_LD1-PA32"</span>, </span>
<span>                   <span class="st">"o_S-BQ2-57_soil_group"</span>, <span class="st">"Xiphinematobacteraceae"</span>, </span>
<span>                   <span class="st">"Simkaniaceae"</span>, <span class="st">"Pedosphaeraceae"</span>, <span class="st">"Parachlamydiaceae"</span>, </span>
<span>                   <span class="st">"Opitutaceae"</span>, <span class="st">"Omnitrophaceae"</span>, <span class="st">"cvE6"</span>, <span class="st">"Chthoniobacteraceae"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="st">"Verrucomicrobiota"</span>, <span class="st">"_agg_order"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, </span>
<span>       <span class="va">tmp_order</span><span class="op">)</span> </span>
<span><span class="co">###################</span></span>
<span></span>
<span><span class="co">## 4) Now, transform the data to relative abundance.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_agg</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_order</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">tmp_agg</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_order"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_agg</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_order</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_get_agg</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">transform_sample_counts</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">psmelt</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span><span class="op">[[</span><span class="va">top_level</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">gdata</span><span class="fu">::</span><span class="fu">reorder.factor</span><span class="op">(</span><span class="va">tmp_df</span><span class="op">[[</span><span class="va">top_level</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                               new.order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">tmp_get_order</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span> <span class="va">tmp_df</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">top_level</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">tmp_agg</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_tax"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_df</span><span class="op">)</span></span>
<span>  <span class="co">#print(c(i, tmp_name, tmp_agg))</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg_tax"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">tmp_get</span><span class="op">[[</span><span class="va">top_level</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">tmp_levels</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 5) Plot the data for a single phyloseq object. Here you use an aggregated tax file.</span></span>
<span></span>
<span><span class="va">ssu18_colvec.tax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span><span class="st">"#3D3C04"</span>,</span>
<span><span class="st">"#FF95BA"</span>,</span>
<span><span class="st">"#00A090"</span>,</span>
<span><span class="st">"#C00B6F"</span>,</span>
<span><span class="st">"#5FFFDE"</span>,</span>
<span><span class="st">"#0063E5"</span>,</span>
<span><span class="st">"#ED0DFD"</span>,</span>
<span><span class="st">"#FFA035"</span>,</span>
<span><span class="st">"#00C7F9"</span>,</span>
<span><span class="st">"#C80B2A"</span>,</span>
<span><span class="st">"#00A51C"</span>,</span>
<span><span class="st">"#FFD5FD"</span>,</span>
<span><span class="st">"#00463C"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">i</span>, <span class="st">"_agg_tax"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tmp_get</span>, <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">TEMP</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Abundance</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">top_level</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>title <span class="op">=</span> <span class="va">top_level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative Abundance (% total reads)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"none"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 6) Plot the data for multiple taxa. Here again you use an aggregated tax file. </span></span>
<span><span class="co">## This code can be used to generate plots for multiple data frames by adding the </span></span>
<span><span class="co">## base  phyloseq names to the `ssu18_split_df` variable. This code will also </span></span>
<span><span class="co">## facet the plots by a metadata variable. If you do not want to facet remove </span></span>
<span><span class="co">## the line beginning with `facet_grid`.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_level_get</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">sample_data</span><span class="op">(</span><span class="va">tmp_level_get</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_level</span> <span class="op">&lt;-</span> <span class="va">tmp_level</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">tmp_level</span><span class="op">$</span><span class="va">TEMP</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">tmp_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">tmp_level</span><span class="op">$</span><span class="va">SamName</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_agg_name</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>,  <span class="st">"_agg_tax"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">tmp_agg_name</span><span class="op">)</span></span>
<span>  <span class="va">tmp_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">reshape</span><span class="fu">::</span><span class="fu">melt</span><span class="op">(</span><span class="va">tmp_get</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample"</span>, <span class="st">"TEMP"</span>, <span class="st">"Abundance"</span>, <span class="st">"Family"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot_name</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot_melt"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmp_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">tmp_df</span>,</span>
<span>                     <span class="fu">aes</span><span class="op">(</span></span>
<span>                       x <span class="op">=</span> <span class="va">Sample</span>,</span>
<span>                       y <span class="op">=</span> <span class="va">Abundance</span>,</span>
<span>                       fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">top_level</span><span class="op">)</span></span>
<span>                     <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_grid</span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">TEMP</span>, scale <span class="op">=</span> <span class="st">"free_x"</span>, space <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">ssu18_colvec.tax</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="va">top_level</span>,</span>
<span>      reverse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      keywidth <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>      keyheight <span class="op">=</span> <span class="fl">0.7</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_plot_name</span>, <span class="va">tmp_plot</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 7) Finally we use the `patchwork` package to combine the two </span></span>
<span><span class="co">## plots and customize the look.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">tax_group</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_plot_main</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_plot_melt</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_plot_melt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tmp_final</span> <span class="op">&lt;-</span> <span class="va">tmp_plot_main</span> <span class="op">+</span> <span class="va">tmp_plot_melt</span></span>
<span>  <span class="va">tmp_final</span> <span class="op">&lt;-</span> <span class="va">tmp_final</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      plot.tag <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>      axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>      strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>      legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>      legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">tmp_name</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">set_to_plot</span>, <span class="st">"_"</span>, <span class="va">.</span>, <span class="st">"_final_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">tmp_name</span>, <span class="va">tmp_final</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"tmp_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">taxa_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"Alphaproteobacteria"</span>, </span>
<span>                  <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"Myxococcota"</span>, </span>
<span>                  <span class="st">"Verrucomicrobiota"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">taxa_to_plot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp_get</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"ssu18_ps_work_"</span>, <span class="va">i</span>, <span class="st">"_final_plot"</span>, sep <span class="op">=</span> <span class="st">""</span></span>
<span>    <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp_get</span>,</span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.png"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">2415</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">6350</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    dpi <span class="op">=</span> <span class="fl">600</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp_get</span>,</span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"include/pub/SOM/"</span>, <span class="va">i</span>, <span class="st">"_tax_div_bar_plots.pdf"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">2415</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">6350</span>,</span>
<span>    units <span class="op">=</span> <span class="st">'px'</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    dpi <span class="op">=</span> <span class="fl">600</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Acidobacteriota_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_7.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Actinobacteriota_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_8.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Alphaproteobacteria_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_9.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Gammaproteobacteria_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_10.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Bacteroidota_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_11.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Firmicutes_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_12.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Myxococcota_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_13.png"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Verrucomicrobiota_tax_div_bar_plots.png"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_14.png"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Acidobacteriota_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_7.pdf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Actinobacteriota_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_8.pdf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Alphaproteobacteria_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_9.pdf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Gammaproteobacteria_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_10.pdf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Bacteroidota_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_11.pdf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Firmicutes_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_12.pdf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Myxococcota_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_13.pdf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span></span>
<span>  <span class="st">"include/pub/SOM/Verrucomicrobiota_tax_div_bar_plots.pdf"</span>,</span>
<span>  <span class="st">"include/pub/SOM/Supplementary_Figure_14.pdf"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Modifications
</div>
</div>
<div class="callout-body-container callout-body">
<p>Post prossessing performed in <a href="https://inkscape.org/">Inkscape</a>. Modifications include sample and variable renaming, and small adjustments in bar height/width.</p>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Original (SF7)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Modified (SF7)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_7.png" class="img-fluid"></p>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Acido.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_7.pdf">Download Supplementary Figure 7 raw pdf</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">Original (SF8)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Modified (SF8)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_8.png" class="img-fluid"></p>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Actino.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_8.pdf">Download Supplementary Figure 8 raw pdf</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">Original (SF9)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Modified (SF9)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_9.png" class="img-fluid"></p>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Alpha.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_9.pdf">Download Supplementary Figure 9 raw pdf</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">Original (SF10)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Modified (SF10)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_10.png" class="img-fluid"></p>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Gamma.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_10.pdf">Download Supplementary Figure 10 raw pdf</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">Original (SF11)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">Modified (SF11)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_11.png" class="img-fluid"></p>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Bacter.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_11.pdf">Download Supplementary Figure 11 raw pdf</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">Original (SF12)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">Modified (SF12)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_12.png" class="img-fluid"></p>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Firm.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_12.pdf">Download Supplementary Figure 12 raw pdf</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">Original (SF13)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">Modified (SF13)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_13.png" class="img-fluid"></p>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Myxo.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_13.pdf">Download Supplementary Figure 13 raw pdf</a></p>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">Original (SF14)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">Modified (SF14)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<p><img src="include/pub/SOM/Supplementary_Figure_14.png" class="img-fluid"></p>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<p><img src="paper/ESM/FIGURES/taxa_plots_class_Verruco.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><i class="bi bi-download"></i> <a href="include/pub/SOM/Supplementary_Figure_14.pdf">Download Supplementary Figure 14 raw pdf</a></p>
</div>
</div>
</div>
</section></section><section id="r-session-information" class="level1"><h1>R Session Information</h1>
<details><summary>
Show/hide R Session Info
</summary><div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.1.3 (2022-03-10)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Catalina 10.15.7

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] digest_0.6.29     jsonlite_1.8.0    magrittr_2.0.3    evaluate_0.15    
 [5] rlang_1.0.2       stringi_1.7.6     cli_3.3.0         rstudioapi_0.13  
 [9] rmarkdown_2.14    tools_4.1.3       stringr_1.4.0     htmlwidgets_1.5.4
[13] xfun_0.31         yaml_2.3.5        fastmap_1.1.0     compiler_4.1.3   
[17] htmltools_0.5.2   knitr_1.39       </code></pre>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.1.3 (2022-03-10)
 os       macOS Catalina 10.15.7
 system   x86_64, darwin17.0
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Denver
 date     2022-07-21
 pandoc   2.17.1.1 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version date (UTC) lib source
 brio          1.1.3   2021-11-30 [1] CRAN (R 4.1.0)
 cachem        1.0.6   2021-08-19 [1] CRAN (R 4.1.0)
 callr         3.7.0   2021-04-20 [1] CRAN (R 4.1.0)
 cli           3.3.0   2022-04-25 [1] CRAN (R 4.1.2)
 crayon        1.5.1   2022-03-26 [1] CRAN (R 4.1.2)
 desc          1.4.1   2022-03-06 [1] CRAN (R 4.1.2)
 devtools      2.4.3   2021-11-30 [1] CRAN (R 4.1.0)
 digest        0.6.29  2021-12-01 [1] CRAN (R 4.1.0)
 ellipsis      0.3.2   2021-04-29 [1] CRAN (R 4.1.0)
 evaluate      0.15    2022-02-18 [1] CRAN (R 4.1.2)
 fastmap       1.1.0   2021-01-25 [1] CRAN (R 4.1.0)
 fs            1.5.2   2021-12-08 [1] CRAN (R 4.1.0)
 glue          1.6.2   2022-02-24 [1] CRAN (R 4.1.2)
 htmltools     0.5.2   2021-08-25 [1] CRAN (R 4.1.0)
 htmlwidgets   1.5.4   2021-09-08 [1] CRAN (R 4.1.0)
 jsonlite      1.8.0   2022-02-22 [1] CRAN (R 4.1.2)
 knitr         1.39    2022-04-26 [1] CRAN (R 4.1.2)
 lifecycle     1.0.1   2021-09-24 [1] CRAN (R 4.1.0)
 magrittr      2.0.3   2022-03-30 [1] CRAN (R 4.1.2)
 memoise       2.0.1   2021-11-26 [1] CRAN (R 4.1.0)
 pkgbuild      1.3.1   2021-12-20 [1] CRAN (R 4.1.0)
 pkgload       1.2.4   2021-11-30 [1] CRAN (R 4.1.0)
 prettyunits   1.1.1   2020-01-24 [1] CRAN (R 4.1.0)
 processx      3.5.3   2022-03-25 [1] CRAN (R 4.1.2)
 ps            1.7.0   2022-04-23 [1] CRAN (R 4.1.2)
 purrr         0.3.4   2020-04-17 [1] CRAN (R 4.1.0)
 R6            2.5.1   2021-08-19 [1] CRAN (R 4.1.0)
 remotes       2.4.2   2021-11-30 [1] CRAN (R 4.1.0)
 rlang         1.0.2   2022-03-04 [1] CRAN (R 4.1.2)
 rmarkdown     2.14    2022-04-25 [1] CRAN (R 4.1.2)
 rprojroot     2.0.3   2022-04-02 [1] CRAN (R 4.1.2)
 rstudioapi    0.13    2020-11-12 [1] CRAN (R 4.1.0)
 sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.1.0)
 stringi       1.7.6   2021-11-29 [1] CRAN (R 4.1.0)
 stringr       1.4.0   2019-02-10 [1] CRAN (R 4.1.0)
 testthat      3.1.4   2022-04-26 [1] CRAN (R 4.1.2)
 usethis       2.1.6   2022-05-25 [1] CRAN (R 4.1.2)
 withr         2.5.0   2022-03-03 [1] CRAN (R 4.1.2)
 xfun          0.31    2022-05-10 [1] CRAN (R 4.1.2)
 yaml          2.3.5   2022-02-21 [1] CRAN (R 4.1.2)

 [1] /Library/Frameworks/R.framework/Versions/4.1/Resources/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</details><div class="cell">

</div>
</section><div id="quarto-appendix" class="default"><section id="source-code" class="level4 appendix"><h2 class="quarto-appendix-heading">Source Code</h2><div class="quarto-appendix-contents">
<p>The source code for this page can be accessed on GitHub <svg aria-hidden="true" role="img" viewbox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> by <a href="https://github.com/sweltr/high-temp/blob/main/pub.qmd">clicking this link</a>.</p>
</div></section><section id="data-availability" class="level4 appendix"><h2 class="quarto-appendix-heading">Data Availability</h2><div class="quarto-appendix-contents">
<p>Data generated in this workflow and the Rdata need to run the workflow can be accessed on figshare at <a href="https://doi.org/10.25573/data.20263857.v1">10.25573/data.20263857</a>.</p>
</div></section><section id="last-updated-on" class="level4 appendix"><h2 class="quarto-appendix-heading">Last updated on</h2><div class="quarto-appendix-contents">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-07-21 08:28:58 MDT"</code></pre>
</div>
</div>


<!-- -->

</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation column-page-left"><div class="nav-page nav-page-previous">
      <a href="./about.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Website Contruction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb31" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Code for Publication Figures"</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Workflows to reproduce all Main, Extended Data, and Supplementary figures in the publication. </span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="an">page-layout:</span><span class="co"> full</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">    sidebar: false</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Get the code"</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: </span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: true</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">      caption: Code</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="an">comments:</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co">  hypothesis: true  </span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click here for packages used on this page."</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq); <span class="fu">packageVersion</span>(<span class="st">"phyloseq"</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, magrittr, file2meco, microbiomeMarker,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>               microeco, cowplot, hilldiv, ggpubr, vegan, Matrix,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>               patchwork, microbiome,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">install =</span> <span class="cn">FALSE</span>, <span class="at">update =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="fu">c</span>(</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cache"</span>,</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cache.path"</span>,</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cache.rebuild"</span>,</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dependson"</span>,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"autodep"</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a><span class="in">details {</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a><span class="in">    background-color: #F6F6F6;</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="in">    border: 1px solid  #B22271;</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a><span class="in">pre.sourceCode.r {</span></span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a><span class="in">    font-size: 0.85em;</span></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a><span class="in">.step #download-button {</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 0;</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a><span class="in">  padding-top: 0;</span></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>***</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;iframe</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://widgets.figshare.com/articles/20263857/embed?show_title=1"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"100%"</span> <span class="er">height</span><span class="ot">=</span><span class="st">"351"</span> <span class="er">allowfullscreen</span> <span class="er">frameborder</span><span class="ot">=</span><span class="st">"0"</span><span class="kw">&gt;&lt;/iframe&gt;</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>For most figures we include the raw figure generated in R, the post-processed figure, plus the code and data needed to generate the figure. </span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a><span class="fu"># Main Paper</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure 1</span></span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include rotating combining 16S rRNA and ITS plots, dendrogram branches, changing color palettes, sample and variable renaming, and adding legend. </span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/MAIN/FIGURES/Figure_1.png)</span></span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Figure 1 data pack</span><span class="co">](include/pub/MAIN/Figure_1.rdata)</span>  </span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in R"</span></span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/MAIN/Figure_1.rdata"</span>)</span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_pime"</span>)</span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>samp_ps_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_pime"</span>, <span class="st">"ssu18_ps_work"</span>)</span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Get all Class-level Proteobacteria names</span></span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps_all) {</span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_proteo"</span>))</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">subset_taxa</span>(tmp_get, Phylum <span class="sc">==</span> <span class="st">"Proteobacteria"</span>)</span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>     tmp_get_taxa <span class="ot">&lt;-</span> <span class="fu">get_taxa_unique</span>(tmp_df,</span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_df)[<span class="dv">3</span>],</span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_get_taxa)</span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a>     <span class="co">#rm(list = ls(pattern = "_proteo"))</span></span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> samp_ps_all) {</span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>  tmp_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tmp_clean)) {</span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>        tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Alphaproteobacteria"</span>) {</span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Alphaproteobacteria"</span>)</span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Gammaproteobacteria"</span>) {</span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Gammaproteobacteria"</span>)</span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Zetaproteobacteria"</span>) {</span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Zetaproteobacteria"</span>)</span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"p_Proteobacteria"</span>) {</span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p_Proteobacteria"</span>)</span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(tmp_get) <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_clean)</span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rank_names</span>(tmp_get)</span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(j, tmp_get)</span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(j, tmp_get))</span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">length</span>(</span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_taxa_unique</span>(</span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>      tmp_get,</span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>      <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">2</span>],</span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a>      <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/"</span>)</span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(class, order, phylum)</span>
<span id="cb31-168"><a href="#cb31-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-169"><a href="#cb31-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing DA ASVs in Anvi’o</span></span>
<span id="cb31-170"><a href="#cb31-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-171"><a href="#cb31-171" aria-hidden="true" tabindex="-1"></a><span class="do">## Here, we combine the results of the ISA and LEfSe analyses with the </span></span>
<span id="cb31-172"><a href="#cb31-172" aria-hidden="true" tabindex="-1"></a><span class="do">## distribution of ASVs across each sample. We are going to do the analysis </span></span>
<span id="cb31-173"><a href="#cb31-173" aria-hidden="true" tabindex="-1"></a><span class="do">## in [anvi’o](https://github.com/merenlab/anvio)---an advanced analysis </span></span>
<span id="cb31-174"><a href="#cb31-174" aria-hidden="true" tabindex="-1"></a><span class="do">## and visualization platform for ‘omics data [@eren2015anvi]---using the </span></span>
<span id="cb31-175"><a href="#cb31-175" aria-hidden="true" tabindex="-1"></a><span class="do">## `anvi-interactive` command. Anvi’o likes databases but it also </span></span>
<span id="cb31-176"><a href="#cb31-176" aria-hidden="true" tabindex="-1"></a><span class="do">## understands that sometimes you do not have a database. So it offers a </span></span>
<span id="cb31-177"><a href="#cb31-177" aria-hidden="true" tabindex="-1"></a><span class="do">## manual mode. If you type this command you can have a look at the </span></span>
<span id="cb31-178"><a href="#cb31-178" aria-hidden="true" tabindex="-1"></a><span class="do">## relevant pieces we need for the visualization, specifically those under </span></span>
<span id="cb31-179"><a href="#cb31-179" aria-hidden="true" tabindex="-1"></a><span class="do">## the headings MANUAL INPUTS and ADDITIONAL STUFF.</span></span>
<span id="cb31-180"><a href="#cb31-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-181"><a href="#cb31-181" aria-hidden="true" tabindex="-1"></a><span class="do">## There are also a few files we generate that cannot be loaded directly. </span></span>
<span id="cb31-182"><a href="#cb31-182" aria-hidden="true" tabindex="-1"></a><span class="do">## So, in addition to the files that can be loaded when running the interactive, </span></span>
<span id="cb31-183"><a href="#cb31-183" aria-hidden="true" tabindex="-1"></a><span class="do">## we also have files that must be added to the database created by anvi’o.</span></span>
<span id="cb31-184"><a href="#cb31-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-185"><a href="#cb31-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-186"><a href="#cb31-186" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. View data: in our case, a sample by ASV abundance matrix.</span></span>
<span id="cb31-187"><a href="#cb31-187" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. Additional info about each ASV.</span></span>
<span id="cb31-188"><a href="#cb31-188" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. Additional info about each sample.</span></span>
<span id="cb31-189"><a href="#cb31-189" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Taxa abundance data for each sample at some rank.</span></span>
<span id="cb31-190"><a href="#cb31-190" aria-hidden="true" tabindex="-1"></a><span class="do">## 5. Dendrograms ordering the ASVs and samples (based on view data).</span></span>
<span id="cb31-191"><a href="#cb31-191" aria-hidden="true" tabindex="-1"></a><span class="do">## 6. Fasta file of all ASVs in the analysis.</span></span>
<span id="cb31-192"><a href="#cb31-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-193"><a href="#cb31-193" aria-hidden="true" tabindex="-1"></a><span class="do">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span id="cb31-194"><a href="#cb31-194" aria-hidden="true" tabindex="-1"></a><span class="do">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span id="cb31-195"><a href="#cb31-195" aria-hidden="true" tabindex="-1"></a><span class="do">## ## ## Main Steps  ## ## ## ## ## </span></span>
<span id="cb31-196"><a href="#cb31-196" aria-hidden="true" tabindex="-1"></a><span class="do">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span id="cb31-197"><a href="#cb31-197" aria-hidden="true" tabindex="-1"></a><span class="do">## ## ## ## ## ## ## ## ## ## ## ## </span></span>
<span id="cb31-198"><a href="#cb31-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-199"><a href="#cb31-199" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-200"><a href="#cb31-200" aria-hidden="true" tabindex="-1"></a><span class="do">### 1. View data  #####################</span></span>
<span id="cb31-201"><a href="#cb31-201" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-202"><a href="#cb31-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-203"><a href="#cb31-203" aria-hidden="true" tabindex="-1"></a><span class="do">## Let’s start with the `-d` or `--view-data` file. This file needs to be </span></span>
<span id="cb31-204"><a href="#cb31-204" aria-hidden="true" tabindex="-1"></a><span class="do">## an ASV by sample matrix of read counts. To simplify the visualization, </span></span>
<span id="cb31-205"><a href="#cb31-205" aria-hidden="true" tabindex="-1"></a><span class="do">## we will use ***all*** ASVs represented by 100 or more total reads, </span></span>
<span id="cb31-206"><a href="#cb31-206" aria-hidden="true" tabindex="-1"></a><span class="do">## including those identified as differentially abundant by the ISA and/or LEfSe. </span></span>
<span id="cb31-207"><a href="#cb31-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-208"><a href="#cb31-208" aria-hidden="true" tabindex="-1"></a>trim_val <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb31-209"><a href="#cb31-209" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-210"><a href="#cb31-210" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-211"><a href="#cb31-211" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">prune_taxa</span>(<span class="fu">taxa_sums</span>(tmp_get) <span class="sc">&gt;</span> trim_val, tmp_get)</span>
<span id="cb31-212"><a href="#cb31-212" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>))</span>
<span id="cb31-213"><a href="#cb31-213" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-214"><a href="#cb31-214" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-215"><a href="#cb31-215" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-216"><a href="#cb31-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-217"><a href="#cb31-217" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps_all) {</span>
<span id="cb31-218"><a href="#cb31-218" aria-hidden="true" tabindex="-1"></a>     tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-219"><a href="#cb31-219" aria-hidden="true" tabindex="-1"></a>     <span class="fu">dir.create</span>(<span class="fu">paste</span>(tmp_path, i, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-220"><a href="#cb31-220" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-221"><a href="#cb31-221" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-222"><a href="#cb31-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-223"><a href="#cb31-223" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-224"><a href="#cb31-224" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-225"><a href="#cb31-225" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb31-226"><a href="#cb31-226" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-227"><a href="#cb31-227" aria-hidden="true" tabindex="-1"></a>     tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-228"><a href="#cb31-228" aria-hidden="true" tabindex="-1"></a>     <span class="fu">write.table</span>(tmp_df, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"data.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-229"><a href="#cb31-229" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-230"><a href="#cb31-230" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-231"><a href="#cb31-231" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-232"><a href="#cb31-232" aria-hidden="true" tabindex="-1"></a><span class="do">## Or export a table of transformed data.</span></span>
<span id="cb31-233"><a href="#cb31-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-234"><a href="#cb31-234" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-235"><a href="#cb31-235" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-236"><a href="#cb31-236" aria-hidden="true" tabindex="-1"></a>  tmp_trans <span class="ot">&lt;-</span></span>
<span id="cb31-237"><a href="#cb31-237" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(x)</span>
<span id="cb31-238"><a href="#cb31-238" aria-hidden="true" tabindex="-1"></a>      <span class="fl">1e5</span> <span class="sc">*</span> {</span>
<span id="cb31-239"><a href="#cb31-239" aria-hidden="true" tabindex="-1"></a>        x <span class="sc">/</span> <span class="fu">sum</span>(x)</span>
<span id="cb31-240"><a href="#cb31-240" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb31-241"><a href="#cb31-241" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_trans)))</span>
<span id="cb31-242"><a href="#cb31-242" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-243"><a href="#cb31-243" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-244"><a href="#cb31-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(</span>
<span id="cb31-245"><a href="#cb31-245" aria-hidden="true" tabindex="-1"></a>    tmp_df,</span>
<span id="cb31-246"><a href="#cb31-246" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"data_trans.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-247"><a href="#cb31-247" aria-hidden="true" tabindex="-1"></a>    <span class="at">quote =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-248"><a href="#cb31-248" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb31-249"><a href="#cb31-249" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb31-250"><a href="#cb31-250" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-251"><a href="#cb31-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-252"><a href="#cb31-252" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-253"><a href="#cb31-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-254"><a href="#cb31-254" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-255"><a href="#cb31-255" aria-hidden="true" tabindex="-1"></a><span class="do">### 2. Additional Layers for ASVs  ####</span></span>
<span id="cb31-256"><a href="#cb31-256" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-257"><a href="#cb31-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-258"><a href="#cb31-258" aria-hidden="true" tabindex="-1"></a><span class="do">## Next, we need some additional data **about the ASVs** to overlay on the </span></span>
<span id="cb31-259"><a href="#cb31-259" aria-hidden="true" tabindex="-1"></a><span class="do">## visual. This can be anything however what I specifically want are the details </span></span>
<span id="cb31-260"><a href="#cb31-260" aria-hidden="true" tabindex="-1"></a><span class="do">## of the ISA analysis, total reads, and lineage info. </span></span>
<span id="cb31-261"><a href="#cb31-261" aria-hidden="true" tabindex="-1"></a><span class="do">## I warn you; this code will get ugly and I urge you to find a better way.</span></span>
<span id="cb31-262"><a href="#cb31-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-263"><a href="#cb31-263" aria-hidden="true" tabindex="-1"></a><span class="do">## Start with an ASV + lineage table for the ASVs in the new phyloseq object.</span></span>
<span id="cb31-264"><a href="#cb31-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-265"><a href="#cb31-265" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-266"><a href="#cb31-266" aria-hidden="true" tabindex="-1"></a>  tmp_get_indval <span class="ot">&lt;-</span></span>
<span id="cb31-267"><a href="#cb31-267" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_indval_final"</span>)))</span>
<span id="cb31-268"><a href="#cb31-268" aria-hidden="true" tabindex="-1"></a>  tmp_get_indval <span class="ot">&lt;-</span></span>
<span id="cb31-269"><a href="#cb31-269" aria-hidden="true" tabindex="-1"></a>    tmp_get_indval <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"Group"</span> <span class="ot">=</span> <span class="st">"ASV_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-270"><a href="#cb31-270" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"enrich_indval"</span> <span class="ot">=</span> <span class="st">"group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-271"><a href="#cb31-271" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"test_indval"</span> <span class="ot">=</span> <span class="st">"indval"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-272"><a href="#cb31-272" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"pval_indval"</span> <span class="ot">=</span> <span class="st">"pval"</span>)</span>
<span id="cb31-273"><a href="#cb31-273" aria-hidden="true" tabindex="-1"></a>  tmp_get_indval <span class="ot">&lt;-</span> tmp_get_indval[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb31-274"><a href="#cb31-274" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-275"><a href="#cb31-275" aria-hidden="true" tabindex="-1"></a>  tmp_get_lefse <span class="ot">&lt;-</span></span>
<span id="cb31-276"><a href="#cb31-276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_lefse_final"</span>)))</span>
<span id="cb31-277"><a href="#cb31-277" aria-hidden="true" tabindex="-1"></a>  tmp_get_lefse <span class="ot">&lt;-</span></span>
<span id="cb31-278"><a href="#cb31-278" aria-hidden="true" tabindex="-1"></a>    tmp_get_lefse <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"Group"</span> <span class="ot">=</span> <span class="st">"ASV_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-279"><a href="#cb31-279" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"enrich_lefse"</span> <span class="ot">=</span> <span class="st">"group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-280"><a href="#cb31-280" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"test_lefse"</span> <span class="ot">=</span> <span class="st">"lda"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-281"><a href="#cb31-281" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"pval_lefse"</span> <span class="ot">=</span> <span class="st">"pval"</span>)</span>
<span id="cb31-282"><a href="#cb31-282" aria-hidden="true" tabindex="-1"></a>  tmp_get_lefse <span class="ot">&lt;-</span> tmp_get_lefse[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-283"><a href="#cb31-283" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-284"><a href="#cb31-284" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-285"><a href="#cb31-285" aria-hidden="true" tabindex="-1"></a>  tmp_otu_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb31-286"><a href="#cb31-286" aria-hidden="true" tabindex="-1"></a>  tmp_total <span class="ot">&lt;-</span></span>
<span id="cb31-287"><a href="#cb31-287" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(tmp_otu_df, <span class="at">total_reads =</span> <span class="fu">rowSums</span>(tmp_otu_df))</span>
<span id="cb31-288"><a href="#cb31-288" aria-hidden="true" tabindex="-1"></a>  tmp_total <span class="ot">&lt;-</span> <span class="fu">rev</span>(tmp_total)[<span class="dv">1</span>]</span>
<span id="cb31-289"><a href="#cb31-289" aria-hidden="true" tabindex="-1"></a>  tmp_total <span class="ot">&lt;-</span> tmp_total <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-290"><a href="#cb31-290" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-291"><a href="#cb31-291" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-292"><a href="#cb31-292" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-293"><a href="#cb31-293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-294"><a href="#cb31-294" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df <span class="ot">&lt;-</span></span>
<span id="cb31-295"><a href="#cb31-295" aria-hidden="true" tabindex="-1"></a>    tmp_tax_df <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-296"><a href="#cb31-296" aria-hidden="true" tabindex="-1"></a>  tmp_add_lay <span class="ot">&lt;-</span></span>
<span id="cb31-297"><a href="#cb31-297" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_tax_df, tmp_total, <span class="at">by =</span> <span class="st">"Group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-298"><a href="#cb31-298" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(., tmp_get_indval, <span class="at">by =</span> <span class="st">"Group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-299"><a href="#cb31-299" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(., tmp_get_lefse, <span class="at">by =</span> <span class="st">"Group"</span>)</span>
<span id="cb31-300"><a href="#cb31-300" aria-hidden="true" tabindex="-1"></a>  tmp_add_lay<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> tmp_add_lay<span class="sc">$</span>Group</span>
<span id="cb31-301"><a href="#cb31-301" aria-hidden="true" tabindex="-1"></a>  tmp_add_lay <span class="ot">&lt;-</span> tmp_add_lay[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>, <span class="dv">13</span><span class="sc">:</span><span class="dv">15</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb31-302"><a href="#cb31-302" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-303"><a href="#cb31-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(</span>
<span id="cb31-304"><a href="#cb31-304" aria-hidden="true" tabindex="-1"></a>    tmp_add_lay,</span>
<span id="cb31-305"><a href="#cb31-305" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"additional_layers.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-306"><a href="#cb31-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">quote =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-307"><a href="#cb31-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb31-308"><a href="#cb31-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-309"><a href="#cb31-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">na =</span> <span class="st">""</span></span>
<span id="cb31-310"><a href="#cb31-310" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-311"><a href="#cb31-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-312"><a href="#cb31-312" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-313"><a href="#cb31-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-314"><a href="#cb31-314" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-315"><a href="#cb31-315" aria-hidden="true" tabindex="-1"></a><span class="do">### 3. Additional Views for Samples  ##</span></span>
<span id="cb31-316"><a href="#cb31-316" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-317"><a href="#cb31-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-318"><a href="#cb31-318" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we want some general data **about the samples** to overlay on the </span></span>
<span id="cb31-319"><a href="#cb31-319" aria-hidden="true" tabindex="-1"></a><span class="do">## visual. Again, this can be anything. How about a table of alpha diversity </span></span>
<span id="cb31-320"><a href="#cb31-320" aria-hidden="true" tabindex="-1"></a><span class="do">## metrics? We actually have such a table that was generated way back up the </span></span>
<span id="cb31-321"><a href="#cb31-321" aria-hidden="true" tabindex="-1"></a><span class="do">## road. Just need to fix the column names.</span></span>
<span id="cb31-322"><a href="#cb31-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-323"><a href="#cb31-323" aria-hidden="true" tabindex="-1"></a>metadata_tab[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">NULL</span>)</span>
<span id="cb31-324"><a href="#cb31-324" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-325"><a href="#cb31-325" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-326"><a href="#cb31-326" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb31-327"><a href="#cb31-327" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb31-328"><a href="#cb31-328" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"id"</span>)</span>
<span id="cb31-329"><a href="#cb31-329" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"no_asvs"</span> <span class="ot">=</span> <span class="st">"Observed"</span>)</span>
<span id="cb31-330"><a href="#cb31-330" aria-hidden="true" tabindex="-1"></a>     tmp_rc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">readcount</span>(tmp_get))</span>
<span id="cb31-331"><a href="#cb31-331" aria-hidden="true" tabindex="-1"></a>     tmp_rc <span class="ot">&lt;-</span> tmp_rc <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"id"</span>)</span>
<span id="cb31-332"><a href="#cb31-332" aria-hidden="true" tabindex="-1"></a>     tmp_rc <span class="ot">&lt;-</span> tmp_rc <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"no_reads"</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb31-333"><a href="#cb31-333" aria-hidden="true" tabindex="-1"></a>     tmp_merge <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_df, tmp_rc)</span>
<span id="cb31-334"><a href="#cb31-334" aria-hidden="true" tabindex="-1"></a>     tmp_merge <span class="ot">&lt;-</span> tmp_merge[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">10</span>,<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb31-335"><a href="#cb31-335" aria-hidden="true" tabindex="-1"></a>     tmp_final <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_merge, metadata_tab, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"Sample_ID"</span>))</span>
<span id="cb31-336"><a href="#cb31-336" aria-hidden="true" tabindex="-1"></a>     tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-337"><a href="#cb31-337" aria-hidden="true" tabindex="-1"></a>     <span class="fu">write.table</span>(tmp_final, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"additional_views.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-338"><a href="#cb31-338" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-339"><a href="#cb31-339" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-340"><a href="#cb31-340" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-341"><a href="#cb31-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-342"><a href="#cb31-342" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-343"><a href="#cb31-343" aria-hidden="true" tabindex="-1"></a><span class="do">### 4. Taxon rank abundance by sample #</span></span>
<span id="cb31-344"><a href="#cb31-344" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-345"><a href="#cb31-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-346"><a href="#cb31-346" aria-hidden="true" tabindex="-1"></a><span class="do">## Turned out this was a little tricky to figure out, but thanks to a </span></span>
<span id="cb31-347"><a href="#cb31-347" aria-hidden="true" tabindex="-1"></a><span class="do">## [little nifty block of code](https://github.com/joey711/phyloseq/issues/418#issuecomment-262637034) </span></span>
<span id="cb31-348"><a href="#cb31-348" aria-hidden="true" tabindex="-1"></a><span class="do">## written by [guoyanzhao](https://github.com/guoyanzhao) on the phyloseq </span></span>
<span id="cb31-349"><a href="#cb31-349" aria-hidden="true" tabindex="-1"></a><span class="do">## Issues forum, it was a piece of cake. The code can be altered to take any </span></span>
<span id="cb31-350"><a href="#cb31-350" aria-hidden="true" tabindex="-1"></a><span class="do">## rank. See the post for an explanation.</span></span>
<span id="cb31-351"><a href="#cb31-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-352"><a href="#cb31-352" aria-hidden="true" tabindex="-1"></a><span class="do">## Anyway, the goal is to sum each taxon at some rank and present that as a </span></span>
<span id="cb31-353"><a href="#cb31-353" aria-hidden="true" tabindex="-1"></a><span class="do">## bar chart for each sample in the visualization. Anvi'o has a specific format </span></span>
<span id="cb31-354"><a href="#cb31-354" aria-hidden="true" tabindex="-1"></a><span class="do">## it needs where each row is a sample and each column is a taxon. Taxa names </span></span>
<span id="cb31-355"><a href="#cb31-355" aria-hidden="true" tabindex="-1"></a><span class="do">## need the prefix `t_&lt;RANK&gt;!`. For example, `t_class!` should be added for </span></span>
<span id="cb31-356"><a href="#cb31-356" aria-hidden="true" tabindex="-1"></a><span class="do">## Class rank.</span></span>
<span id="cb31-357"><a href="#cb31-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-358"><a href="#cb31-358" aria-hidden="true" tabindex="-1"></a>pick_rank <span class="ot">&lt;-</span> <span class="st">"Phylum"</span></span>
<span id="cb31-359"><a href="#cb31-359" aria-hidden="true" tabindex="-1"></a>pick_rank_l <span class="ot">&lt;-</span> <span class="st">"phylum"</span></span>
<span id="cb31-360"><a href="#cb31-360" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps_all) {</span>
<span id="cb31-361"><a href="#cb31-361" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table</span></span>
<span id="cb31-362"><a href="#cb31-362" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-363"><a href="#cb31-363" aria-hidden="true" tabindex="-1"></a>    tmp_glom <span class="ot">&lt;-</span> <span class="fu">tax_glom</span>(tmp_get, <span class="at">taxrank =</span> pick_rank)</span>
<span id="cb31-364"><a href="#cb31-364" aria-hidden="true" tabindex="-1"></a>    tmp_melt <span class="ot">&lt;-</span> <span class="fu">psmelt</span>(tmp_glom)</span>
<span id="cb31-365"><a href="#cb31-365" aria-hidden="true" tabindex="-1"></a>    tmp_melt[[pick_rank]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_melt[[pick_rank]])</span>
<span id="cb31-366"><a href="#cb31-366" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Abundance <span class="sc">~</span> Sample <span class="sc">+</span> tmp_melt[[pick_rank]], tmp_melt, <span class="at">FUN =</span> sum)</span>
<span id="cb31-367"><a href="#cb31-367" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(tmp_abund)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"tax_rank"</span></span>
<span id="cb31-368"><a href="#cb31-368" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(reshape2)</span>
<span id="cb31-369"><a href="#cb31-369" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(reshape<span class="sc">::</span><span class="fu">cast</span>(tmp_abund, Sample <span class="sc">~</span> tax_rank))</span>
<span id="cb31-370"><a href="#cb31-370" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">remove_rownames</span>(tmp_abund)</span>
<span id="cb31-371"><a href="#cb31-371" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(tmp_abund, <span class="st">"Sample"</span>)</span>
<span id="cb31-372"><a href="#cb31-372" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder table column by sum</span></span>
<span id="cb31-373"><a href="#cb31-373" aria-hidden="true" tabindex="-1"></a>    tmp_layers <span class="ot">&lt;-</span> tmp_abund[,<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">colSums</span>(tmp_abund), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb31-374"><a href="#cb31-374" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the prefix</span></span>
<span id="cb31-375"><a href="#cb31-375" aria-hidden="true" tabindex="-1"></a>    tmp_layers <span class="ot">&lt;-</span> tmp_layers <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename_all</span>(<span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="st">"t_"</span>, pick_rank_l,<span class="st">"!"</span>, x))</span>
<span id="cb31-376"><a href="#cb31-376" aria-hidden="true" tabindex="-1"></a>    tmp_layers <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span> (tmp_layers, <span class="st">"taxon"</span>)</span>
<span id="cb31-377"><a href="#cb31-377" aria-hidden="true" tabindex="-1"></a><span class="co"># save the dataframe</span></span>
<span id="cb31-378"><a href="#cb31-378" aria-hidden="true" tabindex="-1"></a>    tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(i, <span class="st">"_taxa"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-379"><a href="#cb31-379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(tmp_name, tmp_layers)</span>
<span id="cb31-380"><a href="#cb31-380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-381"><a href="#cb31-381" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-382"><a href="#cb31-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-383"><a href="#cb31-383" aria-hidden="true" tabindex="-1"></a><span class="do">## REORDER TAXA</span></span>
<span id="cb31-384"><a href="#cb31-384" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_taxa <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(ssu18_ps_work_taxa, <span class="fu">c</span>(</span>
<span id="cb31-385"><a href="#cb31-385" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Alphaproteobacteria"</span>, </span>
<span id="cb31-386"><a href="#cb31-386" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Gammaproteobacteria"</span>, </span>
<span id="cb31-387"><a href="#cb31-387" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Acidobacteriota"</span>, </span>
<span id="cb31-388"><a href="#cb31-388" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Actinobacteriota"</span>, </span>
<span id="cb31-389"><a href="#cb31-389" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Bacteroidota"</span>, </span>
<span id="cb31-390"><a href="#cb31-390" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Firmicutes"</span>,</span>
<span id="cb31-391"><a href="#cb31-391" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span id="cb31-392"><a href="#cb31-392" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Verrucomicrobiota"</span>,</span>
<span id="cb31-393"><a href="#cb31-393" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span id="cb31-394"><a href="#cb31-394" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Chloroflexi"</span>,</span>
<span id="cb31-395"><a href="#cb31-395" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Planctomycetota"</span>,</span>
<span id="cb31-396"><a href="#cb31-396" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Methylomirabilota"</span>,</span>
<span id="cb31-397"><a href="#cb31-397" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Crenarchaeota"</span></span>
<span id="cb31-398"><a href="#cb31-398" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb31-399"><a href="#cb31-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">.after =</span> <span class="st">"taxon"</span> )</span>
<span id="cb31-400"><a href="#cb31-400" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ssu18_ps_work_taxa, <span class="st">"include/pub/MAIN/anvio/ssu/ssu18_ps_work/tax_layers_mod.txt"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)  </span>
<span id="cb31-401"><a href="#cb31-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-402"><a href="#cb31-402" aria-hidden="true" tabindex="-1"></a>ssu18_ps_pime_taxa <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(ssu18_ps_pime_taxa, <span class="fu">c</span>(</span>
<span id="cb31-403"><a href="#cb31-403" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Alphaproteobacteria"</span>, </span>
<span id="cb31-404"><a href="#cb31-404" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Gammaproteobacteria"</span>, </span>
<span id="cb31-405"><a href="#cb31-405" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Acidobacteriota"</span>, </span>
<span id="cb31-406"><a href="#cb31-406" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Actinobacteriota"</span>, </span>
<span id="cb31-407"><a href="#cb31-407" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Bacteroidota"</span>, </span>
<span id="cb31-408"><a href="#cb31-408" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Firmicutes"</span>,</span>
<span id="cb31-409"><a href="#cb31-409" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span id="cb31-410"><a href="#cb31-410" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Verrucomicrobiota"</span>,</span>
<span id="cb31-411"><a href="#cb31-411" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Myxococcota"</span>,</span>
<span id="cb31-412"><a href="#cb31-412" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Chloroflexi"</span>,</span>
<span id="cb31-413"><a href="#cb31-413" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Planctomycetota"</span>,</span>
<span id="cb31-414"><a href="#cb31-414" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Methylomirabilota"</span>,</span>
<span id="cb31-415"><a href="#cb31-415" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_phylum!Crenarchaeota"</span></span>
<span id="cb31-416"><a href="#cb31-416" aria-hidden="true" tabindex="-1"></a>   ), <span class="at">.after =</span> <span class="st">"taxon"</span> )</span>
<span id="cb31-417"><a href="#cb31-417" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ssu18_ps_pime_taxa, <span class="st">"include/pub/MAIN/anvio/ssu/ssu18_ps_pime/tax_layers_mod.txt"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)  </span>
<span id="cb31-418"><a href="#cb31-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-419"><a href="#cb31-419" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-420"><a href="#cb31-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-421"><a href="#cb31-421" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-422"><a href="#cb31-422" aria-hidden="true" tabindex="-1"></a><span class="do">### 5. Construct Dendrograms #</span></span>
<span id="cb31-423"><a href="#cb31-423" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-424"><a href="#cb31-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-425"><a href="#cb31-425" aria-hidden="true" tabindex="-1"></a><span class="do">## The last piece we need is to generate dendrograms that order the ASVs </span></span>
<span id="cb31-426"><a href="#cb31-426" aria-hidden="true" tabindex="-1"></a><span class="do">## by their distribution in the samples and the samples by their ASV composition. </span></span>
<span id="cb31-427"><a href="#cb31-427" aria-hidden="true" tabindex="-1"></a><span class="do">## For this task we will use anvi'o.</span></span>
<span id="cb31-428"><a href="#cb31-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-429"><a href="#cb31-429" aria-hidden="true" tabindex="-1"></a><span class="do">## The first command reads the view data we generated above and uses </span></span>
<span id="cb31-430"><a href="#cb31-430" aria-hidden="true" tabindex="-1"></a><span class="do">## Euclidean distance and Ward linkage for hierarchical clustering of the ASVs. </span></span>
<span id="cb31-431"><a href="#cb31-431" aria-hidden="true" tabindex="-1"></a><span class="do">## The second command transposes the view data table and then does the same for </span></span>
<span id="cb31-432"><a href="#cb31-432" aria-hidden="true" tabindex="-1"></a><span class="do">## the samples. There are several distance metrics and linkage methods available. </span></span>
<span id="cb31-433"><a href="#cb31-433" aria-hidden="true" tabindex="-1"></a><span class="do">## See the help menu for the command by typing `anvi-matrix-to-newick -h`.  Boom.</span></span>
<span id="cb31-434"><a href="#cb31-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-435"><a href="#cb31-435" aria-hidden="true" tabindex="-1"></a><span class="co">#bash_commands &lt;- c() USE this to combine all commands</span></span>
<span id="cb31-436"><a href="#cb31-436" aria-hidden="true" tabindex="-1"></a><span class="co"># including in loop creates separate files</span></span>
<span id="cb31-437"><a href="#cb31-437" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-438"><a href="#cb31-438" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-439"><a href="#cb31-439" aria-hidden="true" tabindex="-1"></a>      tmp_command_asv <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span id="cb31-440"><a href="#cb31-440" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span id="cb31-441"><a href="#cb31-441" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"asv.tre"</span>))</span>
<span id="cb31-442"><a href="#cb31-442" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_asv)</span>
<span id="cb31-443"><a href="#cb31-443" aria-hidden="true" tabindex="-1"></a>      tmp_command_samp <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span id="cb31-444"><a href="#cb31-444" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span id="cb31-445"><a href="#cb31-445" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"sample.tre --transpose"</span>))</span>
<span id="cb31-446"><a href="#cb31-446" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_samp)</span>
<span id="cb31-447"><a href="#cb31-447" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-448"><a href="#cb31-448" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write</span>(bash_commands, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"tre.sh"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-449"><a href="#cb31-449" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-450"><a href="#cb31-450" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-451"><a href="#cb31-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-452"><a href="#cb31-452" aria-hidden="true" tabindex="-1"></a><span class="co"># FOR TANSFORMED DATA</span></span>
<span id="cb31-453"><a href="#cb31-453" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-454"><a href="#cb31-454" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-455"><a href="#cb31-455" aria-hidden="true" tabindex="-1"></a>      tmp_command_asv <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span id="cb31-456"><a href="#cb31-456" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span id="cb31-457"><a href="#cb31-457" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"asv_trans.tre"</span>))</span>
<span id="cb31-458"><a href="#cb31-458" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_asv)</span>
<span id="cb31-459"><a href="#cb31-459" aria-hidden="true" tabindex="-1"></a>      tmp_command_samp <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span id="cb31-460"><a href="#cb31-460" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span id="cb31-461"><a href="#cb31-461" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"sample_trans.tre --transpose"</span>))</span>
<span id="cb31-462"><a href="#cb31-462" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_samp)</span>
<span id="cb31-463"><a href="#cb31-463" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-464"><a href="#cb31-464" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write</span>(bash_commands, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"tre_transformed.sh"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-465"><a href="#cb31-465" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-466"><a href="#cb31-466" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-467"><a href="#cb31-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-468"><a href="#cb31-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-471"><a href="#cb31-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{bash}</span></span>
<span id="cb31-472"><a href="#cb31-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in anvi'o via a bash script"</span></span>
<span id="cb31-473"><a href="#cb31-473" aria-hidden="true" tabindex="-1"></a><span class="co"># The following commands NEED to run in anvio from base dir</span></span>
<span id="cb31-474"><a href="#cb31-474" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> include/pub/MAIN/anvio/ssu</span>
<span id="cb31-475"><a href="#cb31-475" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ssu18_ps_pime</span>
<span id="cb31-476"><a href="#cb31-476" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre.sh</span>
<span id="cb31-477"><a href="#cb31-477" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre_transformed.sh</span>
<span id="cb31-478"><a href="#cb31-478" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../</span>
<span id="cb31-479"><a href="#cb31-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-480"><a href="#cb31-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-483"><a href="#cb31-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-484"><a href="#cb31-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in R"</span></span>
<span id="cb31-485"><a href="#cb31-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-486"><a href="#cb31-486" aria-hidden="true" tabindex="-1"></a><span class="do">## Alternatively, we can generate dendrograms using `phyloseq::distance` and `hclust`. </span></span>
<span id="cb31-487"><a href="#cb31-487" aria-hidden="true" tabindex="-1"></a>pick_dist <span class="ot">&lt;-</span> <span class="st">"bray"</span></span>
<span id="cb31-488"><a href="#cb31-488" aria-hidden="true" tabindex="-1"></a>pick_clust <span class="ot">&lt;-</span> <span class="st">"complete"</span></span>
<span id="cb31-489"><a href="#cb31-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-490"><a href="#cb31-490" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-491"><a href="#cb31-491" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table</span></span>
<span id="cb31-492"><a href="#cb31-492" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-493"><a href="#cb31-493" aria-hidden="true" tabindex="-1"></a>    tmp_dist <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(<span class="at">physeq =</span> tmp_get, <span class="at">method =</span> pick_dist, <span class="at">type =</span> <span class="st">"sample"</span>)</span>
<span id="cb31-494"><a href="#cb31-494" aria-hidden="true" tabindex="-1"></a>    tmp_dend <span class="ot">&lt;-</span> <span class="fu">hclust</span>(tmp_dist, <span class="at">method =</span> pick_clust)</span>
<span id="cb31-495"><a href="#cb31-495" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(tmp_dend, <span class="at">hang =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb31-496"><a href="#cb31-496" aria-hidden="true" tabindex="-1"></a>    tmp_tree <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(tmp_dend) </span>
<span id="cb31-497"><a href="#cb31-497" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-498"><a href="#cb31-498" aria-hidden="true" tabindex="-1"></a>    tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-499"><a href="#cb31-499" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.tree</span>(<span class="at">phy =</span> tmp_tree, <span class="at">file =</span> <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_"</span>, pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-500"><a href="#cb31-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-501"><a href="#cb31-501" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-502"><a href="#cb31-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-503"><a href="#cb31-503" aria-hidden="true" tabindex="-1"></a>pick_dist_asv <span class="ot">&lt;-</span> <span class="st">"euclidean"</span></span>
<span id="cb31-504"><a href="#cb31-504" aria-hidden="true" tabindex="-1"></a>pick_clust_asv <span class="ot">&lt;-</span> <span class="st">"ward"</span></span>
<span id="cb31-505"><a href="#cb31-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-506"><a href="#cb31-506" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-507"><a href="#cb31-507" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table</span></span>
<span id="cb31-508"><a href="#cb31-508" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-509"><a href="#cb31-509" aria-hidden="true" tabindex="-1"></a>    tmp_dist <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(<span class="at">physeq =</span> tmp_get, <span class="at">method =</span> pick_dist_asv, <span class="at">type =</span> <span class="st">"taxa"</span>)</span>
<span id="cb31-510"><a href="#cb31-510" aria-hidden="true" tabindex="-1"></a>    tmp_dend <span class="ot">&lt;-</span> <span class="fu">hclust</span>(tmp_dist, <span class="at">method =</span> pick_clust_asv)</span>
<span id="cb31-511"><a href="#cb31-511" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(tmp_dend, <span class="at">hang =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb31-512"><a href="#cb31-512" aria-hidden="true" tabindex="-1"></a>    tmp_tree <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(tmp_dend) </span>
<span id="cb31-513"><a href="#cb31-513" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-514"><a href="#cb31-514" aria-hidden="true" tabindex="-1"></a>    tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-515"><a href="#cb31-515" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.tree</span>(<span class="at">phy =</span> tmp_tree, <span class="at">file =</span> <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"asv_"</span>, pick_dist_asv, <span class="st">"_"</span>, pick_clust_asv, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-516"><a href="#cb31-516" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-517"><a href="#cb31-517" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-518"><a href="#cb31-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-519"><a href="#cb31-519" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-520"><a href="#cb31-520" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-521"><a href="#cb31-521" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-522"><a href="#cb31-522" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[</span><span class="sc">\r\n</span><span class="st">]"</span>, <span class="st">""</span>, tmp_tree)</span>
<span id="cb31-523"><a href="#cb31-523" aria-hidden="true" tabindex="-1"></a>      tmp_item <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bray_complete"</span>)</span>
<span id="cb31-524"><a href="#cb31-524" aria-hidden="true" tabindex="-1"></a>      tmp_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"newick"</span>)</span>
<span id="cb31-525"><a href="#cb31-525" aria-hidden="true" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_tree)</span>
<span id="cb31-526"><a href="#cb31-526" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_item, tmp_type, tmp_df)</span>
<span id="cb31-527"><a href="#cb31-527" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span>
<span id="cb31-528"><a href="#cb31-528" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(tmp_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span>)</span>
<span id="cb31-529"><a href="#cb31-529" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(tmp_tab, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-530"><a href="#cb31-530" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">""</span>)</span>
<span id="cb31-531"><a href="#cb31-531" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-532"><a href="#cb31-532" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-533"><a href="#cb31-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-534"><a href="#cb31-534" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-535"><a href="#cb31-535" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-536"><a href="#cb31-536" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>,<span class="st">"sample_trans.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-537"><a href="#cb31-537" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[</span><span class="sc">\r\n</span><span class="st">]"</span>, <span class="st">""</span>, tmp_tree)</span>
<span id="cb31-538"><a href="#cb31-538" aria-hidden="true" tabindex="-1"></a>      tmp_item <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bray_complete"</span>)</span>
<span id="cb31-539"><a href="#cb31-539" aria-hidden="true" tabindex="-1"></a>      tmp_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"newick"</span>)</span>
<span id="cb31-540"><a href="#cb31-540" aria-hidden="true" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_tree)</span>
<span id="cb31-541"><a href="#cb31-541" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_item, tmp_type, tmp_df)</span>
<span id="cb31-542"><a href="#cb31-542" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(janitor)</span>
<span id="cb31-543"><a href="#cb31-543" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span>
<span id="cb31-544"><a href="#cb31-544" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(tmp_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span>)</span>
<span id="cb31-545"><a href="#cb31-545" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(tmp_tab, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_trans.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-546"><a href="#cb31-546" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">""</span>)</span>
<span id="cb31-547"><a href="#cb31-547" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-548"><a href="#cb31-548" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-549"><a href="#cb31-549" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span>
<span id="cb31-550"><a href="#cb31-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-551"><a href="#cb31-551" aria-hidden="true" tabindex="-1"></a><span class="co"># FOR HCLUST TREE</span></span>
<span id="cb31-552"><a href="#cb31-552" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-553"><a href="#cb31-553" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-554"><a href="#cb31-554" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_"</span>, pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-555"><a href="#cb31-555" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[</span><span class="sc">\r\n</span><span class="st">]"</span>, <span class="st">""</span>, tmp_tree)</span>
<span id="cb31-556"><a href="#cb31-556" aria-hidden="true" tabindex="-1"></a>      tmp_item <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">"_hclust"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-557"><a href="#cb31-557" aria-hidden="true" tabindex="-1"></a>      tmp_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"newick"</span>)</span>
<span id="cb31-558"><a href="#cb31-558" aria-hidden="true" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_tree)</span>
<span id="cb31-559"><a href="#cb31-559" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_item, tmp_type, tmp_df)</span>
<span id="cb31-560"><a href="#cb31-560" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(janitor)</span>
<span id="cb31-561"><a href="#cb31-561" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span>
<span id="cb31-562"><a href="#cb31-562" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(tmp_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span>)</span>
<span id="cb31-563"><a href="#cb31-563" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(tmp_tab, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_"</span>, pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-564"><a href="#cb31-564" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">""</span>)</span>
<span id="cb31-565"><a href="#cb31-565" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-566"><a href="#cb31-566" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-567"><a href="#cb31-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-568"><a href="#cb31-568" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-569"><a href="#cb31-569" aria-hidden="true" tabindex="-1"></a><span class="do">### 6. Make a fasta file #####</span></span>
<span id="cb31-570"><a href="#cb31-570" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-571"><a href="#cb31-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-572"><a href="#cb31-572" aria-hidden="true" tabindex="-1"></a><span class="do">## We don't need to add a fasta file, but it is a nice way to keep </span></span>
<span id="cb31-573"><a href="#cb31-573" aria-hidden="true" tabindex="-1"></a><span class="do">## everything in one place. Plus, you can do BLAST searches directly </span></span>
<span id="cb31-574"><a href="#cb31-574" aria-hidden="true" tabindex="-1"></a><span class="do">## in the interface by right clicking on the ASV of interest, so it is nice </span></span>
<span id="cb31-575"><a href="#cb31-575" aria-hidden="true" tabindex="-1"></a><span class="do">## to have the sequences.</span></span>
<span id="cb31-576"><a href="#cb31-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-577"><a href="#cb31-577" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-578"><a href="#cb31-578" aria-hidden="true" tabindex="-1"></a>       tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-579"><a href="#cb31-579" aria-hidden="true" tabindex="-1"></a>       tmp_tab <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(tmp_get)</span>
<span id="cb31-580"><a href="#cb31-580" aria-hidden="true" tabindex="-1"></a>       tmp_tab <span class="ot">&lt;-</span> tmp_tab[, <span class="dv">7</span>]</span>
<span id="cb31-581"><a href="#cb31-581" aria-hidden="true" tabindex="-1"></a>       tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">row.names</span>(tmp_tab), tmp_tab)</span>
<span id="cb31-582"><a href="#cb31-582" aria-hidden="true" tabindex="-1"></a>       <span class="fu">colnames</span>(tmp_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ASV_ID"</span>, <span class="st">"ASV_SEQ"</span>)</span>
<span id="cb31-583"><a href="#cb31-583" aria-hidden="true" tabindex="-1"></a>       tmp_df<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"&gt;"</span>, tmp_df<span class="sc">$</span>ASV_ID)</span>
<span id="cb31-584"><a href="#cb31-584" aria-hidden="true" tabindex="-1"></a>       tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/ssu/"</span>)</span>
<span id="cb31-585"><a href="#cb31-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-586"><a href="#cb31-586" aria-hidden="true" tabindex="-1"></a>       <span class="fu">write.table</span>(tmp_df, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, i, <span class="st">".fasta"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-587"><a href="#cb31-587" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">col.names =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-588"><a href="#cb31-588" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb31-589"><a href="#cb31-589" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-590"><a href="#cb31-590" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-591"><a href="#cb31-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-592"><a href="#cb31-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-595"><a href="#cb31-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{bash}</span></span>
<span id="cb31-596"><a href="#cb31-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in anvi'o"</span></span>
<span id="cb31-597"><a href="#cb31-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-598"><a href="#cb31-598" aria-hidden="true" tabindex="-1"></a><span class="co">## Building the Profile Database</span></span>
<span id="cb31-599"><a href="#cb31-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-600"><a href="#cb31-600" aria-hidden="true" tabindex="-1"></a><span class="co">## Time to put all of these pieces together. This gets a little tricky since </span></span>
<span id="cb31-601"><a href="#cb31-601" aria-hidden="true" tabindex="-1"></a><span class="co">## we do not have a database to start with because some of these files can be </span></span>
<span id="cb31-602"><a href="#cb31-602" aria-hidden="true" tabindex="-1"></a><span class="co">## loaded directly in the interface but some need to be added to a database. </span></span>
<span id="cb31-603"><a href="#cb31-603" aria-hidden="true" tabindex="-1"></a><span class="co">## When we fire up the interactive in `--manual` mode, we ***must*** give </span></span>
<span id="cb31-604"><a href="#cb31-604" aria-hidden="true" tabindex="-1"></a><span class="co">## anvi'o the name of a database and it will *create* that database for us. </span></span>
<span id="cb31-605"><a href="#cb31-605" aria-hidden="true" tabindex="-1"></a><span class="co">## Then we can shut down the interactive, add the necessary data files, </span></span>
<span id="cb31-606"><a href="#cb31-606" aria-hidden="true" tabindex="-1"></a><span class="co">## and start back up.</span></span>
<span id="cb31-607"><a href="#cb31-607" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ssu18_ps_pime</span>
<span id="cb31-608"><a href="#cb31-608" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb31-609"><a href="#cb31-609" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb31-610"><a href="#cb31-610" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb31-611"><a href="#cb31-611" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-612"><a href="#cb31-612" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span>
<span id="cb31-613"><a href="#cb31-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-614"><a href="#cb31-614" aria-hidden="true" tabindex="-1"></a><span class="co">## Now we have a new profile database that we can add the sample metadata </span></span>
<span id="cb31-615"><a href="#cb31-615" aria-hidden="true" tabindex="-1"></a><span class="co">## (`additional_layers.txt`) and the sample dendrogram (sample.tre) using the </span></span>
<span id="cb31-616"><a href="#cb31-616" aria-hidden="true" tabindex="-1"></a><span class="co">## command `anvi-import-misc-data`. These commands add the table to the new </span></span>
<span id="cb31-617"><a href="#cb31-617" aria-hidden="true" tabindex="-1"></a><span class="co">## `profile.db`. First, kill the interactive.</span></span>
<span id="cb31-618"><a href="#cb31-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-619"><a href="#cb31-619" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> additional_views.txt <span class="dt">\</span></span>
<span id="cb31-620"><a href="#cb31-620" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-621"><a href="#cb31-621" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb31-622"><a href="#cb31-622" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> sample.tre <span class="dt">\</span></span>
<span id="cb31-623"><a href="#cb31-623" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-624"><a href="#cb31-624" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layer_orders</span>
<span id="cb31-625"><a href="#cb31-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-626"><a href="#cb31-626" aria-hidden="true" tabindex="-1"></a><span class="co">## One last this is to get the table with the taxonomy total by sample </span></span>
<span id="cb31-627"><a href="#cb31-627" aria-hidden="true" tabindex="-1"></a><span class="co">## (`tax_layers.txt`) into the profile database. We will run the same command </span></span>
<span id="cb31-628"><a href="#cb31-628" aria-hidden="true" tabindex="-1"></a><span class="co">## we just used.</span></span>
<span id="cb31-629"><a href="#cb31-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-630"><a href="#cb31-630" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> ../ssu18_ps_work/tax_layers_mod.txt <span class="dt">\</span></span>
<span id="cb31-631"><a href="#cb31-631" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-632"><a href="#cb31-632" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb31-633"><a href="#cb31-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-634"><a href="#cb31-634" aria-hidden="true" tabindex="-1"></a><span class="co">## In fact, we could just as easily append the taxonomy total data onto the </span></span>
<span id="cb31-635"><a href="#cb31-635" aria-hidden="true" tabindex="-1"></a><span class="co">## `additional_layers.txt` and import in one command. But we didn't.</span></span>
<span id="cb31-636"><a href="#cb31-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-637"><a href="#cb31-637" aria-hidden="true" tabindex="-1"></a><span class="co">## Interactive Interface</span></span>
<span id="cb31-638"><a href="#cb31-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-639"><a href="#cb31-639" aria-hidden="true" tabindex="-1"></a><span class="co">## With a populated database in hand, we can now begin modifying the </span></span>
<span id="cb31-640"><a href="#cb31-640" aria-hidden="true" tabindex="-1"></a><span class="co">## visual by running the interactive command again.</span></span>
<span id="cb31-641"><a href="#cb31-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-642"><a href="#cb31-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-643"><a href="#cb31-643" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb31-644"><a href="#cb31-644" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb31-645"><a href="#cb31-645" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb31-646"><a href="#cb31-646" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db</span>
<span id="cb31-647"><a href="#cb31-647" aria-hidden="true" tabindex="-1"></a>                 <span class="ex">--fasta-file</span> ssu18_ps_pime.fasta <span class="dt">\</span></span>
<span id="cb31-648"><a href="#cb31-648" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span>
<span id="cb31-649"><a href="#cb31-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-650"><a href="#cb31-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-653"><a href="#cb31-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-654"><a href="#cb31-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in R"</span></span>
<span id="cb31-655"><a href="#cb31-655" aria-hidden="true" tabindex="-1"></a><span class="do">## The ITS version of the anvi'o workflow is basically a carbon copy of the </span></span>
<span id="cb31-656"><a href="#cb31-656" aria-hidden="true" tabindex="-1"></a><span class="do">## workflow presented above. It is included here for posterity.</span></span>
<span id="cb31-657"><a href="#cb31-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-658"><a href="#cb31-658" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. View data: in our case, a sample by ASV abundance matrix.</span></span>
<span id="cb31-659"><a href="#cb31-659" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. Additional info about each ASV.</span></span>
<span id="cb31-660"><a href="#cb31-660" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. Additional info about each sample.</span></span>
<span id="cb31-661"><a href="#cb31-661" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Taxa abundance data for each sample at some rank.</span></span>
<span id="cb31-662"><a href="#cb31-662" aria-hidden="true" tabindex="-1"></a><span class="do">## 5. Dendrograms ordering the ASVs and samples (based on view data).</span></span>
<span id="cb31-663"><a href="#cb31-663" aria-hidden="true" tabindex="-1"></a><span class="do">## 6. Fasta file of all ASVs in the analysis.</span></span>
<span id="cb31-664"><a href="#cb31-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-665"><a href="#cb31-665" aria-hidden="true" tabindex="-1"></a><span class="do">### Main steps</span></span>
<span id="cb31-666"><a href="#cb31-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-667"><a href="#cb31-667" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-668"><a href="#cb31-668" aria-hidden="true" tabindex="-1"></a><span class="do">### 1. View data  #####################</span></span>
<span id="cb31-669"><a href="#cb31-669" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-670"><a href="#cb31-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-671"><a href="#cb31-671" aria-hidden="true" tabindex="-1"></a><span class="do">## Let’s start with the `-d` or `--view-data` file. This file needs to be </span></span>
<span id="cb31-672"><a href="#cb31-672" aria-hidden="true" tabindex="-1"></a><span class="do">## an ASV by sample matrix of read counts. To simplify the visualization, </span></span>
<span id="cb31-673"><a href="#cb31-673" aria-hidden="true" tabindex="-1"></a><span class="do">## we will use ***all*** ASVs represented by 100 or more total reads, </span></span>
<span id="cb31-674"><a href="#cb31-674" aria-hidden="true" tabindex="-1"></a><span class="do">## including those identified as differentially abundant by the ISA and/or LEfSe. </span></span>
<span id="cb31-675"><a href="#cb31-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-676"><a href="#cb31-676" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_pime"</span>)</span>
<span id="cb31-677"><a href="#cb31-677" aria-hidden="true" tabindex="-1"></a>samp_ps_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_pime"</span>, <span class="st">"its18_ps_work"</span>)</span>
<span id="cb31-678"><a href="#cb31-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-679"><a href="#cb31-679" aria-hidden="true" tabindex="-1"></a>trim_val <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb31-680"><a href="#cb31-680" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-681"><a href="#cb31-681" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-682"><a href="#cb31-682" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">prune_taxa</span>(<span class="fu">taxa_sums</span>(tmp_get) <span class="sc">&gt;</span> trim_val, tmp_get)</span>
<span id="cb31-683"><a href="#cb31-683" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>))</span>
<span id="cb31-684"><a href="#cb31-684" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-685"><a href="#cb31-685" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-686"><a href="#cb31-686" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-687"><a href="#cb31-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-688"><a href="#cb31-688" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps_all) {</span>
<span id="cb31-689"><a href="#cb31-689" aria-hidden="true" tabindex="-1"></a>     tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-690"><a href="#cb31-690" aria-hidden="true" tabindex="-1"></a>     <span class="fu">dir.create</span>(<span class="fu">paste</span>(tmp_path, i, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-691"><a href="#cb31-691" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-692"><a href="#cb31-692" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-693"><a href="#cb31-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-694"><a href="#cb31-694" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-695"><a href="#cb31-695" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-696"><a href="#cb31-696" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb31-697"><a href="#cb31-697" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-698"><a href="#cb31-698" aria-hidden="true" tabindex="-1"></a>     tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-699"><a href="#cb31-699" aria-hidden="true" tabindex="-1"></a>     <span class="fu">write.table</span>(tmp_df, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"data.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-700"><a href="#cb31-700" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-701"><a href="#cb31-701" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-702"><a href="#cb31-702" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-703"><a href="#cb31-703" aria-hidden="true" tabindex="-1"></a><span class="do">## Or export a table of transformed data.</span></span>
<span id="cb31-704"><a href="#cb31-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-705"><a href="#cb31-705" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-706"><a href="#cb31-706" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-707"><a href="#cb31-707" aria-hidden="true" tabindex="-1"></a>  tmp_trans <span class="ot">&lt;-</span></span>
<span id="cb31-708"><a href="#cb31-708" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(x)</span>
<span id="cb31-709"><a href="#cb31-709" aria-hidden="true" tabindex="-1"></a>      <span class="fl">1e5</span> <span class="sc">*</span> {</span>
<span id="cb31-710"><a href="#cb31-710" aria-hidden="true" tabindex="-1"></a>        x <span class="sc">/</span> <span class="fu">sum</span>(x)</span>
<span id="cb31-711"><a href="#cb31-711" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb31-712"><a href="#cb31-712" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_trans)))</span>
<span id="cb31-713"><a href="#cb31-713" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-714"><a href="#cb31-714" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-715"><a href="#cb31-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(</span>
<span id="cb31-716"><a href="#cb31-716" aria-hidden="true" tabindex="-1"></a>    tmp_df,</span>
<span id="cb31-717"><a href="#cb31-717" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"data_trans.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-718"><a href="#cb31-718" aria-hidden="true" tabindex="-1"></a>    <span class="at">quote =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-719"><a href="#cb31-719" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb31-720"><a href="#cb31-720" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb31-721"><a href="#cb31-721" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-722"><a href="#cb31-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-723"><a href="#cb31-723" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-724"><a href="#cb31-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-725"><a href="#cb31-725" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-726"><a href="#cb31-726" aria-hidden="true" tabindex="-1"></a><span class="do">### 2. Additional Layers for ASVs  ####</span></span>
<span id="cb31-727"><a href="#cb31-727" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-728"><a href="#cb31-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-729"><a href="#cb31-729" aria-hidden="true" tabindex="-1"></a><span class="do">## Next, we need some additional data **about the ASVs** to overlay on the </span></span>
<span id="cb31-730"><a href="#cb31-730" aria-hidden="true" tabindex="-1"></a><span class="do">## visual. This can be anything however what I specifically want are the </span></span>
<span id="cb31-731"><a href="#cb31-731" aria-hidden="true" tabindex="-1"></a><span class="do">## details of the ISA analysis, total reads, and lineage info. I warn you; </span></span>
<span id="cb31-732"><a href="#cb31-732" aria-hidden="true" tabindex="-1"></a><span class="do">## this code will get ugly and I urge you to find a better way.</span></span>
<span id="cb31-733"><a href="#cb31-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-734"><a href="#cb31-734" aria-hidden="true" tabindex="-1"></a><span class="do">## Start with an ASV + lineage table for the ASVs in the new phyloseq object.</span></span>
<span id="cb31-735"><a href="#cb31-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-736"><a href="#cb31-736" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-737"><a href="#cb31-737" aria-hidden="true" tabindex="-1"></a>  tmp_get_indval <span class="ot">&lt;-</span></span>
<span id="cb31-738"><a href="#cb31-738" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_indval_final"</span>)))</span>
<span id="cb31-739"><a href="#cb31-739" aria-hidden="true" tabindex="-1"></a>  tmp_get_indval <span class="ot">&lt;-</span></span>
<span id="cb31-740"><a href="#cb31-740" aria-hidden="true" tabindex="-1"></a>    tmp_get_indval <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"Group"</span> <span class="ot">=</span> <span class="st">"ASV_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-741"><a href="#cb31-741" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"enrich_indval"</span> <span class="ot">=</span> <span class="st">"group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-742"><a href="#cb31-742" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"test_indval"</span> <span class="ot">=</span> <span class="st">"indval"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-743"><a href="#cb31-743" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"pval_indval"</span> <span class="ot">=</span> <span class="st">"pval"</span>)</span>
<span id="cb31-744"><a href="#cb31-744" aria-hidden="true" tabindex="-1"></a>  tmp_get_indval <span class="ot">&lt;-</span> tmp_get_indval[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb31-745"><a href="#cb31-745" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-746"><a href="#cb31-746" aria-hidden="true" tabindex="-1"></a>  tmp_get_lefse <span class="ot">&lt;-</span></span>
<span id="cb31-747"><a href="#cb31-747" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_lefse_final"</span>)))</span>
<span id="cb31-748"><a href="#cb31-748" aria-hidden="true" tabindex="-1"></a>  tmp_get_lefse <span class="ot">&lt;-</span></span>
<span id="cb31-749"><a href="#cb31-749" aria-hidden="true" tabindex="-1"></a>    tmp_get_lefse <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"Group"</span> <span class="ot">=</span> <span class="st">"ASV_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-750"><a href="#cb31-750" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"enrich_lefse"</span> <span class="ot">=</span> <span class="st">"group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-751"><a href="#cb31-751" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"test_lefse"</span> <span class="ot">=</span> <span class="st">"lda"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-752"><a href="#cb31-752" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"pval_lefse"</span> <span class="ot">=</span> <span class="st">"pval"</span>)</span>
<span id="cb31-753"><a href="#cb31-753" aria-hidden="true" tabindex="-1"></a>  tmp_get_lefse <span class="ot">&lt;-</span> tmp_get_lefse[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-754"><a href="#cb31-754" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-755"><a href="#cb31-755" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-756"><a href="#cb31-756" aria-hidden="true" tabindex="-1"></a>  tmp_otu_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb31-757"><a href="#cb31-757" aria-hidden="true" tabindex="-1"></a>  tmp_total <span class="ot">&lt;-</span></span>
<span id="cb31-758"><a href="#cb31-758" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(tmp_otu_df, <span class="at">total_reads =</span> <span class="fu">rowSums</span>(tmp_otu_df))</span>
<span id="cb31-759"><a href="#cb31-759" aria-hidden="true" tabindex="-1"></a>  tmp_total <span class="ot">&lt;-</span> <span class="fu">rev</span>(tmp_total)[<span class="dv">1</span>]</span>
<span id="cb31-760"><a href="#cb31-760" aria-hidden="true" tabindex="-1"></a>  tmp_total <span class="ot">&lt;-</span> tmp_total <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-761"><a href="#cb31-761" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-762"><a href="#cb31-762" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-763"><a href="#cb31-763" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-764"><a href="#cb31-764" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-765"><a href="#cb31-765" aria-hidden="true" tabindex="-1"></a>  tmp_tax_df <span class="ot">&lt;-</span></span>
<span id="cb31-766"><a href="#cb31-766" aria-hidden="true" tabindex="-1"></a>    tmp_tax_df <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Group"</span>)</span>
<span id="cb31-767"><a href="#cb31-767" aria-hidden="true" tabindex="-1"></a>  tmp_add_lay <span class="ot">&lt;-</span></span>
<span id="cb31-768"><a href="#cb31-768" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_tax_df, tmp_total, <span class="at">by =</span> <span class="st">"Group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-769"><a href="#cb31-769" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(., tmp_get_indval, <span class="at">by =</span> <span class="st">"Group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-770"><a href="#cb31-770" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(., tmp_get_lefse, <span class="at">by =</span> <span class="st">"Group"</span>)</span>
<span id="cb31-771"><a href="#cb31-771" aria-hidden="true" tabindex="-1"></a>  tmp_add_lay<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> tmp_add_lay<span class="sc">$</span>Group</span>
<span id="cb31-772"><a href="#cb31-772" aria-hidden="true" tabindex="-1"></a>  tmp_add_lay <span class="ot">&lt;-</span> tmp_add_lay[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>, <span class="dv">13</span><span class="sc">:</span><span class="dv">15</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb31-773"><a href="#cb31-773" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-774"><a href="#cb31-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(</span>
<span id="cb31-775"><a href="#cb31-775" aria-hidden="true" tabindex="-1"></a>    tmp_add_lay,</span>
<span id="cb31-776"><a href="#cb31-776" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"additional_layers.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-777"><a href="#cb31-777" aria-hidden="true" tabindex="-1"></a>    <span class="at">quote =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-778"><a href="#cb31-778" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb31-779"><a href="#cb31-779" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-780"><a href="#cb31-780" aria-hidden="true" tabindex="-1"></a>    <span class="at">na =</span> <span class="st">""</span></span>
<span id="cb31-781"><a href="#cb31-781" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-782"><a href="#cb31-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-783"><a href="#cb31-783" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-784"><a href="#cb31-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-785"><a href="#cb31-785" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-786"><a href="#cb31-786" aria-hidden="true" tabindex="-1"></a><span class="do">### 3. Additional Views for Samples  ##</span></span>
<span id="cb31-787"><a href="#cb31-787" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-788"><a href="#cb31-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-789"><a href="#cb31-789" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we want some general data **about the samples** to overlay on the visual. </span></span>
<span id="cb31-790"><a href="#cb31-790" aria-hidden="true" tabindex="-1"></a><span class="do">## Again, this can be anything. How about a table of alpha diversity metrics? </span></span>
<span id="cb31-791"><a href="#cb31-791" aria-hidden="true" tabindex="-1"></a><span class="do">## We actually have such a table that was generated way back up the road. </span></span>
<span id="cb31-792"><a href="#cb31-792" aria-hidden="true" tabindex="-1"></a><span class="do">## Just need to fix the column names.</span></span>
<span id="cb31-793"><a href="#cb31-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-794"><a href="#cb31-794" aria-hidden="true" tabindex="-1"></a>metadata_tab <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"files/metadata/tables/metadata.txt"</span>,</span>
<span id="cb31-795"><a href="#cb31-795" aria-hidden="true" tabindex="-1"></a>                           <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-796"><a href="#cb31-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-797"><a href="#cb31-797" aria-hidden="true" tabindex="-1"></a>tmp_x <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"files/alpha/rdata/its18_ps_pime.rds"</span>)</span>
<span id="cb31-798"><a href="#cb31-798" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_x))</span>
<span id="cb31-799"><a href="#cb31-799" aria-hidden="true" tabindex="-1"></a>metadata_tab[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">NULL</span>)</span>
<span id="cb31-800"><a href="#cb31-800" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-801"><a href="#cb31-801" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-802"><a href="#cb31-802" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb31-803"><a href="#cb31-803" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb31-804"><a href="#cb31-804" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"id"</span>)</span>
<span id="cb31-805"><a href="#cb31-805" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"no_asvs"</span> <span class="ot">=</span> <span class="st">"Observed"</span>)</span>
<span id="cb31-806"><a href="#cb31-806" aria-hidden="true" tabindex="-1"></a>     tmp_rc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">readcount</span>(tmp_get))</span>
<span id="cb31-807"><a href="#cb31-807" aria-hidden="true" tabindex="-1"></a>     tmp_rc <span class="ot">&lt;-</span> tmp_rc <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"id"</span>)</span>
<span id="cb31-808"><a href="#cb31-808" aria-hidden="true" tabindex="-1"></a>     tmp_rc <span class="ot">&lt;-</span> tmp_rc <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"no_reads"</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb31-809"><a href="#cb31-809" aria-hidden="true" tabindex="-1"></a>     <span class="co">#identical(tmp_df$id, tmp_rc$id)</span></span>
<span id="cb31-810"><a href="#cb31-810" aria-hidden="true" tabindex="-1"></a>     tmp_merge <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_df, tmp_rc)</span>
<span id="cb31-811"><a href="#cb31-811" aria-hidden="true" tabindex="-1"></a>     tmp_merge <span class="ot">&lt;-</span> tmp_merge[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">10</span>,<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb31-812"><a href="#cb31-812" aria-hidden="true" tabindex="-1"></a>     tmp_final <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_merge, metadata_tab, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"Sample_ID"</span>))</span>
<span id="cb31-813"><a href="#cb31-813" aria-hidden="true" tabindex="-1"></a>     tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-814"><a href="#cb31-814" aria-hidden="true" tabindex="-1"></a>     <span class="fu">write.table</span>(tmp_final, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"additional_views.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-815"><a href="#cb31-815" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-816"><a href="#cb31-816" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-817"><a href="#cb31-817" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-818"><a href="#cb31-818" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(metadata_tab)</span>
<span id="cb31-819"><a href="#cb31-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-820"><a href="#cb31-820" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-821"><a href="#cb31-821" aria-hidden="true" tabindex="-1"></a><span class="do">### 4. Taxon rank abundance by sample #</span></span>
<span id="cb31-822"><a href="#cb31-822" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb31-823"><a href="#cb31-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-824"><a href="#cb31-824" aria-hidden="true" tabindex="-1"></a><span class="do">## Turned out this was a little tricky to figure out, but thanks to a </span></span>
<span id="cb31-825"><a href="#cb31-825" aria-hidden="true" tabindex="-1"></a><span class="do">## [little nifty block of code](https://github.com/joey711/phyloseq/iitses/418#iitsecomment-262637034) </span></span>
<span id="cb31-826"><a href="#cb31-826" aria-hidden="true" tabindex="-1"></a><span class="do">## written by [guoyanzhao](https://github.com/guoyanzhao) on the phyloseq </span></span>
<span id="cb31-827"><a href="#cb31-827" aria-hidden="true" tabindex="-1"></a><span class="do">## Issues forum, it was a piece of cake. The code can be altered to take any </span></span>
<span id="cb31-828"><a href="#cb31-828" aria-hidden="true" tabindex="-1"></a><span class="do">## rank. See the post for an explanation.</span></span>
<span id="cb31-829"><a href="#cb31-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-830"><a href="#cb31-830" aria-hidden="true" tabindex="-1"></a><span class="do">## Anyway, the goal is to sum each taxon at some rank and present that as a </span></span>
<span id="cb31-831"><a href="#cb31-831" aria-hidden="true" tabindex="-1"></a><span class="do">## bar chart for each sample in the visualization. Anvi'o has a specific </span></span>
<span id="cb31-832"><a href="#cb31-832" aria-hidden="true" tabindex="-1"></a><span class="do">## format it needs where each row is a sample and each column is a taxon. </span></span>
<span id="cb31-833"><a href="#cb31-833" aria-hidden="true" tabindex="-1"></a><span class="do">## Taxa names need the prefix `t_&lt;RANK&gt;!`. For example, `t_class!` should be </span></span>
<span id="cb31-834"><a href="#cb31-834" aria-hidden="true" tabindex="-1"></a><span class="do">## added for Class rank.</span></span>
<span id="cb31-835"><a href="#cb31-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-836"><a href="#cb31-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-837"><a href="#cb31-837" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-838"><a href="#cb31-838" aria-hidden="true" tabindex="-1"></a>pick_rank <span class="ot">&lt;-</span> <span class="st">"Order"</span></span>
<span id="cb31-839"><a href="#cb31-839" aria-hidden="true" tabindex="-1"></a>pick_rank_l <span class="ot">&lt;-</span> <span class="st">"order"</span></span>
<span id="cb31-840"><a href="#cb31-840" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps_all) {</span>
<span id="cb31-841"><a href="#cb31-841" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table</span></span>
<span id="cb31-842"><a href="#cb31-842" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-843"><a href="#cb31-843" aria-hidden="true" tabindex="-1"></a>    tmp_glom <span class="ot">&lt;-</span> <span class="fu">tax_glom</span>(tmp_get, <span class="at">taxrank =</span> pick_rank)</span>
<span id="cb31-844"><a href="#cb31-844" aria-hidden="true" tabindex="-1"></a>    tmp_melt <span class="ot">&lt;-</span> <span class="fu">psmelt</span>(tmp_glom)</span>
<span id="cb31-845"><a href="#cb31-845" aria-hidden="true" tabindex="-1"></a>    tmp_melt[[pick_rank]] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_melt[[pick_rank]])</span>
<span id="cb31-846"><a href="#cb31-846" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Abundance <span class="sc">~</span> Sample <span class="sc">+</span> tmp_melt[[pick_rank]], tmp_melt, <span class="at">FUN =</span> sum)</span>
<span id="cb31-847"><a href="#cb31-847" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(tmp_abund)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"tax_rank"</span></span>
<span id="cb31-848"><a href="#cb31-848" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(reshape2)</span>
<span id="cb31-849"><a href="#cb31-849" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(reshape<span class="sc">::</span><span class="fu">cast</span>(tmp_abund, Sample <span class="sc">~</span> tax_rank))</span>
<span id="cb31-850"><a href="#cb31-850" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">remove_rownames</span>(tmp_abund)</span>
<span id="cb31-851"><a href="#cb31-851" aria-hidden="true" tabindex="-1"></a>    tmp_abund <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(tmp_abund, <span class="st">"Sample"</span>)</span>
<span id="cb31-852"><a href="#cb31-852" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder table column by sum</span></span>
<span id="cb31-853"><a href="#cb31-853" aria-hidden="true" tabindex="-1"></a>    tmp_layers <span class="ot">&lt;-</span> tmp_abund[,<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">colSums</span>(tmp_abund), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb31-854"><a href="#cb31-854" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the prefix</span></span>
<span id="cb31-855"><a href="#cb31-855" aria-hidden="true" tabindex="-1"></a>    tmp_layers <span class="ot">&lt;-</span> tmp_layers <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename_all</span>(<span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="st">"t_"</span>, pick_rank_l,<span class="st">"!"</span>, x))</span>
<span id="cb31-856"><a href="#cb31-856" aria-hidden="true" tabindex="-1"></a>    tmp_layers <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span> (tmp_layers, <span class="st">"taxon"</span>)</span>
<span id="cb31-857"><a href="#cb31-857" aria-hidden="true" tabindex="-1"></a><span class="co">#  save the dataframe</span></span>
<span id="cb31-858"><a href="#cb31-858" aria-hidden="true" tabindex="-1"></a>    tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(i, <span class="st">"_taxa"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-859"><a href="#cb31-859" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(tmp_name, tmp_layers)</span>
<span id="cb31-860"><a href="#cb31-860" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-861"><a href="#cb31-861" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-862"><a href="#cb31-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-863"><a href="#cb31-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-864"><a href="#cb31-864" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(its18_ps_work_taxa)</span>
<span id="cb31-865"><a href="#cb31-865" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(its18_ps_pime_taxa)</span>
<span id="cb31-866"><a href="#cb31-866" aria-hidden="true" tabindex="-1"></a><span class="do">## REORDER TAXA</span></span>
<span id="cb31-867"><a href="#cb31-867" aria-hidden="true" tabindex="-1"></a>its18_ps_work_taxa <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(its18_ps_work_taxa, <span class="fu">c</span>(</span>
<span id="cb31-868"><a href="#cb31-868" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Geastrales"</span>, </span>
<span id="cb31-869"><a href="#cb31-869" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Glomerales"</span>, </span>
<span id="cb31-870"><a href="#cb31-870" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Helotiales"</span>, </span>
<span id="cb31-871"><a href="#cb31-871" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Hypocreales"</span>, </span>
<span id="cb31-872"><a href="#cb31-872" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Saccharomycetales"</span>, </span>
<span id="cb31-873"><a href="#cb31-873" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Trichosporonales"</span>, </span>
<span id="cb31-874"><a href="#cb31-874" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Xylariales"</span>, </span>
<span id="cb31-875"><a href="#cb31-875" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Eurotiales"</span>, </span>
<span id="cb31-876"><a href="#cb31-876" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Capnodiales"</span>, </span>
<span id="cb31-877"><a href="#cb31-877" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Archaeorhizomycetales"</span>, </span>
<span id="cb31-878"><a href="#cb31-878" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Agaricales"</span>, </span>
<span id="cb31-879"><a href="#cb31-879" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!c_Agaricomycetes"</span>, </span>
<span id="cb31-880"><a href="#cb31-880" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!p_Ascomycota"</span>, </span>
<span id="cb31-881"><a href="#cb31-881" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!k_Fungi"</span></span>
<span id="cb31-882"><a href="#cb31-882" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb31-883"><a href="#cb31-883" aria-hidden="true" tabindex="-1"></a>  <span class="at">.after =</span> <span class="st">"taxon"</span> )</span>
<span id="cb31-884"><a href="#cb31-884" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(its18_ps_work_taxa, <span class="st">"include/pub/MAIN/anvio/its/its18_ps_work/tax_layers_mod.txt"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)  </span>
<span id="cb31-885"><a href="#cb31-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-886"><a href="#cb31-886" aria-hidden="true" tabindex="-1"></a>its18_ps_pime_taxa <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">relocate</span>(its18_ps_pime_taxa, <span class="fu">c</span>(</span>
<span id="cb31-887"><a href="#cb31-887" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Geastrales"</span>, </span>
<span id="cb31-888"><a href="#cb31-888" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Glomerales"</span>, </span>
<span id="cb31-889"><a href="#cb31-889" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Helotiales"</span>, </span>
<span id="cb31-890"><a href="#cb31-890" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Hypocreales"</span>, </span>
<span id="cb31-891"><a href="#cb31-891" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Saccharomycetales"</span>, </span>
<span id="cb31-892"><a href="#cb31-892" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Trichosporonales"</span>, </span>
<span id="cb31-893"><a href="#cb31-893" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Xylariales"</span>, </span>
<span id="cb31-894"><a href="#cb31-894" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Eurotiales"</span>, </span>
<span id="cb31-895"><a href="#cb31-895" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Capnodiales"</span>, </span>
<span id="cb31-896"><a href="#cb31-896" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Archaeorhizomycetales"</span>, </span>
<span id="cb31-897"><a href="#cb31-897" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!Agaricales"</span>, </span>
<span id="cb31-898"><a href="#cb31-898" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!c_Agaricomycetes"</span>, </span>
<span id="cb31-899"><a href="#cb31-899" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!p_Ascomycota"</span>, </span>
<span id="cb31-900"><a href="#cb31-900" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t_order!k_Fungi"</span></span>
<span id="cb31-901"><a href="#cb31-901" aria-hidden="true" tabindex="-1"></a>   ), <span class="at">.after =</span> <span class="st">"taxon"</span> )</span>
<span id="cb31-902"><a href="#cb31-902" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(its18_ps_pime_taxa, </span>
<span id="cb31-903"><a href="#cb31-903" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/MAIN/anvio/its/its18_ps_pime/tax_layers_mod.txt"</span>, </span>
<span id="cb31-904"><a href="#cb31-904" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)  </span>
<span id="cb31-905"><a href="#cb31-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-906"><a href="#cb31-906" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-907"><a href="#cb31-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-908"><a href="#cb31-908" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-909"><a href="#cb31-909" aria-hidden="true" tabindex="-1"></a><span class="do">### 5. Construct Dendrograms #</span></span>
<span id="cb31-910"><a href="#cb31-910" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-911"><a href="#cb31-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-912"><a href="#cb31-912" aria-hidden="true" tabindex="-1"></a><span class="do">## The last piece we need is to generate dendrograms that order the ASVs </span></span>
<span id="cb31-913"><a href="#cb31-913" aria-hidden="true" tabindex="-1"></a><span class="do">## by their distribution in the samples and the samples by their </span></span>
<span id="cb31-914"><a href="#cb31-914" aria-hidden="true" tabindex="-1"></a><span class="do">## ASV composition. For this task we will use anvi'o.</span></span>
<span id="cb31-915"><a href="#cb31-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-916"><a href="#cb31-916" aria-hidden="true" tabindex="-1"></a><span class="co">#bash_commands &lt;- c() USE this to combine all commands</span></span>
<span id="cb31-917"><a href="#cb31-917" aria-hidden="true" tabindex="-1"></a><span class="co"># including in loop creates separate files</span></span>
<span id="cb31-918"><a href="#cb31-918" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-919"><a href="#cb31-919" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-920"><a href="#cb31-920" aria-hidden="true" tabindex="-1"></a>      tmp_command_asv <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span id="cb31-921"><a href="#cb31-921" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span id="cb31-922"><a href="#cb31-922" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"asv.tre"</span>))</span>
<span id="cb31-923"><a href="#cb31-923" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_asv)</span>
<span id="cb31-924"><a href="#cb31-924" aria-hidden="true" tabindex="-1"></a>      tmp_command_samp <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data.txt"</span>,</span>
<span id="cb31-925"><a href="#cb31-925" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span id="cb31-926"><a href="#cb31-926" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"sample.tre --transpose"</span>))</span>
<span id="cb31-927"><a href="#cb31-927" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_samp)</span>
<span id="cb31-928"><a href="#cb31-928" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-929"><a href="#cb31-929" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write</span>(bash_commands, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"tre.sh"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-930"><a href="#cb31-930" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-931"><a href="#cb31-931" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-932"><a href="#cb31-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-933"><a href="#cb31-933" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-934"><a href="#cb31-934" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-935"><a href="#cb31-935" aria-hidden="true" tabindex="-1"></a>      tmp_command_asv <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span id="cb31-936"><a href="#cb31-936" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance euclidean --linkage ward -o "</span>,</span>
<span id="cb31-937"><a href="#cb31-937" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"asv_trans.tre"</span>))</span>
<span id="cb31-938"><a href="#cb31-938" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_asv)</span>
<span id="cb31-939"><a href="#cb31-939" aria-hidden="true" tabindex="-1"></a>      tmp_command_samp <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"anvi-matrix-to-newick data_trans.txt"</span>,</span>
<span id="cb31-940"><a href="#cb31-940" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">" --distance braycurtis --linkage complete -o "</span>,</span>
<span id="cb31-941"><a href="#cb31-941" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"sample_trans.tre --transpose"</span>))</span>
<span id="cb31-942"><a href="#cb31-942" aria-hidden="true" tabindex="-1"></a>      bash_commands <span class="ot">&lt;-</span> <span class="fu">append</span>(bash_commands, tmp_command_samp)</span>
<span id="cb31-943"><a href="#cb31-943" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-944"><a href="#cb31-944" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write</span>(bash_commands, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"tre_transformed.sh"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-945"><a href="#cb31-945" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-946"><a href="#cb31-946" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-947"><a href="#cb31-947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-948"><a href="#cb31-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-951"><a href="#cb31-951" aria-hidden="true" tabindex="-1"></a><span class="in">```{bash}</span></span>
<span id="cb31-952"><a href="#cb31-952" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in anvi'o via a bash script"</span></span>
<span id="cb31-953"><a href="#cb31-953" aria-hidden="true" tabindex="-1"></a><span class="co">#NEED to run in anvio from base dir</span></span>
<span id="cb31-954"><a href="#cb31-954" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> its18_ps_pime</span>
<span id="cb31-955"><a href="#cb31-955" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre.sh</span>
<span id="cb31-956"><a href="#cb31-956" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> tre_transformed.sh</span>
<span id="cb31-957"><a href="#cb31-957" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../</span>
<span id="cb31-958"><a href="#cb31-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-959"><a href="#cb31-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-960"><a href="#cb31-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-963"><a href="#cb31-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-964"><a href="#cb31-964" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in R"</span></span>
<span id="cb31-965"><a href="#cb31-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-966"><a href="#cb31-966" aria-hidden="true" tabindex="-1"></a><span class="do">## Alternatively, we can generate dendrograms using `phyloseq::distance` and `hclust`. </span></span>
<span id="cb31-967"><a href="#cb31-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-968"><a href="#cb31-968" aria-hidden="true" tabindex="-1"></a>pick_dist <span class="ot">&lt;-</span> <span class="st">"bray"</span></span>
<span id="cb31-969"><a href="#cb31-969" aria-hidden="true" tabindex="-1"></a>pick_clust <span class="ot">&lt;-</span> <span class="st">"complete"</span></span>
<span id="cb31-970"><a href="#cb31-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-971"><a href="#cb31-971" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-972"><a href="#cb31-972" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table</span></span>
<span id="cb31-973"><a href="#cb31-973" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-974"><a href="#cb31-974" aria-hidden="true" tabindex="-1"></a>    tmp_dist <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(<span class="at">physeq =</span> tmp_get, <span class="at">method =</span> pick_dist, <span class="at">type =</span> <span class="st">"sample"</span>)</span>
<span id="cb31-975"><a href="#cb31-975" aria-hidden="true" tabindex="-1"></a>    tmp_dend <span class="ot">&lt;-</span> <span class="fu">hclust</span>(tmp_dist, <span class="at">method =</span> pick_clust)</span>
<span id="cb31-976"><a href="#cb31-976" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(tmp_dend, <span class="at">hang =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb31-977"><a href="#cb31-977" aria-hidden="true" tabindex="-1"></a>    tmp_tree <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(tmp_dend) </span>
<span id="cb31-978"><a href="#cb31-978" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-979"><a href="#cb31-979" aria-hidden="true" tabindex="-1"></a>    tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-980"><a href="#cb31-980" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.tree</span>(<span class="at">phy =</span> tmp_tree, <span class="at">file =</span> <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_"</span>, pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-981"><a href="#cb31-981" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-982"><a href="#cb31-982" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-983"><a href="#cb31-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-984"><a href="#cb31-984" aria-hidden="true" tabindex="-1"></a>pick_dist_asv <span class="ot">&lt;-</span> <span class="st">"euclidean"</span></span>
<span id="cb31-985"><a href="#cb31-985" aria-hidden="true" tabindex="-1"></a>pick_clust_asv <span class="ot">&lt;-</span> <span class="st">"ward"</span></span>
<span id="cb31-986"><a href="#cb31-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-987"><a href="#cb31-987" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-988"><a href="#cb31-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table</span></span>
<span id="cb31-989"><a href="#cb31-989" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-990"><a href="#cb31-990" aria-hidden="true" tabindex="-1"></a>    tmp_dist <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(<span class="at">physeq =</span> tmp_get, <span class="at">method =</span> pick_dist_asv, <span class="at">type =</span> <span class="st">"taxa"</span>)</span>
<span id="cb31-991"><a href="#cb31-991" aria-hidden="true" tabindex="-1"></a>    tmp_dend <span class="ot">&lt;-</span> <span class="fu">hclust</span>(tmp_dist, <span class="at">method =</span> pick_clust_asv)</span>
<span id="cb31-992"><a href="#cb31-992" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(tmp_dend, <span class="at">hang =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb31-993"><a href="#cb31-993" aria-hidden="true" tabindex="-1"></a>    tmp_tree <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(tmp_dend) </span>
<span id="cb31-994"><a href="#cb31-994" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-995"><a href="#cb31-995" aria-hidden="true" tabindex="-1"></a>    tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-996"><a href="#cb31-996" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.tree</span>(<span class="at">phy =</span> tmp_tree, <span class="at">file =</span> <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"asv_"</span>, pick_dist_asv, <span class="st">"_"</span>, pick_clust_asv, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-997"><a href="#cb31-997" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-998"><a href="#cb31-998" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-999"><a href="#cb31-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1000"><a href="#cb31-1000" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-1001"><a href="#cb31-1001" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-1002"><a href="#cb31-1002" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-1003"><a href="#cb31-1003" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[</span><span class="sc">\r\n</span><span class="st">]"</span>, <span class="st">""</span>, tmp_tree)</span>
<span id="cb31-1004"><a href="#cb31-1004" aria-hidden="true" tabindex="-1"></a>      tmp_item <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bray_complete"</span>)</span>
<span id="cb31-1005"><a href="#cb31-1005" aria-hidden="true" tabindex="-1"></a>      tmp_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"newick"</span>)</span>
<span id="cb31-1006"><a href="#cb31-1006" aria-hidden="true" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_tree)</span>
<span id="cb31-1007"><a href="#cb31-1007" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_item, tmp_type, tmp_df)</span>
<span id="cb31-1008"><a href="#cb31-1008" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(janitor)</span>
<span id="cb31-1009"><a href="#cb31-1009" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span>
<span id="cb31-1010"><a href="#cb31-1010" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(tmp_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span>)</span>
<span id="cb31-1011"><a href="#cb31-1011" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(tmp_tab, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-1012"><a href="#cb31-1012" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">""</span>)</span>
<span id="cb31-1013"><a href="#cb31-1013" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-1014"><a href="#cb31-1014" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-1015"><a href="#cb31-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1016"><a href="#cb31-1016" aria-hidden="true" tabindex="-1"></a><span class="co"># FOR TRANSFORMED DATA</span></span>
<span id="cb31-1017"><a href="#cb31-1017" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-1018"><a href="#cb31-1018" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-1019"><a href="#cb31-1019" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>,<span class="st">"sample_trans.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-1020"><a href="#cb31-1020" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[</span><span class="sc">\r\n</span><span class="st">]"</span>, <span class="st">""</span>, tmp_tree)</span>
<span id="cb31-1021"><a href="#cb31-1021" aria-hidden="true" tabindex="-1"></a>      tmp_item <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bray_complete"</span>)</span>
<span id="cb31-1022"><a href="#cb31-1022" aria-hidden="true" tabindex="-1"></a>      tmp_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"newick"</span>)</span>
<span id="cb31-1023"><a href="#cb31-1023" aria-hidden="true" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_tree)</span>
<span id="cb31-1024"><a href="#cb31-1024" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_item, tmp_type, tmp_df)</span>
<span id="cb31-1025"><a href="#cb31-1025" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(janitor)</span>
<span id="cb31-1026"><a href="#cb31-1026" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span>
<span id="cb31-1027"><a href="#cb31-1027" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(tmp_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span>)</span>
<span id="cb31-1028"><a href="#cb31-1028" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(tmp_tab, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_trans.tre"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-1029"><a href="#cb31-1029" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">""</span>)</span>
<span id="cb31-1030"><a href="#cb31-1030" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-1031"><a href="#cb31-1031" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-1032"><a href="#cb31-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1033"><a href="#cb31-1033" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-1034"><a href="#cb31-1034" aria-hidden="true" tabindex="-1"></a>      tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-1035"><a href="#cb31-1035" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">read_file</span>(<span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_"</span>, pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-1036"><a href="#cb31-1036" aria-hidden="true" tabindex="-1"></a>      tmp_tree <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[</span><span class="sc">\r\n</span><span class="st">]"</span>, <span class="st">""</span>, tmp_tree)</span>
<span id="cb31-1037"><a href="#cb31-1037" aria-hidden="true" tabindex="-1"></a>      tmp_item <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">"_hclust"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb31-1038"><a href="#cb31-1038" aria-hidden="true" tabindex="-1"></a>      tmp_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"newick"</span>)</span>
<span id="cb31-1039"><a href="#cb31-1039" aria-hidden="true" tabindex="-1"></a>      tmp_df <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_tree)</span>
<span id="cb31-1040"><a href="#cb31-1040" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_item, tmp_type, tmp_df)</span>
<span id="cb31-1041"><a href="#cb31-1041" aria-hidden="true" tabindex="-1"></a>      <span class="fu">library</span>(janitor)</span>
<span id="cb31-1042"><a href="#cb31-1042" aria-hidden="true" tabindex="-1"></a>      tmp_tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span>
<span id="cb31-1043"><a href="#cb31-1043" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(tmp_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"item_name"</span>,   <span class="st">"data_type"</span>,    <span class="st">"data_value"</span>)</span>
<span id="cb31-1044"><a href="#cb31-1044" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write.table</span>(tmp_tab, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, <span class="st">"sample_"</span>, pick_dist, <span class="st">"_"</span>, pick_clust, <span class="st">".tre"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-1045"><a href="#cb31-1045" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">na =</span> <span class="st">""</span>)</span>
<span id="cb31-1046"><a href="#cb31-1046" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-1047"><a href="#cb31-1047" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-1048"><a href="#cb31-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1049"><a href="#cb31-1049" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-1050"><a href="#cb31-1050" aria-hidden="true" tabindex="-1"></a><span class="do">### 6. Make a fasta file #####</span></span>
<span id="cb31-1051"><a href="#cb31-1051" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb31-1052"><a href="#cb31-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1053"><a href="#cb31-1053" aria-hidden="true" tabindex="-1"></a><span class="do">## We don't need to add a fasta file, but it is a nice way to keep </span></span>
<span id="cb31-1054"><a href="#cb31-1054" aria-hidden="true" tabindex="-1"></a><span class="do">## everything in one place. Plus, you can do BLAST searches directly </span></span>
<span id="cb31-1055"><a href="#cb31-1055" aria-hidden="true" tabindex="-1"></a><span class="do">## in the interface by right clicking on the ASV of interest, so it is nice </span></span>
<span id="cb31-1056"><a href="#cb31-1056" aria-hidden="true" tabindex="-1"></a><span class="do">## to have the sequences.</span></span>
<span id="cb31-1057"><a href="#cb31-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1058"><a href="#cb31-1058" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb31-1059"><a href="#cb31-1059" aria-hidden="true" tabindex="-1"></a>       tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_trim"</span>)))</span>
<span id="cb31-1060"><a href="#cb31-1060" aria-hidden="true" tabindex="-1"></a>       tmp_tab <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(tmp_get)</span>
<span id="cb31-1061"><a href="#cb31-1061" aria-hidden="true" tabindex="-1"></a>       tmp_tab <span class="ot">&lt;-</span> tmp_tab[, <span class="dv">7</span>]</span>
<span id="cb31-1062"><a href="#cb31-1062" aria-hidden="true" tabindex="-1"></a>       tmp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">row.names</span>(tmp_tab), tmp_tab)</span>
<span id="cb31-1063"><a href="#cb31-1063" aria-hidden="true" tabindex="-1"></a>       <span class="fu">colnames</span>(tmp_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ASV_ID"</span>, <span class="st">"ASV_SEQ"</span>)</span>
<span id="cb31-1064"><a href="#cb31-1064" aria-hidden="true" tabindex="-1"></a>       tmp_df<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"&gt;"</span>, tmp_df<span class="sc">$</span>ASV_ID)</span>
<span id="cb31-1065"><a href="#cb31-1065" aria-hidden="true" tabindex="-1"></a>       tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/MAIN/anvio/its/"</span>)</span>
<span id="cb31-1066"><a href="#cb31-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1067"><a href="#cb31-1067" aria-hidden="true" tabindex="-1"></a>       <span class="fu">write.table</span>(tmp_df, <span class="fu">paste</span>(tmp_path, i, <span class="st">"/"</span>, i, <span class="st">".fasta"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-1068"><a href="#cb31-1068" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">col.names =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-1069"><a href="#cb31-1069" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb31-1070"><a href="#cb31-1070" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-1071"><a href="#cb31-1071" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-1072"><a href="#cb31-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-1073"><a href="#cb31-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1076"><a href="#cb31-1076" aria-hidden="true" tabindex="-1"></a><span class="in">```{bash}</span></span>
<span id="cb31-1077"><a href="#cb31-1077" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "This code is run in anvi'o"</span></span>
<span id="cb31-1078"><a href="#cb31-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1079"><a href="#cb31-1079" aria-hidden="true" tabindex="-1"></a><span class="co">### Building the Profile Database</span></span>
<span id="cb31-1080"><a href="#cb31-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1081"><a href="#cb31-1081" aria-hidden="true" tabindex="-1"></a><span class="co">## Time to put all of these pieces together. This gets a little tricky </span></span>
<span id="cb31-1082"><a href="#cb31-1082" aria-hidden="true" tabindex="-1"></a><span class="co">## since we do not have a database to start with because some of these </span></span>
<span id="cb31-1083"><a href="#cb31-1083" aria-hidden="true" tabindex="-1"></a><span class="co">## files can be loaded directly in the interface but some need to be added </span></span>
<span id="cb31-1084"><a href="#cb31-1084" aria-hidden="true" tabindex="-1"></a><span class="co">## to a database. When we fire up the interactive in `--manual` mode, we </span></span>
<span id="cb31-1085"><a href="#cb31-1085" aria-hidden="true" tabindex="-1"></a><span class="co">## ***must*** give anvi'o the name of a database and it will *create* that </span></span>
<span id="cb31-1086"><a href="#cb31-1086" aria-hidden="true" tabindex="-1"></a><span class="co">## database for us. Then we can shut down the interactive, add the necessary </span></span>
<span id="cb31-1087"><a href="#cb31-1087" aria-hidden="true" tabindex="-1"></a><span class="co">## data files, and start back up.</span></span>
<span id="cb31-1088"><a href="#cb31-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1089"><a href="#cb31-1089" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb31-1090"><a href="#cb31-1090" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb31-1091"><a href="#cb31-1091" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb31-1092"><a href="#cb31-1092" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-1093"><a href="#cb31-1093" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span>
<span id="cb31-1094"><a href="#cb31-1094" aria-hidden="true" tabindex="-1"></a><span class="co">## Now we have a new profile database that we can add the sample metadata </span></span>
<span id="cb31-1095"><a href="#cb31-1095" aria-hidden="true" tabindex="-1"></a><span class="co">## (`additional_layers.txt`) and the sample dendrogram (sample.tre) using the </span></span>
<span id="cb31-1096"><a href="#cb31-1096" aria-hidden="true" tabindex="-1"></a><span class="co">## command `anvi-import-misc-data`. These commands add the table to the new </span></span>
<span id="cb31-1097"><a href="#cb31-1097" aria-hidden="true" tabindex="-1"></a><span class="co">## `profile.db`. First, kill the interactive.</span></span>
<span id="cb31-1098"><a href="#cb31-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1099"><a href="#cb31-1099" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> additional_views.txt <span class="dt">\</span></span>
<span id="cb31-1100"><a href="#cb31-1100" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-1101"><a href="#cb31-1101" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb31-1102"><a href="#cb31-1102" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> sample.tre <span class="dt">\</span></span>
<span id="cb31-1103"><a href="#cb31-1103" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-1104"><a href="#cb31-1104" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layer_orders</span>
<span id="cb31-1105"><a href="#cb31-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1106"><a href="#cb31-1106" aria-hidden="true" tabindex="-1"></a><span class="co">## One last this is to get the table with the taxonomy total by sample </span></span>
<span id="cb31-1107"><a href="#cb31-1107" aria-hidden="true" tabindex="-1"></a><span class="co">## (`tax_layers.txt`) into the profile database. We will run the same </span></span>
<span id="cb31-1108"><a href="#cb31-1108" aria-hidden="true" tabindex="-1"></a><span class="co">## command we just used.</span></span>
<span id="cb31-1109"><a href="#cb31-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1110"><a href="#cb31-1110" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-import-misc-data</span> tax_layers.txt <span class="dt">\</span></span>
<span id="cb31-1111"><a href="#cb31-1111" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--pan-or-profile-db</span> profile.db <span class="dt">\</span></span>
<span id="cb31-1112"><a href="#cb31-1112" aria-hidden="true" tabindex="-1"></a>                      <span class="at">--target-data-table</span> layers</span>
<span id="cb31-1113"><a href="#cb31-1113" aria-hidden="true" tabindex="-1"></a><span class="co">## In fact, we could just as easily append the taxonomy total data onto </span></span>
<span id="cb31-1114"><a href="#cb31-1114" aria-hidden="true" tabindex="-1"></a><span class="co">## the `additional_layers.txt` and import in one command. But we didn't.</span></span>
<span id="cb31-1115"><a href="#cb31-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1116"><a href="#cb31-1116" aria-hidden="true" tabindex="-1"></a><span class="co">### Interactive Interface</span></span>
<span id="cb31-1117"><a href="#cb31-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1118"><a href="#cb31-1118" aria-hidden="true" tabindex="-1"></a><span class="co">## With a populated database in hand, we can now begin modifying the </span></span>
<span id="cb31-1119"><a href="#cb31-1119" aria-hidden="true" tabindex="-1"></a><span class="co">## visual by running the interactive command again.</span></span>
<span id="cb31-1120"><a href="#cb31-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1121"><a href="#cb31-1121" aria-hidden="true" tabindex="-1"></a><span class="ex">anvi-interactive</span> <span class="at">--view-data</span> data.txt <span class="dt">\</span></span>
<span id="cb31-1122"><a href="#cb31-1122" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--tree</span> asv.tre <span class="dt">\</span></span>
<span id="cb31-1123"><a href="#cb31-1123" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--additional-layers</span> additional_layers.txt <span class="dt">\</span></span>
<span id="cb31-1124"><a href="#cb31-1124" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--profile-db</span> profile.db</span>
<span id="cb31-1125"><a href="#cb31-1125" aria-hidden="true" tabindex="-1"></a>                 <span class="ex">--fasta-file</span> anvio.fasta <span class="dt">\</span></span>
<span id="cb31-1126"><a href="#cb31-1126" aria-hidden="true" tabindex="-1"></a>                 <span class="at">--manual</span></span>
<span id="cb31-1127"><a href="#cb31-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-1128"><a href="#cb31-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1129"><a href="#cb31-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure 2</span></span>
<span id="cb31-1130"><a href="#cb31-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1131"><a href="#cb31-1131" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-1132"><a href="#cb31-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1133"><a href="#cb31-1133" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-1134"><a href="#cb31-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1135"><a href="#cb31-1135" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb31-1136"><a href="#cb31-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1137"><a href="#cb31-1137" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1138"><a href="#cb31-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1139"><a href="#cb31-1139" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-1140"><a href="#cb31-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1141"><a href="#cb31-1141" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-1142"><a href="#cb31-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1143"><a href="#cb31-1143" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/MAIN/Figure_2.png)</span></span>
<span id="cb31-1144"><a href="#cb31-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1145"><a href="#cb31-1145" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-1146"><a href="#cb31-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1147"><a href="#cb31-1147" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/MAIN/FIGURES/Figure_2.png)</span></span>
<span id="cb31-1148"><a href="#cb31-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1149"><a href="#cb31-1149" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1150"><a href="#cb31-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1151"><a href="#cb31-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1152"><a href="#cb31-1152" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-1153"><a href="#cb31-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1154"><a href="#cb31-1154" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-1155"><a href="#cb31-1155" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Figure 2 data pack</span><span class="co">](include/pub/MAIN/Figure_2.rdata)</span>  </span>
<span id="cb31-1156"><a href="#cb31-1156" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1157"><a href="#cb31-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1158"><a href="#cb31-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1159"><a href="#cb31-1159" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-1160"><a href="#cb31-1160" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Figure 2 raw pdf</span><span class="co">](include/pub/MAIN/Figure_2.pdf)</span></span>
<span id="cb31-1161"><a href="#cb31-1161" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1162"><a href="#cb31-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1163"><a href="#cb31-1163" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1164"><a href="#cb31-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1165"><a href="#cb31-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1168"><a href="#cb31-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-1169"><a href="#cb31-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Figure 2"</span></span>
<span id="cb31-1170"><a href="#cb31-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1171"><a href="#cb31-1171" aria-hidden="true" tabindex="-1"></a><span class="do">###################### For composite figure main text Tmin and Xylanase Vmax</span></span>
<span id="cb31-1172"><a href="#cb31-1172" aria-hidden="true" tabindex="-1"></a><span class="co">#load data</span></span>
<span id="cb31-1173"><a href="#cb31-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-1174"><a href="#cb31-1174" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/MAIN/Figure_2.rdata"</span>)</span>
<span id="cb31-1175"><a href="#cb31-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1176"><a href="#cb31-1176" aria-hidden="true" tabindex="-1"></a><span class="co">#Box plots Tmin and Xylanase (use mean vals by plot from metadata)</span></span>
<span id="cb31-1177"><a href="#cb31-1177" aria-hidden="true" tabindex="-1"></a>diversity_meta.TminXyl <span class="ot">&lt;-</span></span>
<span id="cb31-1178"><a href="#cb31-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(diversity_meta.long,  measure <span class="sc">==</span> <span class="st">"Tmin"</span> <span class="sc">|</span></span>
<span id="cb31-1179"><a href="#cb31-1179" aria-hidden="true" tabindex="-1"></a>           measure <span class="sc">==</span> <span class="st">"XYL_micC"</span>)</span>
<span id="cb31-1180"><a href="#cb31-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1181"><a href="#cb31-1181" aria-hidden="true" tabindex="-1"></a>plot.Tminxyl <span class="ot">&lt;-</span></span>
<span id="cb31-1182"><a href="#cb31-1182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(diversity_meta.TminXyl, <span class="fu">aes</span>(<span class="at">x =</span> TREAT, <span class="at">y =</span> value), <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb31-1183"><a href="#cb31-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb31-1184"><a href="#cb31-1184" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> diversity_meta.TminXyl,</span>
<span id="cb31-1185"><a href="#cb31-1185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(TREAT, value , <span class="at">fill =</span> TREAT),</span>
<span id="cb31-1186"><a href="#cb31-1186" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb31-1187"><a href="#cb31-1187" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-1188"><a href="#cb31-1188" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier.colour =</span> <span class="st">"grey"</span></span>
<span id="cb31-1189"><a href="#cb31-1189" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-1190"><a href="#cb31-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb31-1191"><a href="#cb31-1191" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span>  . <span class="sc">~</span> measure,</span>
<span id="cb31-1192"><a href="#cb31-1192" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb31-1193"><a href="#cb31-1193" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb31-1194"><a href="#cb31-1194" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">"left"</span>,</span>
<span id="cb31-1195"><a href="#cb31-1195" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="at">Tmin =</span> <span class="st">"Tmin (°C)"</span>, <span class="at">XYL_micC =</span> <span class="st">"β-xylanase Vmax per micC at AST"</span>))</span>
<span id="cb31-1196"><a href="#cb31-1196" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-1197"><a href="#cb31-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-1198"><a href="#cb31-1198" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1199"><a href="#cb31-1199" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-1200"><a href="#cb31-1200" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1201"><a href="#cb31-1201" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1202"><a href="#cb31-1202" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1203"><a href="#cb31-1203" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-1204"><a href="#cb31-1204" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1205"><a href="#cb31-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-1206"><a href="#cb31-1206" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1207"><a href="#cb31-1207" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-1208"><a href="#cb31-1208" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1209"><a href="#cb31-1209" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1210"><a href="#cb31-1210" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1211"><a href="#cb31-1211" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-1212"><a href="#cb31-1212" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1213"><a href="#cb31-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-1214"><a href="#cb31-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-1215"><a href="#cb31-1215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-1216"><a href="#cb31-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-1217"><a href="#cb31-1217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-1218"><a href="#cb31-1218" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1219"><a href="#cb31-1219" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb31-1220"><a href="#cb31-1220" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1221"><a href="#cb31-1221" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-1222"><a href="#cb31-1222" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1223"><a href="#cb31-1223" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb31-1224"><a href="#cb31-1224" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb31-1225"><a href="#cb31-1225" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1226"><a href="#cb31-1226" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb31-1227"><a href="#cb31-1227" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-1228"><a href="#cb31-1228" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-1229"><a href="#cb31-1229" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-1230"><a href="#cb31-1230" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1231"><a href="#cb31-1231" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1232"><a href="#cb31-1232" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb31-1233"><a href="#cb31-1233" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1234"><a href="#cb31-1234" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-1235"><a href="#cb31-1235" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-1236"><a href="#cb31-1236" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1237"><a href="#cb31-1237" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1238"><a href="#cb31-1238" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1239"><a href="#cb31-1239" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1240"><a href="#cb31-1240" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb31-1241"><a href="#cb31-1241" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1242"><a href="#cb31-1242" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-1243"><a href="#cb31-1243" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-1244"><a href="#cb31-1244" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1245"><a href="#cb31-1245" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1246"><a href="#cb31-1246" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1247"><a href="#cb31-1247" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1248"><a href="#cb31-1248" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb31-1249"><a href="#cb31-1249" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1250"><a href="#cb31-1250" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1251"><a href="#cb31-1251" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb31-1252"><a href="#cb31-1252" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1253"><a href="#cb31-1253" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1254"><a href="#cb31-1254" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1255"><a href="#cb31-1255" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1256"><a href="#cb31-1256" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-1257"><a href="#cb31-1257" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-1258"><a href="#cb31-1258" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1259"><a href="#cb31-1259" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-1260"><a href="#cb31-1260" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1261"><a href="#cb31-1261" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-1262"><a href="#cb31-1262" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1263"><a href="#cb31-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1264"><a href="#cb31-1264" aria-hidden="true" tabindex="-1"></a>plot.Tminxyl</span>
<span id="cb31-1265"><a href="#cb31-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1266"><a href="#cb31-1266" aria-hidden="true" tabindex="-1"></a><span class="co">#Scatter plots Tmin and Xylanase</span></span>
<span id="cb31-1267"><a href="#cb31-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1268"><a href="#cb31-1268" aria-hidden="true" tabindex="-1"></a><span class="co">#rename levels</span></span>
<span id="cb31-1269"><a href="#cb31-1269" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Tmindata<span class="sc">$</span>treat)[<span class="fu">levels</span>(Tmindata<span class="sc">$</span>treat) <span class="sc">==</span>  <span class="st">"C"</span>] <span class="ot">&lt;-</span> <span class="st">"Control"</span></span>
<span id="cb31-1270"><a href="#cb31-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Tmindata<span class="sc">$</span>treat)[<span class="fu">levels</span>(Tmindata<span class="sc">$</span>treat) <span class="sc">==</span> <span class="st">"W3"</span>] <span class="ot">&lt;-</span> <span class="st">"+3°C"</span></span>
<span id="cb31-1271"><a href="#cb31-1271" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Tmindata<span class="sc">$</span>treat)[<span class="fu">levels</span>(Tmindata<span class="sc">$</span>treat) <span class="sc">==</span> <span class="st">"W8"</span>] <span class="ot">&lt;-</span> <span class="st">"+8°C"</span></span>
<span id="cb31-1272"><a href="#cb31-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1273"><a href="#cb31-1273" aria-hidden="true" tabindex="-1"></a><span class="co">#Xylanase plot</span></span>
<span id="cb31-1274"><a href="#cb31-1274" aria-hidden="true" tabindex="-1"></a>enzvmax.XY <span class="ot">&lt;-</span> <span class="fu">subset</span>(enzvmax, enzyme <span class="sc">==</span> <span class="st">"XYase"</span>)</span>
<span id="cb31-1275"><a href="#cb31-1275" aria-hidden="true" tabindex="-1"></a>enzvmax.XY<span class="sc">$</span>Vmax.log <span class="ot">&lt;-</span> <span class="fu">log</span>(enzvmax.XY<span class="sc">$</span>Vmax)</span>
<span id="cb31-1276"><a href="#cb31-1276" aria-hidden="true" tabindex="-1"></a>enzvmax.XY<span class="sc">$</span>Vmax.SQRT <span class="ot">&lt;-</span> (enzvmax.XY<span class="sc">$</span>Vmax) <span class="sc">^</span> <span class="fl">0.5</span></span>
<span id="cb31-1277"><a href="#cb31-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1278"><a href="#cb31-1278" aria-hidden="true" tabindex="-1"></a>plot.vmax.XY <span class="ot">&lt;-</span></span>
<span id="cb31-1279"><a href="#cb31-1279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(enzvmax.XY, <span class="fu">aes</span>(<span class="at">x =</span> assayT, <span class="at">y =</span> Vmax.SQRT), <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb31-1280"><a href="#cb31-1280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb31-1281"><a href="#cb31-1281" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> assayT,</span>
<span id="cb31-1282"><a href="#cb31-1282" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> Vmax.SQRT,</span>
<span id="cb31-1283"><a href="#cb31-1283" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">factor</span>(Treat),</span>
<span id="cb31-1284"><a href="#cb31-1284" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb31-1285"><a href="#cb31-1285" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb31-1286"><a href="#cb31-1286" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1287"><a href="#cb31-1287" aria-hidden="true" tabindex="-1"></a><span class="do">## forcats::fct_relevel(Treat, "Control", "+3°C", "+8°C")  </span></span>
<span id="cb31-1288"><a href="#cb31-1288" aria-hidden="true" tabindex="-1"></a><span class="do">## Added by JJS to order facets  </span></span>
<span id="cb31-1289"><a href="#cb31-1289" aria-hidden="true" tabindex="-1"></a><span class="do">## Changed color order as well  </span></span>
<span id="cb31-1290"><a href="#cb31-1290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-1291"><a href="#cb31-1291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(Treat, <span class="st">"Control"</span>, <span class="st">"+3°C"</span>, <span class="st">"+8°C"</span>) <span class="sc">~</span> enzyme,</span>
<span id="cb31-1292"><a href="#cb31-1292" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb31-1293"><a href="#cb31-1293" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-1294"><a href="#cb31-1294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-1295"><a href="#cb31-1295" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span id="cb31-1296"><a href="#cb31-1296" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-1297"><a href="#cb31-1297" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-1298"><a href="#cb31-1298" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-1299"><a href="#cb31-1299" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-1300"><a href="#cb31-1300" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>  <span class="co"># blue</span></span>
<span id="cb31-1301"><a href="#cb31-1301" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1302"><a href="#cb31-1302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-1303"><a href="#cb31-1303" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span id="cb31-1304"><a href="#cb31-1304" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-1305"><a href="#cb31-1305" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-1306"><a href="#cb31-1306" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-1307"><a href="#cb31-1307" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-1308"><a href="#cb31-1308" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span> <span class="co"># blue</span></span>
<span id="cb31-1309"><a href="#cb31-1309" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1310"><a href="#cb31-1310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb31-1311"><a href="#cb31-1311" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.data =</span> mean_cl_normal,</span>
<span id="cb31-1312"><a href="#cb31-1312" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"errorbar"</span>,</span>
<span id="cb31-1313"><a href="#cb31-1313" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb31-1314"><a href="#cb31-1314" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb31-1315"><a href="#cb31-1315" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-1316"><a href="#cb31-1316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb31-1317"><a href="#cb31-1317" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> T,</span>
<span id="cb31-1318"><a href="#cb31-1318" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> lm,</span>
<span id="cb31-1319"><a href="#cb31-1319" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"grey20"</span>,</span>
<span id="cb31-1320"><a href="#cb31-1320" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb31-1321"><a href="#cb31-1321" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-1322"><a href="#cb31-1322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">'B-Xylanase Vmax [SQRT(nmol MU/g/min)]'</span>)) <span class="sc">+</span></span>
<span id="cb31-1323"><a href="#cb31-1323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">'Temperature (°C)'</span>)) <span class="sc">+</span></span>
<span id="cb31-1324"><a href="#cb31-1324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.7</span>)) <span class="sc">+</span></span>
<span id="cb31-1325"><a href="#cb31-1325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-1326"><a href="#cb31-1326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-1327"><a href="#cb31-1327" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1328"><a href="#cb31-1328" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb31-1329"><a href="#cb31-1329" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-1330"><a href="#cb31-1330" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-1331"><a href="#cb31-1331" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1332"><a href="#cb31-1332" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1333"><a href="#cb31-1333" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb31-1334"><a href="#cb31-1334" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1335"><a href="#cb31-1335" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1336"><a href="#cb31-1336" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1337"><a href="#cb31-1337" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1338"><a href="#cb31-1338" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1339"><a href="#cb31-1339" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1340"><a href="#cb31-1340" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1341"><a href="#cb31-1341" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1342"><a href="#cb31-1342" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb31-1343"><a href="#cb31-1343" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1344"><a href="#cb31-1344" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-1345"><a href="#cb31-1345" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-1346"><a href="#cb31-1346" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1347"><a href="#cb31-1347" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1348"><a href="#cb31-1348" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1349"><a href="#cb31-1349" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1350"><a href="#cb31-1350" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb31-1351"><a href="#cb31-1351" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1352"><a href="#cb31-1352" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1353"><a href="#cb31-1353" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-1354"><a href="#cb31-1354" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1355"><a href="#cb31-1355" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1356"><a href="#cb31-1356" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1357"><a href="#cb31-1357" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1358"><a href="#cb31-1358" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb31-1359"><a href="#cb31-1359" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-1360"><a href="#cb31-1360" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1361"><a href="#cb31-1361" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1362"><a href="#cb31-1362" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1363"><a href="#cb31-1363" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-1364"><a href="#cb31-1364" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1365"><a href="#cb31-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1366"><a href="#cb31-1366" aria-hidden="true" tabindex="-1"></a><span class="co">#Tmin plot</span></span>
<span id="cb31-1367"><a href="#cb31-1367" aria-hidden="true" tabindex="-1"></a>plot.Tmin_forVmax <span class="ot">&lt;-</span></span>
<span id="cb31-1368"><a href="#cb31-1368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(Tmindata , <span class="fu">aes</span>(<span class="at">x =</span> temp_av, <span class="at">y =</span> SQRT_activity), <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb31-1369"><a href="#cb31-1369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb31-1370"><a href="#cb31-1370" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> temp_av,</span>
<span id="cb31-1371"><a href="#cb31-1371" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> SQRT_activity,</span>
<span id="cb31-1372"><a href="#cb31-1372" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">factor</span>(treat),</span>
<span id="cb31-1373"><a href="#cb31-1373" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb31-1374"><a href="#cb31-1374" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb31-1375"><a href="#cb31-1375" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1376"><a href="#cb31-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb31-1377"><a href="#cb31-1377" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> temp_av,</span>
<span id="cb31-1378"><a href="#cb31-1378" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> SQRT_activity_inline,</span>
<span id="cb31-1379"><a href="#cb31-1379" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">factor</span>(treat),</span>
<span id="cb31-1380"><a href="#cb31-1380" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb31-1381"><a href="#cb31-1381" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb31-1382"><a href="#cb31-1382" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1383"><a href="#cb31-1383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> . <span class="sc">~</span> treat,</span>
<span id="cb31-1384"><a href="#cb31-1384" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb31-1385"><a href="#cb31-1385" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb31-1386"><a href="#cb31-1386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-1387"><a href="#cb31-1387" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1388"><a href="#cb31-1388" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-1389"><a href="#cb31-1389" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1390"><a href="#cb31-1390" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1391"><a href="#cb31-1391" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1392"><a href="#cb31-1392" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-1393"><a href="#cb31-1393" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1394"><a href="#cb31-1394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-1395"><a href="#cb31-1395" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1396"><a href="#cb31-1396" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-1397"><a href="#cb31-1397" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1398"><a href="#cb31-1398" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-1399"><a href="#cb31-1399" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-1400"><a href="#cb31-1400" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-1401"><a href="#cb31-1401" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-1402"><a href="#cb31-1402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb31-1403"><a href="#cb31-1403" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb31-1404"><a href="#cb31-1404" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb31-1405"><a href="#cb31-1405" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb31-1406"><a href="#cb31-1406" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> temp_av,</span>
<span id="cb31-1407"><a href="#cb31-1407" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> SQRT_activity_inline,</span>
<span id="cb31-1408"><a href="#cb31-1408" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> treat,</span>
<span id="cb31-1409"><a href="#cb31-1409" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> treat</span>
<span id="cb31-1410"><a href="#cb31-1410" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1411"><a href="#cb31-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">fullrange =</span> T</span>
<span id="cb31-1412"><a href="#cb31-1412" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-1413"><a href="#cb31-1413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb31-1414"><a href="#cb31-1414" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.data =</span> mean_cl_normal,</span>
<span id="cb31-1415"><a href="#cb31-1415" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"errorbar"</span>,</span>
<span id="cb31-1416"><a href="#cb31-1416" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb31-1417"><a href="#cb31-1417" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb31-1418"><a href="#cb31-1418" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-1419"><a href="#cb31-1419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">'Bacterial growth [SQRT (dpm/h)]'</span>)) <span class="sc">+</span></span>
<span id="cb31-1420"><a href="#cb31-1420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">'Temperature (°C)'</span>)) <span class="sc">+</span></span>
<span id="cb31-1421"><a href="#cb31-1421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">450</span>)) <span class="sc">+</span></span>
<span id="cb31-1422"><a href="#cb31-1422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-1423"><a href="#cb31-1423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-1424"><a href="#cb31-1424" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1425"><a href="#cb31-1425" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-1426"><a href="#cb31-1426" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-1427"><a href="#cb31-1427" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-1428"><a href="#cb31-1428" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1429"><a href="#cb31-1429" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1430"><a href="#cb31-1430" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-1431"><a href="#cb31-1431" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1432"><a href="#cb31-1432" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1433"><a href="#cb31-1433" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1434"><a href="#cb31-1434" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1435"><a href="#cb31-1435" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1436"><a href="#cb31-1436" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb31-1437"><a href="#cb31-1437" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1438"><a href="#cb31-1438" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1439"><a href="#cb31-1439" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb31-1440"><a href="#cb31-1440" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1441"><a href="#cb31-1441" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-1442"><a href="#cb31-1442" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-1443"><a href="#cb31-1443" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1444"><a href="#cb31-1444" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1445"><a href="#cb31-1445" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1446"><a href="#cb31-1446" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1447"><a href="#cb31-1447" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-1448"><a href="#cb31-1448" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-1449"><a href="#cb31-1449" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1450"><a href="#cb31-1450" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-1451"><a href="#cb31-1451" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1452"><a href="#cb31-1452" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-1453"><a href="#cb31-1453" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-1454"><a href="#cb31-1454" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-1455"><a href="#cb31-1455" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-1456"><a href="#cb31-1456" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-1457"><a href="#cb31-1457" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1458"><a href="#cb31-1458" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-1459"><a href="#cb31-1459" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-1460"><a href="#cb31-1460" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-1461"><a href="#cb31-1461" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1462"><a href="#cb31-1462" aria-hidden="true" tabindex="-1"></a><span class="co">#composite plot</span></span>
<span id="cb31-1463"><a href="#cb31-1463" aria-hidden="true" tabindex="-1"></a>composite.plot <span class="ot">&lt;-</span></span>
<span id="cb31-1464"><a href="#cb31-1464" aria-hidden="true" tabindex="-1"></a>  gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(plot.Tmin_forVmax, plot.vmax.XY, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb31-1465"><a href="#cb31-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1466"><a href="#cb31-1466" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(composite.plot)</span>
<span id="cb31-1467"><a href="#cb31-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1468"><a href="#cb31-1468" aria-hidden="true" tabindex="-1"></a><span class="do">## CAPSCALE PLOTS </span></span>
<span id="cb31-1469"><a href="#cb31-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1470"><a href="#cb31-1470" aria-hidden="true" tabindex="-1"></a><span class="do">## SAME AS Extended_Data_Figure_5 but only using TEMP adaptation </span></span>
<span id="cb31-1471"><a href="#cb31-1471" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Run `rankindex` to compare metadata and community dissimilarity indices </span></span>
<span id="cb31-1472"><a href="#cb31-1472" aria-hidden="true" tabindex="-1"></a><span class="do">## for gradient detection. This will help us select the best dissimilarity </span></span>
<span id="cb31-1473"><a href="#cb31-1473" aria-hidden="true" tabindex="-1"></a><span class="do">## metric to use.</span></span>
<span id="cb31-1474"><a href="#cb31-1474" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Run `capscale` for distance-based redundancy analysis.</span></span>
<span id="cb31-1475"><a href="#cb31-1475" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Run `envfit` to fit environmental parameters onto the ordination. </span></span>
<span id="cb31-1476"><a href="#cb31-1476" aria-hidden="true" tabindex="-1"></a><span class="do">## This function basically calculates correlation scores between the metadata </span></span>
<span id="cb31-1477"><a href="#cb31-1477" aria-hidden="true" tabindex="-1"></a><span class="do">## parameters and the ordination axes. </span></span>
<span id="cb31-1478"><a href="#cb31-1478" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Select metadata parameters significant for `bioenv` (see above) </span></span>
<span id="cb31-1479"><a href="#cb31-1479" aria-hidden="true" tabindex="-1"></a><span class="do">## and/or `envfit` analyses.</span></span>
<span id="cb31-1480"><a href="#cb31-1480" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Run `envfit` on ASVs.</span></span>
<span id="cb31-1481"><a href="#cb31-1481" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) Plot the ordination and vector overlays. </span></span>
<span id="cb31-1482"><a href="#cb31-1482" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1483"><a href="#cb31-1483" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1484"><a href="#cb31-1484" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA Temperature Adaptation #</span></span>
<span id="cb31-1485"><a href="#cb31-1485" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1486"><a href="#cb31-1486" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1487"><a href="#cb31-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1488"><a href="#cb31-1488" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb31-1489"><a href="#cb31-1489" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>temp_adapt</span>
<span id="cb31-1490"><a href="#cb31-1490" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-1491"><a href="#cb31-1491" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-1492"><a href="#cb31-1492" aria-hidden="true" tabindex="-1"></a>temp_adapt_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-1493"><a href="#cb31-1493" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-1494"><a href="#cb31-1494" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-1495"><a href="#cb31-1495" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb31-1496"><a href="#cb31-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1497"><a href="#cb31-1497" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span id="cb31-1498"><a href="#cb31-1498" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: NUE, PUE, SI</span></span>
<span id="cb31-1499"><a href="#cb31-1499" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: NONE</span></span>
<span id="cb31-1500"><a href="#cb31-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1501"><a href="#cb31-1501" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  AG_Q10 <span class="sc">+</span> BG_Q10 <span class="sc">+</span> BP_Q10 <span class="sc">+</span> CE_Q10 <span class="sc">+</span> </span>
<span id="cb31-1502"><a href="#cb31-1502" aria-hidden="true" tabindex="-1"></a>                                       P_Q10 <span class="sc">+</span> N_Q10 <span class="sc">+</span> S_Q10 <span class="sc">+</span> XY_Q10 <span class="sc">+</span> </span>
<span id="cb31-1503"><a href="#cb31-1503" aria-hidden="true" tabindex="-1"></a>                                       LP_Q10 <span class="sc">+</span> PX_Q10 <span class="sc">+</span> CUEcn <span class="sc">+</span> CUEcp <span class="sc">+</span> Tmin, </span>
<span id="cb31-1504"><a href="#cb31-1504" aria-hidden="true" tabindex="-1"></a>                             tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-1505"><a href="#cb31-1505" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(temp_adapt_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-1506"><a href="#cb31-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1507"><a href="#cb31-1507" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-1508"><a href="#cb31-1508" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-1509"><a href="#cb31-1509" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-1510"><a href="#cb31-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1511"><a href="#cb31-1511" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-1512"><a href="#cb31-1512" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-1513"><a href="#cb31-1513" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-1514"><a href="#cb31-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1515"><a href="#cb31-1515" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-1516"><a href="#cb31-1516" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-1517"><a href="#cb31-1517" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb31-1518"><a href="#cb31-1518" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-1519"><a href="#cb31-1519" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-1520"><a href="#cb31-1520" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-1521"><a href="#cb31-1521" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> temp_adapt_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-1522"><a href="#cb31-1522" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-1523"><a href="#cb31-1523" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-1524"><a href="#cb31-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1525"><a href="#cb31-1525" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> temp_adapt_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-1526"><a href="#cb31-1526" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-1527"><a href="#cb31-1527" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> temp_adapt_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-1528"><a href="#cb31-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1529"><a href="#cb31-1529" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-1530"><a href="#cb31-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1531"><a href="#cb31-1531" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-1532"><a href="#cb31-1532" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-1533"><a href="#cb31-1533" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-1534"><a href="#cb31-1534" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-1535"><a href="#cb31-1535" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-1536"><a href="#cb31-1536" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-1537"><a href="#cb31-1537" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-1538"><a href="#cb31-1538" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-1539"><a href="#cb31-1539" aria-hidden="true" tabindex="-1"></a>                                               temp_adapt_md_signif_hits,]</span>
<span id="cb31-1540"><a href="#cb31-1540" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-1541"><a href="#cb31-1541" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel))</span>
<span id="cb31-1542"><a href="#cb31-1542" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1543"><a href="#cb31-1543" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1544"><a href="#cb31-1544" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-1545"><a href="#cb31-1545" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-1546"><a href="#cb31-1546" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1547"><a href="#cb31-1547" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1548"><a href="#cb31-1548" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-1549"><a href="#cb31-1549" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)), </span>
<span id="cb31-1550"><a href="#cb31-1550" aria-hidden="true" tabindex="-1"></a>                       temp_adapt_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-1551"><a href="#cb31-1551" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1552"><a href="#cb31-1552" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1553"><a href="#cb31-1553" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-1554"><a href="#cb31-1554" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-1555"><a href="#cb31-1555" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-1556"><a href="#cb31-1556" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1557"><a href="#cb31-1557" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1558"><a href="#cb31-1558" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and  bioenv."</span>)</span>
<span id="cb31-1559"><a href="#cb31-1559" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-1560"><a href="#cb31-1560" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-1561"><a href="#cb31-1561" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff</span>
<span id="cb31-1562"><a href="#cb31-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1563"><a href="#cb31-1563" aria-hidden="true" tabindex="-1"></a>new_temp_adapt_md_signif_hits <span class="ot">&lt;-</span> temp_adapt_sig_diff</span>
<span id="cb31-1564"><a href="#cb31-1564" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-1565"><a href="#cb31-1565" aria-hidden="true" tabindex="-1"></a>                                                   new_temp_adapt_md_signif_hits,]</span>
<span id="cb31-1566"><a href="#cb31-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1567"><a href="#cb31-1567" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-1568"><a href="#cb31-1568" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb31-1569"><a href="#cb31-1569" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-1570"><a href="#cb31-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1571"><a href="#cb31-1571" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-1572"><a href="#cb31-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1573"><a href="#cb31-1573" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> temp_adapt_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-1574"><a href="#cb31-1574" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-1575"><a href="#cb31-1575" aria-hidden="true" tabindex="-1"></a>                         tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-1576"><a href="#cb31-1576" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-1577"><a href="#cb31-1577" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-1578"><a href="#cb31-1578" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-1579"><a href="#cb31-1579" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-1580"><a href="#cb31-1580" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-1581"><a href="#cb31-1581" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-1582"><a href="#cb31-1582" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif <span class="ot">&lt;-</span> temp_adapt_asv_scores[temp_adapt_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-1583"><a href="#cb31-1583" aria-hidden="true" tabindex="-1"></a>                                                 temp_adapt_asv_signif_hits,]</span>
<span id="cb31-1584"><a href="#cb31-1584" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-1585"><a href="#cb31-1585" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-1586"><a href="#cb31-1586" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_adapt_md_signif_all, temp_adapt_asv_signif)</span>
<span id="cb31-1587"><a href="#cb31-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1588"><a href="#cb31-1588" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-1589"><a href="#cb31-1589" aria-hidden="true" tabindex="-1"></a>                                  temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-1590"><a href="#cb31-1590" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-1591"><a href="#cb31-1591" aria-hidden="true" tabindex="-1"></a>                                   temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-1592"><a href="#cb31-1592" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-1593"><a href="#cb31-1593" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-1594"><a href="#cb31-1594" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-1595"><a href="#cb31-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1596"><a href="#cb31-1596" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, temp_adapt_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-1597"><a href="#cb31-1597" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, temp_adapt_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-1598"><a href="#cb31-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1599"><a href="#cb31-1599" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1600"><a href="#cb31-1600" aria-hidden="true" tabindex="-1"></a><span class="do">###### 16S rRNA plot code </span><span class="al">###</span></span>
<span id="cb31-1601"><a href="#cb31-1601" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1602"><a href="#cb31-1602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1603"><a href="#cb31-1603" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-1604"><a href="#cb31-1604" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(temp_adapt_plot_data) <span class="sc">+</span></span>
<span id="cb31-1605"><a href="#cb31-1605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-1606"><a href="#cb31-1606" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb31-1607"><a href="#cb31-1607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-1608"><a href="#cb31-1608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-1609"><a href="#cb31-1609" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> temp_adapt_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-1610"><a href="#cb31-1610" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.6</span>,</span>
<span id="cb31-1611"><a href="#cb31-1611" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb31-1612"><a href="#cb31-1612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> temp_adapt_bioplot_data_md, </span>
<span id="cb31-1613"><a href="#cb31-1613" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb31-1614"><a href="#cb31-1614" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-1615"><a href="#cb31-1615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-1616"><a href="#cb31-1616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-1617"><a href="#cb31-1617" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-1618"><a href="#cb31-1618" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span></span>
<span id="cb31-1619"><a href="#cb31-1619" aria-hidden="true" tabindex="-1"></a>  temp_adapt_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb31-1620"><a href="#cb31-1620" aria-hidden="true" tabindex="-1"></a>    <span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb31-1621"><a href="#cb31-1621" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-1622"><a href="#cb31-1622" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-1623"><a href="#cb31-1623" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>)</span>
<span id="cb31-1624"><a href="#cb31-1624" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1625"><a href="#cb31-1625" aria-hidden="true" tabindex="-1"></a>ssu18_temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot</span>
<span id="cb31-1626"><a href="#cb31-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1627"><a href="#cb31-1627" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1628"><a href="#cb31-1628" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1629"><a href="#cb31-1629" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS Temperature Adaptation </span><span class="al">###</span></span>
<span id="cb31-1630"><a href="#cb31-1630" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1631"><a href="#cb31-1631" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1632"><a href="#cb31-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1633"><a href="#cb31-1633" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> its18_select_mc_norm_split_no_ac<span class="sc">$</span>temp_adapt</span>
<span id="cb31-1634"><a href="#cb31-1634" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-1635"><a href="#cb31-1635" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(its18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-1636"><a href="#cb31-1636" aria-hidden="true" tabindex="-1"></a>temp_adapt_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-1637"><a href="#cb31-1637" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-1638"><a href="#cb31-1638" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-1639"><a href="#cb31-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1640"><a href="#cb31-1640" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb31-1641"><a href="#cb31-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1642"><a href="#cb31-1642" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span id="cb31-1643"><a href="#cb31-1643" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: NUE, PUE, P_Q10, SI                                                                        </span></span>
<span id="cb31-1644"><a href="#cb31-1644" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: S_Q10</span></span>
<span id="cb31-1645"><a href="#cb31-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1646"><a href="#cb31-1646" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  AG_Q10 <span class="sc">+</span> BG_Q10 <span class="sc">+</span> BP_Q10 <span class="sc">+</span> CE_Q10 <span class="sc">+</span> </span>
<span id="cb31-1647"><a href="#cb31-1647" aria-hidden="true" tabindex="-1"></a>                                       N_Q10 <span class="sc">+</span> XY_Q10 <span class="sc">+</span> LP_Q10 <span class="sc">+</span> PX_Q10 <span class="sc">+</span> </span>
<span id="cb31-1648"><a href="#cb31-1648" aria-hidden="true" tabindex="-1"></a>                                       CUEcn <span class="sc">+</span> CUEcp <span class="sc">+</span> Tmin, </span>
<span id="cb31-1649"><a href="#cb31-1649" aria-hidden="true" tabindex="-1"></a>                           tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-1650"><a href="#cb31-1650" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(temp_adapt_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-1651"><a href="#cb31-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1652"><a href="#cb31-1652" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-1653"><a href="#cb31-1653" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-1654"><a href="#cb31-1654" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-1655"><a href="#cb31-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1656"><a href="#cb31-1656" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-1657"><a href="#cb31-1657" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-1658"><a href="#cb31-1658" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-1659"><a href="#cb31-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1660"><a href="#cb31-1660" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-1661"><a href="#cb31-1661" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-1662"><a href="#cb31-1662" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb31-1663"><a href="#cb31-1663" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-1664"><a href="#cb31-1664" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-1665"><a href="#cb31-1665" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-1666"><a href="#cb31-1666" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> temp_adapt_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-1667"><a href="#cb31-1667" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-1668"><a href="#cb31-1668" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-1669"><a href="#cb31-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1670"><a href="#cb31-1670" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> temp_adapt_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-1671"><a href="#cb31-1671" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-1672"><a href="#cb31-1672" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> temp_adapt_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-1673"><a href="#cb31-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1674"><a href="#cb31-1674" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-1675"><a href="#cb31-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1676"><a href="#cb31-1676" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-1677"><a href="#cb31-1677" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-1678"><a href="#cb31-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1679"><a href="#cb31-1679" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-1680"><a href="#cb31-1680" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-1681"><a href="#cb31-1681" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-1682"><a href="#cb31-1682" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-1683"><a href="#cb31-1683" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-1684"><a href="#cb31-1684" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-1685"><a href="#cb31-1685" aria-hidden="true" tabindex="-1"></a>                                               temp_adapt_md_signif_hits,]</span>
<span id="cb31-1686"><a href="#cb31-1686" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-1687"><a href="#cb31-1687" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel))</span>
<span id="cb31-1688"><a href="#cb31-1688" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1689"><a href="#cb31-1689" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1690"><a href="#cb31-1690" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-1691"><a href="#cb31-1691" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-1692"><a href="#cb31-1692" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1693"><a href="#cb31-1693" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1694"><a href="#cb31-1694" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-1695"><a href="#cb31-1695" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)), </span>
<span id="cb31-1696"><a href="#cb31-1696" aria-hidden="true" tabindex="-1"></a>                       temp_adapt_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-1697"><a href="#cb31-1697" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1698"><a href="#cb31-1698" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1699"><a href="#cb31-1699" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-1700"><a href="#cb31-1700" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-1701"><a href="#cb31-1701" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-1702"><a href="#cb31-1702" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-1703"><a href="#cb31-1703" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-1704"><a href="#cb31-1704" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and  bioenv."</span>)</span>
<span id="cb31-1705"><a href="#cb31-1705" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-1706"><a href="#cb31-1706" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-1707"><a href="#cb31-1707" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff</span>
<span id="cb31-1708"><a href="#cb31-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1709"><a href="#cb31-1709" aria-hidden="true" tabindex="-1"></a>new_temp_adapt_md_signif_hits <span class="ot">&lt;-</span> temp_adapt_sig_diff</span>
<span id="cb31-1710"><a href="#cb31-1710" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-1711"><a href="#cb31-1711" aria-hidden="true" tabindex="-1"></a>                                                   new_temp_adapt_md_signif_hits,]</span>
<span id="cb31-1712"><a href="#cb31-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1713"><a href="#cb31-1713" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-1714"><a href="#cb31-1714" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb31-1715"><a href="#cb31-1715" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-1716"><a href="#cb31-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1717"><a href="#cb31-1717" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-1718"><a href="#cb31-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1719"><a href="#cb31-1719" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> temp_adapt_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-1720"><a href="#cb31-1720" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-1721"><a href="#cb31-1721" aria-hidden="true" tabindex="-1"></a>                         tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-1722"><a href="#cb31-1722" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-1723"><a href="#cb31-1723" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-1724"><a href="#cb31-1724" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-1725"><a href="#cb31-1725" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-1726"><a href="#cb31-1726" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-1727"><a href="#cb31-1727" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-1728"><a href="#cb31-1728" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif <span class="ot">&lt;-</span> temp_adapt_asv_scores[temp_adapt_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-1729"><a href="#cb31-1729" aria-hidden="true" tabindex="-1"></a>                                                 temp_adapt_asv_signif_hits,]</span>
<span id="cb31-1730"><a href="#cb31-1730" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-1731"><a href="#cb31-1731" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-1732"><a href="#cb31-1732" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_adapt_md_signif_all, temp_adapt_asv_signif)</span>
<span id="cb31-1733"><a href="#cb31-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1734"><a href="#cb31-1734" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-1735"><a href="#cb31-1735" aria-hidden="true" tabindex="-1"></a>                                  temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-1736"><a href="#cb31-1736" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-1737"><a href="#cb31-1737" aria-hidden="true" tabindex="-1"></a>                                   temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-1738"><a href="#cb31-1738" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-1739"><a href="#cb31-1739" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-1740"><a href="#cb31-1740" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-1741"><a href="#cb31-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1742"><a href="#cb31-1742" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, temp_adapt_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-1743"><a href="#cb31-1743" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, temp_adapt_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-1744"><a href="#cb31-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1745"><a href="#cb31-1745" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-1746"><a href="#cb31-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1747"><a href="#cb31-1747" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1748"><a href="#cb31-1748" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS plot code </span><span class="al">###</span></span>
<span id="cb31-1749"><a href="#cb31-1749" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1750"><a href="#cb31-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1751"><a href="#cb31-1751" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(temp_adapt_plot_data) <span class="sc">+</span></span>
<span id="cb31-1752"><a href="#cb31-1752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-1753"><a href="#cb31-1753" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb31-1754"><a href="#cb31-1754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-1755"><a href="#cb31-1755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-1756"><a href="#cb31-1756" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> temp_adapt_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-1757"><a href="#cb31-1757" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.6</span>,</span>
<span id="cb31-1758"><a href="#cb31-1758" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb31-1759"><a href="#cb31-1759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> temp_adapt_bioplot_data_md, </span>
<span id="cb31-1760"><a href="#cb31-1760" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb31-1761"><a href="#cb31-1761" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-1762"><a href="#cb31-1762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-1763"><a href="#cb31-1763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-1764"><a href="#cb31-1764" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-1765"><a href="#cb31-1765" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span></span>
<span id="cb31-1766"><a href="#cb31-1766" aria-hidden="true" tabindex="-1"></a>  temp_adapt_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb31-1767"><a href="#cb31-1767" aria-hidden="true" tabindex="-1"></a>    <span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb31-1768"><a href="#cb31-1768" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-1769"><a href="#cb31-1769" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-1770"><a href="#cb31-1770" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>)</span>
<span id="cb31-1771"><a href="#cb31-1771" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1772"><a href="#cb31-1772" aria-hidden="true" tabindex="-1"></a>its18_temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot</span>
<span id="cb31-1773"><a href="#cb31-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1774"><a href="#cb31-1774" aria-hidden="true" tabindex="-1"></a>plot.Tmin_forVmax  <span class="ot">&lt;-</span> plot.Tmin_forVmax <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb31-1775"><a href="#cb31-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1776"><a href="#cb31-1776" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1777"><a href="#cb31-1777" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1778"><a href="#cb31-1778" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1779"><a href="#cb31-1779" aria-hidden="true" tabindex="-1"></a><span class="do">###### COMBO plot code ##############</span></span>
<span id="cb31-1780"><a href="#cb31-1780" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1781"><a href="#cb31-1781" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1782"><a href="#cb31-1782" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-1783"><a href="#cb31-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1784"><a href="#cb31-1784" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-1785"><a href="#cb31-1785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">11</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">2</span>),</span>
<span id="cb31-1786"><a href="#cb31-1786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">11</span>, <span class="at">l =</span> <span class="dv">3</span>, <span class="at">r =</span> <span class="dv">4</span>),</span>
<span id="cb31-1787"><a href="#cb31-1787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">12</span>, <span class="at">b =</span> <span class="dv">14</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">4</span>),</span>
<span id="cb31-1788"><a href="#cb31-1788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">13</span>, <span class="at">l =</span> <span class="dv">5</span>, <span class="at">r =</span> <span class="dv">6</span>)</span>
<span id="cb31-1789"><a href="#cb31-1789" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-1790"><a href="#cb31-1790" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(layout)</span>
<span id="cb31-1791"><a href="#cb31-1791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1792"><a href="#cb31-1792" aria-hidden="true" tabindex="-1"></a>combo_plot <span class="ot">&lt;-</span> </span>
<span id="cb31-1793"><a href="#cb31-1793" aria-hidden="true" tabindex="-1"></a>  plot.Tmin_forVmax <span class="sc">+</span> plot.vmax.XY <span class="sc">+</span> plot.Tminxyl <span class="sc">+</span> ((ssu18_temp_adapt_plot <span class="sc">/</span>  its18_temp_adapt_plot)) <span class="sc">+</span> </span>
<span id="cb31-1794"><a href="#cb31-1794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)  </span>
<span id="cb31-1795"><a href="#cb31-1795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1796"><a href="#cb31-1796" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span id="cb31-1797"><a href="#cb31-1797" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Figure_2.png"</span>, </span>
<span id="cb31-1798"><a href="#cb31-1798" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">7485</span>, <span class="at">width =</span> <span class="dv">9100</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-1799"><a href="#cb31-1799" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb31-1800"><a href="#cb31-1800" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span id="cb31-1801"><a href="#cb31-1801" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Figure_2.pdf"</span>, </span>
<span id="cb31-1802"><a href="#cb31-1802" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">7485</span>, <span class="at">width =</span> <span class="dv">9100</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-1803"><a href="#cb31-1803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-1804"><a href="#cb31-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1805"><a href="#cb31-1805" aria-hidden="true" tabindex="-1"></a><span class="fu">## Figure 3</span></span>
<span id="cb31-1806"><a href="#cb31-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1807"><a href="#cb31-1807" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-1808"><a href="#cb31-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1809"><a href="#cb31-1809" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-1810"><a href="#cb31-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1811"><a href="#cb31-1811" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb31-1812"><a href="#cb31-1812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1813"><a href="#cb31-1813" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1814"><a href="#cb31-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1815"><a href="#cb31-1815" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-1816"><a href="#cb31-1816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1817"><a href="#cb31-1817" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-1818"><a href="#cb31-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1819"><a href="#cb31-1819" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/MAIN/Figure_3.png)</span></span>
<span id="cb31-1820"><a href="#cb31-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1821"><a href="#cb31-1821" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-1822"><a href="#cb31-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1823"><a href="#cb31-1823" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/MAIN/FIGURES/Figure_3.png)</span></span>
<span id="cb31-1824"><a href="#cb31-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1825"><a href="#cb31-1825" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1826"><a href="#cb31-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1827"><a href="#cb31-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1828"><a href="#cb31-1828" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-1829"><a href="#cb31-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1830"><a href="#cb31-1830" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-1831"><a href="#cb31-1831" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Figure 3 data pack</span><span class="co">](include/pub/MAIN/Figure_3.rdata)</span>  </span>
<span id="cb31-1832"><a href="#cb31-1832" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1833"><a href="#cb31-1833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1834"><a href="#cb31-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1835"><a href="#cb31-1835" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-1836"><a href="#cb31-1836" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Figure 3 raw pdf</span><span class="co">](include/pub/MAIN/Figure_3.pdf)</span></span>
<span id="cb31-1837"><a href="#cb31-1837" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1838"><a href="#cb31-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1839"><a href="#cb31-1839" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-1840"><a href="#cb31-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1841"><a href="#cb31-1841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1844"><a href="#cb31-1844" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-1845"><a href="#cb31-1845" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Figure 3"</span></span>
<span id="cb31-1846"><a href="#cb31-1846" aria-hidden="true" tabindex="-1"></a><span class="co">#clear workspace</span></span>
<span id="cb31-1847"><a href="#cb31-1847" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-1848"><a href="#cb31-1848" aria-hidden="true" tabindex="-1"></a><span class="co"># template for blank plot</span></span>
<span id="cb31-1849"><a href="#cb31-1849" aria-hidden="true" tabindex="-1"></a>blankPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_blank</span>(<span class="fu">aes</span>(<span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb31-1850"><a href="#cb31-1850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-1851"><a href="#cb31-1851" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1852"><a href="#cb31-1852" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1853"><a href="#cb31-1853" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1854"><a href="#cb31-1854" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1855"><a href="#cb31-1855" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1856"><a href="#cb31-1856" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1857"><a href="#cb31-1857" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1858"><a href="#cb31-1858" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1859"><a href="#cb31-1859" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1860"><a href="#cb31-1860" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-1861"><a href="#cb31-1861" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_blank</span>()</span>
<span id="cb31-1862"><a href="#cb31-1862" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1863"><a href="#cb31-1863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1864"><a href="#cb31-1864" aria-hidden="true" tabindex="-1"></a><span class="co"># load data </span></span>
<span id="cb31-1865"><a href="#cb31-1865" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted fluxes calculated using Tmin model per treatment, </span></span>
<span id="cb31-1866"><a href="#cb31-1866" aria-hidden="true" tabindex="-1"></a><span class="do">## calculated using CO2 flux at ambient temperature (control plots)</span></span>
<span id="cb31-1867"><a href="#cb31-1867" aria-hidden="true" tabindex="-1"></a><span class="co">#Tmin_CO2pred &lt;-</span></span>
<span id="cb31-1868"><a href="#cb31-1868" aria-hidden="true" tabindex="-1"></a><span class="co">#  read.csv("include/pub/MAIN/Fig3_CO2predict.csv", header = T)</span></span>
<span id="cb31-1869"><a href="#cb31-1869" aria-hidden="true" tabindex="-1"></a><span class="co">#CO2c_fullgrad &lt;-</span></span>
<span id="cb31-1870"><a href="#cb31-1870" aria-hidden="true" tabindex="-1"></a><span class="co">#  read.csv("include/pub/MAIN/Fig3_CO2observed.csv", header = T)</span></span>
<span id="cb31-1871"><a href="#cb31-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1872"><a href="#cb31-1872" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/MAIN/Figure_3.rdata"</span>)</span>
<span id="cb31-1873"><a href="#cb31-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1874"><a href="#cb31-1874" aria-hidden="true" tabindex="-1"></a><span class="co">#determine mean values, measured data</span></span>
<span id="cb31-1875"><a href="#cb31-1875" aria-hidden="true" tabindex="-1"></a>CO2c_fullgrad.means <span class="ot">&lt;-</span></span>
<span id="cb31-1876"><a href="#cb31-1876" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">ddply</span>(</span>
<span id="cb31-1877"><a href="#cb31-1877" aria-hidden="true" tabindex="-1"></a>    CO2c_fullgrad,</span>
<span id="cb31-1878"><a href="#cb31-1878" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Treat"</span>, <span class="st">"Plot"</span>),</span>
<span id="cb31-1879"><a href="#cb31-1879" aria-hidden="true" tabindex="-1"></a>    summarise,</span>
<span id="cb31-1880"><a href="#cb31-1880" aria-hidden="true" tabindex="-1"></a>    <span class="at">NCO2    =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(CO2)),</span>
<span id="cb31-1881"><a href="#cb31-1881" aria-hidden="true" tabindex="-1"></a>    <span class="at">CO2 =</span> <span class="fu">mean</span>(CO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-1882"><a href="#cb31-1882" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdCO2   =</span> <span class="fu">sd</span>(CO2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-1883"><a href="#cb31-1883" aria-hidden="true" tabindex="-1"></a>    <span class="at">seCO2   =</span> sdCO2 <span class="sc">/</span> <span class="fu">sqrt</span>(NCO2),</span>
<span id="cb31-1884"><a href="#cb31-1884" aria-hidden="true" tabindex="-1"></a>    <span class="at">NTemp    =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(Temp)),</span>
<span id="cb31-1885"><a href="#cb31-1885" aria-hidden="true" tabindex="-1"></a>    <span class="at">Temp =</span> <span class="fu">mean</span>(Temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-1886"><a href="#cb31-1886" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdTemp   =</span> <span class="fu">sd</span>(Temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-1887"><a href="#cb31-1887" aria-hidden="true" tabindex="-1"></a>    <span class="at">seTemp   =</span> sdTemp <span class="sc">/</span> <span class="fu">sqrt</span>(NTemp)</span>
<span id="cb31-1888"><a href="#cb31-1888" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1889"><a href="#cb31-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1890"><a href="#cb31-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1891"><a href="#cb31-1891" aria-hidden="true" tabindex="-1"></a><span class="co">#subsets, predicted data</span></span>
<span id="cb31-1892"><a href="#cb31-1892" aria-hidden="true" tabindex="-1"></a>Tmin_CO2pred.C <span class="ot">&lt;-</span> <span class="fu">subset</span>(Tmin_CO2pred, treat <span class="sc">==</span> <span class="st">"C"</span>)</span>
<span id="cb31-1893"><a href="#cb31-1893" aria-hidden="true" tabindex="-1"></a>Tmin_CO2pred.W3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(Tmin_CO2pred, treat <span class="sc">==</span> <span class="st">"W3"</span>)</span>
<span id="cb31-1894"><a href="#cb31-1894" aria-hidden="true" tabindex="-1"></a>Tmin_CO2pred.W8 <span class="ot">&lt;-</span> <span class="fu">subset</span>(Tmin_CO2pred, treat <span class="sc">==</span> <span class="st">"W8"</span>)</span>
<span id="cb31-1895"><a href="#cb31-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1896"><a href="#cb31-1896" aria-hidden="true" tabindex="-1"></a><span class="co"># data in long format , predicted data</span></span>
<span id="cb31-1897"><a href="#cb31-1897" aria-hidden="true" tabindex="-1"></a>CO2predict.C.long <span class="ot">&lt;-</span> Tmin_CO2pred.C <span class="sc">%&gt;%</span></span>
<span id="cb31-1898"><a href="#cb31-1898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(</span>
<span id="cb31-1899"><a href="#cb31-1899" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> measure,</span>
<span id="cb31-1900"><a href="#cb31-1900" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> value,<span class="sc">-</span>treat,</span>
<span id="cb31-1901"><a href="#cb31-1901" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>ID,</span>
<span id="cb31-1902"><a href="#cb31-1902" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>depth,</span>
<span id="cb31-1903"><a href="#cb31-1903" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>year,</span>
<span id="cb31-1904"><a href="#cb31-1904" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>Tmin,</span>
<span id="cb31-1905"><a href="#cb31-1905" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>Tambient,</span>
<span id="cb31-1906"><a href="#cb31-1906" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>CO2.at.Tmin_SQRT,</span>
<span id="cb31-1907"><a href="#cb31-1907" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>CO2.at.Tambient_SQRT,</span>
<span id="cb31-1908"><a href="#cb31-1908" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>slope</span>
<span id="cb31-1909"><a href="#cb31-1909" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1910"><a href="#cb31-1910" aria-hidden="true" tabindex="-1"></a>CO2predict.C.long<span class="sc">$</span>measure <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(CO2predict.C.long<span class="sc">$</span>measure)</span>
<span id="cb31-1911"><a href="#cb31-1911" aria-hidden="true" tabindex="-1"></a>CO2predict.C.long<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(CO2predict.C.long<span class="sc">$</span>value)</span>
<span id="cb31-1912"><a href="#cb31-1912" aria-hidden="true" tabindex="-1"></a>CO2predict.C.long<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-1913"><a href="#cb31-1913" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">revalue</span>(</span>
<span id="cb31-1914"><a href="#cb31-1914" aria-hidden="true" tabindex="-1"></a>    CO2predict.C.long<span class="sc">$</span>measure,</span>
<span id="cb31-1915"><a href="#cb31-1915" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb31-1916"><a href="#cb31-1916" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2_predict29"</span> <span class="ot">=</span> <span class="dv">29</span>,</span>
<span id="cb31-1917"><a href="#cb31-1917" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2_predict34"</span> <span class="ot">=</span> <span class="dv">34</span>,</span>
<span id="cb31-1918"><a href="#cb31-1918" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2.at.Tambient"</span> <span class="ot">=</span> <span class="fl">25.93395</span>,</span>
<span id="cb31-1919"><a href="#cb31-1919" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2.at.Tmin"</span> <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb31-1920"><a href="#cb31-1920" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-1921"><a href="#cb31-1921" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1922"><a href="#cb31-1922" aria-hidden="true" tabindex="-1"></a>CO2predict.C.long<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-1923"><a href="#cb31-1923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(CO2predict.C.long<span class="sc">$</span>measure))</span>
<span id="cb31-1924"><a href="#cb31-1924" aria-hidden="true" tabindex="-1"></a>CO2predict.C.long<span class="sc">$</span>temp.predict.C <span class="ot">&lt;-</span> CO2predict.C.long<span class="sc">$</span>measure</span>
<span id="cb31-1925"><a href="#cb31-1925" aria-hidden="true" tabindex="-1"></a>CO2predict.C.long<span class="sc">$</span>co2.predict.C <span class="ot">&lt;-</span> CO2predict.C.long<span class="sc">$</span>value</span>
<span id="cb31-1926"><a href="#cb31-1926" aria-hidden="true" tabindex="-1"></a><span class="co">#repeat for W3 adaptation</span></span>
<span id="cb31-1927"><a href="#cb31-1927" aria-hidden="true" tabindex="-1"></a>CO2predict.W3.long <span class="ot">&lt;-</span> Tmin_CO2pred.W3 <span class="sc">%&gt;%</span></span>
<span id="cb31-1928"><a href="#cb31-1928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(</span>
<span id="cb31-1929"><a href="#cb31-1929" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> measure,</span>
<span id="cb31-1930"><a href="#cb31-1930" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> value,<span class="sc">-</span>treat,</span>
<span id="cb31-1931"><a href="#cb31-1931" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>ID,</span>
<span id="cb31-1932"><a href="#cb31-1932" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>depth,</span>
<span id="cb31-1933"><a href="#cb31-1933" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>year,</span>
<span id="cb31-1934"><a href="#cb31-1934" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>Tmin,</span>
<span id="cb31-1935"><a href="#cb31-1935" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>Tambient,</span>
<span id="cb31-1936"><a href="#cb31-1936" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>CO2.at.Tmin_SQRT,</span>
<span id="cb31-1937"><a href="#cb31-1937" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>CO2.at.Tambient_SQRT,</span>
<span id="cb31-1938"><a href="#cb31-1938" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>slope</span>
<span id="cb31-1939"><a href="#cb31-1939" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1940"><a href="#cb31-1940" aria-hidden="true" tabindex="-1"></a>CO2predict.W3.long<span class="sc">$</span>measure <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(CO2predict.W3.long<span class="sc">$</span>measure)</span>
<span id="cb31-1941"><a href="#cb31-1941" aria-hidden="true" tabindex="-1"></a>CO2predict.W3.long<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(CO2predict.W3.long<span class="sc">$</span>value)</span>
<span id="cb31-1942"><a href="#cb31-1942" aria-hidden="true" tabindex="-1"></a>CO2predict.W3.long<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-1943"><a href="#cb31-1943" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">revalue</span>(</span>
<span id="cb31-1944"><a href="#cb31-1944" aria-hidden="true" tabindex="-1"></a>    CO2predict.W3.long<span class="sc">$</span>measure,</span>
<span id="cb31-1945"><a href="#cb31-1945" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb31-1946"><a href="#cb31-1946" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2_predict29"</span> <span class="ot">=</span> <span class="dv">29</span>,</span>
<span id="cb31-1947"><a href="#cb31-1947" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2_predict34"</span> <span class="ot">=</span> <span class="dv">34</span>,</span>
<span id="cb31-1948"><a href="#cb31-1948" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2.at.Tambient"</span> <span class="ot">=</span> <span class="fl">25.93395</span>,</span>
<span id="cb31-1949"><a href="#cb31-1949" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2.at.Tmin"</span> <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb31-1950"><a href="#cb31-1950" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-1951"><a href="#cb31-1951" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1952"><a href="#cb31-1952" aria-hidden="true" tabindex="-1"></a>CO2predict.W3.long<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-1953"><a href="#cb31-1953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(CO2predict.W3.long<span class="sc">$</span>measure))</span>
<span id="cb31-1954"><a href="#cb31-1954" aria-hidden="true" tabindex="-1"></a>CO2predict.W3.long<span class="sc">$</span>temp.predict.W3 <span class="ot">&lt;-</span> CO2predict.W3.long<span class="sc">$</span>measure</span>
<span id="cb31-1955"><a href="#cb31-1955" aria-hidden="true" tabindex="-1"></a>CO2predict.W3.long<span class="sc">$</span>co2.predict.W3 <span class="ot">&lt;-</span> CO2predict.W3.long<span class="sc">$</span>value</span>
<span id="cb31-1956"><a href="#cb31-1956" aria-hidden="true" tabindex="-1"></a><span class="co">#repeat for W8 adaptation</span></span>
<span id="cb31-1957"><a href="#cb31-1957" aria-hidden="true" tabindex="-1"></a>CO2predict.W8.long <span class="ot">&lt;-</span> Tmin_CO2pred.W8 <span class="sc">%&gt;%</span></span>
<span id="cb31-1958"><a href="#cb31-1958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(</span>
<span id="cb31-1959"><a href="#cb31-1959" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> measure,</span>
<span id="cb31-1960"><a href="#cb31-1960" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> value,<span class="sc">-</span>treat,</span>
<span id="cb31-1961"><a href="#cb31-1961" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>ID,</span>
<span id="cb31-1962"><a href="#cb31-1962" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>depth,</span>
<span id="cb31-1963"><a href="#cb31-1963" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>year,</span>
<span id="cb31-1964"><a href="#cb31-1964" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>Tmin,</span>
<span id="cb31-1965"><a href="#cb31-1965" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>Tambient,</span>
<span id="cb31-1966"><a href="#cb31-1966" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>CO2.at.Tmin_SQRT,</span>
<span id="cb31-1967"><a href="#cb31-1967" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>CO2.at.Tambient_SQRT,</span>
<span id="cb31-1968"><a href="#cb31-1968" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>slope</span>
<span id="cb31-1969"><a href="#cb31-1969" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1970"><a href="#cb31-1970" aria-hidden="true" tabindex="-1"></a>CO2predict.W8.long<span class="sc">$</span>measure <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(CO2predict.W8.long<span class="sc">$</span>measure)</span>
<span id="cb31-1971"><a href="#cb31-1971" aria-hidden="true" tabindex="-1"></a>CO2predict.W8.long<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(CO2predict.W8.long<span class="sc">$</span>value)</span>
<span id="cb31-1972"><a href="#cb31-1972" aria-hidden="true" tabindex="-1"></a>CO2predict.W8.long<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-1973"><a href="#cb31-1973" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">revalue</span>(</span>
<span id="cb31-1974"><a href="#cb31-1974" aria-hidden="true" tabindex="-1"></a>    CO2predict.W8.long<span class="sc">$</span>measure,</span>
<span id="cb31-1975"><a href="#cb31-1975" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb31-1976"><a href="#cb31-1976" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2_predict29"</span> <span class="ot">=</span> <span class="dv">29</span>,</span>
<span id="cb31-1977"><a href="#cb31-1977" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2_predict34"</span> <span class="ot">=</span> <span class="dv">34</span>,</span>
<span id="cb31-1978"><a href="#cb31-1978" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2.at.Tambient"</span> <span class="ot">=</span> <span class="fl">25.93395</span>,</span>
<span id="cb31-1979"><a href="#cb31-1979" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CO2.at.Tmin"</span> <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb31-1980"><a href="#cb31-1980" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-1981"><a href="#cb31-1981" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-1982"><a href="#cb31-1982" aria-hidden="true" tabindex="-1"></a>CO2predict.W8.long<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-1983"><a href="#cb31-1983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(CO2predict.W8.long<span class="sc">$</span>measure))</span>
<span id="cb31-1984"><a href="#cb31-1984" aria-hidden="true" tabindex="-1"></a>CO2predict.W8.long<span class="sc">$</span>temp.predict.W8 <span class="ot">&lt;-</span> CO2predict.W8.long<span class="sc">$</span>measure</span>
<span id="cb31-1985"><a href="#cb31-1985" aria-hidden="true" tabindex="-1"></a>CO2predict.W8.long<span class="sc">$</span>co2.predict.W8 <span class="ot">&lt;-</span> CO2predict.W8.long<span class="sc">$</span>value</span>
<span id="cb31-1986"><a href="#cb31-1986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1987"><a href="#cb31-1987" aria-hidden="true" tabindex="-1"></a><span class="co">#subset</span></span>
<span id="cb31-1988"><a href="#cb31-1988" aria-hidden="true" tabindex="-1"></a>CO2c_fullgrad_sub_full <span class="ot">&lt;-</span></span>
<span id="cb31-1989"><a href="#cb31-1989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(CO2c_fullgrad, Treat <span class="sc">==</span> <span class="st">"C"</span> <span class="sc">|</span> Treat <span class="sc">==</span> <span class="st">"W3"</span> <span class="sc">|</span> Treat <span class="sc">==</span> <span class="st">"W8"</span>)</span>
<span id="cb31-1990"><a href="#cb31-1990" aria-hidden="true" tabindex="-1"></a>CO2c_fullgrad_sub <span class="ot">&lt;-</span></span>
<span id="cb31-1991"><a href="#cb31-1991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(CO2c_fullgrad.means, Treat <span class="sc">==</span> <span class="st">"C"</span> <span class="sc">|</span></span>
<span id="cb31-1992"><a href="#cb31-1992" aria-hidden="true" tabindex="-1"></a>           Treat <span class="sc">==</span> <span class="st">"W3"</span> <span class="sc">|</span> Treat <span class="sc">==</span> <span class="st">"W8"</span>)</span>
<span id="cb31-1993"><a href="#cb31-1993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1994"><a href="#cb31-1994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1995"><a href="#cb31-1995" aria-hidden="true" tabindex="-1"></a><span class="do">############ scatter plot CO2 with fit #################################</span></span>
<span id="cb31-1996"><a href="#cb31-1996" aria-hidden="true" tabindex="-1"></a>plot.CO2byT_gr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-1997"><a href="#cb31-1997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> CO2c_fullgrad, <span class="fu">aes</span>(</span>
<span id="cb31-1998"><a href="#cb31-1998" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> Temp,</span>
<span id="cb31-1999"><a href="#cb31-1999" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> CO2,</span>
<span id="cb31-2000"><a href="#cb31-2000" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">factor</span>(Treat),</span>
<span id="cb31-2001"><a href="#cb31-2001" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb31-2002"><a href="#cb31-2002" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb31-2003"><a href="#cb31-2003" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-2004"><a href="#cb31-2004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb31-2005"><a href="#cb31-2005" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2c_fullgrad,</span>
<span id="cb31-2006"><a href="#cb31-2006" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Temp, <span class="at">y =</span> CO2, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb31-2007"><a href="#cb31-2007" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb31-2008"><a href="#cb31-2008" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb31-2009"><a href="#cb31-2009" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> T,</span>
<span id="cb31-2010"><a href="#cb31-2010" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2011"><a href="#cb31-2011" aria-hidden="true" tabindex="-1"></a>    <span class="at">fullrange =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-2012"><a href="#cb31-2012" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb31-2013"><a href="#cb31-2013" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2014"><a href="#cb31-2014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-2015"><a href="#cb31-2015" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2016"><a href="#cb31-2016" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-2017"><a href="#cb31-2017" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2018"><a href="#cb31-2018" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2019"><a href="#cb31-2019" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2020"><a href="#cb31-2020" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-2021"><a href="#cb31-2021" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-2022"><a href="#cb31-2022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-2023"><a href="#cb31-2023" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2024"><a href="#cb31-2024" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-2025"><a href="#cb31-2025" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2026"><a href="#cb31-2026" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2027"><a href="#cb31-2027" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2028"><a href="#cb31-2028" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-2029"><a href="#cb31-2029" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-2030"><a href="#cb31-2030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">35</span>)) <span class="sc">+</span></span>
<span id="cb31-2031"><a href="#cb31-2031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb31-2032"><a href="#cb31-2032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">'Soil'</span> <span class="sc">~</span> CO[<span class="dv">2</span>] <span class="sc">~</span> <span class="st">'efflux ('</span> <span class="sc">*</span> mu <span class="sc">~</span> <span class="st">'mol'</span> <span class="sc">~</span> CO[<span class="dv">2</span>] <span class="sc">~</span> m <span class="sc">^</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">~</span></span>
<span id="cb31-2033"><a href="#cb31-2033" aria-hidden="true" tabindex="-1"></a>                s <span class="sc">^</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="st">')'</span>)) <span class="sc">+</span></span>
<span id="cb31-2034"><a href="#cb31-2034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">' Soil temperature (°C)'</span>)) <span class="sc">+</span></span>
<span id="cb31-2035"><a href="#cb31-2035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-2036"><a href="#cb31-2036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-2037"><a href="#cb31-2037" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-2038"><a href="#cb31-2038" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-2039"><a href="#cb31-2039" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-2040"><a href="#cb31-2040" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-2041"><a href="#cb31-2041" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2042"><a href="#cb31-2042" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2043"><a href="#cb31-2043" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-2044"><a href="#cb31-2044" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2045"><a href="#cb31-2045" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2046"><a href="#cb31-2046" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2047"><a href="#cb31-2047" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2048"><a href="#cb31-2048" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2049"><a href="#cb31-2049" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2050"><a href="#cb31-2050" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2051"><a href="#cb31-2051" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-2052"><a href="#cb31-2052" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2053"><a href="#cb31-2053" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-2054"><a href="#cb31-2054" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-2055"><a href="#cb31-2055" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2056"><a href="#cb31-2056" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2057"><a href="#cb31-2057" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2058"><a href="#cb31-2058" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2059"><a href="#cb31-2059" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb31-2060"><a href="#cb31-2060" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2061"><a href="#cb31-2061" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2062"><a href="#cb31-2062" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-2063"><a href="#cb31-2063" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2064"><a href="#cb31-2064" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2065"><a href="#cb31-2065" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2066"><a href="#cb31-2066" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2067"><a href="#cb31-2067" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb31-2068"><a href="#cb31-2068" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-2069"><a href="#cb31-2069" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2070"><a href="#cb31-2070" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2071"><a href="#cb31-2071" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2072"><a href="#cb31-2072" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-2073"><a href="#cb31-2073" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-2074"><a href="#cb31-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2075"><a href="#cb31-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2076"><a href="#cb31-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2077"><a href="#cb31-2077" aria-hidden="true" tabindex="-1"></a><span class="do">############boxplot CO2, means</span></span>
<span id="cb31-2078"><a href="#cb31-2078" aria-hidden="true" tabindex="-1"></a>plot_CO2_box_full <span class="ot">&lt;-</span></span>
<span id="cb31-2079"><a href="#cb31-2079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(CO2c_fullgrad_sub_full, <span class="fu">aes</span>(<span class="at">x =</span> Treat, <span class="at">y =</span> CO2)) <span class="sc">+</span></span>
<span id="cb31-2080"><a href="#cb31-2080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb31-2081"><a href="#cb31-2081" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2c_fullgrad_sub_full,</span>
<span id="cb31-2082"><a href="#cb31-2082" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Treat, CO2, <span class="at">fill =</span> Treat),</span>
<span id="cb31-2083"><a href="#cb31-2083" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb31-2084"><a href="#cb31-2084" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2085"><a href="#cb31-2085" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier.colour =</span> <span class="st">"grey80"</span></span>
<span id="cb31-2086"><a href="#cb31-2086" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2087"><a href="#cb31-2087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-2088"><a href="#cb31-2088" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2089"><a href="#cb31-2089" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-2090"><a href="#cb31-2090" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2091"><a href="#cb31-2091" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2092"><a href="#cb31-2092" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2093"><a href="#cb31-2093" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-2094"><a href="#cb31-2094" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-2095"><a href="#cb31-2095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-2096"><a href="#cb31-2096" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2097"><a href="#cb31-2097" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-2098"><a href="#cb31-2098" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2099"><a href="#cb31-2099" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2100"><a href="#cb31-2100" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2101"><a href="#cb31-2101" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-2102"><a href="#cb31-2102" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-2103"><a href="#cb31-2103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">35</span>)) <span class="sc">+</span></span>
<span id="cb31-2104"><a href="#cb31-2104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb31-2105"><a href="#cb31-2105" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fl">4.736140</span>    ,</span>
<span id="cb31-2106"><a href="#cb31-2106" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb31-2107"><a href="#cb31-2107" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2108"><a href="#cb31-2108" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span></span>
<span id="cb31-2109"><a href="#cb31-2109" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2110"><a href="#cb31-2110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb31-2111"><a href="#cb31-2111" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fl">8.427807</span>   ,</span>
<span id="cb31-2112"><a href="#cb31-2112" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb31-2113"><a href="#cb31-2113" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2114"><a href="#cb31-2114" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span></span>
<span id="cb31-2115"><a href="#cb31-2115" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2116"><a href="#cb31-2116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb31-2117"><a href="#cb31-2117" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fl">15.984643</span>    ,</span>
<span id="cb31-2118"><a href="#cb31-2118" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb31-2119"><a href="#cb31-2119" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2120"><a href="#cb31-2120" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span></span>
<span id="cb31-2121"><a href="#cb31-2121" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2122"><a href="#cb31-2122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-2123"><a href="#cb31-2123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-2124"><a href="#cb31-2124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-2125"><a href="#cb31-2125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-2126"><a href="#cb31-2126" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-2127"><a href="#cb31-2127" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-2128"><a href="#cb31-2128" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-2129"><a href="#cb31-2129" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-2130"><a href="#cb31-2130" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2131"><a href="#cb31-2131" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2132"><a href="#cb31-2132" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2133"><a href="#cb31-2133" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2134"><a href="#cb31-2134" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2135"><a href="#cb31-2135" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2136"><a href="#cb31-2136" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2137"><a href="#cb31-2137" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2138"><a href="#cb31-2138" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2139"><a href="#cb31-2139" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2140"><a href="#cb31-2140" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2141"><a href="#cb31-2141" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2142"><a href="#cb31-2142" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-2143"><a href="#cb31-2143" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-2144"><a href="#cb31-2144" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2145"><a href="#cb31-2145" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2146"><a href="#cb31-2146" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2147"><a href="#cb31-2147" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2148"><a href="#cb31-2148" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2149"><a href="#cb31-2149" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2150"><a href="#cb31-2150" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2151"><a href="#cb31-2151" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-2152"><a href="#cb31-2152" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2153"><a href="#cb31-2153" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2154"><a href="#cb31-2154" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2155"><a href="#cb31-2155" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2156"><a href="#cb31-2156" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2157"><a href="#cb31-2157" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-2158"><a href="#cb31-2158" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2159"><a href="#cb31-2159" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2160"><a href="#cb31-2160" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2161"><a href="#cb31-2161" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-2162"><a href="#cb31-2162" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-2163"><a href="#cb31-2163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2164"><a href="#cb31-2164" aria-hidden="true" tabindex="-1"></a><span class="do">############boxplot soilT, means</span></span>
<span id="cb31-2165"><a href="#cb31-2165" aria-hidden="true" tabindex="-1"></a>plot_T_box <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(CO2c_fullgrad_sub, <span class="fu">aes</span>(<span class="at">x =</span> Treat, <span class="at">y =</span> Temp)) <span class="sc">+</span></span>
<span id="cb31-2166"><a href="#cb31-2166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb31-2167"><a href="#cb31-2167" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2c_fullgrad_sub,</span>
<span id="cb31-2168"><a href="#cb31-2168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Treat, Temp, <span class="at">fill =</span> Treat),</span>
<span id="cb31-2169"><a href="#cb31-2169" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb31-2170"><a href="#cb31-2170" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2171"><a href="#cb31-2171" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier.colour =</span> <span class="st">"grey80"</span></span>
<span id="cb31-2172"><a href="#cb31-2172" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2173"><a href="#cb31-2173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-2174"><a href="#cb31-2174" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2175"><a href="#cb31-2175" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-2176"><a href="#cb31-2176" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2177"><a href="#cb31-2177" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2178"><a href="#cb31-2178" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2179"><a href="#cb31-2179" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-2180"><a href="#cb31-2180" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-2181"><a href="#cb31-2181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-2182"><a href="#cb31-2182" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2183"><a href="#cb31-2183" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-2184"><a href="#cb31-2184" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2185"><a href="#cb31-2185" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-2186"><a href="#cb31-2186" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2187"><a href="#cb31-2187" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-2188"><a href="#cb31-2188" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-2189"><a href="#cb31-2189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">41</span>)) <span class="sc">+</span></span>
<span id="cb31-2190"><a href="#cb31-2190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb31-2191"><a href="#cb31-2191" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fl">26.07722</span>  ,</span>
<span id="cb31-2192"><a href="#cb31-2192" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb31-2193"><a href="#cb31-2193" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2194"><a href="#cb31-2194" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span></span>
<span id="cb31-2195"><a href="#cb31-2195" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2196"><a href="#cb31-2196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb31-2197"><a href="#cb31-2197" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fl">28.53902</span> ,</span>
<span id="cb31-2198"><a href="#cb31-2198" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb31-2199"><a href="#cb31-2199" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2200"><a href="#cb31-2200" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span></span>
<span id="cb31-2201"><a href="#cb31-2201" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2202"><a href="#cb31-2202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb31-2203"><a href="#cb31-2203" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fl">33.84000</span>   ,</span>
<span id="cb31-2204"><a href="#cb31-2204" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb31-2205"><a href="#cb31-2205" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-2206"><a href="#cb31-2206" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span></span>
<span id="cb31-2207"><a href="#cb31-2207" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2208"><a href="#cb31-2208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-2209"><a href="#cb31-2209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-2210"><a href="#cb31-2210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb31-2211"><a href="#cb31-2211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-2212"><a href="#cb31-2212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-2213"><a href="#cb31-2213" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-2214"><a href="#cb31-2214" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-2215"><a href="#cb31-2215" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-2216"><a href="#cb31-2216" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-2217"><a href="#cb31-2217" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2218"><a href="#cb31-2218" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2219"><a href="#cb31-2219" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2220"><a href="#cb31-2220" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2221"><a href="#cb31-2221" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2222"><a href="#cb31-2222" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2223"><a href="#cb31-2223" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2224"><a href="#cb31-2224" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2225"><a href="#cb31-2225" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2226"><a href="#cb31-2226" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2227"><a href="#cb31-2227" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2228"><a href="#cb31-2228" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2229"><a href="#cb31-2229" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-2230"><a href="#cb31-2230" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-2231"><a href="#cb31-2231" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2232"><a href="#cb31-2232" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2233"><a href="#cb31-2233" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2234"><a href="#cb31-2234" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2235"><a href="#cb31-2235" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2236"><a href="#cb31-2236" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-2237"><a href="#cb31-2237" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2238"><a href="#cb31-2238" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-2239"><a href="#cb31-2239" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2240"><a href="#cb31-2240" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-2241"><a href="#cb31-2241" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-2242"><a href="#cb31-2242" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-2243"><a href="#cb31-2243" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-2244"><a href="#cb31-2244" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-2245"><a href="#cb31-2245" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2246"><a href="#cb31-2246" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-2247"><a href="#cb31-2247" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-2248"><a href="#cb31-2248" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-2249"><a href="#cb31-2249" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-2250"><a href="#cb31-2250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2251"><a href="#cb31-2251" aria-hidden="true" tabindex="-1"></a><span class="co">#  overlay fitted prediction plots onto CO2 scatter</span></span>
<span id="cb31-2252"><a href="#cb31-2252" aria-hidden="true" tabindex="-1"></a>plot.CO2byT_gr_withpredict <span class="ot">&lt;-</span> plot.CO2byT_gr <span class="sc">+</span></span>
<span id="cb31-2253"><a href="#cb31-2253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb31-2254"><a href="#cb31-2254" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2predict.C.long,</span>
<span id="cb31-2255"><a href="#cb31-2255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span> (<span class="at">x =</span> temp.predict.C, <span class="at">y =</span> co2.predict.C) ,</span>
<span id="cb31-2256"><a href="#cb31-2256" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"grey40"</span>,</span>
<span id="cb31-2257"><a href="#cb31-2257" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2258"><a href="#cb31-2258" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb31-2259"><a href="#cb31-2259" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb31-2260"><a href="#cb31-2260" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2261"><a href="#cb31-2261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb31-2262"><a href="#cb31-2262" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2predict.C.long,</span>
<span id="cb31-2263"><a href="#cb31-2263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp.predict.C, <span class="at">y =</span> co2.predict.C, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb31-2264"><a href="#cb31-2264" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb31-2265"><a href="#cb31-2265" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb31-2266"><a href="#cb31-2266" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> T,</span>
<span id="cb31-2267"><a href="#cb31-2267" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"grey40"</span>,</span>
<span id="cb31-2268"><a href="#cb31-2268" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"#2271b2"</span>,</span>
<span id="cb31-2269"><a href="#cb31-2269" aria-hidden="true" tabindex="-1"></a>    <span class="at">fullrange =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-2270"><a href="#cb31-2270" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="fu">c</span>(<span class="dv">2</span>),</span>
<span id="cb31-2271"><a href="#cb31-2271" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb31-2272"><a href="#cb31-2272" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2273"><a href="#cb31-2273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb31-2274"><a href="#cb31-2274" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2predict.W3.long,</span>
<span id="cb31-2275"><a href="#cb31-2275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span> (<span class="at">x =</span> temp.predict.W3, <span class="at">y =</span> co2.predict.W3) ,</span>
<span id="cb31-2276"><a href="#cb31-2276" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"grey40"</span>,</span>
<span id="cb31-2277"><a href="#cb31-2277" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#71b222"</span>,</span>
<span id="cb31-2278"><a href="#cb31-2278" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb31-2279"><a href="#cb31-2279" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb31-2280"><a href="#cb31-2280" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2281"><a href="#cb31-2281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb31-2282"><a href="#cb31-2282" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2predict.W3.long,</span>
<span id="cb31-2283"><a href="#cb31-2283" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp.predict.W3, <span class="at">y =</span> co2.predict.W3, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb31-2284"><a href="#cb31-2284" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb31-2285"><a href="#cb31-2285" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb31-2286"><a href="#cb31-2286" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> T,</span>
<span id="cb31-2287"><a href="#cb31-2287" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"grey20"</span>,</span>
<span id="cb31-2288"><a href="#cb31-2288" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"#71b222"</span>,</span>
<span id="cb31-2289"><a href="#cb31-2289" aria-hidden="true" tabindex="-1"></a>    <span class="at">fullrange =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-2290"><a href="#cb31-2290" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="fu">c</span>(<span class="dv">2</span>),</span>
<span id="cb31-2291"><a href="#cb31-2291" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb31-2292"><a href="#cb31-2292" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2293"><a href="#cb31-2293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb31-2294"><a href="#cb31-2294" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2predict.W8.long,</span>
<span id="cb31-2295"><a href="#cb31-2295" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span> (<span class="at">x =</span> temp.predict.W8, <span class="at">y =</span> co2.predict.W8) ,</span>
<span id="cb31-2296"><a href="#cb31-2296" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"grey40"</span>,</span>
<span id="cb31-2297"><a href="#cb31-2297" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#b22271"</span>,</span>
<span id="cb31-2298"><a href="#cb31-2298" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb31-2299"><a href="#cb31-2299" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb31-2300"><a href="#cb31-2300" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-2301"><a href="#cb31-2301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb31-2302"><a href="#cb31-2302" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CO2predict.W8.long,</span>
<span id="cb31-2303"><a href="#cb31-2303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp.predict.W8, <span class="at">y =</span> co2.predict.W8, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb31-2304"><a href="#cb31-2304" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb31-2305"><a href="#cb31-2305" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb31-2306"><a href="#cb31-2306" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> T,</span>
<span id="cb31-2307"><a href="#cb31-2307" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"grey40"</span>,</span>
<span id="cb31-2308"><a href="#cb31-2308" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"#b22271"</span>,</span>
<span id="cb31-2309"><a href="#cb31-2309" aria-hidden="true" tabindex="-1"></a>    <span class="at">fullrange =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-2310"><a href="#cb31-2310" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="fu">c</span>(<span class="dv">2</span>),</span>
<span id="cb31-2311"><a href="#cb31-2311" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb31-2312"><a href="#cb31-2312" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-2313"><a href="#cb31-2313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2314"><a href="#cb31-2314" aria-hidden="true" tabindex="-1"></a><span class="co"># composite plot</span></span>
<span id="cb31-2315"><a href="#cb31-2315" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(plot_T_box, blankPlot, plot.CO2byT_gr_withpredict, plot_CO2_box_full, </span>
<span id="cb31-2316"><a href="#cb31-2316" aria-hidden="true" tabindex="-1"></a>        <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">1.4</span>), <span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">1.4</span>, <span class="dv">4</span>))</span>
<span id="cb31-2317"><a href="#cb31-2317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2318"><a href="#cb31-2318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2319"><a href="#cb31-2319" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-2320"><a href="#cb31-2320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">11</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">4</span>),</span>
<span id="cb31-2321"><a href="#cb31-2321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">12</span>, <span class="at">b =</span> <span class="dv">14</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">4</span>),</span>
<span id="cb31-2322"><a href="#cb31-2322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">11</span>, <span class="at">l =</span> <span class="dv">5</span>, <span class="at">r =</span> <span class="dv">5</span>)</span>
<span id="cb31-2323"><a href="#cb31-2323" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-2324"><a href="#cb31-2324" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(layout)</span>
<span id="cb31-2325"><a href="#cb31-2325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2326"><a href="#cb31-2326" aria-hidden="true" tabindex="-1"></a>combo_plot <span class="ot">&lt;-</span> plot.CO2byT_gr_withpredict <span class="sc">+</span> plot_T_box <span class="sc">+</span> plot_CO2_box_full <span class="sc">+</span> </span>
<span id="cb31-2327"><a href="#cb31-2327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)  </span>
<span id="cb31-2328"><a href="#cb31-2328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2329"><a href="#cb31-2329" aria-hidden="true" tabindex="-1"></a><span class="co">#combo_plot &lt;- </span></span>
<span id="cb31-2330"><a href="#cb31-2330" aria-hidden="true" tabindex="-1"></a><span class="co">#  plot.Tmin_forVmax + plot.vmax.XY + plot.Tminxyl + ((ssu18_temp_adapt_plot /  its18_temp_adapt_plot)) + </span></span>
<span id="cb31-2331"><a href="#cb31-2331" aria-hidden="true" tabindex="-1"></a><span class="co">#  plot_layout(design = layout)  </span></span>
<span id="cb31-2332"><a href="#cb31-2332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2333"><a href="#cb31-2333" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span id="cb31-2334"><a href="#cb31-2334" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Figure_3.png"</span>, </span>
<span id="cb31-2335"><a href="#cb31-2335" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="fl">19.33</span>, <span class="at">width =</span> <span class="fl">18.51</span>, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-2336"><a href="#cb31-2336" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb31-2337"><a href="#cb31-2337" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/MAIN/"</span>, </span>
<span id="cb31-2338"><a href="#cb31-2338" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Figure_3.pdf"</span>, </span>
<span id="cb31-2339"><a href="#cb31-2339" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="fl">19.33</span>, <span class="at">width =</span> <span class="fl">18.51</span>, <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-2340"><a href="#cb31-2340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2341"><a href="#cb31-2341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-2342"><a href="#cb31-2342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2343"><a href="#cb31-2343" aria-hidden="true" tabindex="-1"></a><span class="fu"># Extended Data</span></span>
<span id="cb31-2344"><a href="#cb31-2344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2345"><a href="#cb31-2345" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 2</span></span>
<span id="cb31-2346"><a href="#cb31-2346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2347"><a href="#cb31-2347" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-2348"><a href="#cb31-2348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2349"><a href="#cb31-2349" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-2350"><a href="#cb31-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2351"><a href="#cb31-2351" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include axes and label resizing, removing non-significant (NS) values from plots,  changing significant p-values to asterisks (<span class="in">`*`</span>), creating a legend, and enlarging outlier points. </span>
<span id="cb31-2352"><a href="#cb31-2352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2353"><a href="#cb31-2353" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-2354"><a href="#cb31-2354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2355"><a href="#cb31-2355" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-2356"><a href="#cb31-2356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2357"><a href="#cb31-2357" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-2358"><a href="#cb31-2358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2359"><a href="#cb31-2359" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.png)</span></span>
<span id="cb31-2360"><a href="#cb31-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2361"><a href="#cb31-2361" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-2362"><a href="#cb31-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2363"><a href="#cb31-2363" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_2.png)</span></span>
<span id="cb31-2364"><a href="#cb31-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2365"><a href="#cb31-2365" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-2366"><a href="#cb31-2366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2367"><a href="#cb31-2367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2368"><a href="#cb31-2368" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-2369"><a href="#cb31-2369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2370"><a href="#cb31-2370" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-2371"><a href="#cb31-2371" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 2 data pack</span><span class="co">](include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.rdata)</span>  </span>
<span id="cb31-2372"><a href="#cb31-2372" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-2373"><a href="#cb31-2373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2374"><a href="#cb31-2374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2375"><a href="#cb31-2375" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-2376"><a href="#cb31-2376" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 2 raw  pdf</span><span class="co">](include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.pdf)</span></span>
<span id="cb31-2377"><a href="#cb31-2377" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-2378"><a href="#cb31-2378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2379"><a href="#cb31-2379" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-2380"><a href="#cb31-2380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2381"><a href="#cb31-2381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alpha diversity plot code</span></span>
<span id="cb31-2382"><a href="#cb31-2382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2385"><a href="#cb31-2385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-2386"><a href="#cb31-2386" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Extended Data Figure 2 a &amp; d"</span></span>
<span id="cb31-2387"><a href="#cb31-2387" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-2388"><a href="#cb31-2388" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/EXD/EXD_Figure_2/Extended_Data_Figure_2.rdata"</span>)</span>
<span id="cb31-2389"><a href="#cb31-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2390"><a href="#cb31-2390" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2391"><a href="#cb31-2391" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2392"><a href="#cb31-2392" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA ALPHA DIV PLOTS ########</span></span>
<span id="cb31-2393"><a href="#cb31-2393" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2394"><a href="#cb31-2394" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2395"><a href="#cb31-2395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2396"><a href="#cb31-2396" aria-hidden="true" tabindex="-1"></a>tmp_objects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_perfect"</span>)</span>
<span id="cb31-2397"><a href="#cb31-2397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2398"><a href="#cb31-2398" aria-hidden="true" tabindex="-1"></a>tmp_metric <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span>))</span>
<span id="cb31-2399"><a href="#cb31-2399" aria-hidden="true" tabindex="-1"></a>tmp_qvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>))</span>
<span id="cb31-2400"><a href="#cb31-2400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2401"><a href="#cb31-2401" aria-hidden="true" tabindex="-1"></a>qvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb31-2402"><a href="#cb31-2402" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tmp_objects) {</span>
<span id="cb31-2403"><a href="#cb31-2403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2404"><a href="#cb31-2404" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2405"><a href="#cb31-2405" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2406"><a href="#cb31-2406" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2407"><a href="#cb31-2407" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>homogeneity.pvalue</span>
<span id="cb31-2408"><a href="#cb31-2408" aria-hidden="true" tabindex="-1"></a>          tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_h_pvalue, tmp_get))</span>
<span id="cb31-2409"><a href="#cb31-2409" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2410"><a href="#cb31-2410" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_h_pvalue)</span>
<span id="cb31-2411"><a href="#cb31-2411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2412"><a href="#cb31-2412" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2413"><a href="#cb31-2413" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2414"><a href="#cb31-2414" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2415"><a href="#cb31-2415" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>normality.pvalue</span>
<span id="cb31-2416"><a href="#cb31-2416" aria-hidden="true" tabindex="-1"></a>          tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_n_pvalue, tmp_get))</span>
<span id="cb31-2417"><a href="#cb31-2417" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2418"><a href="#cb31-2418" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_n_pvalue)</span>
<span id="cb31-2419"><a href="#cb31-2419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2420"><a href="#cb31-2420" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2421"><a href="#cb31-2421" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2422"><a href="#cb31-2422" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2423"><a href="#cb31-2423" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>method</span>
<span id="cb31-2424"><a href="#cb31-2424" aria-hidden="true" tabindex="-1"></a>          tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_method, tmp_get))</span>
<span id="cb31-2425"><a href="#cb31-2425" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2426"><a href="#cb31-2426" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_method)</span>
<span id="cb31-2427"><a href="#cb31-2427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2428"><a href="#cb31-2428" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2429"><a href="#cb31-2429" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2430"><a href="#cb31-2430" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2431"><a href="#cb31-2431" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2432"><a href="#cb31-2432" aria-hidden="true" tabindex="-1"></a>          tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_phoc_method, tmp_get))</span>
<span id="cb31-2433"><a href="#cb31-2433" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2434"><a href="#cb31-2434" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_phoc_method)</span>
<span id="cb31-2435"><a href="#cb31-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2436"><a href="#cb31-2436" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(tmp_metric, tmp_qvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2437"><a href="#cb31-2437" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_n_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2438"><a href="#cb31-2438" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_h_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2439"><a href="#cb31-2439" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_method) <span class="sc">%&gt;%</span></span>
<span id="cb31-2440"><a href="#cb31-2440" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_phoc_method) <span class="sc">%&gt;%</span></span>
<span id="cb31-2441"><a href="#cb31-2441" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"metric"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"q-value"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"normality p-value"</span> <span class="ot">=</span> <span class="dv">3</span>, </span>
<span id="cb31-2442"><a href="#cb31-2442" aria-hidden="true" tabindex="-1"></a>                <span class="st">"homogeneity p-value"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"method"</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">"posthoc method"</span> <span class="ot">=</span> <span class="dv">6</span>)</span>
<span id="cb31-2443"><a href="#cb31-2443" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">"_sig_tab"</span>))</span>
<span id="cb31-2444"><a href="#cb31-2444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-2445"><a href="#cb31-2445" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2446"><a href="#cb31-2446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2447"><a href="#cb31-2447" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span></span>
<span id="cb31-2448"><a href="#cb31-2448" aria-hidden="true" tabindex="-1"></a><span class="do">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span></span>
<span id="cb31-2449"><a href="#cb31-2449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2450"><a href="#cb31-2450" aria-hidden="true" tabindex="-1"></a>tmp_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(ssu18_ps_perfect_q0_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb31-2451"><a href="#cb31-2451" aria-hidden="true" tabindex="-1"></a>                           ssu18_ps_perfect_q1_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb31-2452"><a href="#cb31-2452" aria-hidden="true" tabindex="-1"></a>                           ssu18_ps_perfect_q2_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]]))</span>
<span id="cb31-2453"><a href="#cb31-2453" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(ssu18_ps_perfect_sig_tab, tmp_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2454"><a href="#cb31-2454" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"posthoc p-value"</span> <span class="ot">=</span> <span class="dv">7</span>)</span>
<span id="cb31-2455"><a href="#cb31-2455" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-2456"><a href="#cb31-2456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2457"><a href="#cb31-2457" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb31-2458"><a href="#cb31-2458" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-2459"><a href="#cb31-2459" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab<span class="sc">$</span>lineage <span class="ot">&lt;-</span> <span class="st">"No"</span></span>
<span id="cb31-2460"><a href="#cb31-2460" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_sig_tab <span class="ot">&lt;-</span> ssu18_ps_perfect_sig_tab[,<span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb31-2461"><a href="#cb31-2461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2462"><a href="#cb31-2462" aria-hidden="true" tabindex="-1"></a>ssu18_sig_tab_all <span class="ot">&lt;-</span> ssu18_ps_perfect_sig_tab</span>
<span id="cb31-2463"><a href="#cb31-2463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2464"><a href="#cb31-2464" aria-hidden="true" tabindex="-1"></a><span class="do">## PostHoc Analyses </span></span>
<span id="cb31-2465"><a href="#cb31-2465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2466"><a href="#cb31-2466" aria-hidden="true" tabindex="-1"></a><span class="do">## First let's check the results of each posthoc analysis.</span></span>
<span id="cb31-2467"><a href="#cb31-2467" aria-hidden="true" tabindex="-1"></a><span class="do">### Observed (q-value = 0)</span></span>
<span id="cb31-2468"><a href="#cb31-2468" aria-hidden="true" tabindex="-1"></a>ssu18_asvr0_lab <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb31-2469"><a href="#cb31-2469" aria-hidden="true" tabindex="-1"></a>ssu18_asvr0_lab</span>
<span id="cb31-2470"><a href="#cb31-2470" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q0_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2471"><a href="#cb31-2471" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(ssu18_ps_perfect_q0_adt<span class="sc">$</span>posthoc)</span>
<span id="cb31-2472"><a href="#cb31-2472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2473"><a href="#cb31-2473" aria-hidden="true" tabindex="-1"></a>ssu18_asvr1_lab <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb31-2474"><a href="#cb31-2474" aria-hidden="true" tabindex="-1"></a>ssu18_asvr1_lab</span>
<span id="cb31-2475"><a href="#cb31-2475" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q1_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2476"><a href="#cb31-2476" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(ssu18_ps_perfect_q1_adt<span class="sc">$</span>posthoc)</span>
<span id="cb31-2477"><a href="#cb31-2477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2478"><a href="#cb31-2478" aria-hidden="true" tabindex="-1"></a>ssu18_asvr2_lab <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb31-2479"><a href="#cb31-2479" aria-hidden="true" tabindex="-1"></a>ssu18_asvr2_lab</span>
<span id="cb31-2480"><a href="#cb31-2480" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q2_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2481"><a href="#cb31-2481" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(ssu18_ps_perfect_q2_adt<span class="sc">$</span>posthoc)</span>
<span id="cb31-2482"><a href="#cb31-2482" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we can plot the results from the posthoc analyses for each metric </span></span>
<span id="cb31-2483"><a href="#cb31-2483" aria-hidden="true" tabindex="-1"></a><span class="do">## and data set using the function `div_test_plot_jjs`. </span></span>
<span id="cb31-2484"><a href="#cb31-2484" aria-hidden="true" tabindex="-1"></a><span class="do">## I modified the original function (`div_test_plot`) to control a </span></span>
<span id="cb31-2485"><a href="#cb31-2485" aria-hidden="true" tabindex="-1"></a><span class="do">## little of the formatting.</span></span>
<span id="cb31-2486"><a href="#cb31-2486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2487"><a href="#cb31-2487" aria-hidden="true" tabindex="-1"></a><span class="do">## The command is as follows:</span></span>
<span id="cb31-2488"><a href="#cb31-2488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2489"><a href="#cb31-2489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2490"><a href="#cb31-2490" aria-hidden="true" tabindex="-1"></a><span class="do">## div_test_plot(divtest = x, chart = "type", colour = col.pal, </span></span>
<span id="cb31-2491"><a href="#cb31-2491" aria-hidden="true" tabindex="-1"></a><span class="do">##               posthoc = TRUE, threshold = value))</span></span>
<span id="cb31-2492"><a href="#cb31-2492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2493"><a href="#cb31-2493" aria-hidden="true" tabindex="-1"></a><span class="do">## where `x` is the results from the `div_test` function, `"type"` is </span></span>
<span id="cb31-2494"><a href="#cb31-2494" aria-hidden="true" tabindex="-1"></a><span class="do">## chart type (box, jitter, or violin), `colour` is is a color palette, </span></span>
<span id="cb31-2495"><a href="#cb31-2495" aria-hidden="true" tabindex="-1"></a><span class="do">## `posthoc` indicates whether to run posthoc pairwise analyses, and `value` </span></span>
<span id="cb31-2496"><a href="#cb31-2496" aria-hidden="true" tabindex="-1"></a><span class="do">## is the maximum p-value to show in pairwise posthoc results. </span></span>
<span id="cb31-2497"><a href="#cb31-2497" aria-hidden="true" tabindex="-1"></a><span class="do">## **</span><span class="al">WARNING</span><span class="do">** if none of the posthoc results are below the specified </span></span>
<span id="cb31-2498"><a href="#cb31-2498" aria-hidden="true" tabindex="-1"></a><span class="do">## threshold, the function will throw an error. Therefore, until this is </span></span>
<span id="cb31-2499"><a href="#cb31-2499" aria-hidden="true" tabindex="-1"></a><span class="do">## fixed, all posthoc values are shown.</span></span>
<span id="cb31-2500"><a href="#cb31-2500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2501"><a href="#cb31-2501" aria-hidden="true" tabindex="-1"></a>div_test_plot_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (divtest, chart, colour, posthoc, threshold) </span>
<span id="cb31-2502"><a href="#cb31-2502" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-2503"><a href="#cb31-2503" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(chart)) {</span>
<span id="cb31-2504"><a href="#cb31-2504" aria-hidden="true" tabindex="-1"></a>        chart <span class="ot">=</span> <span class="st">"box"</span></span>
<span id="cb31-2505"><a href="#cb31-2505" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2506"><a href="#cb31-2506" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(posthoc)) {</span>
<span id="cb31-2507"><a href="#cb31-2507" aria-hidden="true" tabindex="-1"></a>        posthoc <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb31-2508"><a href="#cb31-2508" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2509"><a href="#cb31-2509" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">names</span>(divtest)[<span class="dv">1</span>] <span class="sc">!=</span> <span class="st">"data"</span>) <span class="sc">&amp;</span> (<span class="fu">names</span>(divtest)[<span class="dv">2</span>] <span class="sc">!=</span> </span>
<span id="cb31-2510"><a href="#cb31-2510" aria-hidden="true" tabindex="-1"></a>        <span class="st">"normality.pvalue"</span>)) </span>
<span id="cb31-2511"><a href="#cb31-2511" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"The input object does not seem to be a div_test output."</span>)</span>
<span id="cb31-2512"><a href="#cb31-2512" aria-hidden="true" tabindex="-1"></a>    divtestdata <span class="ot">&lt;-</span> divtest<span class="sc">$</span>data</span>
<span id="cb31-2513"><a href="#cb31-2513" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(divtestdata<span class="sc">$</span>Group)</span>
<span id="cb31-2514"><a href="#cb31-2514" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(divtestdata<span class="sc">$</span>Group, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(divtestdata<span class="sc">$</span>Group)))</span>
<span id="cb31-2515"><a href="#cb31-2515" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(colour) <span class="sc">||</span> (<span class="fu">length</span>(colour) <span class="sc">&lt;</span> divtest<span class="sc">$</span>groups)) {</span>
<span id="cb31-2516"><a href="#cb31-2516" aria-hidden="true" tabindex="-1"></a>        getPalette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(divtest<span class="sc">$</span>groups, </span>
<span id="cb31-2517"><a href="#cb31-2517" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Paired"</span>))</span>
<span id="cb31-2518"><a href="#cb31-2518" aria-hidden="true" tabindex="-1"></a>        colour <span class="ot">&lt;-</span> <span class="fu">getPalette</span>(divtest<span class="sc">$</span>groups)</span>
<span id="cb31-2519"><a href="#cb31-2519" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2520"><a href="#cb31-2520" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-2521"><a href="#cb31-2521" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">names</span>(divtest)[<span class="dv">7</span>])) </span>
<span id="cb31-2522"><a href="#cb31-2522" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span id="cb31-2523"><a href="#cb31-2523" aria-hidden="true" tabindex="-1"></a><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span>)</span>
<span id="cb31-2524"><a href="#cb31-2524" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Tukey post-hoc test"</span>) {</span>
<span id="cb31-2525"><a href="#cb31-2525" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb31-2526"><a href="#cb31-2526" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb31-2527"><a href="#cb31-2527" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2528"><a href="#cb31-2528" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">4</span>], <span class="dv">4</span>)</span>
<span id="cb31-2529"><a href="#cb31-2529" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb31-2530"><a href="#cb31-2530" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb31-2531"><a href="#cb31-2531" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb31-2532"><a href="#cb31-2532" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb31-2533"><a href="#cb31-2533" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2534"><a href="#cb31-2534" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span>) {</span>
<span id="cb31-2535"><a href="#cb31-2535" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb31-2536"><a href="#cb31-2536" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb31-2537"><a href="#cb31-2537" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2538"><a href="#cb31-2538" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">3</span>], <span class="dv">4</span>)</span>
<span id="cb31-2539"><a href="#cb31-2539" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb31-2540"><a href="#cb31-2540" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb31-2541"><a href="#cb31-2541" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb31-2542"><a href="#cb31-2542" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb31-2543"><a href="#cb31-2543" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2544"><a href="#cb31-2544" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">1</span>])</span>
<span id="cb31-2545"><a href="#cb31-2545" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">2</span>])</span>
<span id="cb31-2546"><a href="#cb31-2546" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(pairwisetable[, </span>
<span id="cb31-2547"><a href="#cb31-2547" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>]))</span>
<span id="cb31-2548"><a href="#cb31-2548" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(threshold)) {</span>
<span id="cb31-2549"><a href="#cb31-2549" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> pairwisetable[<span class="fu">which</span>(pairwisetable<span class="sc">$</span>p <span class="sc">&lt;</span> </span>
<span id="cb31-2550"><a href="#cb31-2550" aria-hidden="true" tabindex="-1"></a>                threshold), ]</span>
<span id="cb31-2551"><a href="#cb31-2551" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2552"><a href="#cb31-2552" aria-hidden="true" tabindex="-1"></a>        sortedgroups <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(pairwisetable<span class="sc">$</span>group1, pairwisetable<span class="sc">$</span>group2)))</span>
<span id="cb31-2553"><a href="#cb31-2553" aria-hidden="true" tabindex="-1"></a>        datamax <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">max</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb31-2554"><a href="#cb31-2554" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb31-2555"><a href="#cb31-2555" aria-hidden="true" tabindex="-1"></a>        datamin <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">min</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb31-2556"><a href="#cb31-2556" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb31-2557"><a href="#cb31-2557" aria-hidden="true" tabindex="-1"></a>        datarange <span class="ot">&lt;-</span> datamax <span class="sc">-</span> datamin</span>
<span id="cb31-2558"><a href="#cb31-2558" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">&lt;-</span> datarange <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb31-2559"><a href="#cb31-2559" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">&lt;-</span> datamax</span>
<span id="cb31-2560"><a href="#cb31-2560" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">&lt;-</span> min <span class="sc">+</span> (by <span class="sc">*</span> <span class="fu">nrow</span>(pairwisetable))</span>
<span id="cb31-2561"><a href="#cb31-2561" aria-hidden="true" tabindex="-1"></a>        ypos <span class="ot">&lt;-</span> <span class="fu">seq</span>(min, max, by)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb31-2562"><a href="#cb31-2562" aria-hidden="true" tabindex="-1"></a>        pairwisetable<span class="sc">$</span>ypos <span class="ot">&lt;-</span> ypos</span>
<span id="cb31-2563"><a href="#cb31-2563" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2564"><a href="#cb31-2564" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"box"</span>) {</span>
<span id="cb31-2565"><a href="#cb31-2565" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">outlier.size =</span> <span class="dv">3</span>,</span>
<span id="cb31-2566"><a href="#cb31-2566" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb31-2567"><a href="#cb31-2567" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-2568"><a href="#cb31-2568" aria-hidden="true" tabindex="-1"></a>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span id="cb31-2569"><a href="#cb31-2569" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb31-2570"><a href="#cb31-2570" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb31-2571"><a href="#cb31-2571" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_linetype_manual</span>()</span>
<span id="cb31-2572"><a href="#cb31-2572" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-2573"><a href="#cb31-2573" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-2574"><a href="#cb31-2574" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-2575"><a href="#cb31-2575" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2576"><a href="#cb31-2576" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(plot)</span>
<span id="cb31-2577"><a href="#cb31-2577" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2578"><a href="#cb31-2578" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"jitter"</span>) {</span>
<span id="cb31-2579"><a href="#cb31-2579" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb31-2580"><a href="#cb31-2580" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb31-2581"><a href="#cb31-2581" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-2582"><a href="#cb31-2582" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-2583"><a href="#cb31-2583" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>))</span>
<span id="cb31-2584"><a href="#cb31-2584" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-2585"><a href="#cb31-2585" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-2586"><a href="#cb31-2586" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-2587"><a href="#cb31-2587" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2588"><a href="#cb31-2588" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb31-2589"><a href="#cb31-2589" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2590"><a href="#cb31-2590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"violin"</span>) {</span>
<span id="cb31-2591"><a href="#cb31-2591" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggviolin</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb31-2592"><a href="#cb31-2592" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb31-2593"><a href="#cb31-2593" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-2594"><a href="#cb31-2594" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-2595"><a href="#cb31-2595" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-2596"><a href="#cb31-2596" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>))</span>
<span id="cb31-2597"><a href="#cb31-2597" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-2598"><a href="#cb31-2598" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-2599"><a href="#cb31-2599" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-2600"><a href="#cb31-2600" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2601"><a href="#cb31-2601" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb31-2602"><a href="#cb31-2602" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2603"><a href="#cb31-2603" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2604"><a href="#cb31-2604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2605"><a href="#cb31-2605" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-2606"><a href="#cb31-2606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2607"><a href="#cb31-2607" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb31-2608"><a href="#cb31-2608" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb31-2609"><a href="#cb31-2609" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb31-2610"><a href="#cb31-2610" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-2611"><a href="#cb31-2611" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get, <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb31-2612"><a href="#cb31-2612" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">colour =</span> swel_col, <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2613"><a href="#cb31-2613" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb31-2614"><a href="#cb31-2614" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-2615"><a href="#cb31-2615" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-2616"><a href="#cb31-2616" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-2617"><a href="#cb31-2617" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2618"><a href="#cb31-2618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2619"><a href="#cb31-2619" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb31-2620"><a href="#cb31-2620" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-2621"><a href="#cb31-2621" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effective no. of Taxon Units"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-2622"><a href="#cb31-2622" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(ssu18_asvr0_lab) <span class="sc">+</span> </span>
<span id="cb31-2623"><a href="#cb31-2623" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-2624"><a href="#cb31-2624" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-2625"><a href="#cb31-2625" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatment"</span>) <span class="sc">+</span></span>
<span id="cb31-2626"><a href="#cb31-2626" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-2627"><a href="#cb31-2627" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(ssu18_asvr1_lab) <span class="sc">+</span> </span>
<span id="cb31-2628"><a href="#cb31-2628" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-2629"><a href="#cb31-2629" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-2630"><a href="#cb31-2630" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-2631"><a href="#cb31-2631" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb31-2632"><a href="#cb31-2632" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(ssu18_asvr2_lab) <span class="sc">+</span> </span>
<span id="cb31-2633"><a href="#cb31-2633" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-2634"><a href="#cb31-2634" aria-hidden="true" tabindex="-1"></a>ssu18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb31-2635"><a href="#cb31-2635" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q0_adt_plot, </span>
<span id="cb31-2636"><a href="#cb31-2636" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q1_adt_plot, </span>
<span id="cb31-2637"><a href="#cb31-2637" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q2_adt_plot, </span>
<span id="cb31-2638"><a href="#cb31-2638" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb31-2639"><a href="#cb31-2639" aria-hidden="true" tabindex="-1"></a>ssu18_alph_div_plots_asv</span>
<span id="cb31-2640"><a href="#cb31-2640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2641"><a href="#cb31-2641" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2642"><a href="#cb31-2642" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2643"><a href="#cb31-2643" aria-hidden="true" tabindex="-1"></a><span class="do">### ITS ALPHA DIV PLOTS #############</span></span>
<span id="cb31-2644"><a href="#cb31-2644" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2645"><a href="#cb31-2645" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2646"><a href="#cb31-2646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2647"><a href="#cb31-2647" aria-hidden="true" tabindex="-1"></a>tmp_objects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_perfect"</span>)</span>
<span id="cb31-2648"><a href="#cb31-2648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2649"><a href="#cb31-2649" aria-hidden="true" tabindex="-1"></a>tmp_metric <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Shannon exponential"</span>, <span class="st">"Inverse Simpson"</span>))</span>
<span id="cb31-2650"><a href="#cb31-2650" aria-hidden="true" tabindex="-1"></a>tmp_qvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>))</span>
<span id="cb31-2651"><a href="#cb31-2651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2652"><a href="#cb31-2652" aria-hidden="true" tabindex="-1"></a>qvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb31-2653"><a href="#cb31-2653" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tmp_objects) {</span>
<span id="cb31-2654"><a href="#cb31-2654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2655"><a href="#cb31-2655" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2656"><a href="#cb31-2656" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2657"><a href="#cb31-2657" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2658"><a href="#cb31-2658" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>homogeneity.pvalue</span>
<span id="cb31-2659"><a href="#cb31-2659" aria-hidden="true" tabindex="-1"></a>          tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_h_pvalue, tmp_get))</span>
<span id="cb31-2660"><a href="#cb31-2660" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2661"><a href="#cb31-2661" aria-hidden="true" tabindex="-1"></a>  tmp_h_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_h_pvalue)</span>
<span id="cb31-2662"><a href="#cb31-2662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2663"><a href="#cb31-2663" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2664"><a href="#cb31-2664" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2665"><a href="#cb31-2665" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2666"><a href="#cb31-2666" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>normality.pvalue</span>
<span id="cb31-2667"><a href="#cb31-2667" aria-hidden="true" tabindex="-1"></a>          tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_n_pvalue, tmp_get))</span>
<span id="cb31-2668"><a href="#cb31-2668" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2669"><a href="#cb31-2669" aria-hidden="true" tabindex="-1"></a>  tmp_n_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_n_pvalue)</span>
<span id="cb31-2670"><a href="#cb31-2670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2671"><a href="#cb31-2671" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2672"><a href="#cb31-2672" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2673"><a href="#cb31-2673" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2674"><a href="#cb31-2674" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>method</span>
<span id="cb31-2675"><a href="#cb31-2675" aria-hidden="true" tabindex="-1"></a>          tmp_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_method, tmp_get))</span>
<span id="cb31-2676"><a href="#cb31-2676" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2677"><a href="#cb31-2677" aria-hidden="true" tabindex="-1"></a>  tmp_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_method)</span>
<span id="cb31-2678"><a href="#cb31-2678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2679"><a href="#cb31-2679" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-2680"><a href="#cb31-2680" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> qvalue) {</span>
<span id="cb31-2681"><a href="#cb31-2681" aria-hidden="true" tabindex="-1"></a>          tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_q"</span>, j, <span class="st">"_adt"</span>))</span>
<span id="cb31-2682"><a href="#cb31-2682" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_name)<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2683"><a href="#cb31-2683" aria-hidden="true" tabindex="-1"></a>          tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">append</span>(tmp_phoc_method, tmp_get))</span>
<span id="cb31-2684"><a href="#cb31-2684" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-2685"><a href="#cb31-2685" aria-hidden="true" tabindex="-1"></a>  tmp_phoc_method <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp_phoc_method)</span>
<span id="cb31-2686"><a href="#cb31-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2687"><a href="#cb31-2687" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(tmp_metric, tmp_qvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2688"><a href="#cb31-2688" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_n_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2689"><a href="#cb31-2689" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_h_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2690"><a href="#cb31-2690" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_method) <span class="sc">%&gt;%</span></span>
<span id="cb31-2691"><a href="#cb31-2691" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(., tmp_phoc_method) <span class="sc">%&gt;%</span></span>
<span id="cb31-2692"><a href="#cb31-2692" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"metric"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"q-value"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"normality p-value"</span> <span class="ot">=</span> <span class="dv">3</span>, </span>
<span id="cb31-2693"><a href="#cb31-2693" aria-hidden="true" tabindex="-1"></a>                <span class="st">"homogeneity p-value"</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">"method"</span> <span class="ot">=</span> <span class="dv">5</span>, <span class="st">"posthoc method"</span> <span class="ot">=</span> <span class="dv">6</span>)</span>
<span id="cb31-2694"><a href="#cb31-2694" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">"_sig_tab"</span>))</span>
<span id="cb31-2695"><a href="#cb31-2695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-2696"><a href="#cb31-2696" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2697"><a href="#cb31-2697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2698"><a href="#cb31-2698" aria-hidden="true" tabindex="-1"></a><span class="do">## FALSE Kruskal-Wallis Test = its18_pime_q1_adt$test[[3]]</span></span>
<span id="cb31-2699"><a href="#cb31-2699" aria-hidden="true" tabindex="-1"></a><span class="do">## TRUE Tukey post-hoc  = its18_ps_work_q0_adt$test[[1]][[1, 5]]</span></span>
<span id="cb31-2700"><a href="#cb31-2700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2701"><a href="#cb31-2701" aria-hidden="true" tabindex="-1"></a>tmp_pvalue <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">c</span>(its18_ps_perfect_q0_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb31-2702"><a href="#cb31-2702" aria-hidden="true" tabindex="-1"></a>                           its18_ps_perfect_q1_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]],</span>
<span id="cb31-2703"><a href="#cb31-2703" aria-hidden="true" tabindex="-1"></a>                           its18_ps_perfect_q2_adt<span class="sc">$</span>test[[<span class="dv">1</span>]][[<span class="dv">1</span>, <span class="dv">5</span>]]))</span>
<span id="cb31-2704"><a href="#cb31-2704" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(its18_ps_perfect_sig_tab, tmp_pvalue) <span class="sc">%&gt;%</span></span>
<span id="cb31-2705"><a href="#cb31-2705" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"posthoc p-value"</span> <span class="ot">=</span> <span class="dv">7</span>)</span>
<span id="cb31-2706"><a href="#cb31-2706" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-2707"><a href="#cb31-2707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2708"><a href="#cb31-2708" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb31-2709"><a href="#cb31-2709" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-2710"><a href="#cb31-2710" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab<span class="sc">$</span>lineage <span class="ot">&lt;-</span> <span class="st">"No"</span></span>
<span id="cb31-2711"><a href="#cb31-2711" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_sig_tab <span class="ot">&lt;-</span> its18_ps_perfect_sig_tab[,<span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb31-2712"><a href="#cb31-2712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2713"><a href="#cb31-2713" aria-hidden="true" tabindex="-1"></a>its18_sig_tab_all <span class="ot">&lt;-</span> its18_ps_perfect_sig_tab</span>
<span id="cb31-2714"><a href="#cb31-2714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2715"><a href="#cb31-2715" aria-hidden="true" tabindex="-1"></a><span class="do">## PostHoc Analyses </span></span>
<span id="cb31-2716"><a href="#cb31-2716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2717"><a href="#cb31-2717" aria-hidden="true" tabindex="-1"></a><span class="do">## First let's check the results of each posthoc analysis.</span></span>
<span id="cb31-2718"><a href="#cb31-2718" aria-hidden="true" tabindex="-1"></a><span class="do">### Observed (q-value = 0)</span></span>
<span id="cb31-2719"><a href="#cb31-2719" aria-hidden="true" tabindex="-1"></a>its18_asvr0_lab <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb31-2720"><a href="#cb31-2720" aria-hidden="true" tabindex="-1"></a>its18_asvr0_lab</span>
<span id="cb31-2721"><a href="#cb31-2721" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q0_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2722"><a href="#cb31-2722" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(its18_ps_perfect_q0_adt<span class="sc">$</span>posthoc)</span>
<span id="cb31-2723"><a href="#cb31-2723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2724"><a href="#cb31-2724" aria-hidden="true" tabindex="-1"></a>its18_asvr1_lab <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb31-2725"><a href="#cb31-2725" aria-hidden="true" tabindex="-1"></a>its18_asvr1_lab</span>
<span id="cb31-2726"><a href="#cb31-2726" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q1_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2727"><a href="#cb31-2727" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(its18_ps_perfect_q1_adt<span class="sc">$</span>posthoc)</span>
<span id="cb31-2728"><a href="#cb31-2728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2729"><a href="#cb31-2729" aria-hidden="true" tabindex="-1"></a>its18_asvr2_lab <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb31-2730"><a href="#cb31-2730" aria-hidden="true" tabindex="-1"></a>its18_asvr2_lab</span>
<span id="cb31-2731"><a href="#cb31-2731" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q2_adt<span class="sc">$</span>posthoc.method</span>
<span id="cb31-2732"><a href="#cb31-2732" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(its18_ps_perfect_q2_adt<span class="sc">$</span>posthoc)</span>
<span id="cb31-2733"><a href="#cb31-2733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2734"><a href="#cb31-2734" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-2735"><a href="#cb31-2735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2736"><a href="#cb31-2736" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb31-2737"><a href="#cb31-2737" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb31-2738"><a href="#cb31-2738" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb31-2739"><a href="#cb31-2739" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-2740"><a href="#cb31-2740" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get, <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb31-2741"><a href="#cb31-2741" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">colour =</span> swel_col, <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2742"><a href="#cb31-2742" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb31-2743"><a href="#cb31-2743" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-2744"><a href="#cb31-2744" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-2745"><a href="#cb31-2745" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-2746"><a href="#cb31-2746" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2747"><a href="#cb31-2747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2748"><a href="#cb31-2748" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb31-2749"><a href="#cb31-2749" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-2750"><a href="#cb31-2750" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Effective no. of Taxon Units"</span>, <span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-2751"><a href="#cb31-2751" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(its18_asvr0_lab) <span class="sc">+</span> </span>
<span id="cb31-2752"><a href="#cb31-2752" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-2753"><a href="#cb31-2753" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-2754"><a href="#cb31-2754" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatment"</span>) <span class="sc">+</span></span>
<span id="cb31-2755"><a href="#cb31-2755" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-2756"><a href="#cb31-2756" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(its18_asvr1_lab) <span class="sc">+</span> </span>
<span id="cb31-2757"><a href="#cb31-2757" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-2758"><a href="#cb31-2758" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-2759"><a href="#cb31-2759" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-2760"><a href="#cb31-2760" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb31-2761"><a href="#cb31-2761" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ggtitle</span>(its18_asvr2_lab) <span class="sc">+</span> </span>
<span id="cb31-2762"><a href="#cb31-2762" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-2763"><a href="#cb31-2763" aria-hidden="true" tabindex="-1"></a>its18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb31-2764"><a href="#cb31-2764" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q0_adt_plot, </span>
<span id="cb31-2765"><a href="#cb31-2765" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q1_adt_plot, </span>
<span id="cb31-2766"><a href="#cb31-2766" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q2_adt_plot, </span>
<span id="cb31-2767"><a href="#cb31-2767" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb31-2768"><a href="#cb31-2768" aria-hidden="true" tabindex="-1"></a>its18_alph_div_plots_asv</span>
<span id="cb31-2769"><a href="#cb31-2769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-2770"><a href="#cb31-2770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2771"><a href="#cb31-2771" aria-hidden="true" tabindex="-1"></a><span class="fu">### Beta diversity plot code</span></span>
<span id="cb31-2772"><a href="#cb31-2772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2775"><a href="#cb31-2775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-2776"><a href="#cb31-2776" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Extended Data Figure 2 b, c, e, &amp; f"</span></span>
<span id="cb31-2777"><a href="#cb31-2777" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2778"><a href="#cb31-2778" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2779"><a href="#cb31-2779" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA BETA DIV PLOTS #########</span></span>
<span id="cb31-2780"><a href="#cb31-2780" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2781"><a href="#cb31-2781" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-2782"><a href="#cb31-2782" aria-hidden="true" tabindex="-1"></a><span class="do">## First the code for ordination implementation in `phyloseq`. </span></span>
<span id="cb31-2783"><a href="#cb31-2783" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb31-2784"><a href="#cb31-2784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2785"><a href="#cb31-2785" aria-hidden="true" tabindex="-1"></a>ssu18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_perfect"</span>)</span>
<span id="cb31-2786"><a href="#cb31-2786" aria-hidden="true" tabindex="-1"></a>ssu_dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"unifrac"</span>, <span class="st">"wunifrac"</span>)</span>
<span id="cb31-2787"><a href="#cb31-2787" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-2788"><a href="#cb31-2788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2789"><a href="#cb31-2789" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (samp_ps <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-2790"><a href="#cb31-2790" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> ssu_dist){</span>
<span id="cb31-2791"><a href="#cb31-2791" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_prop"</span>)))</span>
<span id="cb31-2792"><a href="#cb31-2792" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PCoA"</span>) <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span></span>
<span id="cb31-2793"><a href="#cb31-2793" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb31-2794"><a href="#cb31-2794" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb31-2795"><a href="#cb31-2795" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color =</span> <span class="st">"TEMP"</span>)</span>
<span id="cb31-2796"><a href="#cb31-2796" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb31-2797"><a href="#cb31-2797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2798"><a href="#cb31-2798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb31-2799"><a href="#cb31-2799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2800"><a href="#cb31-2800" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb31-2801"><a href="#cb31-2801" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb31-2802"><a href="#cb31-2802" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb31-2803"><a href="#cb31-2803" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb31-2804"><a href="#cb31-2804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb31-2805"><a href="#cb31-2805" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-2806"><a href="#cb31-2806" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">color =</span> TEMP, <span class="at">fill =</span> TEMP))</span>
<span id="cb31-2807"><a href="#cb31-2807" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb31-2808"><a href="#cb31-2808" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb31-2809"><a href="#cb31-2809" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb31-2810"><a href="#cb31-2810" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-2811"><a href="#cb31-2811" aria-hidden="true" tabindex="-1"></a>  tmp_df_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, .))</span>
<span id="cb31-2812"><a href="#cb31-2812" aria-hidden="true" tabindex="-1"></a>  tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>, ., <span class="st">"_plist"</span>))</span>
<span id="cb31-2813"><a href="#cb31-2813" aria-hidden="true" tabindex="-1"></a>  tmp_plot_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, ., <span class="st">"_plot"</span>))</span>
<span id="cb31-2814"><a href="#cb31-2814" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"tmp_df_name"</span> <span class="ot">=</span> tmp_df, <span class="at">tmp_plist_name =</span> tmp_plist, <span class="at">tmp_plot_name =</span> tmp_plot)</span>
<span id="cb31-2815"><a href="#cb31-2815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>,  d, <span class="st">"_ord_results"</span>), tmp_list)</span>
<span id="cb31-2816"><a href="#cb31-2816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_tmp"</span>))</span>
<span id="cb31-2817"><a href="#cb31-2817" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb31-2818"><a href="#cb31-2818" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2819"><a href="#cb31-2819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2820"><a href="#cb31-2820" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_ord_results"</span>)</span>
<span id="cb31-2821"><a href="#cb31-2821" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_num &lt;- c(1,2,3,4)</span></span>
<span id="cb31-2822"><a href="#cb31-2822" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb31-2823"><a href="#cb31-2823" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb31-2824"><a href="#cb31-2824" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb31-2825"><a href="#cb31-2825" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)<span class="sc">$</span>tmp_plist_name</span>
<span id="cb31-2826"><a href="#cb31-2826" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb31-2827"><a href="#cb31-2827" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">"ord_results"</span>, tmp_ord)</span>
<span id="cb31-2828"><a href="#cb31-2828" aria-hidden="true" tabindex="-1"></a>       tmp_dist <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(tmp_name, <span class="st">"ssu18_ps_perfect_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2829"><a href="#cb31-2829" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., tmp_ord) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2830"><a href="#cb31-2830" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., <span class="st">"_"</span>)</span>
<span id="cb31-2831"><a href="#cb31-2831" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb31-2832"><a href="#cb31-2832" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb31-2833"><a href="#cb31-2833" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb31-2834"><a href="#cb31-2834" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-2835"><a href="#cb31-2835" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-2836"><a href="#cb31-2836" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-2837"><a href="#cb31-2837" aria-hidden="true" tabindex="-1"></a>               <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb31-2838"><a href="#cb31-2838" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">"TEMP"</span></span>
<span id="cb31-2839"><a href="#cb31-2839" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb31-2840"><a href="#cb31-2840" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"unifrac"</span>) {</span>
<span id="cb31-2841"><a href="#cb31-2841" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Unweighted Unifrac"</span></span>
<span id="cb31-2842"><a href="#cb31-2842" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"wunifrac"</span>) {</span>
<span id="cb31-2843"><a href="#cb31-2843" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Weighted Unifrac"</span></span>
<span id="cb31-2844"><a href="#cb31-2844" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb31-2845"><a href="#cb31-2845" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb31-2846"><a href="#cb31-2846" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2847"><a href="#cb31-2847" aria-hidden="true" tabindex="-1"></a>   tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_dist_name)</span>
<span id="cb31-2848"><a href="#cb31-2848" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb31-2849"><a href="#cb31-2849" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-2850"><a href="#cb31-2850" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-2851"><a href="#cb31-2851" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-2852"><a href="#cb31-2852" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2853"><a href="#cb31-2853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2854"><a href="#cb31-2854" aria-hidden="true" tabindex="-1"></a><span class="do">## And now the code for ordination implementation in `microeco`. </span></span>
<span id="cb31-2855"><a href="#cb31-2855" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(self)</span>
<span id="cb31-2856"><a href="#cb31-2856" aria-hidden="true" tabindex="-1"></a>plot_group_distance_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (choose_data, <span class="at">plot_group_order =</span> <span class="cn">NULL</span>, <span class="at">color_values =</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">8</span>, </span>
<span id="cb31-2857"><a href="#cb31-2857" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dark2"</span>), <span class="at">distance_pair_stat =</span> <span class="cn">FALSE</span>, <span class="at">hide_ns =</span> <span class="cn">FALSE</span>, <span class="at">hide_ns_more =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-2858"><a href="#cb31-2858" aria-hidden="true" tabindex="-1"></a>    <span class="at">pair_compare_filter_match =</span> <span class="cn">NULL</span>, <span class="at">pair_compare_filter_select =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-2859"><a href="#cb31-2859" aria-hidden="true" tabindex="-1"></a>    <span class="at">pair_compare_method =</span> <span class="st">"wilcox.test"</span>, <span class="at">plot_distance_xtype =</span> <span class="cn">NULL</span>) </span>
<span id="cb31-2860"><a href="#cb31-2860" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-2861"><a href="#cb31-2861" aria-hidden="true" tabindex="-1"></a>    self <span class="ot">&lt;-</span> choose_data</span>
<span id="cb31-2862"><a href="#cb31-2862" aria-hidden="true" tabindex="-1"></a>    group_distance <span class="ot">&lt;-</span> self<span class="sc">$</span>res_group_distance</span>
<span id="cb31-2863"><a href="#cb31-2863" aria-hidden="true" tabindex="-1"></a>    group <span class="ot">&lt;-</span> self<span class="sc">$</span>group</span>
<span id="cb31-2864"><a href="#cb31-2864" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (self<span class="sc">$</span>measure <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"wei_unifrac"</span>, <span class="st">"unwei_unifrac"</span>, <span class="st">"bray"</span>, </span>
<span id="cb31-2865"><a href="#cb31-2865" aria-hidden="true" tabindex="-1"></a>        <span class="st">"jaccard"</span>)) {</span>
<span id="cb31-2866"><a href="#cb31-2866" aria-hidden="true" tabindex="-1"></a>        titlename <span class="ot">&lt;-</span> <span class="cf">switch</span>(self<span class="sc">$</span>measure, <span class="at">wei_unifrac =</span> <span class="st">"Weighted Unifrac"</span>, </span>
<span id="cb31-2867"><a href="#cb31-2867" aria-hidden="true" tabindex="-1"></a>            <span class="at">unwei_unifrac =</span> <span class="st">"Unweighted Unifrac"</span>, <span class="at">bray =</span> <span class="st">"Bray-Curtis"</span>, </span>
<span id="cb31-2868"><a href="#cb31-2868" aria-hidden="true" tabindex="-1"></a>            <span class="at">jaccard =</span> <span class="st">"Jaccard"</span>)</span>
<span id="cb31-2869"><a href="#cb31-2869" aria-hidden="true" tabindex="-1"></a>        ylabname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(titlename, <span class="st">" distance"</span>)</span>
<span id="cb31-2870"><a href="#cb31-2870" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2871"><a href="#cb31-2871" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb31-2872"><a href="#cb31-2872" aria-hidden="true" tabindex="-1"></a>        ylabname <span class="ot">&lt;-</span> self<span class="sc">$</span>measure</span>
<span id="cb31-2873"><a href="#cb31-2873" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2874"><a href="#cb31-2874" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_group_order)) {</span>
<span id="cb31-2875"><a href="#cb31-2875" aria-hidden="true" tabindex="-1"></a>        group_distance[, group] <span class="sc">%&lt;&gt;%</span> <span class="fu">factor</span>(., <span class="at">levels =</span> plot_group_order)</span>
<span id="cb31-2876"><a href="#cb31-2876" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2877"><a href="#cb31-2877" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb31-2878"><a href="#cb31-2878" aria-hidden="true" tabindex="-1"></a>        group_distance[, group] <span class="sc">%&lt;&gt;%</span> as.factor</span>
<span id="cb31-2879"><a href="#cb31-2879" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2880"><a href="#cb31-2880" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"The ordered groups are "</span>, <span class="fu">paste0</span>(<span class="fu">levels</span>(group_distance[, </span>
<span id="cb31-2881"><a href="#cb31-2881" aria-hidden="true" tabindex="-1"></a>        group]), <span class="at">collapse =</span> <span class="st">" "</span>), <span class="st">" ..."</span>)</span>
<span id="cb31-2882"><a href="#cb31-2882" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(group_distance, <span class="fu">aes_string</span>(<span class="at">x =</span> group, <span class="at">y =</span> <span class="st">"value"</span>, </span>
<span id="cb31-2883"><a href="#cb31-2883" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> group)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb31-2884"><a href="#cb31-2884" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb31-2885"><a href="#cb31-2885" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">shape =</span> <span class="dv">20</span>, </span>
<span id="cb31-2886"><a href="#cb31-2886" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(ylabname) <span class="sc">+</span> </span>
<span id="cb31-2887"><a href="#cb31-2887" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>), </span>
<span id="cb31-2888"><a href="#cb31-2888" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_values)</span>
<span id="cb31-2889"><a href="#cb31-2889" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(plot_distance_xtype)) {</span>
<span id="cb31-2890"><a href="#cb31-2890" aria-hidden="true" tabindex="-1"></a>        p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> plot_distance_xtype, </span>
<span id="cb31-2891"><a href="#cb31-2891" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb31-2892"><a href="#cb31-2892" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2893"><a href="#cb31-2893" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (distance_pair_stat <span class="sc">==</span> T) {</span>
<span id="cb31-2894"><a href="#cb31-2894" aria-hidden="true" tabindex="-1"></a>        comparisons_list <span class="ot">&lt;-</span> <span class="fu">levels</span>(group_distance[, group]) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2895"><a href="#cb31-2895" aria-hidden="true" tabindex="-1"></a>            <span class="fu">combn</span>(., <span class="dv">2</span>)</span>
<span id="cb31-2896"><a href="#cb31-2896" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (hide_ns) {</span>
<span id="cb31-2897"><a href="#cb31-2897" aria-hidden="true" tabindex="-1"></a>            pre_filter <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">compare_means</span>(<span class="fu">reformulate</span>(group, </span>
<span id="cb31-2898"><a href="#cb31-2898" aria-hidden="true" tabindex="-1"></a>                <span class="st">"value"</span>), group_distance)</span>
<span id="cb31-2899"><a href="#cb31-2899" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="fu">is.null</span>(hide_ns_more)) {</span>
<span id="cb31-2900"><a href="#cb31-2900" aria-hidden="true" tabindex="-1"></a>                filter_mark <span class="ot">&lt;-</span> <span class="st">"ns"</span></span>
<span id="cb31-2901"><a href="#cb31-2901" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb31-2902"><a href="#cb31-2902" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> {</span>
<span id="cb31-2903"><a href="#cb31-2903" aria-hidden="true" tabindex="-1"></a>                filter_mark <span class="ot">&lt;-</span> hide_ns_more</span>
<span id="cb31-2904"><a href="#cb31-2904" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb31-2905"><a href="#cb31-2905" aria-hidden="true" tabindex="-1"></a>            comparisons_list <span class="sc">%&lt;&gt;%</span> .[, <span class="sc">!</span>(pre_filter<span class="sc">$</span>p.signif <span class="sc">%in%</span> </span>
<span id="cb31-2906"><a href="#cb31-2906" aria-hidden="true" tabindex="-1"></a>                filter_mark), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb31-2907"><a href="#cb31-2907" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2908"><a href="#cb31-2908" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb31-2909"><a href="#cb31-2909" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(pair_compare_filter_match) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(pair_compare_filter_select)) {</span>
<span id="cb31-2910"><a href="#cb31-2910" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stop</span>(<span class="st">"The parameter pair_compare_filter_select and pair_compare_filter_match can not be both used together!"</span>)</span>
<span id="cb31-2911"><a href="#cb31-2911" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb31-2912"><a href="#cb31-2912" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(pair_compare_filter_match)) {</span>
<span id="cb31-2913"><a href="#cb31-2913" aria-hidden="true" tabindex="-1"></a>                comparisons_list <span class="sc">%&lt;&gt;%</span> {</span>
<span id="cb31-2914"><a href="#cb31-2914" aria-hidden="true" tabindex="-1"></a>                  .[, <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">as.data.frame</span>(.), <span class="cf">function</span>(x) <span class="fu">any</span>(<span class="fu">grepl</span>(pair_compare_filter_match, </span>
<span id="cb31-2915"><a href="#cb31-2915" aria-hidden="true" tabindex="-1"></a>                    x)))), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb31-2916"><a href="#cb31-2916" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb31-2917"><a href="#cb31-2917" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb31-2918"><a href="#cb31-2918" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(pair_compare_filter_select)) {</span>
<span id="cb31-2919"><a href="#cb31-2919" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(pair_compare_filter_select)) {</span>
<span id="cb31-2920"><a href="#cb31-2920" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">stop</span>(<span class="st">"The parameter pair_compare_filter_select must be numeric !"</span>)</span>
<span id="cb31-2921"><a href="#cb31-2921" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb31-2922"><a href="#cb31-2922" aria-hidden="true" tabindex="-1"></a>                messages_use <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">as.data.frame</span>(comparisons_list[, </span>
<span id="cb31-2923"><a href="#cb31-2923" aria-hidden="true" tabindex="-1"></a>                  pair_compare_filter_select, <span class="at">drop =</span> <span class="cn">FALSE</span>]), </span>
<span id="cb31-2924"><a href="#cb31-2924" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">function</span>(x) {</span>
<span id="cb31-2925"><a href="#cb31-2925" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste0</span>(x, <span class="at">collapse =</span> <span class="st">"-"</span>)</span>
<span id="cb31-2926"><a href="#cb31-2926" aria-hidden="true" tabindex="-1"></a>                  }))</span>
<span id="cb31-2927"><a href="#cb31-2927" aria-hidden="true" tabindex="-1"></a>                <span class="fu">message</span>(<span class="st">"Selected groups are "</span>, <span class="fu">paste0</span>(messages_use, </span>
<span id="cb31-2928"><a href="#cb31-2928" aria-hidden="true" tabindex="-1"></a>                  <span class="at">collapse =</span> <span class="st">" "</span>), <span class="st">" ..."</span>)</span>
<span id="cb31-2929"><a href="#cb31-2929" aria-hidden="true" tabindex="-1"></a>                comparisons_list <span class="sc">%&lt;&gt;%</span> .[, pair_compare_filter_select, </span>
<span id="cb31-2930"><a href="#cb31-2930" aria-hidden="true" tabindex="-1"></a>                  drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb31-2931"><a href="#cb31-2931" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb31-2932"><a href="#cb31-2932" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2933"><a href="#cb31-2933" aria-hidden="true" tabindex="-1"></a>        comparisons_list <span class="sc">%&lt;&gt;%</span> {</span>
<span id="cb31-2934"><a href="#cb31-2934" aria-hidden="true" tabindex="-1"></a>            <span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">ncol</span>(.)), <span class="cf">function</span>(x) .[, x])</span>
<span id="cb31-2935"><a href="#cb31-2935" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-2936"><a href="#cb31-2936" aria-hidden="true" tabindex="-1"></a>        p <span class="ot">&lt;-</span> p <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_compare_means</span>(<span class="at">comparisons =</span> my_comparisons)</span>
<span id="cb31-2937"><a href="#cb31-2937" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2938"><a href="#cb31-2938" aria-hidden="true" tabindex="-1"></a>    p</span>
<span id="cb31-2939"><a href="#cb31-2939" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2940"><a href="#cb31-2940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2941"><a href="#cb31-2941" aria-hidden="true" tabindex="-1"></a>my_comparisons <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"3"</span>), <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"8"</span>), <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"8"</span>) )</span>
<span id="cb31-2942"><a href="#cb31-2942" aria-hidden="true" tabindex="-1"></a>microeco_path <span class="ot">&lt;-</span> <span class="st">"include/pub/EXD/"</span></span>
<span id="cb31-2943"><a href="#cb31-2943" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-2944"><a href="#cb31-2944" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb31-2945"><a href="#cb31-2945" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">cal_betadiv</span>(<span class="at">unifrac =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2946"><a href="#cb31-2946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-2947"><a href="#cb31-2947" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2948"><a href="#cb31-2948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2949"><a href="#cb31-2949" aria-hidden="true" tabindex="-1"></a><span class="do">## Here I made a custom "function" to run the analysis, plot the graphs, </span></span>
<span id="cb31-2950"><a href="#cb31-2950" aria-hidden="true" tabindex="-1"></a><span class="do">## save graph objects, and save plots (as `.png` and `.pdf` files). </span></span>
<span id="cb31-2951"><a href="#cb31-2951" aria-hidden="true" tabindex="-1"></a><span class="do">## I am sure an actual programmer would be shocked, but it works. </span></span>
<span id="cb31-2952"><a href="#cb31-2952" aria-hidden="true" tabindex="-1"></a>microeco_beta_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(choose_input, choose_metric, choose_ord) {  </span>
<span id="cb31-2953"><a href="#cb31-2953" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(choose_input, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb31-2954"><a href="#cb31-2954" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-2955"><a href="#cb31-2955" aria-hidden="true" tabindex="-1"></a>  tmp_t1 <span class="ot">&lt;-</span> trans_beta<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_dataset, <span class="at">group =</span> <span class="st">"TEMP"</span>, <span class="at">measure =</span> choose_metric)</span>
<span id="cb31-2956"><a href="#cb31-2956" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_ordination</span>(<span class="at">ordination =</span> choose_ord)</span>
<span id="cb31-2957"><a href="#cb31-2957" aria-hidden="true" tabindex="-1"></a>  tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_ordination</span>(<span class="at">plot_color =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb31-2958"><a href="#cb31-2958" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">plot_shape =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb31-2959"><a href="#cb31-2959" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">color_values =</span> swel_col, </span>
<span id="cb31-2960"><a href="#cb31-2960" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">shape_values =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">16</span>)) <span class="sc">+</span> </span>
<span id="cb31-2961"><a href="#cb31-2961" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb31-2962"><a href="#cb31-2962" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb31-2963"><a href="#cb31-2963" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-2964"><a href="#cb31-2964" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-2965"><a href="#cb31-2965" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-2966"><a href="#cb31-2966" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb31-2967"><a href="#cb31-2967" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-2968"><a href="#cb31-2968" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"unwei_unifrac"</span>) {</span>
<span id="cb31-2969"><a href="#cb31-2969" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Unweighted Unifrac"</span></span>
<span id="cb31-2970"><a href="#cb31-2970" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"wei_unifrac"</span>) {</span>
<span id="cb31-2971"><a href="#cb31-2971" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Weighted Unifrac"</span></span>
<span id="cb31-2972"><a href="#cb31-2972" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb31-2973"><a href="#cb31-2973" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb31-2974"><a href="#cb31-2974" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-2975"><a href="#cb31-2975" aria-hidden="true" tabindex="-1"></a>   tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1_ord_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb31-2976"><a href="#cb31-2976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2977"><a href="#cb31-2977" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>()</span>
<span id="cb31-2978"><a href="#cb31-2978" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span>plot_group_distance_jjs <span class="ot">&lt;-</span> plot_group_distance_jjs</span>
<span id="cb31-2979"><a href="#cb31-2979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2980"><a href="#cb31-2980" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance_jjs</span>(<span class="at">choose_data =</span> tmp_t1, <span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col)</span>
<span id="cb31-2981"><a href="#cb31-2981" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1_within_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb31-2982"><a href="#cb31-2982" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span>res_group_distance</span>
<span id="cb31-2983"><a href="#cb31-2983" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>(<span class="at">within_group =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-2984"><a href="#cb31-2984" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance_jjs</span>(<span class="at">choose_data =</span> tmp_t1, <span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col) </span>
<span id="cb31-2985"><a href="#cb31-2985" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1_btwn_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb31-2986"><a href="#cb31-2986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2987"><a href="#cb31-2987" aria-hidden="true" tabindex="-1"></a><span class="do">###### SET names</span></span>
<span id="cb31-2988"><a href="#cb31-2988" aria-hidden="true" tabindex="-1"></a>  tmp_name_ord <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-2989"><a href="#cb31-2989" aria-hidden="true" tabindex="-1"></a>  tmp_name_wg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_wg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-2990"><a href="#cb31-2990" aria-hidden="true" tabindex="-1"></a>  tmp_name_bg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_bg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-2991"><a href="#cb31-2991" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-2992"><a href="#cb31-2992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_ord, tmp_t1_ord_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb31-2993"><a href="#cb31-2993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_wg, tmp_t1_within_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb31-2994"><a href="#cb31-2994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_bg, tmp_t1_btwn_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb31-2995"><a href="#cb31-2995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_PCoA"</span>))</span>
<span id="cb31-2996"><a href="#cb31-2996" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-2997"><a href="#cb31-2997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2998"><a href="#cb31-2998" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity)) {</span>
<span id="cb31-2999"><a href="#cb31-2999" aria-hidden="true" tabindex="-1"></a>  tmp_metric <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"ssu18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity[j])</span>
<span id="cb31-3000"><a href="#cb31-3000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">microeco_beta_plot</span>(<span class="at">choose_input =</span> <span class="st">"ssu18_ps_perfect"</span>, <span class="at">choose_metric =</span> tmp_metric, <span class="at">choose_ord =</span> <span class="st">"PCoA"</span>)</span>
<span id="cb31-3001"><a href="#cb31-3001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3002"><a href="#cb31-3002" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3003"><a href="#cb31-3003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3004"><a href="#cb31-3004" aria-hidden="true" tabindex="-1"></a>ssu18_unifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_unifrac_PCoA <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb31-3005"><a href="#cb31-3005" aria-hidden="true" tabindex="-1"></a>ssu18_wunifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_wunifrac_PCoA  <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb31-3006"><a href="#cb31-3006" aria-hidden="true" tabindex="-1"></a>ssu18_wg_unwei_unifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_me_wg_unwei_unifrac_PCoA</span>
<span id="cb31-3007"><a href="#cb31-3007" aria-hidden="true" tabindex="-1"></a>ssu18_wg_wei_unifrac <span class="ot">&lt;-</span> ssu18_ps_perfect_me_wg_wei_unifrac_PCoA</span>
<span id="cb31-3008"><a href="#cb31-3008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3009"><a href="#cb31-3009" aria-hidden="true" tabindex="-1"></a>ssu18_wg_unwei_unifrac <span class="ot">&lt;-</span> ssu18_wg_unwei_unifrac <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb31-3010"><a href="#cb31-3010" aria-hidden="true" tabindex="-1"></a>ssu18_wg_wei_unifrac <span class="ot">&lt;-</span> ssu18_wg_wei_unifrac <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb31-3011"><a href="#cb31-3011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3012"><a href="#cb31-3012" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3013"><a href="#cb31-3013" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3014"><a href="#cb31-3014" aria-hidden="true" tabindex="-1"></a><span class="do">### ITS  BETA DIV PLOTS #############</span></span>
<span id="cb31-3015"><a href="#cb31-3015" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3016"><a href="#cb31-3016" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3017"><a href="#cb31-3017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3018"><a href="#cb31-3018" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb31-3019"><a href="#cb31-3019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3020"><a href="#cb31-3020" aria-hidden="true" tabindex="-1"></a>its18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_perfect"</span>)</span>
<span id="cb31-3021"><a href="#cb31-3021" aria-hidden="true" tabindex="-1"></a>its_dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"jsd"</span>, <span class="st">"bray"</span>)</span>
<span id="cb31-3022"><a href="#cb31-3022" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-3023"><a href="#cb31-3023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3024"><a href="#cb31-3024" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (samp_ps <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-3025"><a href="#cb31-3025" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> its_dist){</span>
<span id="cb31-3026"><a href="#cb31-3026" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_prop"</span>)))</span>
<span id="cb31-3027"><a href="#cb31-3027" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PCoA"</span>) <span class="co"># MDS = PCoA, "CCA", "DCA", "DPCoA", "RDA"</span></span>
<span id="cb31-3028"><a href="#cb31-3028" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb31-3029"><a href="#cb31-3029" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb31-3030"><a href="#cb31-3030" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color =</span> <span class="st">"TEMP"</span>)</span>
<span id="cb31-3031"><a href="#cb31-3031" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb31-3032"><a href="#cb31-3032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3033"><a href="#cb31-3033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb31-3034"><a href="#cb31-3034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3035"><a href="#cb31-3035" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb31-3036"><a href="#cb31-3036" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb31-3037"><a href="#cb31-3037" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb31-3038"><a href="#cb31-3038" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb31-3039"><a href="#cb31-3039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb31-3040"><a href="#cb31-3040" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3041"><a href="#cb31-3041" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">color =</span> TEMP, <span class="at">fill =</span> TEMP))</span>
<span id="cb31-3042"><a href="#cb31-3042" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb31-3043"><a href="#cb31-3043" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb31-3044"><a href="#cb31-3044" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb31-3045"><a href="#cb31-3045" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3046"><a href="#cb31-3046" aria-hidden="true" tabindex="-1"></a>  tmp_df_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, .))</span>
<span id="cb31-3047"><a href="#cb31-3047" aria-hidden="true" tabindex="-1"></a>  tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>, ., <span class="st">"_plist"</span>))</span>
<span id="cb31-3048"><a href="#cb31-3048" aria-hidden="true" tabindex="-1"></a>  tmp_plot_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">"_dist_"</span>, ., <span class="st">"_plot"</span>))</span>
<span id="cb31-3049"><a href="#cb31-3049" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"tmp_df_name"</span> <span class="ot">=</span> tmp_df, <span class="at">tmp_plist_name =</span> tmp_plist, <span class="at">tmp_plot_name =</span> tmp_plot)</span>
<span id="cb31-3050"><a href="#cb31-3050" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(samp_ps, <span class="st">"_"</span>,  d, <span class="st">"_ord_results"</span>), tmp_list)</span>
<span id="cb31-3051"><a href="#cb31-3051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_tmp"</span>))</span>
<span id="cb31-3052"><a href="#cb31-3052" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb31-3053"><a href="#cb31-3053" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3054"><a href="#cb31-3054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3055"><a href="#cb31-3055" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_ord_results"</span>)</span>
<span id="cb31-3056"><a href="#cb31-3056" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_num &lt;- c(1,2,3,4)</span></span>
<span id="cb31-3057"><a href="#cb31-3057" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb31-3058"><a href="#cb31-3058" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb31-3059"><a href="#cb31-3059" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb31-3060"><a href="#cb31-3060" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)<span class="sc">$</span>tmp_plist_name</span>
<span id="cb31-3061"><a href="#cb31-3061" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb31-3062"><a href="#cb31-3062" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">"ord_results"</span>, tmp_ord)</span>
<span id="cb31-3063"><a href="#cb31-3063" aria-hidden="true" tabindex="-1"></a>       tmp_dist <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(tmp_name, <span class="st">"its18_ps_perfect_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3064"><a href="#cb31-3064" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., tmp_ord) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3065"><a href="#cb31-3065" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_remove</span>(., <span class="st">"_"</span>)</span>
<span id="cb31-3066"><a href="#cb31-3066" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb31-3067"><a href="#cb31-3067" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb31-3068"><a href="#cb31-3068" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb31-3069"><a href="#cb31-3069" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-3070"><a href="#cb31-3070" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-3071"><a href="#cb31-3071" aria-hidden="true" tabindex="-1"></a>               <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-3072"><a href="#cb31-3072" aria-hidden="true" tabindex="-1"></a>               <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb31-3073"><a href="#cb31-3073" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">"TEMP"</span></span>
<span id="cb31-3074"><a href="#cb31-3074" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb31-3075"><a href="#cb31-3075" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"jsd"</span>) {</span>
<span id="cb31-3076"><a href="#cb31-3076" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Jensen-Shannon"</span></span>
<span id="cb31-3077"><a href="#cb31-3077" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_dist <span class="sc">==</span> <span class="st">"bray"</span>) {</span>
<span id="cb31-3078"><a href="#cb31-3078" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">"Bray-Curtis"</span></span>
<span id="cb31-3079"><a href="#cb31-3079" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb31-3080"><a href="#cb31-3080" aria-hidden="true" tabindex="-1"></a>      tmp_dist_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb31-3081"><a href="#cb31-3081" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-3082"><a href="#cb31-3082" aria-hidden="true" tabindex="-1"></a>   tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_dist_name)</span>
<span id="cb31-3083"><a href="#cb31-3083" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb31-3084"><a href="#cb31-3084" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-3085"><a href="#cb31-3085" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3086"><a href="#cb31-3086" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-3087"><a href="#cb31-3087" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3088"><a href="#cb31-3088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3089"><a href="#cb31-3089" aria-hidden="true" tabindex="-1"></a><span class="do">## And now the code for ordination implementation in `microeco`. </span></span>
<span id="cb31-3090"><a href="#cb31-3090" aria-hidden="true" tabindex="-1"></a>my_comparisons <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"3"</span>), <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"8"</span>), <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"8"</span>) )</span>
<span id="cb31-3091"><a href="#cb31-3091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3092"><a href="#cb31-3092" aria-hidden="true" tabindex="-1"></a>microeco_path <span class="ot">&lt;-</span> <span class="st">"include/pub/EXD/"</span></span>
<span id="cb31-3093"><a href="#cb31-3093" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-3094"><a href="#cb31-3094" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb31-3095"><a href="#cb31-3095" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">cal_betadiv</span>(<span class="at">unifrac =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-3096"><a href="#cb31-3096" aria-hidden="true" tabindex="-1"></a><span class="do">#### CODE TO ADD JSD DISTANCE ####  </span></span>
<span id="cb31-3097"><a href="#cb31-3097" aria-hidden="true" tabindex="-1"></a>  tmp_jsd <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(<span class="fu">get</span>(i), <span class="at">method =</span> <span class="st">"jsd"</span>) </span>
<span id="cb31-3098"><a href="#cb31-3098" aria-hidden="true" tabindex="-1"></a>  tmp_jsd <span class="ot">&lt;-</span> <span class="fu">forceSymmetric</span>(<span class="fu">as.matrix</span>(tmp_jsd), <span class="at">uplo =</span> <span class="st">"L"</span>)</span>
<span id="cb31-3099"><a href="#cb31-3099" aria-hidden="true" tabindex="-1"></a>  tmp_jsd <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_jsd)</span>
<span id="cb31-3100"><a href="#cb31-3100" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span>beta_diversity<span class="sc">$</span>jsd <span class="ot">&lt;-</span> tmp_jsd</span>
<span id="cb31-3101"><a href="#cb31-3101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3102"><a href="#cb31-3102" aria-hidden="true" tabindex="-1"></a>}    </span>
<span id="cb31-3103"><a href="#cb31-3103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3104"><a href="#cb31-3104" aria-hidden="true" tabindex="-1"></a><span class="do">## Here I made a custom "function" to run the analysis, plot the graphs, </span></span>
<span id="cb31-3105"><a href="#cb31-3105" aria-hidden="true" tabindex="-1"></a><span class="do">## save graph objects, and save plots (as `.png` and `.pdf` files). </span></span>
<span id="cb31-3106"><a href="#cb31-3106" aria-hidden="true" tabindex="-1"></a><span class="do">## I am sure an actual programmer would be shocked, but it works. </span></span>
<span id="cb31-3107"><a href="#cb31-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3108"><a href="#cb31-3108" aria-hidden="true" tabindex="-1"></a>microeco_beta_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(choose_input, choose_metric, choose_ord) {  </span>
<span id="cb31-3109"><a href="#cb31-3109" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(choose_input, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb31-3110"><a href="#cb31-3110" aria-hidden="true" tabindex="-1"></a>  tmp_t1 <span class="ot">&lt;-</span> trans_beta<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_dataset, <span class="at">group =</span> <span class="st">"TEMP"</span>, <span class="at">measure =</span> choose_metric)</span>
<span id="cb31-3111"><a href="#cb31-3111" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_ordination</span>(<span class="at">ordination =</span> choose_ord)</span>
<span id="cb31-3112"><a href="#cb31-3112" aria-hidden="true" tabindex="-1"></a>  tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_ordination</span>(<span class="at">plot_color =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb31-3113"><a href="#cb31-3113" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">plot_shape =</span> <span class="st">"TEMP"</span>, </span>
<span id="cb31-3114"><a href="#cb31-3114" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">color_values =</span> swel_col, </span>
<span id="cb31-3115"><a href="#cb31-3115" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">shape_values =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">16</span>)) <span class="sc">+</span> </span>
<span id="cb31-3116"><a href="#cb31-3116" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb31-3117"><a href="#cb31-3117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb31-3118"><a href="#cb31-3118" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-3119"><a href="#cb31-3119" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-3120"><a href="#cb31-3120" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb31-3121"><a href="#cb31-3121" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>))</span>
<span id="cb31-3122"><a href="#cb31-3122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3123"><a href="#cb31-3123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"jsd"</span>) {</span>
<span id="cb31-3124"><a href="#cb31-3124" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Jensen-Shannon"</span></span>
<span id="cb31-3125"><a href="#cb31-3125" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (choose_metric <span class="sc">==</span> <span class="st">"bray"</span>) {</span>
<span id="cb31-3126"><a href="#cb31-3126" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">"Bray-Curtis"</span></span>
<span id="cb31-3127"><a href="#cb31-3127" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> {</span>
<span id="cb31-3128"><a href="#cb31-3128" aria-hidden="true" tabindex="-1"></a>      tmp_plt_name <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb31-3129"><a href="#cb31-3129" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-3130"><a href="#cb31-3130" aria-hidden="true" tabindex="-1"></a>   tmp_t1_ord_plot <span class="ot">&lt;-</span> tmp_t1_ord_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb31-3131"><a href="#cb31-3131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3132"><a href="#cb31-3132" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>()</span>
<span id="cb31-3133"><a href="#cb31-3133" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span>plot_group_distance_jjs <span class="ot">&lt;-</span> plot_group_distance_jjs</span>
<span id="cb31-3134"><a href="#cb31-3134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3135"><a href="#cb31-3135" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance_jjs</span>(<span class="at">choose_data =</span> tmp_t1, <span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col)</span>
<span id="cb31-3136"><a href="#cb31-3136" aria-hidden="true" tabindex="-1"></a>  tmp_t1_within_group_plot <span class="ot">&lt;-</span> tmp_t1_within_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb31-3137"><a href="#cb31-3137" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span>res_group_distance</span>
<span id="cb31-3138"><a href="#cb31-3138" aria-hidden="true" tabindex="-1"></a>  tmp_t1<span class="sc">$</span><span class="fu">cal_group_distance</span>(<span class="at">within_group =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-3139"><a href="#cb31-3139" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1<span class="sc">$</span><span class="fu">plot_group_distance_jjs</span>(<span class="at">choose_data =</span> tmp_t1, <span class="at">distance_pair_stat =</span> <span class="cn">TRUE</span>, <span class="at">color_values =</span> swel_col) </span>
<span id="cb31-3140"><a href="#cb31-3140" aria-hidden="true" tabindex="-1"></a>  tmp_t1_btwn_group_plot <span class="ot">&lt;-</span> tmp_t1_btwn_group_plot <span class="sc">+</span> <span class="fu">ggtitle</span>(tmp_plt_name)</span>
<span id="cb31-3141"><a href="#cb31-3141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3142"><a href="#cb31-3142" aria-hidden="true" tabindex="-1"></a><span class="do">###### SET names</span></span>
<span id="cb31-3143"><a href="#cb31-3143" aria-hidden="true" tabindex="-1"></a>  tmp_name_ord <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3144"><a href="#cb31-3144" aria-hidden="true" tabindex="-1"></a>  tmp_name_wg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_wg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3145"><a href="#cb31-3145" aria-hidden="true" tabindex="-1"></a>  tmp_name_bg <span class="ot">&lt;-</span> <span class="fu">paste</span>(choose_input, <span class="st">"_me_bg_"</span>, choose_metric, <span class="st">"_"</span>, choose_ord, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3146"><a href="#cb31-3146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3147"><a href="#cb31-3147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_ord, tmp_t1_ord_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb31-3148"><a href="#cb31-3148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_wg, tmp_t1_within_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )</span>
<span id="cb31-3149"><a href="#cb31-3149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_bg, tmp_t1_btwn_group_plot, <span class="at">envir =</span> <span class="fu">parent.frame</span>() )  </span>
<span id="cb31-3150"><a href="#cb31-3150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_PCoA"</span>))</span>
<span id="cb31-3151"><a href="#cb31-3151" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3152"><a href="#cb31-3152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3153"><a href="#cb31-3153" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity)) {</span>
<span id="cb31-3154"><a href="#cb31-3154" aria-hidden="true" tabindex="-1"></a>  tmp_metric <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">"its18_ps_perfect"</span>, <span class="st">"_me"</span>, <span class="at">sep =</span> <span class="st">""</span>))<span class="sc">$</span>beta_diversity[j])</span>
<span id="cb31-3155"><a href="#cb31-3155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">microeco_beta_plot</span>(<span class="at">choose_input =</span> <span class="st">"its18_ps_perfect"</span>, <span class="at">choose_metric =</span> tmp_metric, <span class="at">choose_ord =</span> <span class="st">"PCoA"</span>)</span>
<span id="cb31-3156"><a href="#cb31-3156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3157"><a href="#cb31-3157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3158"><a href="#cb31-3158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3159"><a href="#cb31-3159" aria-hidden="true" tabindex="-1"></a>its18_jsd <span class="ot">&lt;-</span> its18_ps_perfect_jsd_PCoA <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb31-3160"><a href="#cb31-3160" aria-hidden="true" tabindex="-1"></a>its18_bray <span class="ot">&lt;-</span> its18_ps_perfect_bray_PCoA  <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb31-3161"><a href="#cb31-3161" aria-hidden="true" tabindex="-1"></a>its18_wg_jsd <span class="ot">&lt;-</span> its18_ps_perfect_me_wg_jsd_PCoA</span>
<span id="cb31-3162"><a href="#cb31-3162" aria-hidden="true" tabindex="-1"></a>its18_wg_bray <span class="ot">&lt;-</span> its18_ps_perfect_me_wg_bray_PCoA</span>
<span id="cb31-3163"><a href="#cb31-3163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3164"><a href="#cb31-3164" aria-hidden="true" tabindex="-1"></a>its18_wg_jsd <span class="ot">&lt;-</span> its18_wg_jsd <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb31-3165"><a href="#cb31-3165" aria-hidden="true" tabindex="-1"></a>its18_wg_bray <span class="ot">&lt;-</span> its18_wg_bray <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"distance"</span>)</span>
<span id="cb31-3166"><a href="#cb31-3166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3167"><a href="#cb31-3167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3168"><a href="#cb31-3168" aria-hidden="true" tabindex="-1"></a><span class="do">### CREATE combo plot using PATCHWORK</span></span>
<span id="cb31-3169"><a href="#cb31-3169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3170"><a href="#cb31-3170" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-3171"><a href="#cb31-3171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">15</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">22</span>),</span>
<span id="cb31-3172"><a href="#cb31-3172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">17</span>, <span class="at">b =</span> <span class="dv">31</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">9</span>),</span>
<span id="cb31-3173"><a href="#cb31-3173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">17</span>, <span class="at">b =</span> <span class="dv">31</span>, <span class="at">l =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">17</span>),</span>
<span id="cb31-3174"><a href="#cb31-3174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">16</span>, <span class="at">b =</span> <span class="dv">23</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>),</span>
<span id="cb31-3175"><a href="#cb31-3175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">24</span>, <span class="at">b =</span> <span class="dv">31</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>),</span>
<span id="cb31-3176"><a href="#cb31-3176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3177"><a href="#cb31-3177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">32</span>, <span class="at">b =</span> <span class="dv">46</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">22</span>),</span>
<span id="cb31-3178"><a href="#cb31-3178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">48</span>, <span class="at">b =</span> <span class="dv">62</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">9</span>),</span>
<span id="cb31-3179"><a href="#cb31-3179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">48</span>, <span class="at">b =</span> <span class="dv">62</span>, <span class="at">l =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">17</span>),</span>
<span id="cb31-3180"><a href="#cb31-3180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">47</span>, <span class="at">b =</span> <span class="dv">54</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>),</span>
<span id="cb31-3181"><a href="#cb31-3181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">55</span>, <span class="at">b =</span> <span class="dv">62</span>, <span class="at">l =</span> <span class="dv">18</span>, <span class="at">r =</span> <span class="dv">21</span>)</span>
<span id="cb31-3182"><a href="#cb31-3182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3183"><a href="#cb31-3183" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-3184"><a href="#cb31-3184" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(layout)</span>
<span id="cb31-3185"><a href="#cb31-3185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3186"><a href="#cb31-3186" aria-hidden="true" tabindex="-1"></a>combo_plot <span class="ot">&lt;-</span> </span>
<span id="cb31-3187"><a href="#cb31-3187" aria-hidden="true" tabindex="-1"></a>  ssu18_alph_div_plots_asv <span class="sc">+</span> </span>
<span id="cb31-3188"><a href="#cb31-3188" aria-hidden="true" tabindex="-1"></a>           ssu18_unifrac <span class="sc">+</span> ssu18_wunifrac <span class="sc">+</span>  </span>
<span id="cb31-3189"><a href="#cb31-3189" aria-hidden="true" tabindex="-1"></a>           ssu18_wg_unwei_unifrac <span class="sc">+</span> ssu18_wg_wei_unifrac <span class="sc">+</span> </span>
<span id="cb31-3190"><a href="#cb31-3190" aria-hidden="true" tabindex="-1"></a>  its18_alph_div_plots_asv <span class="sc">+</span> </span>
<span id="cb31-3191"><a href="#cb31-3191" aria-hidden="true" tabindex="-1"></a>           its18_jsd <span class="sc">+</span> its18_bray <span class="sc">+</span>  </span>
<span id="cb31-3192"><a href="#cb31-3192" aria-hidden="true" tabindex="-1"></a>           its18_wg_jsd <span class="sc">+</span> its18_wg_bray <span class="sc">+</span> </span>
<span id="cb31-3193"><a href="#cb31-3193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)  </span>
<span id="cb31-3194"><a href="#cb31-3194" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_2/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_2.png"</span>, <span class="at">height =</span> <span class="dv">56</span>, <span class="at">width =</span> <span class="dv">40</span>,</span>
<span id="cb31-3195"><a href="#cb31-3195" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-3196"><a href="#cb31-3196" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_2/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_2.pdf"</span>, <span class="at">height =</span> <span class="dv">56</span>, <span class="at">width =</span> <span class="dv">40</span>,</span>
<span id="cb31-3197"><a href="#cb31-3197" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-3198"><a href="#cb31-3198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3199"><a href="#cb31-3199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-3200"><a href="#cb31-3200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3201"><a href="#cb31-3201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 3</span></span>
<span id="cb31-3202"><a href="#cb31-3202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3203"><a href="#cb31-3203" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-3204"><a href="#cb31-3204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3205"><a href="#cb31-3205" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-3206"><a href="#cb31-3206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3207"><a href="#cb31-3207" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include axes renaming, removing non-significant (NS) values from plots,  changing significant p-values to asterisks (<span class="in">`*`</span>), removing gridlines, and enlarging outlier points. </span>
<span id="cb31-3208"><a href="#cb31-3208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3209"><a href="#cb31-3209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3210"><a href="#cb31-3210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3211"><a href="#cb31-3211" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-3212"><a href="#cb31-3212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3213"><a href="#cb31-3213" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-3214"><a href="#cb31-3214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3215"><a href="#cb31-3215" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.png)</span></span>
<span id="cb31-3216"><a href="#cb31-3216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3217"><a href="#cb31-3217" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-3218"><a href="#cb31-3218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3219"><a href="#cb31-3219" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_3.png)</span></span>
<span id="cb31-3220"><a href="#cb31-3220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3221"><a href="#cb31-3221" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3222"><a href="#cb31-3222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3223"><a href="#cb31-3223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3224"><a href="#cb31-3224" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-3225"><a href="#cb31-3225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3226"><a href="#cb31-3226" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-3227"><a href="#cb31-3227" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 3 data pack</span><span class="co">](include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.rds)</span>  </span>
<span id="cb31-3228"><a href="#cb31-3228" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3229"><a href="#cb31-3229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3230"><a href="#cb31-3230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3231"><a href="#cb31-3231" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-3232"><a href="#cb31-3232" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 3 raw pdf</span><span class="co">](include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.pdf)</span></span>
<span id="cb31-3233"><a href="#cb31-3233" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3234"><a href="#cb31-3234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3235"><a href="#cb31-3235" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3236"><a href="#cb31-3236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3239"><a href="#cb31-3239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-3240"><a href="#cb31-3240" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Extended Data Figure 3"</span></span>
<span id="cb31-3241"><a href="#cb31-3241" aria-hidden="true" tabindex="-1"></a><span class="do">## In this section of the workflow we use the </span></span>
<span id="cb31-3242"><a href="#cb31-3242" aria-hidden="true" tabindex="-1"></a><span class="do">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span></span>
<span id="cb31-3243"><a href="#cb31-3243" aria-hidden="true" tabindex="-1"></a><span class="do">## to assess the response of taxonomic lineages to soil warming. </span></span>
<span id="cb31-3244"><a href="#cb31-3244" aria-hidden="true" tabindex="-1"></a><span class="do">## In the first step we need to fix the selected data set to make it </span></span>
<span id="cb31-3245"><a href="#cb31-3245" aria-hidden="true" tabindex="-1"></a><span class="do">## compatible with the various functions. For this analysis we use the </span></span>
<span id="cb31-3246"><a href="#cb31-3246" aria-hidden="true" tabindex="-1"></a><span class="do">## PERfect filtered data set.</span></span>
<span id="cb31-3247"><a href="#cb31-3247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3248"><a href="#cb31-3248" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-3249"><a href="#cb31-3249" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_rf_all <span class="ot">&lt;-</span></span>
<span id="cb31-3250"><a href="#cb31-3250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="st">"include/pub/EXD/EXD_Figure_3/Extended_Data_Figure_3.rds"</span>)</span>
<span id="cb31-3251"><a href="#cb31-3251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3252"><a href="#cb31-3252" aria-hidden="true" tabindex="-1"></a><span class="do">## FIX ps object</span></span>
<span id="cb31-3253"><a href="#cb31-3253" aria-hidden="true" tabindex="-1"></a>ssu_ps <span class="ot">&lt;-</span> ssu18_ps_perfect_rf_all</span>
<span id="cb31-3254"><a href="#cb31-3254" aria-hidden="true" tabindex="-1"></a>tmp_tax1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(ssu_ps))</span>
<span id="cb31-3255"><a href="#cb31-3255" aria-hidden="true" tabindex="-1"></a>tmp_rn <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp_tax1)</span>
<span id="cb31-3256"><a href="#cb31-3256" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span></span>
<span id="cb31-3257"><a href="#cb31-3257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">lapply</span>(tmp_tax1, <span class="cf">function</span>(x) {</span>
<span id="cb31-3258"><a href="#cb31-3258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(|)"</span>, <span class="st">""</span>, x)</span>
<span id="cb31-3259"><a href="#cb31-3259" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb31-3260"><a href="#cb31-3260" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(tmp_tax) <span class="ot">&lt;-</span> tmp_rn</span>
<span id="cb31-3261"><a href="#cb31-3261" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">row.names</span>(tmp_tax), <span class="fu">row.names</span>(tmp_tax1))</span>
<span id="cb31-3262"><a href="#cb31-3262" aria-hidden="true" tabindex="-1"></a>ps_tax_new <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax)</span>
<span id="cb31-3263"><a href="#cb31-3263" aria-hidden="true" tabindex="-1"></a>tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(ssu_ps),</span>
<span id="cb31-3264"><a href="#cb31-3264" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">phy_tree</span>(ssu_ps),</span>
<span id="cb31-3265"><a href="#cb31-3265" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">tax_table</span>(ps_tax_new),</span>
<span id="cb31-3266"><a href="#cb31-3266" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample_data</span>(ssu_ps))</span>
<span id="cb31-3267"><a href="#cb31-3267" aria-hidden="true" tabindex="-1"></a>ssu_ps <span class="ot">&lt;-</span> tmp_ps</span>
<span id="cb31-3268"><a href="#cb31-3268" aria-hidden="true" tabindex="-1"></a>phyloseq<span class="sc">::</span><span class="fu">rank_names</span>(ssu_ps)</span>
<span id="cb31-3269"><a href="#cb31-3269" aria-hidden="true" tabindex="-1"></a><span class="do">## Next we run a statistical test for multiple groups</span></span>
<span id="cb31-3270"><a href="#cb31-3270" aria-hidden="true" tabindex="-1"></a><span class="do">## using the `run_test_multiple_groups` function.</span></span>
<span id="cb31-3271"><a href="#cb31-3271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3272"><a href="#cb31-3272" aria-hidden="true" tabindex="-1"></a>ssu_group_anova <span class="ot">&lt;-</span></span>
<span id="cb31-3273"><a href="#cb31-3273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_test_multiple_groups</span>(ssu_ps,</span>
<span id="cb31-3274"><a href="#cb31-3274" aria-hidden="true" tabindex="-1"></a>                           <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb31-3275"><a href="#cb31-3275" aria-hidden="true" tabindex="-1"></a>                           <span class="at">taxa_rank =</span> <span class="st">"all"</span>,</span>
<span id="cb31-3276"><a href="#cb31-3276" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb31-3277"><a href="#cb31-3277" aria-hidden="true" tabindex="-1"></a>ssu_group_anova<span class="sc">@</span>marker_table</span>
<span id="cb31-3278"><a href="#cb31-3278" aria-hidden="true" tabindex="-1"></a><span class="fu">marker_table</span>(ssu_group_anova)</span>
<span id="cb31-3279"><a href="#cb31-3279" aria-hidden="true" tabindex="-1"></a><span class="do">## And then conduct post hoc pairwise comparisons for multiple</span></span>
<span id="cb31-3280"><a href="#cb31-3280" aria-hidden="true" tabindex="-1"></a><span class="do">## groups test using the `run_posthoc_test` function.</span></span>
<span id="cb31-3281"><a href="#cb31-3281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3282"><a href="#cb31-3282" aria-hidden="true" tabindex="-1"></a>ssu_default_pht <span class="ot">&lt;-</span> <span class="fu">run_posthoc_test</span>(ssu_ps,</span>
<span id="cb31-3283"><a href="#cb31-3283" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb31-3284"><a href="#cb31-3284" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">method =</span> <span class="st">"tukey"</span>,</span>
<span id="cb31-3285"><a href="#cb31-3285" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">transform =</span> <span class="st">"log10"</span>)</span>
<span id="cb31-3286"><a href="#cb31-3286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3287"><a href="#cb31-3287" aria-hidden="true" tabindex="-1"></a><span class="do">## We can filter out a select taxa and plot the results.</span></span>
<span id="cb31-3288"><a href="#cb31-3288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3289"><a href="#cb31-3289" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(</span>
<span id="cb31-3290"><a href="#cb31-3290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(ssu_default_pht<span class="sc">@</span>result),</span>
<span id="cb31-3291"><a href="#cb31-3291" aria-hidden="true" tabindex="-1"></a>  group_name <span class="sc">==</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span></span>
<span id="cb31-3292"><a href="#cb31-3292" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-3293"><a href="#cb31-3293" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_postHocTest</span>(ssu_default_pht, <span class="at">feature =</span> <span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span>) <span class="sc">&amp;</span></span>
<span id="cb31-3294"><a href="#cb31-3294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb31-3295"><a href="#cb31-3295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3296"><a href="#cb31-3296" aria-hidden="true" tabindex="-1"></a><span class="do">## But what we really want to do is get all of the markers that are</span></span>
<span id="cb31-3297"><a href="#cb31-3297" aria-hidden="true" tabindex="-1"></a><span class="do">## significant from the analysis, excluding any significant ASVs so we can</span></span>
<span id="cb31-3298"><a href="#cb31-3298" aria-hidden="true" tabindex="-1"></a><span class="do">## look at high taxa ranks.</span></span>
<span id="cb31-3299"><a href="#cb31-3299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3300"><a href="#cb31-3300" aria-hidden="true" tabindex="-1"></a>ssu_pht <span class="ot">&lt;-</span> ssu_default_pht</span>
<span id="cb31-3301"><a href="#cb31-3301" aria-hidden="true" tabindex="-1"></a>ssu18_pht_filt <span class="ot">&lt;-</span></span>
<span id="cb31-3302"><a href="#cb31-3302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">data.frame</span>(ssu_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"ASV"</span>, <span class="fu">filter</span>(<span class="fu">data.frame</span>(ssu_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)<span class="sc">$</span>group_name), ]</span>
<span id="cb31-3303"><a href="#cb31-3303" aria-hidden="true" tabindex="-1"></a>ssu18_pht_filt <span class="ot">&lt;-</span></span>
<span id="cb31-3304"><a href="#cb31-3304" aria-hidden="true" tabindex="-1"></a>  ssu18_pht_filt[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[a-z]__$"</span>, ssu18_pht_filt<span class="sc">$</span>group_name), ]</span>
<span id="cb31-3305"><a href="#cb31-3305" aria-hidden="true" tabindex="-1"></a>ssu18_pht_filt <span class="ot">&lt;-</span></span>
<span id="cb31-3306"><a href="#cb31-3306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ssu18_pht_filt, group_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-3307"><a href="#cb31-3307" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(ssu18_pht_filt)</span>
<span id="cb31-3308"><a href="#cb31-3308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3309"><a href="#cb31-3309" aria-hidden="true" tabindex="-1"></a>plot_postHocTest_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (pht, feature, <span class="at">step_increase =</span> <span class="fl">0.12</span>) </span>
<span id="cb31-3310"><a href="#cb31-3310" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-3311"><a href="#cb31-3311" aria-hidden="true" tabindex="-1"></a>    abd_long <span class="ot">&lt;-</span> pht<span class="sc">@</span>abundance <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>.data<span class="sc">$</span>group, </span>
<span id="cb31-3312"><a href="#cb31-3312" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"feat"</span>)</span>
<span id="cb31-3313"><a href="#cb31-3313" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(feature)) {</span>
<span id="cb31-3314"><a href="#cb31-3314" aria-hidden="true" tabindex="-1"></a>        abd_long <span class="ot">&lt;-</span> <span class="fu">filter</span>(abd_long, .data<span class="sc">$</span>feat <span class="sc">%in%</span> feature)</span>
<span id="cb31-3315"><a href="#cb31-3315" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-3316"><a href="#cb31-3316" aria-hidden="true" tabindex="-1"></a>    annotation <span class="ot">&lt;-</span> <span class="fu">get_sig_annotation</span>(pht, <span class="at">step_increase =</span> step_increase)</span>
<span id="cb31-3317"><a href="#cb31-3317" aria-hidden="true" tabindex="-1"></a>    p_box <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">ggplot</span>(abd_long, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>group, </span>
<span id="cb31-3318"><a href="#cb31-3318" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> .data<span class="sc">$</span>value)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> ggsignif<span class="sc">::</span><span class="fu">geom_signif</span>(<span class="at">data =</span> annotation[annotation<span class="sc">$</span>feature <span class="sc">%in%</span> </span>
<span id="cb31-3319"><a href="#cb31-3319" aria-hidden="true" tabindex="-1"></a>        feature, ], <span class="fu">aes</span>(<span class="at">xmin =</span> .data<span class="sc">$</span>xmin, <span class="at">xmax =</span> .data<span class="sc">$</span>xmax, </span>
<span id="cb31-3320"><a href="#cb31-3320" aria-hidden="true" tabindex="-1"></a>        <span class="at">annotations =</span> .data<span class="sc">$</span>annotation, <span class="at">y_position =</span> .data<span class="sc">$</span>y_position), </span>
<span id="cb31-3321"><a href="#cb31-3321" aria-hidden="true" tabindex="-1"></a>        <span class="at">manual =</span> <span class="cn">TRUE</span>, <span class="at">textsize =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-3322"><a href="#cb31-3322" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Abundance"</span>))</span>
<span id="cb31-3323"><a href="#cb31-3323" aria-hidden="true" tabindex="-1"></a>    test_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pht<span class="sc">@</span>result[[feature]])</span>
<span id="cb31-3324"><a href="#cb31-3324" aria-hidden="true" tabindex="-1"></a>    p_test <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(test_res, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>comparions)) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .data<span class="sc">$</span>ci_lower, </span>
<span id="cb31-3325"><a href="#cb31-3325" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymax =</span> .data<span class="sc">$</span>ci_upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .data<span class="sc">$</span>diff_mean)) <span class="sc">+</span> </span>
<span id="cb31-3326"><a href="#cb31-3326" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"95% confidence intervals"</span>)</span>
<span id="cb31-3327"><a href="#cb31-3327" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(p_box)</span>
<span id="cb31-3328"><a href="#cb31-3328" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3329"><a href="#cb31-3329" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(plot_postHocTest_jjs) <span class="ot">&lt;-</span> <span class="fu">asNamespace</span>(<span class="st">'microbiomeMarker'</span>)</span>
<span id="cb31-3330"><a href="#cb31-3330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3331"><a href="#cb31-3331" aria-hidden="true" tabindex="-1"></a>ssu_select <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-3332"><a href="#cb31-3332" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Acidobacteriota|c__Acidobacteriae|o__Subgroup_2"</span>, </span>
<span id="cb31-3333"><a href="#cb31-3333" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Chitinophagales|f__Saprospiraceae"</span>, </span>
<span id="cb31-3334"><a href="#cb31-3334" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Cytophagales"</span>, </span>
<span id="cb31-3335"><a href="#cb31-3335" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Flavobacteriales"</span>, </span>
<span id="cb31-3336"><a href="#cb31-3336" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Bacteroidota|c__Bacteroidia|o__Sphingobacteriales"</span>, </span>
<span id="cb31-3337"><a href="#cb31-3337" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Myxococcota|c__Polyangia|o__mle1-27"</span>, </span>
<span id="cb31-3338"><a href="#cb31-3338" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Comamonadaceae|g__Rubrivivax"</span>, </span>
<span id="cb31-3339"><a href="#cb31-3339" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Actinobacteriota|c__Acidimicrobiia|o__Microtrichales"</span>, </span>
<span id="cb31-3340"><a href="#cb31-3340" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Actinobacteriota|c__Thermoleophilia|o__Gaiellales"</span>, </span>
<span id="cb31-3341"><a href="#cb31-3341" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Firmicutes|c__Bacilli|o__Bacillales"</span>, </span>
<span id="cb31-3342"><a href="#cb31-3342" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Myxococcota|c__Myxococcia|o__Myxococcales|f__Myxococcaceae|g__Corallococcus"</span>, </span>
<span id="cb31-3343"><a href="#cb31-3343" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Bacteria|p__Proteobacteria|c__Gammaproteobacteria|o__Burkholderiales|f__Burkholderiaceae|g__Ralstonia"</span> </span>
<span id="cb31-3344"><a href="#cb31-3344" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-3345"><a href="#cb31-3345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3346"><a href="#cb31-3346" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-3347"><a href="#cb31-3347" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu_select) {</span>
<span id="cb31-3348"><a href="#cb31-3348" aria-hidden="true" tabindex="-1"></a>  tmp_select_feat <span class="ot">&lt;-</span> i</span>
<span id="cb31-3349"><a href="#cb31-3349" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span>(ssu_pht, <span class="at">feature =</span> tmp_select_feat) <span class="sc">&amp;</span> <span class="fu">theme_bw</span>() </span>
<span id="cb31-3350"><a href="#cb31-3350" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> swel_col) <span class="sc">+</span> </span>
<span id="cb31-3351"><a href="#cb31-3351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb31-3352"><a href="#cb31-3352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb31-3353"><a href="#cb31-3353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative abundance (% total reads)"</span>)</span>
<span id="cb31-3354"><a href="#cb31-3354" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))</span>
<span id="cb31-3355"><a href="#cb31-3355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-3356"><a href="#cb31-3356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3357"><a href="#cb31-3357" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb31-3358"><a href="#cb31-3358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3359"><a href="#cb31-3359" aria-hidden="true" tabindex="-1"></a>ssu_title <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-3360"><a href="#cb31-3360" aria-hidden="true" tabindex="-1"></a><span class="st">"Subgroup_2 (Acidobacteriota)"</span>, </span>
<span id="cb31-3361"><a href="#cb31-3361" aria-hidden="true" tabindex="-1"></a><span class="st">"Saprospiraceae (Bacteroidota)"</span>, </span>
<span id="cb31-3362"><a href="#cb31-3362" aria-hidden="true" tabindex="-1"></a><span class="st">"Cytophagales (Bacteroidota)"</span>, </span>
<span id="cb31-3363"><a href="#cb31-3363" aria-hidden="true" tabindex="-1"></a><span class="st">"Flavobacteriales (Bacteroidota)"</span>, </span>
<span id="cb31-3364"><a href="#cb31-3364" aria-hidden="true" tabindex="-1"></a><span class="st">"Sphingobacteriales (Bacteroidota)"</span>, </span>
<span id="cb31-3365"><a href="#cb31-3365" aria-hidden="true" tabindex="-1"></a><span class="st">"mle1-27 (Myxococcota)"</span>, </span>
<span id="cb31-3366"><a href="#cb31-3366" aria-hidden="true" tabindex="-1"></a><span class="st">"Rubrivivax (Proteobacteria)"</span>, </span>
<span id="cb31-3367"><a href="#cb31-3367" aria-hidden="true" tabindex="-1"></a><span class="st">"Microtrichales (Actinobacteriota)"</span>, </span>
<span id="cb31-3368"><a href="#cb31-3368" aria-hidden="true" tabindex="-1"></a><span class="st">"Gaiellales (Actinobacteriota)"</span>, </span>
<span id="cb31-3369"><a href="#cb31-3369" aria-hidden="true" tabindex="-1"></a><span class="st">"Bacillales (Firmicutes)"</span>, </span>
<span id="cb31-3370"><a href="#cb31-3370" aria-hidden="true" tabindex="-1"></a><span class="st">"Corallococcus (Myxococcota)"</span>, </span>
<span id="cb31-3371"><a href="#cb31-3371" aria-hidden="true" tabindex="-1"></a><span class="st">"Ralstonia (Proteobacteria)"</span></span>
<span id="cb31-3372"><a href="#cb31-3372" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-3373"><a href="#cb31-3373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3374"><a href="#cb31-3374" aria-hidden="true" tabindex="-1"></a>ssu_plt_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lineage =</span> ssu_select, <span class="at">label =</span> ssu_title)</span>
<span id="cb31-3375"><a href="#cb31-3375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3376"><a href="#cb31-3376" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(ssu_plt_info))) {</span>
<span id="cb31-3377"><a href="#cb31-3377" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"plot_"</span>, i, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3378"><a href="#cb31-3378" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(ssu_plt_info[i, <span class="dv">1</span>], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))) <span class="sc">+</span> </span>
<span id="cb31-3379"><a href="#cb31-3379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(ssu_plt_info[i, <span class="dv">2</span>])</span>
<span id="cb31-3380"><a href="#cb31-3380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-3381"><a href="#cb31-3381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3382"><a href="#cb31-3382" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3383"><a href="#cb31-3383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3384"><a href="#cb31-3384" aria-hidden="true" tabindex="-1"></a>ssu_taxa_combo_plot <span class="ot">&lt;-</span> ((plot_1 <span class="sc">+</span> plot_2 <span class="sc">+</span> plot_3) <span class="sc">/</span> (plot_4 <span class="sc">+</span> plot_5 <span class="sc">+</span> plot_6) <span class="sc">/</span> (plot_7 <span class="sc">+</span> plot_8 <span class="sc">+</span> plot_9) <span class="sc">/</span> (plot_10 <span class="sc">+</span> plot_11 <span class="sc">+</span> plot_12))</span>
<span id="cb31-3385"><a href="#cb31-3385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3386"><a href="#cb31-3386" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(ssu_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_3/"</span>, </span>
<span id="cb31-3387"><a href="#cb31-3387" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Extended_Data_Figure_3.png"</span>, </span>
<span id="cb31-3388"><a href="#cb31-3388" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb31-3389"><a href="#cb31-3389" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-3390"><a href="#cb31-3390" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb31-3391"><a href="#cb31-3391" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(ssu_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_3/"</span>, </span>
<span id="cb31-3392"><a href="#cb31-3392" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_3.pdf"</span>, </span>
<span id="cb31-3393"><a href="#cb31-3393" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb31-3394"><a href="#cb31-3394" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-3395"><a href="#cb31-3395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3396"><a href="#cb31-3396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-3397"><a href="#cb31-3397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3398"><a href="#cb31-3398" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 4</span></span>
<span id="cb31-3399"><a href="#cb31-3399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3400"><a href="#cb31-3400" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-3401"><a href="#cb31-3401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3402"><a href="#cb31-3402" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-3403"><a href="#cb31-3403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3404"><a href="#cb31-3404" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include axes renaming, removing non-significant (NS) values from plots,  changing significant p-values to asterisks (<span class="in">`*`</span>), removing gridlines, and enlarging outlier points. </span>
<span id="cb31-3405"><a href="#cb31-3405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3406"><a href="#cb31-3406" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3407"><a href="#cb31-3407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3408"><a href="#cb31-3408" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-3409"><a href="#cb31-3409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3410"><a href="#cb31-3410" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-3411"><a href="#cb31-3411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3412"><a href="#cb31-3412" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.png)</span></span>
<span id="cb31-3413"><a href="#cb31-3413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3414"><a href="#cb31-3414" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-3415"><a href="#cb31-3415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3416"><a href="#cb31-3416" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_4.png)</span></span>
<span id="cb31-3417"><a href="#cb31-3417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3418"><a href="#cb31-3418" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3419"><a href="#cb31-3419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3420"><a href="#cb31-3420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3421"><a href="#cb31-3421" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-3422"><a href="#cb31-3422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3423"><a href="#cb31-3423" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-3424"><a href="#cb31-3424" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 4data pack</span><span class="co">](include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.rds)</span>  </span>
<span id="cb31-3425"><a href="#cb31-3425" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3426"><a href="#cb31-3426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3427"><a href="#cb31-3427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3428"><a href="#cb31-3428" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-3429"><a href="#cb31-3429" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 4 raw  pdf</span><span class="co">](include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.pdf)</span></span>
<span id="cb31-3430"><a href="#cb31-3430" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3431"><a href="#cb31-3431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3432"><a href="#cb31-3432" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3433"><a href="#cb31-3433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3436"><a href="#cb31-3436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-3437"><a href="#cb31-3437" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Extended Data Figure 4"</span></span>
<span id="cb31-3438"><a href="#cb31-3438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3439"><a href="#cb31-3439" aria-hidden="true" tabindex="-1"></a><span class="do">## In this section of the workflow we use the </span></span>
<span id="cb31-3440"><a href="#cb31-3440" aria-hidden="true" tabindex="-1"></a><span class="do">## [`microbiomeMarker`](https://github.com/yiluheihei/microbiomeMarker) package </span></span>
<span id="cb31-3441"><a href="#cb31-3441" aria-hidden="true" tabindex="-1"></a><span class="do">## to assess the response of taxonomic lineages to soil warming. </span></span>
<span id="cb31-3442"><a href="#cb31-3442" aria-hidden="true" tabindex="-1"></a><span class="do">## In the first step we need to fix the selected data set to make it </span></span>
<span id="cb31-3443"><a href="#cb31-3443" aria-hidden="true" tabindex="-1"></a><span class="do">## compatible with the various functions. For this analysis we use the </span></span>
<span id="cb31-3444"><a href="#cb31-3444" aria-hidden="true" tabindex="-1"></a><span class="do">## PERfect filtered data set.</span></span>
<span id="cb31-3445"><a href="#cb31-3445" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-3446"><a href="#cb31-3446" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_rf_all <span class="ot">&lt;-</span></span>
<span id="cb31-3447"><a href="#cb31-3447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="st">"include/pub/EXD/EXD_Figure_4/Extended_Data_Figure_4.rds"</span>)</span>
<span id="cb31-3448"><a href="#cb31-3448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3449"><a href="#cb31-3449" aria-hidden="true" tabindex="-1"></a><span class="do">## FIX ps object</span></span>
<span id="cb31-3450"><a href="#cb31-3450" aria-hidden="true" tabindex="-1"></a>its_ps <span class="ot">&lt;-</span> its18_ps_perfect_rf_all</span>
<span id="cb31-3451"><a href="#cb31-3451" aria-hidden="true" tabindex="-1"></a>tmp_tax1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(its_ps))</span>
<span id="cb31-3452"><a href="#cb31-3452" aria-hidden="true" tabindex="-1"></a>tmp_tax1<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3453"><a href="#cb31-3453" aria-hidden="true" tabindex="-1"></a>tmp_rn <span class="ot">&lt;-</span> <span class="fu">row.names</span>(tmp_tax1)</span>
<span id="cb31-3454"><a href="#cb31-3454" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span></span>
<span id="cb31-3455"><a href="#cb31-3455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">lapply</span>(tmp_tax1, <span class="cf">function</span>(x) {</span>
<span id="cb31-3456"><a href="#cb31-3456" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(|)"</span>, <span class="st">""</span>, x)</span>
<span id="cb31-3457"><a href="#cb31-3457" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb31-3458"><a href="#cb31-3458" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(tmp_tax) <span class="ot">&lt;-</span> tmp_rn</span>
<span id="cb31-3459"><a href="#cb31-3459" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">row.names</span>(tmp_tax), <span class="fu">row.names</span>(tmp_tax1))</span>
<span id="cb31-3460"><a href="#cb31-3460" aria-hidden="true" tabindex="-1"></a>ps_tax_new <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax)</span>
<span id="cb31-3461"><a href="#cb31-3461" aria-hidden="true" tabindex="-1"></a>tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(its_ps),</span>
<span id="cb31-3462"><a href="#cb31-3462" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">tax_table</span>(ps_tax_new),</span>
<span id="cb31-3463"><a href="#cb31-3463" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample_data</span>(its_ps))</span>
<span id="cb31-3464"><a href="#cb31-3464" aria-hidden="true" tabindex="-1"></a>its_ps <span class="ot">&lt;-</span> tmp_ps</span>
<span id="cb31-3465"><a href="#cb31-3465" aria-hidden="true" tabindex="-1"></a>phyloseq<span class="sc">::</span><span class="fu">rank_names</span>(its_ps)</span>
<span id="cb31-3466"><a href="#cb31-3466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3467"><a href="#cb31-3467" aria-hidden="true" tabindex="-1"></a><span class="do">## Next we run a statistical test for multiple groups</span></span>
<span id="cb31-3468"><a href="#cb31-3468" aria-hidden="true" tabindex="-1"></a><span class="do">## using the `run_test_multiple_groups` function.</span></span>
<span id="cb31-3469"><a href="#cb31-3469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3470"><a href="#cb31-3470" aria-hidden="true" tabindex="-1"></a>its_group_anova <span class="ot">&lt;-</span></span>
<span id="cb31-3471"><a href="#cb31-3471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_test_multiple_groups</span>(its_ps,</span>
<span id="cb31-3472"><a href="#cb31-3472" aria-hidden="true" tabindex="-1"></a>                           <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb31-3473"><a href="#cb31-3473" aria-hidden="true" tabindex="-1"></a>                           <span class="at">taxa_rank =</span> <span class="st">"all"</span>,</span>
<span id="cb31-3474"><a href="#cb31-3474" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb31-3475"><a href="#cb31-3475" aria-hidden="true" tabindex="-1"></a>its_group_anova<span class="sc">@</span>marker_table</span>
<span id="cb31-3476"><a href="#cb31-3476" aria-hidden="true" tabindex="-1"></a><span class="fu">marker_table</span>(its_group_anova)</span>
<span id="cb31-3477"><a href="#cb31-3477" aria-hidden="true" tabindex="-1"></a><span class="do">## And then conduct post hoc pairwise comparisons for multiple</span></span>
<span id="cb31-3478"><a href="#cb31-3478" aria-hidden="true" tabindex="-1"></a><span class="do">## groups test using the `run_posthoc_test` function.</span></span>
<span id="cb31-3479"><a href="#cb31-3479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3480"><a href="#cb31-3480" aria-hidden="true" tabindex="-1"></a>its_default_pht <span class="ot">&lt;-</span> <span class="fu">run_posthoc_test</span>(its_ps,</span>
<span id="cb31-3481"><a href="#cb31-3481" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">group =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb31-3482"><a href="#cb31-3482" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">method =</span> <span class="st">"tukey"</span>,</span>
<span id="cb31-3483"><a href="#cb31-3483" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">transform =</span> <span class="st">"log10"</span>)</span>
<span id="cb31-3484"><a href="#cb31-3484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3485"><a href="#cb31-3485" aria-hidden="true" tabindex="-1"></a><span class="do">## But what we really want to do is get all of the markers that are</span></span>
<span id="cb31-3486"><a href="#cb31-3486" aria-hidden="true" tabindex="-1"></a><span class="do">## significant from the analysis, excluding any significant ASVs so we can</span></span>
<span id="cb31-3487"><a href="#cb31-3487" aria-hidden="true" tabindex="-1"></a><span class="do">## look at high taxa ranks.</span></span>
<span id="cb31-3488"><a href="#cb31-3488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3489"><a href="#cb31-3489" aria-hidden="true" tabindex="-1"></a>its_pht <span class="ot">&lt;-</span> its_default_pht</span>
<span id="cb31-3490"><a href="#cb31-3490" aria-hidden="true" tabindex="-1"></a>its18_pht_filt <span class="ot">&lt;-</span> <span class="fu">filter</span>(<span class="fu">data.frame</span>(its_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"ASV"</span>, <span class="fu">filter</span>(<span class="fu">data.frame</span>(its_pht<span class="sc">@</span>result), pvalue <span class="sc">&lt;=</span> <span class="st">"0.05"</span>)<span class="sc">$</span>group_name),]</span>
<span id="cb31-3491"><a href="#cb31-3491" aria-hidden="true" tabindex="-1"></a>its18_pht_filt <span class="ot">&lt;-</span> its18_pht_filt[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[a-z]__$"</span>, its18_pht_filt<span class="sc">$</span>group_name),]</span>
<span id="cb31-3492"><a href="#cb31-3492" aria-hidden="true" tabindex="-1"></a>its18_pht_filt <span class="ot">&lt;-</span> <span class="fu">unique</span>(its18_pht_filt<span class="sc">$</span>group_name)</span>
<span id="cb31-3493"><a href="#cb31-3493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3494"><a href="#cb31-3494" aria-hidden="true" tabindex="-1"></a>plot_postHocTest_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (pht, feature, <span class="at">step_increase =</span> <span class="fl">0.12</span>) </span>
<span id="cb31-3495"><a href="#cb31-3495" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-3496"><a href="#cb31-3496" aria-hidden="true" tabindex="-1"></a>    abd_long <span class="ot">&lt;-</span> pht<span class="sc">@</span>abundance <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>.data<span class="sc">$</span>group, </span>
<span id="cb31-3497"><a href="#cb31-3497" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"feat"</span>)</span>
<span id="cb31-3498"><a href="#cb31-3498" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(feature)) {</span>
<span id="cb31-3499"><a href="#cb31-3499" aria-hidden="true" tabindex="-1"></a>        abd_long <span class="ot">&lt;-</span> <span class="fu">filter</span>(abd_long, .data<span class="sc">$</span>feat <span class="sc">%in%</span> feature)</span>
<span id="cb31-3500"><a href="#cb31-3500" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-3501"><a href="#cb31-3501" aria-hidden="true" tabindex="-1"></a>    annotation <span class="ot">&lt;-</span> <span class="fu">get_sig_annotation</span>(pht, <span class="at">step_increase =</span> step_increase)</span>
<span id="cb31-3502"><a href="#cb31-3502" aria-hidden="true" tabindex="-1"></a>    p_box <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">ggplot</span>(abd_long, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>group, </span>
<span id="cb31-3503"><a href="#cb31-3503" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> .data<span class="sc">$</span>value)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> ggsignif<span class="sc">::</span><span class="fu">geom_signif</span>(<span class="at">data =</span> annotation[annotation<span class="sc">$</span>feature <span class="sc">%in%</span> </span>
<span id="cb31-3504"><a href="#cb31-3504" aria-hidden="true" tabindex="-1"></a>        feature, ], <span class="fu">aes</span>(<span class="at">xmin =</span> .data<span class="sc">$</span>xmin, <span class="at">xmax =</span> .data<span class="sc">$</span>xmax, </span>
<span id="cb31-3505"><a href="#cb31-3505" aria-hidden="true" tabindex="-1"></a>        <span class="at">annotations =</span> .data<span class="sc">$</span>annotation, <span class="at">y_position =</span> .data<span class="sc">$</span>y_position), </span>
<span id="cb31-3506"><a href="#cb31-3506" aria-hidden="true" tabindex="-1"></a>        <span class="at">manual =</span> <span class="cn">TRUE</span>, <span class="at">textsize =</span> <span class="dv">3</span>, <span class="at">vjust =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-3507"><a href="#cb31-3507" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Abundance"</span>))</span>
<span id="cb31-3508"><a href="#cb31-3508" aria-hidden="true" tabindex="-1"></a>    test_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pht<span class="sc">@</span>result[[feature]])</span>
<span id="cb31-3509"><a href="#cb31-3509" aria-hidden="true" tabindex="-1"></a>    p_test <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(test_res, <span class="fu">aes</span>(<span class="at">x =</span> .data<span class="sc">$</span>comparions)) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .data<span class="sc">$</span>ci_lower, </span>
<span id="cb31-3510"><a href="#cb31-3510" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymax =</span> .data<span class="sc">$</span>ci_upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .data<span class="sc">$</span>diff_mean)) <span class="sc">+</span> </span>
<span id="cb31-3511"><a href="#cb31-3511" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"95% confidence intervals"</span>)</span>
<span id="cb31-3512"><a href="#cb31-3512" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(p_box)</span>
<span id="cb31-3513"><a href="#cb31-3513" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3514"><a href="#cb31-3514" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(plot_postHocTest_jjs) <span class="ot">&lt;-</span> <span class="fu">asNamespace</span>(<span class="st">'microbiomeMarker'</span>)</span>
<span id="cb31-3515"><a href="#cb31-3515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3516"><a href="#cb31-3516" aria-hidden="true" tabindex="-1"></a>its_select <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-3517"><a href="#cb31-3517" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Xylariales|f__Microdochiaceae"</span>, </span>
<span id="cb31-3518"><a href="#cb31-3518" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Entolomataceae"</span>, </span>
<span id="cb31-3519"><a href="#cb31-3519" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales|f__Clavariaceae"</span>, </span>
<span id="cb31-3520"><a href="#cb31-3520" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Agaricomycetes|o__Agaricales"</span>, </span>
<span id="cb31-3521"><a href="#cb31-3521" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Basidiomycota|c__Microbotryomycetes|o__Sporidiobolales"</span>, </span>
<span id="cb31-3522"><a href="#cb31-3522" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Rozellomycota|c__Rozellomycotina_cls_Incertae_sedis"</span>, </span>
<span id="cb31-3523"><a href="#cb31-3523" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Eurotiomycetes|o__Eurotiales|f__Trichocomaceae|g__Talaromyces"</span>, </span>
<span id="cb31-3524"><a href="#cb31-3524" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Pezizomycetes|o__Pezizales|f__Pyronemataceae"</span>, </span>
<span id="cb31-3525"><a href="#cb31-3525" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Sordariomycetes|o__Hypocreales|f__Nectriaceae|g__Fusarium"</span>, </span>
<span id="cb31-3526"><a href="#cb31-3526" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Ascomycota|c__Saccharomycetes|o__Saccharomycetales|f__Metschnikowiaceae"</span>, </span>
<span id="cb31-3527"><a href="#cb31-3527" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Glomeromycota|c__Glomeromycetes|o__Glomerales"</span>, </span>
<span id="cb31-3528"><a href="#cb31-3528" aria-hidden="true" tabindex="-1"></a><span class="st">"k__Fungi|p__Mortierellomycota|c__Mortierellomycetes|o__Mortierellales"</span></span>
<span id="cb31-3529"><a href="#cb31-3529" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-3530"><a href="#cb31-3530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3531"><a href="#cb31-3531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3532"><a href="#cb31-3532" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-3533"><a href="#cb31-3533" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its_select) {</span>
<span id="cb31-3534"><a href="#cb31-3534" aria-hidden="true" tabindex="-1"></a>  tmp_select_feat <span class="ot">&lt;-</span> i</span>
<span id="cb31-3535"><a href="#cb31-3535" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">plot_postHocTest_jjs</span>(its_pht, <span class="at">feature =</span> tmp_select_feat) <span class="sc">&amp;</span> <span class="fu">theme_bw</span>() </span>
<span id="cb31-3536"><a href="#cb31-3536" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> swel_col) <span class="sc">+</span> </span>
<span id="cb31-3537"><a href="#cb31-3537" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb31-3538"><a href="#cb31-3538" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb31-3539"><a href="#cb31-3539" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative abundance (% total reads)"</span>)</span>
<span id="cb31-3540"><a href="#cb31-3540" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))</span>
<span id="cb31-3541"><a href="#cb31-3541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-3542"><a href="#cb31-3542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3543"><a href="#cb31-3543" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb31-3544"><a href="#cb31-3544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3545"><a href="#cb31-3545" aria-hidden="true" tabindex="-1"></a>its_title <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-3546"><a href="#cb31-3546" aria-hidden="true" tabindex="-1"></a><span class="st">"Microdochiaceae (Ascomycota)"</span>, </span>
<span id="cb31-3547"><a href="#cb31-3547" aria-hidden="true" tabindex="-1"></a><span class="st">"Entolomataceae (Basidiomycota)"</span>, </span>
<span id="cb31-3548"><a href="#cb31-3548" aria-hidden="true" tabindex="-1"></a><span class="st">"Clavariaceae (Basidiomycota)"</span>, </span>
<span id="cb31-3549"><a href="#cb31-3549" aria-hidden="true" tabindex="-1"></a><span class="st">"Agaricales (Basidiomycota)"</span>, </span>
<span id="cb31-3550"><a href="#cb31-3550" aria-hidden="true" tabindex="-1"></a><span class="st">"Sporidiobolales (Basidiomycota)"</span>, </span>
<span id="cb31-3551"><a href="#cb31-3551" aria-hidden="true" tabindex="-1"></a><span class="st">"Rozellomycotina (Rozellomycota)"</span>, </span>
<span id="cb31-3552"><a href="#cb31-3552" aria-hidden="true" tabindex="-1"></a><span class="st">"Talaromyces (Ascomycota)"</span>, </span>
<span id="cb31-3553"><a href="#cb31-3553" aria-hidden="true" tabindex="-1"></a><span class="st">"Pyronemataceae (Ascomycota)"</span>, </span>
<span id="cb31-3554"><a href="#cb31-3554" aria-hidden="true" tabindex="-1"></a><span class="st">"Fusarium (Ascomycota)"</span>, </span>
<span id="cb31-3555"><a href="#cb31-3555" aria-hidden="true" tabindex="-1"></a><span class="st">"Metschnikowiaceae (Ascomycota)"</span>, </span>
<span id="cb31-3556"><a href="#cb31-3556" aria-hidden="true" tabindex="-1"></a><span class="st">"Glomerales (Glomeromycota)"</span>, </span>
<span id="cb31-3557"><a href="#cb31-3557" aria-hidden="true" tabindex="-1"></a><span class="st">"Mortierellales (Mortierellomycota)"</span></span>
<span id="cb31-3558"><a href="#cb31-3558" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-3559"><a href="#cb31-3559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3560"><a href="#cb31-3560" aria-hidden="true" tabindex="-1"></a>its_plt_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lineage =</span> its_select, <span class="at">label =</span> its_title)</span>
<span id="cb31-3561"><a href="#cb31-3561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3562"><a href="#cb31-3562" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(its_plt_info))) {</span>
<span id="cb31-3563"><a href="#cb31-3563" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"plot_"</span>, i, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3564"><a href="#cb31-3564" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(its_plt_info[i, <span class="dv">1</span>], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_plot"</span>))) <span class="sc">+</span> </span>
<span id="cb31-3565"><a href="#cb31-3565" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(its_plt_info[i, <span class="dv">2</span>])</span>
<span id="cb31-3566"><a href="#cb31-3566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-3567"><a href="#cb31-3567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3568"><a href="#cb31-3568" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-3569"><a href="#cb31-3569" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3570"><a href="#cb31-3570" aria-hidden="true" tabindex="-1"></a>its_taxa_combo_plot <span class="ot">&lt;-</span> ((plot_1 <span class="sc">+</span> plot_2 <span class="sc">+</span> plot_3) <span class="sc">/</span> (plot_4 <span class="sc">+</span> plot_5 <span class="sc">+</span> plot_6) <span class="sc">/</span> (plot_7 <span class="sc">+</span> plot_8 <span class="sc">+</span> plot_9) <span class="sc">/</span> (plot_10 <span class="sc">+</span> plot_11 <span class="sc">+</span> plot_12))</span>
<span id="cb31-3571"><a href="#cb31-3571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3572"><a href="#cb31-3572" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(its_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_4/"</span>, </span>
<span id="cb31-3573"><a href="#cb31-3573" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Extended_Data_Figure_4.png"</span>, </span>
<span id="cb31-3574"><a href="#cb31-3574" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb31-3575"><a href="#cb31-3575" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-3576"><a href="#cb31-3576" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb31-3577"><a href="#cb31-3577" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(its_taxa_combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_4/"</span>, </span>
<span id="cb31-3578"><a href="#cb31-3578" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_4.pdf"</span>, </span>
<span id="cb31-3579"><a href="#cb31-3579" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">14157</span>, <span class="at">width =</span> <span class="dv">12186</span>, </span>
<span id="cb31-3580"><a href="#cb31-3580" aria-hidden="true" tabindex="-1"></a>                <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-3581"><a href="#cb31-3581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3582"><a href="#cb31-3582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-3583"><a href="#cb31-3583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3584"><a href="#cb31-3584" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 5</span></span>
<span id="cb31-3585"><a href="#cb31-3585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3586"><a href="#cb31-3586" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-3587"><a href="#cb31-3587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3588"><a href="#cb31-3588" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-3589"><a href="#cb31-3589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3590"><a href="#cb31-3590" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include repositioning vector overlay labels, styling legend, and changing font size and style. </span>
<span id="cb31-3591"><a href="#cb31-3591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3592"><a href="#cb31-3592" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3593"><a href="#cb31-3593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3594"><a href="#cb31-3594" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-3595"><a href="#cb31-3595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3596"><a href="#cb31-3596" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-3597"><a href="#cb31-3597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3598"><a href="#cb31-3598" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.png)</span></span>
<span id="cb31-3599"><a href="#cb31-3599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3600"><a href="#cb31-3600" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-3601"><a href="#cb31-3601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3602"><a href="#cb31-3602" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_5.png)</span></span>
<span id="cb31-3603"><a href="#cb31-3603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3604"><a href="#cb31-3604" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3605"><a href="#cb31-3605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3606"><a href="#cb31-3606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3607"><a href="#cb31-3607" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-3608"><a href="#cb31-3608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3609"><a href="#cb31-3609" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-3610"><a href="#cb31-3610" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 5 data pack</span><span class="co">](include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.rdata)</span>  </span>
<span id="cb31-3611"><a href="#cb31-3611" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3612"><a href="#cb31-3612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3613"><a href="#cb31-3613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3614"><a href="#cb31-3614" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-3615"><a href="#cb31-3615" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 5 raw  pdf</span><span class="co">](include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.pdf)</span></span>
<span id="cb31-3616"><a href="#cb31-3616" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3617"><a href="#cb31-3617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3618"><a href="#cb31-3618" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-3619"><a href="#cb31-3619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3622"><a href="#cb31-3622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-3623"><a href="#cb31-3623" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Extended Data Figure 5"</span></span>
<span id="cb31-3624"><a href="#cb31-3624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3625"><a href="#cb31-3625" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-3626"><a href="#cb31-3626" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/EXD/EXD_Figure_5/Extended_Data_Figure_5.rdata"</span>)</span>
<span id="cb31-3627"><a href="#cb31-3627" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Run `rankindex` to compare metadata and community dissimilarity indices </span></span>
<span id="cb31-3628"><a href="#cb31-3628" aria-hidden="true" tabindex="-1"></a><span class="do">## for gradient detection. This will help us select the best dissimilarity </span></span>
<span id="cb31-3629"><a href="#cb31-3629" aria-hidden="true" tabindex="-1"></a><span class="do">## metric to use.</span></span>
<span id="cb31-3630"><a href="#cb31-3630" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Run `capscale` for distance-based redundancy analysis.</span></span>
<span id="cb31-3631"><a href="#cb31-3631" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Run `envfit` to fit environmental parameters onto the ordination. </span></span>
<span id="cb31-3632"><a href="#cb31-3632" aria-hidden="true" tabindex="-1"></a><span class="do">## This function basically calculates correlation scores between the metadata </span></span>
<span id="cb31-3633"><a href="#cb31-3633" aria-hidden="true" tabindex="-1"></a><span class="do">## parameters and the ordination axes. </span></span>
<span id="cb31-3634"><a href="#cb31-3634" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Select metadata parameters significant for `bioenv` (see above) </span></span>
<span id="cb31-3635"><a href="#cb31-3635" aria-hidden="true" tabindex="-1"></a><span class="do">## and/or `envfit` analyses.</span></span>
<span id="cb31-3636"><a href="#cb31-3636" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Run `envfit` on ASVs.</span></span>
<span id="cb31-3637"><a href="#cb31-3637" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) Plot the ordination and vector overlays. </span></span>
<span id="cb31-3638"><a href="#cb31-3638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3639"><a href="#cb31-3639" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3640"><a href="#cb31-3640" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3641"><a href="#cb31-3641" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA EDAPHIC PROPERTIES #####</span></span>
<span id="cb31-3642"><a href="#cb31-3642" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3643"><a href="#cb31-3643" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3644"><a href="#cb31-3644" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>edaphic</span>
<span id="cb31-3645"><a href="#cb31-3645" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-3646"><a href="#cb31-3646" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-3647"><a href="#cb31-3647" aria-hidden="true" tabindex="-1"></a>edaphic_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-3648"><a href="#cb31-3648" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-3649"><a href="#cb31-3649" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-3650"><a href="#cb31-3650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3651"><a href="#cb31-3651" aria-hidden="true" tabindex="-1"></a><span class="do">## Run `capscale` using Bray-Curtis. </span></span>
<span id="cb31-3652"><a href="#cb31-3652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3653"><a href="#cb31-3653" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN</span></span>
<span id="cb31-3654"><a href="#cb31-3654" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: TEB, DON, Na, Al, Ca</span></span>
<span id="cb31-3655"><a href="#cb31-3655" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 total, only works with 13</span></span>
<span id="cb31-3656"><a href="#cb31-3656" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: Mg, Mn</span></span>
<span id="cb31-3657"><a href="#cb31-3657" aria-hidden="true" tabindex="-1"></a>edaphic_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span> AST <span class="sc">+</span> H2O <span class="sc">+</span> N <span class="sc">+</span> P <span class="sc">+</span> Fe <span class="sc">+</span> K <span class="sc">+</span> ECEC <span class="sc">+</span> </span>
<span id="cb31-3658"><a href="#cb31-3658" aria-hidden="true" tabindex="-1"></a>                                   pH <span class="sc">+</span> NH4 <span class="sc">+</span> NO3 <span class="sc">+</span> PO4 <span class="sc">+</span> DOC <span class="sc">+</span> DOCN, </span>
<span id="cb31-3659"><a href="#cb31-3659" aria-hidden="true" tabindex="-1"></a>                        tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-3660"><a href="#cb31-3660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3661"><a href="#cb31-3661" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-3662"><a href="#cb31-3662" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-3663"><a href="#cb31-3663" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-3664"><a href="#cb31-3664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3665"><a href="#cb31-3665" aria-hidden="true" tabindex="-1"></a><span class="do">## Next, we need to grab capscale scores for the samples and create a </span></span>
<span id="cb31-3666"><a href="#cb31-3666" aria-hidden="true" tabindex="-1"></a><span class="do">## data frame of the first two dimensions. We will also need to add some </span></span>
<span id="cb31-3667"><a href="#cb31-3667" aria-hidden="true" tabindex="-1"></a><span class="do">## of the sample details to the data frame. For this we use the vegan </span></span>
<span id="cb31-3668"><a href="#cb31-3668" aria-hidden="true" tabindex="-1"></a><span class="do">## function `scores` which gets species or site scores from the ordination.</span></span>
<span id="cb31-3669"><a href="#cb31-3669" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggvegan)</span>
<span id="cb31-3670"><a href="#cb31-3670" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(edaphic_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-3671"><a href="#cb31-3671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3672"><a href="#cb31-3672" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-3673"><a href="#cb31-3673" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3674"><a href="#cb31-3674" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-3675"><a href="#cb31-3675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3676"><a href="#cb31-3676" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-3677"><a href="#cb31-3677" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-3678"><a href="#cb31-3678" aria-hidden="true" tabindex="-1"></a>edaphic_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-3679"><a href="#cb31-3679" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we have a new data frame that contains sample details and capscale values. </span></span>
<span id="cb31-3680"><a href="#cb31-3680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3681"><a href="#cb31-3681" aria-hidden="true" tabindex="-1"></a><span class="do">## We can then do the same with the metadata vectors. </span></span>
<span id="cb31-3682"><a href="#cb31-3682" aria-hidden="true" tabindex="-1"></a><span class="do">## Here though we only need the scores and parameter name. </span></span>
<span id="cb31-3683"><a href="#cb31-3683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3684"><a href="#cb31-3684" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-3685"><a href="#cb31-3685" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3686"><a href="#cb31-3686" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> edaphic_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-3687"><a href="#cb31-3687" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-3688"><a href="#cb31-3688" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-3689"><a href="#cb31-3689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3690"><a href="#cb31-3690" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run some quick correlations of metadata with ordination axes to </span></span>
<span id="cb31-3691"><a href="#cb31-3691" aria-hidden="true" tabindex="-1"></a><span class="do">## see which parameters are significant. For this we use the vegan function `envfit`.</span></span>
<span id="cb31-3692"><a href="#cb31-3692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3693"><a href="#cb31-3693" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> edaphic_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-3694"><a href="#cb31-3694" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-3695"><a href="#cb31-3695" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> edaphic_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-3696"><a href="#cb31-3696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3697"><a href="#cb31-3697" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-3698"><a href="#cb31-3698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3699"><a href="#cb31-3699" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-3700"><a href="#cb31-3700" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-3701"><a href="#cb31-3701" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-3702"><a href="#cb31-3702" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-3703"><a href="#cb31-3703" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-3704"><a href="#cb31-3704" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_md_signif_hits)</span>
<span id="cb31-3705"><a href="#cb31-3705" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_md_signif_hits)</span>
<span id="cb31-3706"><a href="#cb31-3706" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_md_signif_hits,]</span>
<span id="cb31-3707"><a href="#cb31-3707" aria-hidden="true" tabindex="-1"></a><span class="do">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span></span>
<span id="cb31-3708"><a href="#cb31-3708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3709"><a href="#cb31-3709" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-3710"><a href="#cb31-3710" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel))</span>
<span id="cb31-3711"><a href="#cb31-3711" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3712"><a href="#cb31-3712" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3713"><a href="#cb31-3713" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-3714"><a href="#cb31-3714" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-3715"><a href="#cb31-3715" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3716"><a href="#cb31-3716" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3717"><a href="#cb31-3717" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-3718"><a href="#cb31-3718" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel)), </span>
<span id="cb31-3719"><a href="#cb31-3719" aria-hidden="true" tabindex="-1"></a>                       edaphic_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-3720"><a href="#cb31-3720" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3721"><a href="#cb31-3721" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3722"><a href="#cb31-3722" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-3723"><a href="#cb31-3723" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-3724"><a href="#cb31-3724" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb31-3725"><a href="#cb31-3725" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3726"><a href="#cb31-3726" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3727"><a href="#cb31-3727" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb31-3728"><a href="#cb31-3728" aria-hidden="true" tabindex="-1"></a>edaphic_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-3729"><a href="#cb31-3729" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb31-3730"><a href="#cb31-3730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3731"><a href="#cb31-3731" aria-hidden="true" tabindex="-1"></a>new_edaphic_md_signif_hits <span class="ot">&lt;-</span> edaphic_sig_diff</span>
<span id="cb31-3732"><a href="#cb31-3732" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> new_edaphic_md_signif_hits,]</span>
<span id="cb31-3733"><a href="#cb31-3733" aria-hidden="true" tabindex="-1"></a><span class="do">## Check. Next, we run `envfit` for the ASVs.</span></span>
<span id="cb31-3734"><a href="#cb31-3734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3735"><a href="#cb31-3735" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-3736"><a href="#cb31-3736" aria-hidden="true" tabindex="-1"></a>                             tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb31-3737"><a href="#cb31-3737" aria-hidden="true" tabindex="-1"></a>                             <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-3738"><a href="#cb31-3738" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-3739"><a href="#cb31-3739" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> edaphic_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-3740"><a href="#cb31-3740" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-3741"><a href="#cb31-3741" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-3742"><a href="#cb31-3742" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3743"><a href="#cb31-3743" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-3744"><a href="#cb31-3744" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-3745"><a href="#cb31-3745" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-3746"><a href="#cb31-3746" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_asv_signif_hits)</span>
<span id="cb31-3747"><a href="#cb31-3747" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_asv_signif_hits)</span>
<span id="cb31-3748"><a href="#cb31-3748" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif <span class="ot">&lt;-</span> edaphic_asv_scores[edaphic_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_asv_signif_hits,]</span>
<span id="cb31-3749"><a href="#cb31-3749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3750"><a href="#cb31-3750" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-3751"><a href="#cb31-3751" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-3752"><a href="#cb31-3752" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(edaphic_md_signif_all, edaphic_asv_signif)</span>
<span id="cb31-3753"><a href="#cb31-3753" aria-hidden="true" tabindex="-1"></a><span class="do">## The last thing to do is categorize parameters scores and ASV </span></span>
<span id="cb31-3754"><a href="#cb31-3754" aria-hidden="true" tabindex="-1"></a><span class="do">## scores into different variable types for plotting.</span></span>
<span id="cb31-3755"><a href="#cb31-3755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3756"><a href="#cb31-3756" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb31-3757"><a href="#cb31-3757" aria-hidden="true" tabindex="-1"></a>                                  edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-3758"><a href="#cb31-3758" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb31-3759"><a href="#cb31-3759" aria-hidden="true" tabindex="-1"></a>                                   edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-3760"><a href="#cb31-3760" aria-hidden="true" tabindex="-1"></a><span class="do">##  code for the plot</span></span>
<span id="cb31-3761"><a href="#cb31-3761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3762"><a href="#cb31-3762" aria-hidden="true" tabindex="-1"></a>edaphic_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-3763"><a href="#cb31-3763" aria-hidden="true" tabindex="-1"></a>edaphic_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-3764"><a href="#cb31-3764" aria-hidden="true" tabindex="-1"></a>edaphic_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-3765"><a href="#cb31-3765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3766"><a href="#cb31-3766" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, edaphic_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3767"><a href="#cb31-3767" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, edaphic_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3768"><a href="#cb31-3768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3769"><a href="#cb31-3769" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-3770"><a href="#cb31-3770" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(edaphic_plot_data) <span class="sc">+</span></span>
<span id="cb31-3771"><a href="#cb31-3771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-3772"><a href="#cb31-3772" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb31-3773"><a href="#cb31-3773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-3774"><a href="#cb31-3774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-3775"><a href="#cb31-3775" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> edaphic_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-3776"><a href="#cb31-3776" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb31-3777"><a href="#cb31-3777" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb31-3778"><a href="#cb31-3778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> edaphic_bioplot_data_md, </span>
<span id="cb31-3779"><a href="#cb31-3779" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>, </span>
<span id="cb31-3780"><a href="#cb31-3780" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-3781"><a href="#cb31-3781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-3782"><a href="#cb31-3782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Edaphic properties"</span>, </span>
<span id="cb31-3783"><a href="#cb31-3783" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-3784"><a href="#cb31-3784" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-3785"><a href="#cb31-3785" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> edaphic_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb31-3786"><a href="#cb31-3786" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3787"><a href="#cb31-3787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3788"><a href="#cb31-3788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3789"><a href="#cb31-3789" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3790"><a href="#cb31-3790" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3791"><a href="#cb31-3791" aria-hidden="true" tabindex="-1"></a><span class="co"># 16S rRNA Soil Functional Response #</span></span>
<span id="cb31-3792"><a href="#cb31-3792" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3793"><a href="#cb31-3793" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3794"><a href="#cb31-3794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3795"><a href="#cb31-3795" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>soil_funct</span>
<span id="cb31-3796"><a href="#cb31-3796" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-3797"><a href="#cb31-3797" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-3798"><a href="#cb31-3798" aria-hidden="true" tabindex="-1"></a>soil_funct_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-3799"><a href="#cb31-3799" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-3800"><a href="#cb31-3800" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-3801"><a href="#cb31-3801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3802"><a href="#cb31-3802" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb31-3803"><a href="#cb31-3803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3804"><a href="#cb31-3804" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span></span>
<span id="cb31-3805"><a href="#cb31-3805" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span></span>
<span id="cb31-3806"><a href="#cb31-3806" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: NONE</span></span>
<span id="cb31-3807"><a href="#cb31-3807" aria-hidden="true" tabindex="-1"></a>soil_funct_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span> micC <span class="sc">+</span> micP <span class="sc">+</span> micCN <span class="sc">+</span> micCP <span class="sc">+</span> AG_ase <span class="sc">+</span> BG_ase <span class="sc">+</span> </span>
<span id="cb31-3808"><a href="#cb31-3808" aria-hidden="true" tabindex="-1"></a>                                      S_ase <span class="sc">+</span> XY_ase <span class="sc">+</span> PX_ase <span class="sc">+</span> CO2 <span class="sc">+</span> enzNP, </span>
<span id="cb31-3809"><a href="#cb31-3809" aria-hidden="true" tabindex="-1"></a>                           tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-3810"><a href="#cb31-3810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3811"><a href="#cb31-3811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3812"><a href="#cb31-3812" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(soil_funct_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-3813"><a href="#cb31-3813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3814"><a href="#cb31-3814" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-3815"><a href="#cb31-3815" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-3816"><a href="#cb31-3816" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-3817"><a href="#cb31-3817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3818"><a href="#cb31-3818" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-3819"><a href="#cb31-3819" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3820"><a href="#cb31-3820" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-3821"><a href="#cb31-3821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3822"><a href="#cb31-3822" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-3823"><a href="#cb31-3823" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-3824"><a href="#cb31-3824" aria-hidden="true" tabindex="-1"></a>soil_funct_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb31-3825"><a href="#cb31-3825" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-3826"><a href="#cb31-3826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3827"><a href="#cb31-3827" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-3828"><a href="#cb31-3828" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3829"><a href="#cb31-3829" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> soil_funct_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-3830"><a href="#cb31-3830" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3831"><a href="#cb31-3831" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-3832"><a href="#cb31-3832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3833"><a href="#cb31-3833" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> soil_funct_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-3834"><a href="#cb31-3834" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-3835"><a href="#cb31-3835" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> soil_funct_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-3836"><a href="#cb31-3836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3837"><a href="#cb31-3837" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-3838"><a href="#cb31-3838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3839"><a href="#cb31-3839" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-3840"><a href="#cb31-3840" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-3841"><a href="#cb31-3841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3842"><a href="#cb31-3842" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-3843"><a href="#cb31-3843" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-3844"><a href="#cb31-3844" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-3845"><a href="#cb31-3845" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_md_signif_hits)</span>
<span id="cb31-3846"><a href="#cb31-3846" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_md_signif_hits)</span>
<span id="cb31-3847"><a href="#cb31-3847" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-3848"><a href="#cb31-3848" aria-hidden="true" tabindex="-1"></a>                                               soil_funct_md_signif_hits,]</span>
<span id="cb31-3849"><a href="#cb31-3849" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-3850"><a href="#cb31-3850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3851"><a href="#cb31-3851" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-3852"><a href="#cb31-3852" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel))</span>
<span id="cb31-3853"><a href="#cb31-3853" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3854"><a href="#cb31-3854" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3855"><a href="#cb31-3855" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-3856"><a href="#cb31-3856" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-3857"><a href="#cb31-3857" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3858"><a href="#cb31-3858" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3859"><a href="#cb31-3859" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-3860"><a href="#cb31-3860" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel)), </span>
<span id="cb31-3861"><a href="#cb31-3861" aria-hidden="true" tabindex="-1"></a>                       soil_funct_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-3862"><a href="#cb31-3862" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3863"><a href="#cb31-3863" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3864"><a href="#cb31-3864" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-3865"><a href="#cb31-3865" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-3866"><a href="#cb31-3866" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb31-3867"><a href="#cb31-3867" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3868"><a href="#cb31-3868" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3869"><a href="#cb31-3869" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb31-3870"><a href="#cb31-3870" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-3871"><a href="#cb31-3871" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb31-3872"><a href="#cb31-3872" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff</span>
<span id="cb31-3873"><a href="#cb31-3873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3874"><a href="#cb31-3874" aria-hidden="true" tabindex="-1"></a>new_soil_funct_md_signif_hits <span class="ot">&lt;-</span> soil_funct_sig_diff</span>
<span id="cb31-3875"><a href="#cb31-3875" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-3876"><a href="#cb31-3876" aria-hidden="true" tabindex="-1"></a>                                                   new_soil_funct_md_signif_hits,]</span>
<span id="cb31-3877"><a href="#cb31-3877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3878"><a href="#cb31-3878" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-3879"><a href="#cb31-3879" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], </span>
<span id="cb31-3880"><a href="#cb31-3880" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-3881"><a href="#cb31-3881" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-3882"><a href="#cb31-3882" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> soil_funct_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-3883"><a href="#cb31-3883" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3884"><a href="#cb31-3884" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-3885"><a href="#cb31-3885" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3886"><a href="#cb31-3886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3887"><a href="#cb31-3887" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-3888"><a href="#cb31-3888" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-3889"><a href="#cb31-3889" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-3890"><a href="#cb31-3890" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_asv_signif_hits)</span>
<span id="cb31-3891"><a href="#cb31-3891" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_asv_signif_hits)</span>
<span id="cb31-3892"><a href="#cb31-3892" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif <span class="ot">&lt;-</span> soil_funct_asv_scores[soil_funct_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-3893"><a href="#cb31-3893" aria-hidden="true" tabindex="-1"></a>                                                 soil_funct_asv_signif_hits,]</span>
<span id="cb31-3894"><a href="#cb31-3894" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-3895"><a href="#cb31-3895" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-3896"><a href="#cb31-3896" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(soil_funct_md_signif_all, soil_funct_asv_signif)</span>
<span id="cb31-3897"><a href="#cb31-3897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3898"><a href="#cb31-3898" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb31-3899"><a href="#cb31-3899" aria-hidden="true" tabindex="-1"></a>                                  soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-3900"><a href="#cb31-3900" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb31-3901"><a href="#cb31-3901" aria-hidden="true" tabindex="-1"></a>                                   soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-3902"><a href="#cb31-3902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3903"><a href="#cb31-3903" aria-hidden="true" tabindex="-1"></a><span class="do">## PLOT Code</span></span>
<span id="cb31-3904"><a href="#cb31-3904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3905"><a href="#cb31-3905" aria-hidden="true" tabindex="-1"></a>soil_funct_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-3906"><a href="#cb31-3906" aria-hidden="true" tabindex="-1"></a>soil_funct_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-3907"><a href="#cb31-3907" aria-hidden="true" tabindex="-1"></a>soil_funct_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-3908"><a href="#cb31-3908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3909"><a href="#cb31-3909" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, soil_funct_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3910"><a href="#cb31-3910" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, soil_funct_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-3911"><a href="#cb31-3911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3912"><a href="#cb31-3912" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-3913"><a href="#cb31-3913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3914"><a href="#cb31-3914" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(soil_funct_plot_data) <span class="sc">+</span></span>
<span id="cb31-3915"><a href="#cb31-3915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-3916"><a href="#cb31-3916" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb31-3917"><a href="#cb31-3917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-3918"><a href="#cb31-3918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-3919"><a href="#cb31-3919" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> soil_funct_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-3920"><a href="#cb31-3920" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb31-3921"><a href="#cb31-3921" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>) <span class="sc">+</span></span>
<span id="cb31-3922"><a href="#cb31-3922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> soil_funct_bioplot_data_md, </span>
<span id="cb31-3923"><a href="#cb31-3923" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb31-3924"><a href="#cb31-3924" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-3925"><a href="#cb31-3925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-3926"><a href="#cb31-3926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Functional Response"</span>, </span>
<span id="cb31-3927"><a href="#cb31-3927" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-3928"><a href="#cb31-3928" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-3929"><a href="#cb31-3929" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb31-3930"><a href="#cb31-3930" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-3931"><a href="#cb31-3931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3932"><a href="#cb31-3932" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3933"><a href="#cb31-3933" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3934"><a href="#cb31-3934" aria-hidden="true" tabindex="-1"></a><span class="do">### 16S rRNA Temperature Adaptation #</span></span>
<span id="cb31-3935"><a href="#cb31-3935" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3936"><a href="#cb31-3936" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-3937"><a href="#cb31-3937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3938"><a href="#cb31-3938" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb31-3939"><a href="#cb31-3939" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>temp_adapt</span>
<span id="cb31-3940"><a href="#cb31-3940" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-3941"><a href="#cb31-3941" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(ssu18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-3942"><a href="#cb31-3942" aria-hidden="true" tabindex="-1"></a>temp_adapt_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-3943"><a href="#cb31-3943" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-3944"><a href="#cb31-3944" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-3945"><a href="#cb31-3945" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb31-3946"><a href="#cb31-3946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3947"><a href="#cb31-3947" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span id="cb31-3948"><a href="#cb31-3948" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: NUE, PUE, SI</span></span>
<span id="cb31-3949"><a href="#cb31-3949" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: NONE</span></span>
<span id="cb31-3950"><a href="#cb31-3950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3951"><a href="#cb31-3951" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  AG_Q10 <span class="sc">+</span> BG_Q10 <span class="sc">+</span> BP_Q10 <span class="sc">+</span> CE_Q10 <span class="sc">+</span> </span>
<span id="cb31-3952"><a href="#cb31-3952" aria-hidden="true" tabindex="-1"></a>                                       P_Q10 <span class="sc">+</span> N_Q10 <span class="sc">+</span> S_Q10 <span class="sc">+</span> XY_Q10 <span class="sc">+</span> </span>
<span id="cb31-3953"><a href="#cb31-3953" aria-hidden="true" tabindex="-1"></a>                                       LP_Q10 <span class="sc">+</span> PX_Q10 <span class="sc">+</span> CUEcn <span class="sc">+</span> CUEcp <span class="sc">+</span> Tmin, </span>
<span id="cb31-3954"><a href="#cb31-3954" aria-hidden="true" tabindex="-1"></a>                             tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-3955"><a href="#cb31-3955" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(temp_adapt_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-3956"><a href="#cb31-3956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3957"><a href="#cb31-3957" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-3958"><a href="#cb31-3958" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-3959"><a href="#cb31-3959" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-3960"><a href="#cb31-3960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3961"><a href="#cb31-3961" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-3962"><a href="#cb31-3962" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3963"><a href="#cb31-3963" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-3964"><a href="#cb31-3964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3965"><a href="#cb31-3965" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-3966"><a href="#cb31-3966" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-3967"><a href="#cb31-3967" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb31-3968"><a href="#cb31-3968" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-3969"><a href="#cb31-3969" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-3970"><a href="#cb31-3970" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-3971"><a href="#cb31-3971" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> temp_adapt_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-3972"><a href="#cb31-3972" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3973"><a href="#cb31-3973" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-3974"><a href="#cb31-3974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3975"><a href="#cb31-3975" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> temp_adapt_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-3976"><a href="#cb31-3976" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-3977"><a href="#cb31-3977" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> temp_adapt_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-3978"><a href="#cb31-3978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3979"><a href="#cb31-3979" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-3980"><a href="#cb31-3980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3981"><a href="#cb31-3981" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-3982"><a href="#cb31-3982" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-3983"><a href="#cb31-3983" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-3984"><a href="#cb31-3984" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-3985"><a href="#cb31-3985" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-3986"><a href="#cb31-3986" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-3987"><a href="#cb31-3987" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-3988"><a href="#cb31-3988" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-3989"><a href="#cb31-3989" aria-hidden="true" tabindex="-1"></a>                                               temp_adapt_md_signif_hits,]</span>
<span id="cb31-3990"><a href="#cb31-3990" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-3991"><a href="#cb31-3991" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel))</span>
<span id="cb31-3992"><a href="#cb31-3992" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3993"><a href="#cb31-3993" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3994"><a href="#cb31-3994" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-3995"><a href="#cb31-3995" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-3996"><a href="#cb31-3996" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-3997"><a href="#cb31-3997" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-3998"><a href="#cb31-3998" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-3999"><a href="#cb31-3999" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)), </span>
<span id="cb31-4000"><a href="#cb31-4000" aria-hidden="true" tabindex="-1"></a>                       temp_adapt_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-4001"><a href="#cb31-4001" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4002"><a href="#cb31-4002" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4003"><a href="#cb31-4003" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-4004"><a href="#cb31-4004" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4005"><a href="#cb31-4005" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-4006"><a href="#cb31-4006" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4007"><a href="#cb31-4007" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4008"><a href="#cb31-4008" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and  bioenv."</span>)</span>
<span id="cb31-4009"><a href="#cb31-4009" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4010"><a href="#cb31-4010" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(ssu18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-4011"><a href="#cb31-4011" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff</span>
<span id="cb31-4012"><a href="#cb31-4012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4013"><a href="#cb31-4013" aria-hidden="true" tabindex="-1"></a>new_temp_adapt_md_signif_hits <span class="ot">&lt;-</span> temp_adapt_sig_diff</span>
<span id="cb31-4014"><a href="#cb31-4014" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4015"><a href="#cb31-4015" aria-hidden="true" tabindex="-1"></a>                                                   new_temp_adapt_md_signif_hits,]</span>
<span id="cb31-4016"><a href="#cb31-4016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4017"><a href="#cb31-4017" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-4018"><a href="#cb31-4018" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb31-4019"><a href="#cb31-4019" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-4020"><a href="#cb31-4020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4021"><a href="#cb31-4021" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-4022"><a href="#cb31-4022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4023"><a href="#cb31-4023" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> temp_adapt_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-4024"><a href="#cb31-4024" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-4025"><a href="#cb31-4025" aria-hidden="true" tabindex="-1"></a>                         tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-4026"><a href="#cb31-4026" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4027"><a href="#cb31-4027" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-4028"><a href="#cb31-4028" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-4029"><a href="#cb31-4029" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-4030"><a href="#cb31-4030" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-4031"><a href="#cb31-4031" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-4032"><a href="#cb31-4032" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif <span class="ot">&lt;-</span> temp_adapt_asv_scores[temp_adapt_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4033"><a href="#cb31-4033" aria-hidden="true" tabindex="-1"></a>                                                 temp_adapt_asv_signif_hits,]</span>
<span id="cb31-4034"><a href="#cb31-4034" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-4035"><a href="#cb31-4035" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-4036"><a href="#cb31-4036" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_adapt_md_signif_all, temp_adapt_asv_signif)</span>
<span id="cb31-4037"><a href="#cb31-4037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4038"><a href="#cb31-4038" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-4039"><a href="#cb31-4039" aria-hidden="true" tabindex="-1"></a>                                  temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-4040"><a href="#cb31-4040" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-4041"><a href="#cb31-4041" aria-hidden="true" tabindex="-1"></a>                                   temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-4042"><a href="#cb31-4042" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-4043"><a href="#cb31-4043" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4044"><a href="#cb31-4044" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4045"><a href="#cb31-4045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4046"><a href="#cb31-4046" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, temp_adapt_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4047"><a href="#cb31-4047" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, temp_adapt_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4048"><a href="#cb31-4048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4049"><a href="#cb31-4049" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-4050"><a href="#cb31-4050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4051"><a href="#cb31-4051" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(temp_adapt_plot_data) <span class="sc">+</span></span>
<span id="cb31-4052"><a href="#cb31-4052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-4053"><a href="#cb31-4053" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb31-4054"><a href="#cb31-4054" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-4055"><a href="#cb31-4055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-4056"><a href="#cb31-4056" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> temp_adapt_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-4057"><a href="#cb31-4057" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>,</span>
<span id="cb31-4058"><a href="#cb31-4058" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb31-4059"><a href="#cb31-4059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> temp_adapt_bioplot_data_md, </span>
<span id="cb31-4060"><a href="#cb31-4060" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb31-4061"><a href="#cb31-4061" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-4062"><a href="#cb31-4062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-4063"><a href="#cb31-4063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Temperature Adaptation"</span>,</span>
<span id="cb31-4064"><a href="#cb31-4064" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-4065"><a href="#cb31-4065" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-4066"><a href="#cb31-4066" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span>
<span id="cb31-4067"><a href="#cb31-4067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4068"><a href="#cb31-4068" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_plot"</span>)</span>
<span id="cb31-4069"><a href="#cb31-4069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4070"><a href="#cb31-4070" aria-hidden="true" tabindex="-1"></a>ssu18_edaphic_plot <span class="ot">&lt;-</span> edaphic_plot</span>
<span id="cb31-4071"><a href="#cb31-4071" aria-hidden="true" tabindex="-1"></a>ssu18_soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot</span>
<span id="cb31-4072"><a href="#cb31-4072" aria-hidden="true" tabindex="-1"></a>ssu18_temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot</span>
<span id="cb31-4073"><a href="#cb31-4073" aria-hidden="true" tabindex="-1"></a>gdata<span class="sc">::</span><span class="fu">keep</span>(ssu18_edaphic_plot, ssu18_soil_funct_plot, ssu18_temp_adapt_plot, its18_edaphic_bioenv_ind_mantel, its18_select_mc_norm_split_no_ac, its18_soil_funct_bioenv_ind_mantel, its18_temp_adapt_bioenv_ind_mantel, ssu18_edaphic_bioenv_ind_mantel, ssu18_select_mc_norm_split_no_ac, ssu18_soil_funct_bioenv_ind_mantel, ssu18_temp_adapt_bioenv_ind_mantel, <span class="at">sure =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-4074"><a href="#cb31-4074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4075"><a href="#cb31-4075" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4076"><a href="#cb31-4076" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4077"><a href="#cb31-4077" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS EDAPHIC PROPERTIES #######</span></span>
<span id="cb31-4078"><a href="#cb31-4078" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4079"><a href="#cb31-4079" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4080"><a href="#cb31-4080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4081"><a href="#cb31-4081" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> its18_select_mc_norm_split_no_ac<span class="sc">$</span>edaphic</span>
<span id="cb31-4082"><a href="#cb31-4082" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-4083"><a href="#cb31-4083" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(its18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-4084"><a href="#cb31-4084" aria-hidden="true" tabindex="-1"></a>edaphic_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-4085"><a href="#cb31-4085" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>,<span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-4086"><a href="#cb31-4086" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-4087"><a href="#cb31-4087" aria-hidden="true" tabindex="-1"></a><span class="do">## Run `capscale` using Bray-Curtis. </span></span>
<span id="cb31-4088"><a href="#cb31-4088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4089"><a href="#cb31-4089" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AST, H2O, N, P, Al, Ca, Fe, K, Mg, Mn, Na, TEB, ECEC, pH, NH4, NO3, PO4, DOC, DON, DOCN.</span></span>
<span id="cb31-4090"><a href="#cb31-4090" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: TEB, DON, Na, Al, Ca.</span></span>
<span id="cb31-4091"><a href="#cb31-4091" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: Mg, Mn, Na, Al, Fe, K</span></span>
<span id="cb31-4092"><a href="#cb31-4092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4093"><a href="#cb31-4093" aria-hidden="true" tabindex="-1"></a>edaphic_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span> AST <span class="sc">+</span> H2O <span class="sc">+</span> N <span class="sc">+</span> P <span class="sc">+</span> ECEC <span class="sc">+</span> pH <span class="sc">+</span> </span>
<span id="cb31-4094"><a href="#cb31-4094" aria-hidden="true" tabindex="-1"></a>                                   NH4 <span class="sc">+</span> NO3 <span class="sc">+</span> PO4 <span class="sc">+</span> DOC <span class="sc">+</span> DOCN, </span>
<span id="cb31-4095"><a href="#cb31-4095" aria-hidden="true" tabindex="-1"></a>                        tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-4096"><a href="#cb31-4096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4097"><a href="#cb31-4097" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-4098"><a href="#cb31-4098" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-4099"><a href="#cb31-4099" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(edaphic_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-4100"><a href="#cb31-4100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4101"><a href="#cb31-4101" aria-hidden="true" tabindex="-1"></a><span class="do">## Next, we need to grab capscale scores for the samples and create a </span></span>
<span id="cb31-4102"><a href="#cb31-4102" aria-hidden="true" tabindex="-1"></a><span class="do">## data frame of the first two dimensions. We will also need to add some </span></span>
<span id="cb31-4103"><a href="#cb31-4103" aria-hidden="true" tabindex="-1"></a><span class="do">## of the sample details to the data frame. For this we use the vegan </span></span>
<span id="cb31-4104"><a href="#cb31-4104" aria-hidden="true" tabindex="-1"></a><span class="do">## function `scores` which gets species or site scores from the ordination.</span></span>
<span id="cb31-4105"><a href="#cb31-4105" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggvegan)</span>
<span id="cb31-4106"><a href="#cb31-4106" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(edaphic_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-4107"><a href="#cb31-4107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4108"><a href="#cb31-4108" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-4109"><a href="#cb31-4109" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4110"><a href="#cb31-4110" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-4111"><a href="#cb31-4111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4112"><a href="#cb31-4112" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-4113"><a href="#cb31-4113" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-4114"><a href="#cb31-4114" aria-hidden="true" tabindex="-1"></a>edaphic_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-4115"><a href="#cb31-4115" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we have a new data frame that contains sample details and capscale values. </span></span>
<span id="cb31-4116"><a href="#cb31-4116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4117"><a href="#cb31-4117" aria-hidden="true" tabindex="-1"></a><span class="do">## We can then do the same with the metadata vectors. </span></span>
<span id="cb31-4118"><a href="#cb31-4118" aria-hidden="true" tabindex="-1"></a><span class="do">## Here though we only need the scores and parameter name. </span></span>
<span id="cb31-4119"><a href="#cb31-4119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4120"><a href="#cb31-4120" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-4121"><a href="#cb31-4121" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4122"><a href="#cb31-4122" aria-hidden="true" tabindex="-1"></a>edaphic_md_scores <span class="ot">&lt;-</span> edaphic_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-4123"><a href="#cb31-4123" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-4124"><a href="#cb31-4124" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-4125"><a href="#cb31-4125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4126"><a href="#cb31-4126" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run some quick correlations of metadata with ordination axes to </span></span>
<span id="cb31-4127"><a href="#cb31-4127" aria-hidden="true" tabindex="-1"></a><span class="do">## see which parameters are significant. For this we use the vegan function `envfit`.</span></span>
<span id="cb31-4128"><a href="#cb31-4128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4129"><a href="#cb31-4129" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> edaphic_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-4130"><a href="#cb31-4130" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-4131"><a href="#cb31-4131" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> edaphic_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-4132"><a href="#cb31-4132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4133"><a href="#cb31-4133" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-4134"><a href="#cb31-4134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4135"><a href="#cb31-4135" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-4136"><a href="#cb31-4136" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-4137"><a href="#cb31-4137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4138"><a href="#cb31-4138" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-4139"><a href="#cb31-4139" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-4140"><a href="#cb31-4140" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-4141"><a href="#cb31-4141" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_md_signif_hits)</span>
<span id="cb31-4142"><a href="#cb31-4142" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_md_signif_hits)</span>
<span id="cb31-4143"><a href="#cb31-4143" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_md_signif_hits,]</span>
<span id="cb31-4144"><a href="#cb31-4144" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-4145"><a href="#cb31-4145" aria-hidden="true" tabindex="-1"></a><span class="do">## Now let's see if the same parameters are significant for the `envfit` and `bioenv` analyses.</span></span>
<span id="cb31-4146"><a href="#cb31-4146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4147"><a href="#cb31-4147" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-4148"><a href="#cb31-4148" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel))</span>
<span id="cb31-4149"><a href="#cb31-4149" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4150"><a href="#cb31-4150" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4151"><a href="#cb31-4151" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-4152"><a href="#cb31-4152" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-4153"><a href="#cb31-4153" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4154"><a href="#cb31-4154" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4155"><a href="#cb31-4155" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-4156"><a href="#cb31-4156" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel)), </span>
<span id="cb31-4157"><a href="#cb31-4157" aria-hidden="true" tabindex="-1"></a>                       edaphic_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-4158"><a href="#cb31-4158" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4159"><a href="#cb31-4159" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4160"><a href="#cb31-4160" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-4161"><a href="#cb31-4161" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4162"><a href="#cb31-4162" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb31-4163"><a href="#cb31-4163" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4164"><a href="#cb31-4164" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4165"><a href="#cb31-4165" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb31-4166"><a href="#cb31-4166" aria-hidden="true" tabindex="-1"></a>edaphic_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(edaphic_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4167"><a href="#cb31-4167" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_edaphic_bioenv_ind_mantel)))</span>
<span id="cb31-4168"><a href="#cb31-4168" aria-hidden="true" tabindex="-1"></a>edaphic_sig_diff</span>
<span id="cb31-4169"><a href="#cb31-4169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4170"><a href="#cb31-4170" aria-hidden="true" tabindex="-1"></a>new_edaphic_md_signif_hits <span class="ot">&lt;-</span> edaphic_sig_diff</span>
<span id="cb31-4171"><a href="#cb31-4171" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all <span class="ot">&lt;-</span> edaphic_md_scores[edaphic_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> new_edaphic_md_signif_hits,]</span>
<span id="cb31-4172"><a href="#cb31-4172" aria-hidden="true" tabindex="-1"></a><span class="do">## Check. Next, we run `envfit` for the ASVs.</span></span>
<span id="cb31-4173"><a href="#cb31-4173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4174"><a href="#cb31-4174" aria-hidden="true" tabindex="-1"></a>envfit_edaphic_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-4175"><a href="#cb31-4175" aria-hidden="true" tabindex="-1"></a>                             tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb31-4176"><a href="#cb31-4176" aria-hidden="true" tabindex="-1"></a>                             <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-4177"><a href="#cb31-4177" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-4178"><a href="#cb31-4178" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores <span class="ot">&lt;-</span> edaphic_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-4179"><a href="#cb31-4179" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-4180"><a href="#cb31-4180" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-4181"><a href="#cb31-4181" aria-hidden="true" tabindex="-1"></a>edaphic_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4182"><a href="#cb31-4182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4183"><a href="#cb31-4183" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-4184"><a href="#cb31-4184" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-4185"><a href="#cb31-4185" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_edaphic_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-4186"><a href="#cb31-4186" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_asv_signif_hits)</span>
<span id="cb31-4187"><a href="#cb31-4187" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(edaphic_asv_signif_hits)</span>
<span id="cb31-4188"><a href="#cb31-4188" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif <span class="ot">&lt;-</span> edaphic_asv_scores[edaphic_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> edaphic_asv_signif_hits,]</span>
<span id="cb31-4189"><a href="#cb31-4189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4190"><a href="#cb31-4190" aria-hidden="true" tabindex="-1"></a>edaphic_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-4191"><a href="#cb31-4191" aria-hidden="true" tabindex="-1"></a>edaphic_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-4192"><a href="#cb31-4192" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(edaphic_md_signif_all, edaphic_asv_signif)</span>
<span id="cb31-4193"><a href="#cb31-4193" aria-hidden="true" tabindex="-1"></a><span class="do">## The last thing to do is categorize parameters scores and ASV </span></span>
<span id="cb31-4194"><a href="#cb31-4194" aria-hidden="true" tabindex="-1"></a><span class="do">## scores into different variable types for plotting.</span></span>
<span id="cb31-4195"><a href="#cb31-4195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4196"><a href="#cb31-4196" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb31-4197"><a href="#cb31-4197" aria-hidden="true" tabindex="-1"></a>                                  edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-4198"><a href="#cb31-4198" aria-hidden="true" tabindex="-1"></a>edaphic_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(edaphic_bioplot_data, </span>
<span id="cb31-4199"><a href="#cb31-4199" aria-hidden="true" tabindex="-1"></a>                                   edaphic_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-4200"><a href="#cb31-4200" aria-hidden="true" tabindex="-1"></a><span class="do">##  code for the plot</span></span>
<span id="cb31-4201"><a href="#cb31-4201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4202"><a href="#cb31-4202" aria-hidden="true" tabindex="-1"></a>edaphic_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edaphic_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-4203"><a href="#cb31-4203" aria-hidden="true" tabindex="-1"></a>edaphic_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4204"><a href="#cb31-4204" aria-hidden="true" tabindex="-1"></a>edaphic_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((edaphic_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4205"><a href="#cb31-4205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4206"><a href="#cb31-4206" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, edaphic_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4207"><a href="#cb31-4207" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, edaphic_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4208"><a href="#cb31-4208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4209"><a href="#cb31-4209" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-4210"><a href="#cb31-4210" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(edaphic_plot_data) <span class="sc">+</span></span>
<span id="cb31-4211"><a href="#cb31-4211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-4212"><a href="#cb31-4212" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb31-4213"><a href="#cb31-4213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-4214"><a href="#cb31-4214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-4215"><a href="#cb31-4215" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> edaphic_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-4216"><a href="#cb31-4216" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb31-4217"><a href="#cb31-4217" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb31-4218"><a href="#cb31-4218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> edaphic_bioplot_data_md, </span>
<span id="cb31-4219"><a href="#cb31-4219" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>, </span>
<span id="cb31-4220"><a href="#cb31-4220" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-4221"><a href="#cb31-4221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-4222"><a href="#cb31-4222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-4223"><a href="#cb31-4223" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-4224"><a href="#cb31-4224" aria-hidden="true" tabindex="-1"></a>edaphic_plot <span class="ot">&lt;-</span> edaphic_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb31-4225"><a href="#cb31-4225" aria-hidden="true" tabindex="-1"></a>edaphic_plot</span>
<span id="cb31-4226"><a href="#cb31-4226" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-4227"><a href="#cb31-4227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4228"><a href="#cb31-4228" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4229"><a href="#cb31-4229" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4230"><a href="#cb31-4230" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS Soil Functional Response #</span></span>
<span id="cb31-4231"><a href="#cb31-4231" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4232"><a href="#cb31-4232" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4233"><a href="#cb31-4233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4234"><a href="#cb31-4234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4235"><a href="#cb31-4235" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> its18_select_mc_norm_split_no_ac<span class="sc">$</span>soil_funct</span>
<span id="cb31-4236"><a href="#cb31-4236" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-4237"><a href="#cb31-4237" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(its18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-4238"><a href="#cb31-4238" aria-hidden="true" tabindex="-1"></a>soil_funct_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-4239"><a href="#cb31-4239" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-4240"><a href="#cb31-4240" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-4241"><a href="#cb31-4241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4242"><a href="#cb31-4242" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis </span></span>
<span id="cb31-4243"><a href="#cb31-4243" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: micC, micN, micP, micCN, micCP, micNP, AG_ase, BG_ase, BP_ase, CE_ase, P_ase, N_ase, S_ase, XY_ase,  LP_ase, PX_ase, CO2, enzCN, enzCP, enzNP</span></span>
<span id="cb31-4244"><a href="#cb31-4244" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: micN, micNP, enzCN, enzCP, BP_ase, CE_ase, LP_ase, N_ase, P_ase</span></span>
<span id="cb31-4245"><a href="#cb31-4245" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: NONE</span></span>
<span id="cb31-4246"><a href="#cb31-4246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4247"><a href="#cb31-4247" aria-hidden="true" tabindex="-1"></a>soil_funct_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  micC <span class="sc">+</span> micP <span class="sc">+</span> micCN <span class="sc">+</span> micCP <span class="sc">+</span> AG_ase <span class="sc">+</span> BG_ase <span class="sc">+</span> </span>
<span id="cb31-4248"><a href="#cb31-4248" aria-hidden="true" tabindex="-1"></a>                                       S_ase <span class="sc">+</span> XY_ase <span class="sc">+</span> PX_ase <span class="sc">+</span> CO2 <span class="sc">+</span> enzNP, </span>
<span id="cb31-4249"><a href="#cb31-4249" aria-hidden="true" tabindex="-1"></a>                           tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-4250"><a href="#cb31-4250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4251"><a href="#cb31-4251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4252"><a href="#cb31-4252" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(soil_funct_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-4253"><a href="#cb31-4253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4254"><a href="#cb31-4254" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-4255"><a href="#cb31-4255" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-4256"><a href="#cb31-4256" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(soil_funct_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-4257"><a href="#cb31-4257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4258"><a href="#cb31-4258" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-4259"><a href="#cb31-4259" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4260"><a href="#cb31-4260" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-4261"><a href="#cb31-4261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4262"><a href="#cb31-4262" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-4263"><a href="#cb31-4263" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-4264"><a href="#cb31-4264" aria-hidden="true" tabindex="-1"></a>soil_funct_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb31-4265"><a href="#cb31-4265" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-4266"><a href="#cb31-4266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4267"><a href="#cb31-4267" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-4268"><a href="#cb31-4268" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4269"><a href="#cb31-4269" aria-hidden="true" tabindex="-1"></a>soil_funct_md_scores <span class="ot">&lt;-</span> soil_funct_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-4270"><a href="#cb31-4270" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4271"><a href="#cb31-4271" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-4272"><a href="#cb31-4272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4273"><a href="#cb31-4273" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> soil_funct_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-4274"><a href="#cb31-4274" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-4275"><a href="#cb31-4275" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> soil_funct_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-4276"><a href="#cb31-4276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4277"><a href="#cb31-4277" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-4278"><a href="#cb31-4278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4279"><a href="#cb31-4279" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-4280"><a href="#cb31-4280" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-4281"><a href="#cb31-4281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4282"><a href="#cb31-4282" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-4283"><a href="#cb31-4283" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-4284"><a href="#cb31-4284" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-4285"><a href="#cb31-4285" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_md_signif_hits)</span>
<span id="cb31-4286"><a href="#cb31-4286" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_md_signif_hits)</span>
<span id="cb31-4287"><a href="#cb31-4287" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4288"><a href="#cb31-4288" aria-hidden="true" tabindex="-1"></a>                                               soil_funct_md_signif_hits,]</span>
<span id="cb31-4289"><a href="#cb31-4289" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-4290"><a href="#cb31-4290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4291"><a href="#cb31-4291" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-4292"><a href="#cb31-4292" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel))</span>
<span id="cb31-4293"><a href="#cb31-4293" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4294"><a href="#cb31-4294" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4295"><a href="#cb31-4295" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-4296"><a href="#cb31-4296" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-4297"><a href="#cb31-4297" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4298"><a href="#cb31-4298" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4299"><a href="#cb31-4299" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-4300"><a href="#cb31-4300" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel)), </span>
<span id="cb31-4301"><a href="#cb31-4301" aria-hidden="true" tabindex="-1"></a>                       soil_funct_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-4302"><a href="#cb31-4302" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4303"><a href="#cb31-4303" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4304"><a href="#cb31-4304" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-4305"><a href="#cb31-4305" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4306"><a href="#cb31-4306" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb31-4307"><a href="#cb31-4307" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4308"><a href="#cb31-4308" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4309"><a href="#cb31-4309" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and bioenv."</span>)</span>
<span id="cb31-4310"><a href="#cb31-4310" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(soil_funct_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4311"><a href="#cb31-4311" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_soil_funct_bioenv_ind_mantel)))</span>
<span id="cb31-4312"><a href="#cb31-4312" aria-hidden="true" tabindex="-1"></a>soil_funct_sig_diff</span>
<span id="cb31-4313"><a href="#cb31-4313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4314"><a href="#cb31-4314" aria-hidden="true" tabindex="-1"></a>new_soil_funct_md_signif_hits <span class="ot">&lt;-</span> soil_funct_sig_diff</span>
<span id="cb31-4315"><a href="#cb31-4315" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all <span class="ot">&lt;-</span> soil_funct_md_scores[soil_funct_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4316"><a href="#cb31-4316" aria-hidden="true" tabindex="-1"></a>                                                   new_soil_funct_md_signif_hits,]</span>
<span id="cb31-4317"><a href="#cb31-4317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4318"><a href="#cb31-4318" aria-hidden="true" tabindex="-1"></a>envfit_soil_funct_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-4319"><a href="#cb31-4319" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], </span>
<span id="cb31-4320"><a href="#cb31-4320" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-4321"><a href="#cb31-4321" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-4322"><a href="#cb31-4322" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores <span class="ot">&lt;-</span> soil_funct_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-4323"><a href="#cb31-4323" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4324"><a href="#cb31-4324" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-4325"><a href="#cb31-4325" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4326"><a href="#cb31-4326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4327"><a href="#cb31-4327" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-4328"><a href="#cb31-4328" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-4329"><a href="#cb31-4329" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_soil_funct_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-4330"><a href="#cb31-4330" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_asv_signif_hits)</span>
<span id="cb31-4331"><a href="#cb31-4331" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(soil_funct_asv_signif_hits)</span>
<span id="cb31-4332"><a href="#cb31-4332" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif <span class="ot">&lt;-</span> soil_funct_asv_scores[soil_funct_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4333"><a href="#cb31-4333" aria-hidden="true" tabindex="-1"></a>                                                 soil_funct_asv_signif_hits,]</span>
<span id="cb31-4334"><a href="#cb31-4334" aria-hidden="true" tabindex="-1"></a>soil_funct_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-4335"><a href="#cb31-4335" aria-hidden="true" tabindex="-1"></a>soil_funct_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-4336"><a href="#cb31-4336" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(soil_funct_md_signif_all, soil_funct_asv_signif)</span>
<span id="cb31-4337"><a href="#cb31-4337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4338"><a href="#cb31-4338" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb31-4339"><a href="#cb31-4339" aria-hidden="true" tabindex="-1"></a>                                  soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-4340"><a href="#cb31-4340" aria-hidden="true" tabindex="-1"></a>soil_funct_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(soil_funct_bioplot_data, </span>
<span id="cb31-4341"><a href="#cb31-4341" aria-hidden="true" tabindex="-1"></a>                                   soil_funct_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-4342"><a href="#cb31-4342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4343"><a href="#cb31-4343" aria-hidden="true" tabindex="-1"></a><span class="do">## PLOT Code</span></span>
<span id="cb31-4344"><a href="#cb31-4344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4345"><a href="#cb31-4345" aria-hidden="true" tabindex="-1"></a>soil_funct_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(soil_funct_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-4346"><a href="#cb31-4346" aria-hidden="true" tabindex="-1"></a>soil_funct_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4347"><a href="#cb31-4347" aria-hidden="true" tabindex="-1"></a>soil_funct_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((soil_funct_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4348"><a href="#cb31-4348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4349"><a href="#cb31-4349" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, soil_funct_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4350"><a href="#cb31-4350" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, soil_funct_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4351"><a href="#cb31-4351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4352"><a href="#cb31-4352" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-4353"><a href="#cb31-4353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4354"><a href="#cb31-4354" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(soil_funct_plot_data) <span class="sc">+</span></span>
<span id="cb31-4355"><a href="#cb31-4355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-4356"><a href="#cb31-4356" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb31-4357"><a href="#cb31-4357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-4358"><a href="#cb31-4358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-4359"><a href="#cb31-4359" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> soil_funct_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-4360"><a href="#cb31-4360" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>, </span>
<span id="cb31-4361"><a href="#cb31-4361" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>) <span class="sc">+</span></span>
<span id="cb31-4362"><a href="#cb31-4362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> soil_funct_bioplot_data_md, </span>
<span id="cb31-4363"><a href="#cb31-4363" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb31-4364"><a href="#cb31-4364" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-4365"><a href="#cb31-4365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-4366"><a href="#cb31-4366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-4367"><a href="#cb31-4367" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-4368"><a href="#cb31-4368" aria-hidden="true" tabindex="-1"></a>soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb31-4369"><a href="#cb31-4369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4370"><a href="#cb31-4370" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-4371"><a href="#cb31-4371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4372"><a href="#cb31-4372" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4373"><a href="#cb31-4373" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4374"><a href="#cb31-4374" aria-hidden="true" tabindex="-1"></a><span class="do">###### ITS Temperature Adaptation </span><span class="al">###</span></span>
<span id="cb31-4375"><a href="#cb31-4375" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4376"><a href="#cb31-4376" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb31-4377"><a href="#cb31-4377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4378"><a href="#cb31-4378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4379"><a href="#cb31-4379" aria-hidden="true" tabindex="-1"></a>tmp_md <span class="ot">&lt;-</span> its18_select_mc_norm_split_no_ac<span class="sc">$</span>temp_adapt</span>
<span id="cb31-4380"><a href="#cb31-4380" aria-hidden="true" tabindex="-1"></a>tmp_md<span class="sc">$</span>TREAT_T <span class="ot">&lt;-</span> <span class="fu">as.character</span>(tmp_md<span class="sc">$</span>TREAT_T)</span>
<span id="cb31-4381"><a href="#cb31-4381" aria-hidden="true" tabindex="-1"></a>tmp_comm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(its18_select_mc_norm_split_no_ac<span class="sc">$</span>data_loaded))</span>
<span id="cb31-4382"><a href="#cb31-4382" aria-hidden="true" tabindex="-1"></a>temp_adapt_rank <span class="ot">&lt;-</span> <span class="fu">rankindex</span>(tmp_md[, <span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(tmp_md)], tmp_comm, </span>
<span id="cb31-4383"><a href="#cb31-4383" aria-hidden="true" tabindex="-1"></a>          <span class="at">indices =</span> <span class="fu">c</span>(<span class="st">"euc"</span>, <span class="st">"man"</span>, <span class="st">"gow"</span>, <span class="st">"bra"</span>, <span class="st">"kul"</span>), </span>
<span id="cb31-4384"><a href="#cb31-4384" aria-hidden="true" tabindex="-1"></a>          <span class="at">stepacross =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb31-4385"><a href="#cb31-4385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4386"><a href="#cb31-4386" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's run `capscale` using Bray-Curtis. </span></span>
<span id="cb31-4387"><a href="#cb31-4387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4388"><a href="#cb31-4388" aria-hidden="true" tabindex="-1"></a><span class="do">## * Starting properties: AG_Q10, BG_Q10, BP_Q10, CE_Q10, P_Q10, N_Q10, S_Q10, XY_Q10, LP_Q10, PX_Q10, CUEcn, CUEcp, NUE, PUE, Tmin, SI</span></span>
<span id="cb31-4389"><a href="#cb31-4389" aria-hidden="true" tabindex="-1"></a><span class="do">## * Autocorrelated removed: NUE, PUE, P_Q10, SI                                                                        </span></span>
<span id="cb31-4390"><a href="#cb31-4390" aria-hidden="true" tabindex="-1"></a><span class="do">## * Remove for capscale: S_Q10</span></span>
<span id="cb31-4391"><a href="#cb31-4391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4392"><a href="#cb31-4392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4393"><a href="#cb31-4393" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap <span class="ot">&lt;-</span> <span class="fu">capscale</span>(tmp_comm <span class="sc">~</span>  AG_Q10 <span class="sc">+</span> BG_Q10 <span class="sc">+</span> BP_Q10 <span class="sc">+</span> CE_Q10 <span class="sc">+</span> </span>
<span id="cb31-4394"><a href="#cb31-4394" aria-hidden="true" tabindex="-1"></a>                                       N_Q10 <span class="sc">+</span> XY_Q10 <span class="sc">+</span> LP_Q10 <span class="sc">+</span> PX_Q10 <span class="sc">+</span> </span>
<span id="cb31-4395"><a href="#cb31-4395" aria-hidden="true" tabindex="-1"></a>                                       CUEcn <span class="sc">+</span> CUEcp <span class="sc">+</span> Tmin, </span>
<span id="cb31-4396"><a href="#cb31-4396" aria-hidden="true" tabindex="-1"></a>                           tmp_md, <span class="at">dist =</span> <span class="st">"bray"</span>)</span>
<span id="cb31-4397"><a href="#cb31-4397" aria-hidden="true" tabindex="-1"></a>tmp_auto_plt <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(temp_adapt_cap, <span class="at">arrows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-4398"><a href="#cb31-4398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4399"><a href="#cb31-4399" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap) <span class="co"># overall test of the significant of the analysis</span></span>
<span id="cb31-4400"><a href="#cb31-4400" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"axis"</span>, <span class="at">perm.max =</span> <span class="dv">500</span>) <span class="co"># test axes for significance</span></span>
<span id="cb31-4401"><a href="#cb31-4401" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(temp_adapt_cap, <span class="at">by =</span> <span class="st">"terms"</span>, <span class="at">permu =</span> <span class="dv">500</span>) <span class="co"># test for sign. environ. variables</span></span>
<span id="cb31-4402"><a href="#cb31-4402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4403"><a href="#cb31-4403" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"sites"</span>)</span>
<span id="cb31-4404"><a href="#cb31-4404" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4405"><a href="#cb31-4405" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores <span class="ot">&lt;-</span> tmp_samp_scores <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">SampleID =</span> Label)</span>
<span id="cb31-4406"><a href="#cb31-4406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4407"><a href="#cb31-4407" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-4408"><a href="#cb31-4408" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> tmp_md_sub <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"SampleID"</span>)</span>
<span id="cb31-4409"><a href="#cb31-4409" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(tmp_md_sub, tmp_samp_scores, </span>
<span id="cb31-4410"><a href="#cb31-4410" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">by =</span> <span class="st">"SampleID"</span>)</span>
<span id="cb31-4411"><a href="#cb31-4411" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"biplot"</span>)</span>
<span id="cb31-4412"><a href="#cb31-4412" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4413"><a href="#cb31-4413" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_scores <span class="ot">&lt;-</span> temp_adapt_md_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-4414"><a href="#cb31-4414" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4415"><a href="#cb31-4415" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-4416"><a href="#cb31-4416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4417"><a href="#cb31-4417" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> temp_adapt_plot_data[, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb31-4418"><a href="#cb31-4418" aria-hidden="true" tabindex="-1"></a>tmp_samp_scores_sub <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_samp_scores_sub)</span>
<span id="cb31-4419"><a href="#cb31-4419" aria-hidden="true" tabindex="-1"></a>tmp_param_list <span class="ot">&lt;-</span> temp_adapt_md_scores<span class="sc">$</span>parameters</span>
<span id="cb31-4420"><a href="#cb31-4420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4421"><a href="#cb31-4421" aria-hidden="true" tabindex="-1"></a>tmp_md_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(tmp_md,  <span class="at">select =</span>  tmp_param_list)</span>
<span id="cb31-4422"><a href="#cb31-4422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4423"><a href="#cb31-4423" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_md <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, tmp_md_sub,</span>
<span id="cb31-4424"><a href="#cb31-4424" aria-hidden="true" tabindex="-1"></a>                 <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-4425"><a href="#cb31-4425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4426"><a href="#cb31-4426" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-4427"><a href="#cb31-4427" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-4428"><a href="#cb31-4428" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_md<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.4</span>))</span>
<span id="cb31-4429"><a href="#cb31-4429" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-4430"><a href="#cb31-4430" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_md_signif_hits)</span>
<span id="cb31-4431"><a href="#cb31-4431" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4432"><a href="#cb31-4432" aria-hidden="true" tabindex="-1"></a>                                               temp_adapt_md_signif_hits,]</span>
<span id="cb31-4433"><a href="#cb31-4433" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from bioenv analysis."</span>)</span>
<span id="cb31-4434"><a href="#cb31-4434" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel))</span>
<span id="cb31-4435"><a href="#cb31-4435" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4436"><a href="#cb31-4436" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4437"><a href="#cb31-4437" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Significant parameters from envfit analysis."</span>)</span>
<span id="cb31-4438"><a href="#cb31-4438" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif<span class="sc">$</span>parameters</span>
<span id="cb31-4439"><a href="#cb31-4439" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4440"><a href="#cb31-4440" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4441"><a href="#cb31-4441" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in bioenv but not envfit."</span>)</span>
<span id="cb31-4442"><a href="#cb31-4442" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)), </span>
<span id="cb31-4443"><a href="#cb31-4443" aria-hidden="true" tabindex="-1"></a>                       temp_adapt_md_signif<span class="sc">$</span>parameters)</span>
<span id="cb31-4444"><a href="#cb31-4444" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4445"><a href="#cb31-4445" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4446"><a href="#cb31-4446" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit but not bioenv."</span>)</span>
<span id="cb31-4447"><a href="#cb31-4447" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4448"><a href="#cb31-4448" aria-hidden="true" tabindex="-1"></a>              <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-4449"><a href="#cb31-4449" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"_____________________________________"</span>)</span>
<span id="cb31-4450"><a href="#cb31-4450" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-4451"><a href="#cb31-4451" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Found in envfit and  bioenv."</span>)</span>
<span id="cb31-4452"><a href="#cb31-4452" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(temp_adapt_md_signif<span class="sc">$</span>parameters, </span>
<span id="cb31-4453"><a href="#cb31-4453" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">row.names</span>(<span class="fu">summary</span>(its18_temp_adapt_bioenv_ind_mantel)))</span>
<span id="cb31-4454"><a href="#cb31-4454" aria-hidden="true" tabindex="-1"></a>temp_adapt_sig_diff</span>
<span id="cb31-4455"><a href="#cb31-4455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4456"><a href="#cb31-4456" aria-hidden="true" tabindex="-1"></a>new_temp_adapt_md_signif_hits <span class="ot">&lt;-</span> temp_adapt_sig_diff[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb31-4457"><a href="#cb31-4457" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all <span class="ot">&lt;-</span> temp_adapt_md_scores[temp_adapt_md_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4458"><a href="#cb31-4458" aria-hidden="true" tabindex="-1"></a>                                                   new_temp_adapt_md_signif_hits,]</span>
<span id="cb31-4459"><a href="#cb31-4459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4460"><a href="#cb31-4460" aria-hidden="true" tabindex="-1"></a>envfit_temp_adapt_asv <span class="ot">&lt;-</span> <span class="fu">envfit</span>(tmp_samp_scores_sub, </span>
<span id="cb31-4461"><a href="#cb31-4461" aria-hidden="true" tabindex="-1"></a>                                tmp_comm[, <span class="fu">order</span>(<span class="fu">colSums</span>(<span class="sc">-</span>tmp_comm))][, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb31-4462"><a href="#cb31-4462" aria-hidden="true" tabindex="-1"></a>                                <span class="at">perm =</span> <span class="dv">1000</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb31-4463"><a href="#cb31-4463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4464"><a href="#cb31-4464" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(tmp_auto_plt<span class="sc">$</span>plot_env<span class="sc">$</span>obj, Score <span class="sc">==</span> <span class="st">"species"</span>)</span>
<span id="cb31-4465"><a href="#cb31-4465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4466"><a href="#cb31-4466" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores <span class="ot">&lt;-</span> temp_adapt_asv_scores <span class="sc">%&gt;%</span> </span>
<span id="cb31-4467"><a href="#cb31-4467" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameters =</span> Label, <span class="at">.before =</span> CAP1) <span class="sc">%&gt;%</span></span>
<span id="cb31-4468"><a href="#cb31-4468" aria-hidden="true" tabindex="-1"></a>                         tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">"Label"</span>)</span>
<span id="cb31-4469"><a href="#cb31-4469" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_scores[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-4470"><a href="#cb31-4470" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">subset</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals, </span>
<span id="cb31-4471"><a href="#cb31-4471" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>pvals </span>
<span id="cb31-4472"><a href="#cb31-4472" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> envfit_temp_adapt_asv<span class="sc">$</span>vectors<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.5</span>))</span>
<span id="cb31-4473"><a href="#cb31-4473" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-4474"><a href="#cb31-4474" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif_hits <span class="ot">&lt;-</span> <span class="fu">rownames</span>(temp_adapt_asv_signif_hits)</span>
<span id="cb31-4475"><a href="#cb31-4475" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif <span class="ot">&lt;-</span> temp_adapt_asv_scores[temp_adapt_asv_scores<span class="sc">$</span>parameters <span class="sc">%in%</span> </span>
<span id="cb31-4476"><a href="#cb31-4476" aria-hidden="true" tabindex="-1"></a>                                                 temp_adapt_asv_signif_hits,]</span>
<span id="cb31-4477"><a href="#cb31-4477" aria-hidden="true" tabindex="-1"></a>temp_adapt_md_signif_all<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"metadata"</span></span>
<span id="cb31-4478"><a href="#cb31-4478" aria-hidden="true" tabindex="-1"></a>temp_adapt_asv_signif<span class="sc">$</span>variable_type <span class="ot">&lt;-</span> <span class="st">"ASV"</span></span>
<span id="cb31-4479"><a href="#cb31-4479" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_adapt_md_signif_all, temp_adapt_asv_signif)</span>
<span id="cb31-4480"><a href="#cb31-4480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4481"><a href="#cb31-4481" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_md <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-4482"><a href="#cb31-4482" aria-hidden="true" tabindex="-1"></a>                                  temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"metadata"</span>)</span>
<span id="cb31-4483"><a href="#cb31-4483" aria-hidden="true" tabindex="-1"></a>temp_adapt_bioplot_data_asv <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp_adapt_bioplot_data, </span>
<span id="cb31-4484"><a href="#cb31-4484" aria-hidden="true" tabindex="-1"></a>                                   temp_adapt_bioplot_data<span class="sc">$</span>variable_type <span class="sc">==</span> <span class="st">"ASV"</span>)</span>
<span id="cb31-4485"><a href="#cb31-4485" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(temp_adapt_cap<span class="sc">$</span>CCA<span class="sc">$</span>eig[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-4486"><a href="#cb31-4486" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap1 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">1</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4487"><a href="#cb31-4487" aria-hidden="true" tabindex="-1"></a>temp_adapt_cap2 <span class="ot">&lt;-</span> <span class="fu">signif</span>((temp_adapt_cap_vals[<span class="dv">2</span>,] <span class="sc">*</span> <span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb31-4488"><a href="#cb31-4488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4489"><a href="#cb31-4489" aria-hidden="true" tabindex="-1"></a>cpa1_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP1"</span>, <span class="st">" ("</span>, temp_adapt_cap1, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4490"><a href="#cb31-4490" aria-hidden="true" tabindex="-1"></a>cpa2_lab <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"CAP2"</span>, <span class="st">" ("</span>, temp_adapt_cap2, <span class="st">"%)"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-4491"><a href="#cb31-4491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4492"><a href="#cb31-4492" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-4493"><a href="#cb31-4493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4494"><a href="#cb31-4494" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(temp_adapt_plot_data) <span class="sc">+</span></span>
<span id="cb31-4495"><a href="#cb31-4495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2,</span>
<span id="cb31-4496"><a href="#cb31-4496" aria-hidden="true" tabindex="-1"></a>                           <span class="at">colour =</span> TREAT_T), <span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb31-4497"><a href="#cb31-4497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) <span class="sc">+</span></span>
<span id="cb31-4498"><a href="#cb31-4498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> CAP1, <span class="at">yend =</span> CAP2),</span>
<span id="cb31-4499"><a href="#cb31-4499" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> temp_adapt_bioplot_data_md, <span class="at">linetype =</span> <span class="st">"solid"</span>,</span>
<span id="cb31-4500"><a href="#cb31-4500" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>)), <span class="at">size =</span> <span class="fl">0.9</span>,</span>
<span id="cb31-4501"><a href="#cb31-4501" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#191919"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb31-4502"><a href="#cb31-4502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> temp_adapt_bioplot_data_md, </span>
<span id="cb31-4503"><a href="#cb31-4503" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> CAP1, <span class="at">y =</span> CAP2, <span class="at">label =</span> parameters), <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb31-4504"><a href="#cb31-4504" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.1</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-4505"><a href="#cb31-4505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span> </span>
<span id="cb31-4506"><a href="#cb31-4506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> cpa1_lab, </span>
<span id="cb31-4507"><a href="#cb31-4507" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> cpa2_lab)</span>
<span id="cb31-4508"><a href="#cb31-4508" aria-hidden="true" tabindex="-1"></a>temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb31-4509"><a href="#cb31-4509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4510"><a href="#cb31-4510" aria-hidden="true" tabindex="-1"></a>its18_edaphic_plot <span class="ot">&lt;-</span> edaphic_plot</span>
<span id="cb31-4511"><a href="#cb31-4511" aria-hidden="true" tabindex="-1"></a>its18_soil_funct_plot <span class="ot">&lt;-</span> soil_funct_plot</span>
<span id="cb31-4512"><a href="#cb31-4512" aria-hidden="true" tabindex="-1"></a>its18_temp_adapt_plot <span class="ot">&lt;-</span> temp_adapt_plot</span>
<span id="cb31-4513"><a href="#cb31-4513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4514"><a href="#cb31-4514" aria-hidden="true" tabindex="-1"></a><span class="do">### BUILD the final Plot</span></span>
<span id="cb31-4515"><a href="#cb31-4515" aria-hidden="true" tabindex="-1"></a>tmp_plot_final <span class="ot">&lt;-</span> (ssu18_edaphic_plot <span class="sc">|</span> ssu18_soil_funct_plot) <span class="sc">/</span> (its18_edaphic_plot <span class="sc">|</span> its18_soil_funct_plot) <span class="sc">+</span></span>
<span id="cb31-4516"><a href="#cb31-4516" aria-hidden="true" tabindex="-1"></a>   patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"a"</span>, </span>
<span id="cb31-4517"><a href="#cb31-4517" aria-hidden="true" tabindex="-1"></a>                              <span class="at">title =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-4518"><a href="#cb31-4518" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subtitle =</span> <span class="cn">NULL</span>, </span>
<span id="cb31-4519"><a href="#cb31-4519" aria-hidden="true" tabindex="-1"></a>                              <span class="at">caption =</span> <span class="cn">NULL</span>) </span>
<span id="cb31-4520"><a href="#cb31-4520" aria-hidden="true" tabindex="-1"></a>tmp_plot_final <span class="ot">&lt;-</span> tmp_plot_final <span class="sc">+</span> </span>
<span id="cb31-4521"><a href="#cb31-4521" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span></span>
<span id="cb31-4522"><a href="#cb31-4522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb31-4523"><a href="#cb31-4523" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">24</span>),</span>
<span id="cb31-4524"><a href="#cb31-4524" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">31</span>), </span>
<span id="cb31-4525"><a href="#cb31-4525" aria-hidden="true" tabindex="-1"></a>             <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>), </span>
<span id="cb31-4526"><a href="#cb31-4526" aria-hidden="true" tabindex="-1"></a>             <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)) </span>
<span id="cb31-4527"><a href="#cb31-4527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4528"><a href="#cb31-4528" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(tmp_plot_final, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_5/"</span>, </span>
<span id="cb31-4529"><a href="#cb31-4529" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span>  <span class="st">"Extended_Data_Figure_5.png"</span>, </span>
<span id="cb31-4530"><a href="#cb31-4530" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">8398</span>, <span class="at">width =</span> <span class="dv">7485</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-4531"><a href="#cb31-4531" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb31-4532"><a href="#cb31-4532" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(tmp_plot_final, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_5/"</span>, </span>
<span id="cb31-4533"><a href="#cb31-4533" aria-hidden="true" tabindex="-1"></a>                <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_5.pdf"</span>, </span>
<span id="cb31-4534"><a href="#cb31-4534" aria-hidden="true" tabindex="-1"></a>                <span class="at">height =</span> <span class="dv">8398</span>, <span class="at">width =</span> <span class="dv">7485</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-4535"><a href="#cb31-4535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-4536"><a href="#cb31-4536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4537"><a href="#cb31-4537" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 6</span></span>
<span id="cb31-4538"><a href="#cb31-4538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4539"><a href="#cb31-4539" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-4540"><a href="#cb31-4540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4541"><a href="#cb31-4541" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-4542"><a href="#cb31-4542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4543"><a href="#cb31-4543" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Graphic convertor</span><span class="co">](https://www.lemkesoft.de/en/products/graphicconverter/)</span>. </span>
<span id="cb31-4544"><a href="#cb31-4544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4545"><a href="#cb31-4545" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-4546"><a href="#cb31-4546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4547"><a href="#cb31-4547" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-4548"><a href="#cb31-4548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4549"><a href="#cb31-4549" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-4550"><a href="#cb31-4550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4551"><a href="#cb31-4551" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.png)</span></span>
<span id="cb31-4552"><a href="#cb31-4552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4553"><a href="#cb31-4553" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-4554"><a href="#cb31-4554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4555"><a href="#cb31-4555" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_6.png)</span></span>
<span id="cb31-4556"><a href="#cb31-4556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4557"><a href="#cb31-4557" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-4558"><a href="#cb31-4558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4559"><a href="#cb31-4559" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-4560"><a href="#cb31-4560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4561"><a href="#cb31-4561" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-4562"><a href="#cb31-4562" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 6 data file</span><span class="co">](include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.csv)</span>  </span>
<span id="cb31-4563"><a href="#cb31-4563" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-4564"><a href="#cb31-4564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4565"><a href="#cb31-4565" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-4566"><a href="#cb31-4566" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 6 raw pdf</span><span class="co">](include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.pdf)</span></span>
<span id="cb31-4567"><a href="#cb31-4567" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-4568"><a href="#cb31-4568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4569"><a href="#cb31-4569" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-4570"><a href="#cb31-4570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4573"><a href="#cb31-4573" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-4574"><a href="#cb31-4574" aria-hidden="true" tabindex="-1"></a><span class="co">#clear workspace</span></span>
<span id="cb31-4575"><a href="#cb31-4575" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Extended Data Figure 6"</span></span>
<span id="cb31-4576"><a href="#cb31-4576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4577"><a href="#cb31-4577" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-4578"><a href="#cb31-4578" aria-hidden="true" tabindex="-1"></a><span class="co">#load data</span></span>
<span id="cb31-4579"><a href="#cb31-4579" aria-hidden="true" tabindex="-1"></a>diversity_meta <span class="ot">&lt;-</span></span>
<span id="cb31-4580"><a href="#cb31-4580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="st">"include/pub/EXD/EXD_Figure_6/Extended_Data_Figure_6.csv"</span>, <span class="at">header =</span> T)</span>
<span id="cb31-4581"><a href="#cb31-4581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4582"><a href="#cb31-4582" aria-hidden="true" tabindex="-1"></a><span class="do">##################### Function for arranging ggplots. </span></span>
<span id="cb31-4583"><a href="#cb31-4583" aria-hidden="true" tabindex="-1"></a><span class="do">## use png(); arrange(p1, p2, ncol=1); dev.off() to save.</span></span>
<span id="cb31-4584"><a href="#cb31-4584" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(grid)</span>
<span id="cb31-4585"><a href="#cb31-4585" aria-hidden="true" tabindex="-1"></a>vp.layout <span class="ot">&lt;-</span></span>
<span id="cb31-4586"><a href="#cb31-4586" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x, y)</span>
<span id="cb31-4587"><a href="#cb31-4587" aria-hidden="true" tabindex="-1"></a>    <span class="fu">viewport</span>(<span class="at">layout.pos.row =</span> x, <span class="at">layout.pos.col =</span> y)</span>
<span id="cb31-4588"><a href="#cb31-4588" aria-hidden="true" tabindex="-1"></a>arrange_ggplot2 <span class="ot">&lt;-</span></span>
<span id="cb31-4589"><a href="#cb31-4589" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(...,</span>
<span id="cb31-4590"><a href="#cb31-4590" aria-hidden="true" tabindex="-1"></a>           <span class="at">nrow =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-4591"><a href="#cb31-4591" aria-hidden="true" tabindex="-1"></a>           <span class="at">ncol =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-4592"><a href="#cb31-4592" aria-hidden="true" tabindex="-1"></a>           <span class="at">as.table =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb31-4593"><a href="#cb31-4593" aria-hidden="true" tabindex="-1"></a>    dots <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb31-4594"><a href="#cb31-4594" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(dots)</span>
<span id="cb31-4595"><a href="#cb31-4595" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(nrow) <span class="sc">&amp;</span></span>
<span id="cb31-4596"><a href="#cb31-4596" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.null</span>(ncol)) {</span>
<span id="cb31-4597"><a href="#cb31-4597" aria-hidden="true" tabindex="-1"></a>      nrow <span class="ot">=</span> <span class="fu">floor</span>(n <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb31-4598"><a href="#cb31-4598" aria-hidden="true" tabindex="-1"></a>      ncol <span class="ot">=</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> nrow)</span>
<span id="cb31-4599"><a href="#cb31-4599" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-4600"><a href="#cb31-4600" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(nrow)) {</span>
<span id="cb31-4601"><a href="#cb31-4601" aria-hidden="true" tabindex="-1"></a>      nrow <span class="ot">=</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> ncol)</span>
<span id="cb31-4602"><a href="#cb31-4602" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-4603"><a href="#cb31-4603" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(ncol)) {</span>
<span id="cb31-4604"><a href="#cb31-4604" aria-hidden="true" tabindex="-1"></a>      ncol <span class="ot">=</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> nrow)</span>
<span id="cb31-4605"><a href="#cb31-4605" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-4606"><a href="#cb31-4606" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span><span class="al">NOTE</span><span class="do"> see n2mfrow in grDevices for possible alternative</span></span>
<span id="cb31-4607"><a href="#cb31-4607" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grid.newpage</span>()</span>
<span id="cb31-4608"><a href="#cb31-4608" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pushViewport</span>(<span class="fu">viewport</span>(<span class="at">layout =</span> <span class="fu">grid.layout</span>(nrow, ncol)))</span>
<span id="cb31-4609"><a href="#cb31-4609" aria-hidden="true" tabindex="-1"></a>    ii.p <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb31-4610"><a href="#cb31-4610" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ii.row <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, nrow)) {</span>
<span id="cb31-4611"><a href="#cb31-4611" aria-hidden="true" tabindex="-1"></a>      ii.table.row <span class="ot">&lt;-</span> ii.row</span>
<span id="cb31-4612"><a href="#cb31-4612" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (as.table) {</span>
<span id="cb31-4613"><a href="#cb31-4613" aria-hidden="true" tabindex="-1"></a>        ii.table.row <span class="ot">&lt;-</span> nrow <span class="sc">-</span> ii.table.row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb31-4614"><a href="#cb31-4614" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb31-4615"><a href="#cb31-4615" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (ii.col <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, ncol)) {</span>
<span id="cb31-4616"><a href="#cb31-4616" aria-hidden="true" tabindex="-1"></a>        ii.table <span class="ot">&lt;-</span> ii.p</span>
<span id="cb31-4617"><a href="#cb31-4617" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (ii.p <span class="sc">&gt;</span> n)</span>
<span id="cb31-4618"><a href="#cb31-4618" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span></span>
<span id="cb31-4619"><a href="#cb31-4619" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(dots[[ii.table]], <span class="at">vp =</span> <span class="fu">vp.layout</span>(ii.table.row, ii.col))</span>
<span id="cb31-4620"><a href="#cb31-4620" aria-hidden="true" tabindex="-1"></a>        ii.p <span class="ot">&lt;-</span> ii.p <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb31-4621"><a href="#cb31-4621" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb31-4622"><a href="#cb31-4622" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-4623"><a href="#cb31-4623" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-4624"><a href="#cb31-4624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4625"><a href="#cb31-4625" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################</span></span>
<span id="cb31-4626"><a href="#cb31-4626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4627"><a href="#cb31-4627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4628"><a href="#cb31-4628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4629"><a href="#cb31-4629" aria-hidden="true" tabindex="-1"></a><span class="co">#long format</span></span>
<span id="cb31-4630"><a href="#cb31-4630" aria-hidden="true" tabindex="-1"></a>diversity_meta.long <span class="ot">&lt;-</span> diversity_meta <span class="sc">%&gt;%</span></span>
<span id="cb31-4631"><a href="#cb31-4631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(</span>
<span id="cb31-4632"><a href="#cb31-4632" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> measure,</span>
<span id="cb31-4633"><a href="#cb31-4633" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> value,</span>
<span id="cb31-4634"><a href="#cb31-4634" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>index,</span>
<span id="cb31-4635"><a href="#cb31-4635" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>PLOT,</span>
<span id="cb31-4636"><a href="#cb31-4636" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>SEASON,</span>
<span id="cb31-4637"><a href="#cb31-4637" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>TREAT,</span>
<span id="cb31-4638"><a href="#cb31-4638" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>PAIR,</span>
<span id="cb31-4639"><a href="#cb31-4639" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>TEMP_AV_ACROSSPLOTS,</span>
<span id="cb31-4640"><a href="#cb31-4640" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">FALSE</span></span>
<span id="cb31-4641"><a href="#cb31-4641" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4642"><a href="#cb31-4642" aria-hidden="true" tabindex="-1"></a>diversity_meta.long<span class="sc">$</span>measure <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(diversity_meta.long<span class="sc">$</span>measure)</span>
<span id="cb31-4643"><a href="#cb31-4643" aria-hidden="true" tabindex="-1"></a>diversity_meta.long<span class="sc">$</span>TEMP_AV_ACROSSPLOTS <span class="ot">&lt;-</span></span>
<span id="cb31-4644"><a href="#cb31-4644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>(diversity_meta.long<span class="sc">$</span>TEMP_AV_ACROSSPLOTS)</span>
<span id="cb31-4645"><a href="#cb31-4645" aria-hidden="true" tabindex="-1"></a><span class="do">## NEEDed for Figure 2</span></span>
<span id="cb31-4646"><a href="#cb31-4646" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(diversity_meta.long, "include/pub/MAIN/diversity_meta.long.rds")</span></span>
<span id="cb31-4647"><a href="#cb31-4647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4648"><a href="#cb31-4648" aria-hidden="true" tabindex="-1"></a><span class="co">#subset of long format, with values to plot in facet - in order</span></span>
<span id="cb31-4649"><a href="#cb31-4649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4650"><a href="#cb31-4650" aria-hidden="true" tabindex="-1"></a><span class="co">#edaphic metadata</span></span>
<span id="cb31-4651"><a href="#cb31-4651" aria-hidden="true" tabindex="-1"></a>diversity_meta.env <span class="ot">&lt;-</span></span>
<span id="cb31-4652"><a href="#cb31-4652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(</span>
<span id="cb31-4653"><a href="#cb31-4653" aria-hidden="true" tabindex="-1"></a>    diversity_meta.long,</span>
<span id="cb31-4654"><a href="#cb31-4654" aria-hidden="true" tabindex="-1"></a>    measure <span class="sc">==</span> <span class="st">"pH"</span> <span class="sc">|</span></span>
<span id="cb31-4655"><a href="#cb31-4655" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"H2O"</span> <span class="sc">|</span></span>
<span id="cb31-4656"><a href="#cb31-4656" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"NH4"</span> <span class="sc">|</span></span>
<span id="cb31-4657"><a href="#cb31-4657" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"NO3"</span> <span class="sc">|</span></span>
<span id="cb31-4658"><a href="#cb31-4658" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"resinP"</span> <span class="sc">|</span></span>
<span id="cb31-4659"><a href="#cb31-4659" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"DOC"</span> <span class="sc">|</span> measure <span class="sc">==</span> <span class="st">"DON"</span> <span class="sc">|</span> measure <span class="sc">==</span> <span class="st">"ECEC"</span></span>
<span id="cb31-4660"><a href="#cb31-4660" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4661"><a href="#cb31-4661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4662"><a href="#cb31-4662" aria-hidden="true" tabindex="-1"></a><span class="co">#enzymes per mic C</span></span>
<span id="cb31-4663"><a href="#cb31-4663" aria-hidden="true" tabindex="-1"></a>diversity_meta.enzmic <span class="ot">&lt;-</span></span>
<span id="cb31-4664"><a href="#cb31-4664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(</span>
<span id="cb31-4665"><a href="#cb31-4665" aria-hidden="true" tabindex="-1"></a>    diversity_meta.long,</span>
<span id="cb31-4666"><a href="#cb31-4666" aria-hidden="true" tabindex="-1"></a>    measure <span class="sc">==</span> <span class="st">"AG_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4667"><a href="#cb31-4667" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"BG_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4668"><a href="#cb31-4668" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"BIS_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4669"><a href="#cb31-4669" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"CEL_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4670"><a href="#cb31-4670" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"MUP_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4671"><a href="#cb31-4671" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"NA_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4672"><a href="#cb31-4672" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"S_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4673"><a href="#cb31-4673" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"XYL_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4674"><a href="#cb31-4674" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"LEU_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4675"><a href="#cb31-4675" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"POX_micC"</span> <span class="sc">|</span></span>
<span id="cb31-4676"><a href="#cb31-4676" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"micC"</span> <span class="sc">|</span> measure <span class="sc">==</span> <span class="st">"micN"</span> <span class="sc">|</span> measure <span class="sc">==</span> <span class="st">"micP"</span></span>
<span id="cb31-4677"><a href="#cb31-4677" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4678"><a href="#cb31-4678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4679"><a href="#cb31-4679" aria-hidden="true" tabindex="-1"></a><span class="co">#Temp response- growth and enzymes</span></span>
<span id="cb31-4680"><a href="#cb31-4680" aria-hidden="true" tabindex="-1"></a>diversity_meta.Tresponse <span class="ot">&lt;-</span></span>
<span id="cb31-4681"><a href="#cb31-4681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(</span>
<span id="cb31-4682"><a href="#cb31-4682" aria-hidden="true" tabindex="-1"></a>    diversity_meta.long,</span>
<span id="cb31-4683"><a href="#cb31-4683" aria-hidden="true" tabindex="-1"></a>    measure <span class="sc">==</span> <span class="st">"Tmin"</span> <span class="sc">|</span></span>
<span id="cb31-4684"><a href="#cb31-4684" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"SI"</span> <span class="sc">|</span></span>
<span id="cb31-4685"><a href="#cb31-4685" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"CUEcn"</span> <span class="sc">|</span></span>
<span id="cb31-4686"><a href="#cb31-4686" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"CUEcp"</span> <span class="sc">|</span></span>
<span id="cb31-4687"><a href="#cb31-4687" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"AG_Q10"</span> <span class="sc">|</span></span>
<span id="cb31-4688"><a href="#cb31-4688" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"BG_Q10"</span> <span class="sc">|</span></span>
<span id="cb31-4689"><a href="#cb31-4689" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"BIS_Q10"</span> <span class="sc">|</span></span>
<span id="cb31-4690"><a href="#cb31-4690" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"CEL_Q10"</span> <span class="sc">|</span></span>
<span id="cb31-4691"><a href="#cb31-4691" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"MUP_Q10"</span> <span class="sc">|</span></span>
<span id="cb31-4692"><a href="#cb31-4692" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"NA_Q10"</span> <span class="sc">|</span></span>
<span id="cb31-4693"><a href="#cb31-4693" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"S_Q10"</span> <span class="sc">|</span></span>
<span id="cb31-4694"><a href="#cb31-4694" aria-hidden="true" tabindex="-1"></a>      measure <span class="sc">==</span> <span class="st">"XYL_Q10"</span> <span class="sc">|</span> measure <span class="sc">==</span> <span class="st">"LEU_Q10"</span> <span class="sc">|</span> measure <span class="sc">==</span> <span class="st">"POX_Q10"</span></span>
<span id="cb31-4695"><a href="#cb31-4695" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4696"><a href="#cb31-4696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4697"><a href="#cb31-4697" aria-hidden="true" tabindex="-1"></a>diversity_meta.Tresponse<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-4698"><a href="#cb31-4698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(</span>
<span id="cb31-4699"><a href="#cb31-4699" aria-hidden="true" tabindex="-1"></a>    diversity_meta.Tresponse<span class="sc">$</span>measure,</span>
<span id="cb31-4700"><a href="#cb31-4700" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb31-4701"><a href="#cb31-4701" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Tmin"</span>,</span>
<span id="cb31-4702"><a href="#cb31-4702" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SI"</span>,</span>
<span id="cb31-4703"><a href="#cb31-4703" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CUEcn"</span>,</span>
<span id="cb31-4704"><a href="#cb31-4704" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CUEcp"</span>,</span>
<span id="cb31-4705"><a href="#cb31-4705" aria-hidden="true" tabindex="-1"></a>      <span class="st">"AG_Q10"</span>,</span>
<span id="cb31-4706"><a href="#cb31-4706" aria-hidden="true" tabindex="-1"></a>      <span class="st">"BG_Q10"</span>,</span>
<span id="cb31-4707"><a href="#cb31-4707" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CEL_Q10"</span>,</span>
<span id="cb31-4708"><a href="#cb31-4708" aria-hidden="true" tabindex="-1"></a>      <span class="st">"XYL_Q10"</span>,</span>
<span id="cb31-4709"><a href="#cb31-4709" aria-hidden="true" tabindex="-1"></a>      <span class="st">"POX_Q10"</span>,</span>
<span id="cb31-4710"><a href="#cb31-4710" aria-hidden="true" tabindex="-1"></a>      <span class="st">"NA_Q10"</span>,</span>
<span id="cb31-4711"><a href="#cb31-4711" aria-hidden="true" tabindex="-1"></a>      <span class="st">"LEU_Q10"</span>,</span>
<span id="cb31-4712"><a href="#cb31-4712" aria-hidden="true" tabindex="-1"></a>      <span class="st">"MUP_Q10"</span>,</span>
<span id="cb31-4713"><a href="#cb31-4713" aria-hidden="true" tabindex="-1"></a>      <span class="st">"BIS_Q10"</span>,</span>
<span id="cb31-4714"><a href="#cb31-4714" aria-hidden="true" tabindex="-1"></a>      <span class="st">"S_Q10"</span></span>
<span id="cb31-4715"><a href="#cb31-4715" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4716"><a href="#cb31-4716" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4717"><a href="#cb31-4717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4718"><a href="#cb31-4718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4719"><a href="#cb31-4719" aria-hidden="true" tabindex="-1"></a><span class="co">#relabel</span></span>
<span id="cb31-4720"><a href="#cb31-4720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4721"><a href="#cb31-4721" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.env <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.env <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"C"</span>] <span class="ot">&lt;-</span> <span class="st">"control"</span></span>
<span id="cb31-4722"><a href="#cb31-4722" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.env <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.env <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"W3"</span>] <span class="ot">&lt;-</span> <span class="st">"+3°C"</span></span>
<span id="cb31-4723"><a href="#cb31-4723" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.env <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.env <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"W8"</span>] <span class="ot">&lt;-</span> <span class="st">"+8°C"</span></span>
<span id="cb31-4724"><a href="#cb31-4724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4725"><a href="#cb31-4725" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.Tresponse <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.Tresponse <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"C"</span>] <span class="ot">&lt;-</span> <span class="st">"control"</span></span>
<span id="cb31-4726"><a href="#cb31-4726" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.Tresponse <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.Tresponse <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"W3"</span>] <span class="ot">&lt;-</span> <span class="st">"+3°C"</span></span>
<span id="cb31-4727"><a href="#cb31-4727" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.Tresponse <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.Tresponse <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"W8"</span>] <span class="ot">&lt;-</span> <span class="st">"+8°C"</span></span>
<span id="cb31-4728"><a href="#cb31-4728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4729"><a href="#cb31-4729" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.enzmic <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.enzmic <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"C"</span>] <span class="ot">&lt;-</span> <span class="st">"control"</span></span>
<span id="cb31-4730"><a href="#cb31-4730" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.enzmic <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.enzmic <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"W3"</span>] <span class="ot">&lt;-</span> <span class="st">"+3°C"</span></span>
<span id="cb31-4731"><a href="#cb31-4731" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diversity_meta.enzmic <span class="sc">$</span>TREAT)[<span class="fu">levels</span>(diversity_meta.enzmic <span class="sc">$</span>TREAT) <span class="sc">==</span> <span class="st">"W8"</span>] <span class="ot">&lt;-</span> <span class="st">"+8°C"</span></span>
<span id="cb31-4732"><a href="#cb31-4732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4733"><a href="#cb31-4733" aria-hidden="true" tabindex="-1"></a><span class="co">#reorder factor levels for plots</span></span>
<span id="cb31-4734"><a href="#cb31-4734" aria-hidden="true" tabindex="-1"></a>diversity_meta.env<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-4735"><a href="#cb31-4735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(</span>
<span id="cb31-4736"><a href="#cb31-4736" aria-hidden="true" tabindex="-1"></a>    diversity_meta.env<span class="sc">$</span>measure,</span>
<span id="cb31-4737"><a href="#cb31-4737" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"H2O"</span>, <span class="st">"pH"</span>, <span class="st">"ECEC"</span>, <span class="st">"DOC"</span>, <span class="st">"DON"</span>, <span class="st">"NO3"</span>, <span class="st">"NH4"</span>, <span class="st">"resinP"</span>)</span>
<span id="cb31-4738"><a href="#cb31-4738" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4739"><a href="#cb31-4739" aria-hidden="true" tabindex="-1"></a>diversity_meta.Tresponse<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-4740"><a href="#cb31-4740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(</span>
<span id="cb31-4741"><a href="#cb31-4741" aria-hidden="true" tabindex="-1"></a>    diversity_meta.Tresponse<span class="sc">$</span>measure,</span>
<span id="cb31-4742"><a href="#cb31-4742" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb31-4743"><a href="#cb31-4743" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Tmin"</span>,</span>
<span id="cb31-4744"><a href="#cb31-4744" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SI"</span>,</span>
<span id="cb31-4745"><a href="#cb31-4745" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CUEcn"</span>,</span>
<span id="cb31-4746"><a href="#cb31-4746" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CUEcp"</span>,</span>
<span id="cb31-4747"><a href="#cb31-4747" aria-hidden="true" tabindex="-1"></a>      <span class="st">"AG_Q10"</span>,</span>
<span id="cb31-4748"><a href="#cb31-4748" aria-hidden="true" tabindex="-1"></a>      <span class="st">"BG_Q10"</span>,</span>
<span id="cb31-4749"><a href="#cb31-4749" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CEL_Q10"</span>,</span>
<span id="cb31-4750"><a href="#cb31-4750" aria-hidden="true" tabindex="-1"></a>      <span class="st">"XYL_Q10"</span>,</span>
<span id="cb31-4751"><a href="#cb31-4751" aria-hidden="true" tabindex="-1"></a>      <span class="st">"POX_Q10"</span>,</span>
<span id="cb31-4752"><a href="#cb31-4752" aria-hidden="true" tabindex="-1"></a>      <span class="st">"NA_Q10"</span>,</span>
<span id="cb31-4753"><a href="#cb31-4753" aria-hidden="true" tabindex="-1"></a>      <span class="st">"LEU_Q10"</span>,</span>
<span id="cb31-4754"><a href="#cb31-4754" aria-hidden="true" tabindex="-1"></a>      <span class="st">"MUP_Q10"</span>,</span>
<span id="cb31-4755"><a href="#cb31-4755" aria-hidden="true" tabindex="-1"></a>      <span class="st">"BIS_Q10"</span>,</span>
<span id="cb31-4756"><a href="#cb31-4756" aria-hidden="true" tabindex="-1"></a>      <span class="st">"S_Q10"</span></span>
<span id="cb31-4757"><a href="#cb31-4757" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4758"><a href="#cb31-4758" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4759"><a href="#cb31-4759" aria-hidden="true" tabindex="-1"></a>diversity_meta.enzmic<span class="sc">$</span>measure <span class="ot">&lt;-</span></span>
<span id="cb31-4760"><a href="#cb31-4760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(</span>
<span id="cb31-4761"><a href="#cb31-4761" aria-hidden="true" tabindex="-1"></a>    diversity_meta.enzmic<span class="sc">$</span>measure,</span>
<span id="cb31-4762"><a href="#cb31-4762" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb31-4763"><a href="#cb31-4763" aria-hidden="true" tabindex="-1"></a>      <span class="st">"micC"</span>,</span>
<span id="cb31-4764"><a href="#cb31-4764" aria-hidden="true" tabindex="-1"></a>      <span class="st">"micN"</span>,</span>
<span id="cb31-4765"><a href="#cb31-4765" aria-hidden="true" tabindex="-1"></a>      <span class="st">"micP"</span>,</span>
<span id="cb31-4766"><a href="#cb31-4766" aria-hidden="true" tabindex="-1"></a>      <span class="st">"AG_micC"</span>,</span>
<span id="cb31-4767"><a href="#cb31-4767" aria-hidden="true" tabindex="-1"></a>      <span class="st">"BG_micC"</span>,</span>
<span id="cb31-4768"><a href="#cb31-4768" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CEL_micC"</span>,</span>
<span id="cb31-4769"><a href="#cb31-4769" aria-hidden="true" tabindex="-1"></a>      <span class="st">"XYL_micC"</span>,</span>
<span id="cb31-4770"><a href="#cb31-4770" aria-hidden="true" tabindex="-1"></a>      <span class="st">"POX_micC"</span>,</span>
<span id="cb31-4771"><a href="#cb31-4771" aria-hidden="true" tabindex="-1"></a>      <span class="st">"NA_micC"</span>,</span>
<span id="cb31-4772"><a href="#cb31-4772" aria-hidden="true" tabindex="-1"></a>      <span class="st">"LEU_micC"</span>,</span>
<span id="cb31-4773"><a href="#cb31-4773" aria-hidden="true" tabindex="-1"></a>      <span class="st">"MUP_micC"</span>,</span>
<span id="cb31-4774"><a href="#cb31-4774" aria-hidden="true" tabindex="-1"></a>      <span class="st">"BIS_micC"</span>,</span>
<span id="cb31-4775"><a href="#cb31-4775" aria-hidden="true" tabindex="-1"></a>      <span class="st">"S_micC"</span></span>
<span id="cb31-4776"><a href="#cb31-4776" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4777"><a href="#cb31-4777" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4778"><a href="#cb31-4778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4779"><a href="#cb31-4779" aria-hidden="true" tabindex="-1"></a>plot.diversity_meta.env <span class="ot">&lt;-</span></span>
<span id="cb31-4780"><a href="#cb31-4780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(diversity_meta.env, <span class="fu">aes</span>(<span class="at">x =</span> TREAT, <span class="at">y =</span> value), <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb31-4781"><a href="#cb31-4781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb31-4782"><a href="#cb31-4782" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> diversity_meta.env,</span>
<span id="cb31-4783"><a href="#cb31-4783" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(TREAT, value , <span class="at">fill =</span> TREAT),</span>
<span id="cb31-4784"><a href="#cb31-4784" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb31-4785"><a href="#cb31-4785" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-4786"><a href="#cb31-4786" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier.colour =</span> <span class="st">"grey"</span></span>
<span id="cb31-4787"><a href="#cb31-4787" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-4788"><a href="#cb31-4788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb31-4789"><a href="#cb31-4789" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span>  . <span class="sc">~</span> measure,</span>
<span id="cb31-4790"><a href="#cb31-4790" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb31-4791"><a href="#cb31-4791" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb31-4792"><a href="#cb31-4792" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">"left"</span>,</span>
<span id="cb31-4793"><a href="#cb31-4793" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb31-4794"><a href="#cb31-4794" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb31-4795"><a href="#cb31-4795" aria-hidden="true" tabindex="-1"></a>        <span class="at">H2O =</span> <span class="st">"Soil moisture (g g-1)"</span>,</span>
<span id="cb31-4796"><a href="#cb31-4796" aria-hidden="true" tabindex="-1"></a>        <span class="at">pH =</span> <span class="st">"pH"</span>,</span>
<span id="cb31-4797"><a href="#cb31-4797" aria-hidden="true" tabindex="-1"></a>        <span class="at">ECEC =</span> <span class="st">"ECEC (cmolc/kg)"</span>,</span>
<span id="cb31-4798"><a href="#cb31-4798" aria-hidden="true" tabindex="-1"></a>        <span class="at">NH4 =</span> <span class="st">"NH4 (mg kg-1)"</span>,</span>
<span id="cb31-4799"><a href="#cb31-4799" aria-hidden="true" tabindex="-1"></a>        <span class="at">NO3 =</span> <span class="st">"NO3 (mg kg-1)"</span>,</span>
<span id="cb31-4800"><a href="#cb31-4800" aria-hidden="true" tabindex="-1"></a>        <span class="at">resinP =</span> <span class="st">"resin P (mg kg-1)"</span>,</span>
<span id="cb31-4801"><a href="#cb31-4801" aria-hidden="true" tabindex="-1"></a>        <span class="at">DOC =</span> <span class="st">"DOC (mg kg-1)"</span>,</span>
<span id="cb31-4802"><a href="#cb31-4802" aria-hidden="true" tabindex="-1"></a>        <span class="at">DON =</span> <span class="st">"DON (mg kg-1)"</span></span>
<span id="cb31-4803"><a href="#cb31-4803" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb31-4804"><a href="#cb31-4804" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4805"><a href="#cb31-4805" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-4806"><a href="#cb31-4806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-4807"><a href="#cb31-4807" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4808"><a href="#cb31-4808" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-4809"><a href="#cb31-4809" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4810"><a href="#cb31-4810" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4811"><a href="#cb31-4811" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4812"><a href="#cb31-4812" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-4813"><a href="#cb31-4813" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-4814"><a href="#cb31-4814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-4815"><a href="#cb31-4815" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4816"><a href="#cb31-4816" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-4817"><a href="#cb31-4817" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4818"><a href="#cb31-4818" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4819"><a href="#cb31-4819" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4820"><a href="#cb31-4820" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-4821"><a href="#cb31-4821" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-4822"><a href="#cb31-4822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-4823"><a href="#cb31-4823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-4824"><a href="#cb31-4824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"a) Soil properties"</span>) <span class="sc">+</span></span>
<span id="cb31-4825"><a href="#cb31-4825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-4826"><a href="#cb31-4826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-4827"><a href="#cb31-4827" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-4828"><a href="#cb31-4828" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb31-4829"><a href="#cb31-4829" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4830"><a href="#cb31-4830" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-4831"><a href="#cb31-4831" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4832"><a href="#cb31-4832" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb31-4833"><a href="#cb31-4833" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb31-4834"><a href="#cb31-4834" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-4835"><a href="#cb31-4835" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb31-4836"><a href="#cb31-4836" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-4837"><a href="#cb31-4837" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-4838"><a href="#cb31-4838" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-4839"><a href="#cb31-4839" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-4840"><a href="#cb31-4840" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4841"><a href="#cb31-4841" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4842"><a href="#cb31-4842" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb31-4843"><a href="#cb31-4843" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-4844"><a href="#cb31-4844" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-4845"><a href="#cb31-4845" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-4846"><a href="#cb31-4846" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-4847"><a href="#cb31-4847" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-4848"><a href="#cb31-4848" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4849"><a href="#cb31-4849" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4850"><a href="#cb31-4850" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb31-4851"><a href="#cb31-4851" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-4852"><a href="#cb31-4852" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-4853"><a href="#cb31-4853" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-4854"><a href="#cb31-4854" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-4855"><a href="#cb31-4855" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-4856"><a href="#cb31-4856" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4857"><a href="#cb31-4857" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4858"><a href="#cb31-4858" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb31-4859"><a href="#cb31-4859" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-4860"><a href="#cb31-4860" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-4861"><a href="#cb31-4861" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-4862"><a href="#cb31-4862" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-4863"><a href="#cb31-4863" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4864"><a href="#cb31-4864" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4865"><a href="#cb31-4865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4866"><a href="#cb31-4866" aria-hidden="true" tabindex="-1"></a><span class="do">## enzyme data per mic C</span></span>
<span id="cb31-4867"><a href="#cb31-4867" aria-hidden="true" tabindex="-1"></a>plot.diversity_meta.enzmic <span class="ot">&lt;-</span></span>
<span id="cb31-4868"><a href="#cb31-4868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(diversity_meta.enzmic, <span class="fu">aes</span>(<span class="at">x =</span> TREAT, <span class="at">y =</span> value), <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb31-4869"><a href="#cb31-4869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb31-4870"><a href="#cb31-4870" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> diversity_meta.enzmic,</span>
<span id="cb31-4871"><a href="#cb31-4871" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(TREAT, value , <span class="at">fill =</span> TREAT),</span>
<span id="cb31-4872"><a href="#cb31-4872" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb31-4873"><a href="#cb31-4873" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-4874"><a href="#cb31-4874" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier.colour =</span> <span class="st">"grey"</span></span>
<span id="cb31-4875"><a href="#cb31-4875" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-4876"><a href="#cb31-4876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb31-4877"><a href="#cb31-4877" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span>  . <span class="sc">~</span> measure,</span>
<span id="cb31-4878"><a href="#cb31-4878" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb31-4879"><a href="#cb31-4879" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb31-4880"><a href="#cb31-4880" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">"left"</span>,</span>
<span id="cb31-4881"><a href="#cb31-4881" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb31-4882"><a href="#cb31-4882" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb31-4883"><a href="#cb31-4883" aria-hidden="true" tabindex="-1"></a>        <span class="at">micC =</span> <span class="st">"Mic C (mg/kg)"</span>,</span>
<span id="cb31-4884"><a href="#cb31-4884" aria-hidden="true" tabindex="-1"></a>        <span class="at">micN =</span> <span class="st">"Mic N (mg/kg)"</span>,</span>
<span id="cb31-4885"><a href="#cb31-4885" aria-hidden="true" tabindex="-1"></a>        <span class="at">micP =</span> <span class="st">"Mic P (mg/kg)"</span>,</span>
<span id="cb31-4886"><a href="#cb31-4886" aria-hidden="true" tabindex="-1"></a>        <span class="at">AG_micC =</span> <span class="st">"AGase"</span>,</span>
<span id="cb31-4887"><a href="#cb31-4887" aria-hidden="true" tabindex="-1"></a>        <span class="at">BG_micC =</span> <span class="st">"BGase"</span>,</span>
<span id="cb31-4888"><a href="#cb31-4888" aria-hidden="true" tabindex="-1"></a>        <span class="at">CEL_micC =</span> <span class="st">"CEase"</span>,</span>
<span id="cb31-4889"><a href="#cb31-4889" aria-hidden="true" tabindex="-1"></a>        <span class="at">XYL_micC =</span> <span class="st">"XYase"</span>,</span>
<span id="cb31-4890"><a href="#cb31-4890" aria-hidden="true" tabindex="-1"></a>        <span class="at">POX_micC =</span> <span class="st">"PXase"</span>,</span>
<span id="cb31-4891"><a href="#cb31-4891" aria-hidden="true" tabindex="-1"></a>        <span class="at">NA_micC =</span> <span class="st">"Nase"</span>,</span>
<span id="cb31-4892"><a href="#cb31-4892" aria-hidden="true" tabindex="-1"></a>        <span class="at">LEU_micC =</span> <span class="st">"LPase"</span>,</span>
<span id="cb31-4893"><a href="#cb31-4893" aria-hidden="true" tabindex="-1"></a>        <span class="at">MUP_micC =</span> <span class="st">"Pase"</span>,</span>
<span id="cb31-4894"><a href="#cb31-4894" aria-hidden="true" tabindex="-1"></a>        <span class="at">BIS_micC =</span> <span class="st">"BPase"</span>,</span>
<span id="cb31-4895"><a href="#cb31-4895" aria-hidden="true" tabindex="-1"></a>        <span class="at">S_micC =</span> <span class="st">"Sase"</span></span>
<span id="cb31-4896"><a href="#cb31-4896" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb31-4897"><a href="#cb31-4897" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4898"><a href="#cb31-4898" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-4899"><a href="#cb31-4899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-4900"><a href="#cb31-4900" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4901"><a href="#cb31-4901" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-4902"><a href="#cb31-4902" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4903"><a href="#cb31-4903" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4904"><a href="#cb31-4904" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4905"><a href="#cb31-4905" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-4906"><a href="#cb31-4906" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-4907"><a href="#cb31-4907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-4908"><a href="#cb31-4908" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4909"><a href="#cb31-4909" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-4910"><a href="#cb31-4910" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4911"><a href="#cb31-4911" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4912"><a href="#cb31-4912" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4913"><a href="#cb31-4913" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-4914"><a href="#cb31-4914" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-4915"><a href="#cb31-4915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-4916"><a href="#cb31-4916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-4917"><a href="#cb31-4917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"b) Microbial biomass &amp; enzyme activity per unit microbial C"</span>) <span class="sc">+</span></span>
<span id="cb31-4918"><a href="#cb31-4918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-4919"><a href="#cb31-4919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-4920"><a href="#cb31-4920" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-4921"><a href="#cb31-4921" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb31-4922"><a href="#cb31-4922" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4923"><a href="#cb31-4923" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-4924"><a href="#cb31-4924" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4925"><a href="#cb31-4925" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb31-4926"><a href="#cb31-4926" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb31-4927"><a href="#cb31-4927" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-4928"><a href="#cb31-4928" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb31-4929"><a href="#cb31-4929" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb31-4930"><a href="#cb31-4930" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.23</span>),</span>
<span id="cb31-4931"><a href="#cb31-4931" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-4932"><a href="#cb31-4932" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-4933"><a href="#cb31-4933" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4934"><a href="#cb31-4934" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4935"><a href="#cb31-4935" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb31-4936"><a href="#cb31-4936" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-4937"><a href="#cb31-4937" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-4938"><a href="#cb31-4938" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-4939"><a href="#cb31-4939" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-4940"><a href="#cb31-4940" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-4941"><a href="#cb31-4941" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4942"><a href="#cb31-4942" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4943"><a href="#cb31-4943" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb31-4944"><a href="#cb31-4944" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-4945"><a href="#cb31-4945" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-4946"><a href="#cb31-4946" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-4947"><a href="#cb31-4947" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-4948"><a href="#cb31-4948" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-4949"><a href="#cb31-4949" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-4950"><a href="#cb31-4950" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-4951"><a href="#cb31-4951" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb31-4952"><a href="#cb31-4952" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-4953"><a href="#cb31-4953" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-4954"><a href="#cb31-4954" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-4955"><a href="#cb31-4955" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-4956"><a href="#cb31-4956" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4957"><a href="#cb31-4957" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-4958"><a href="#cb31-4958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4959"><a href="#cb31-4959" aria-hidden="true" tabindex="-1"></a><span class="do">## Temp response</span></span>
<span id="cb31-4960"><a href="#cb31-4960" aria-hidden="true" tabindex="-1"></a>plot.diversity_meta.Tresponse <span class="ot">&lt;-</span></span>
<span id="cb31-4961"><a href="#cb31-4961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(diversity_meta.Tresponse, <span class="fu">aes</span>(<span class="at">x =</span> TREAT, <span class="at">y =</span> value), <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb31-4962"><a href="#cb31-4962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb31-4963"><a href="#cb31-4963" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> diversity_meta.Tresponse,</span>
<span id="cb31-4964"><a href="#cb31-4964" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(TREAT, value , <span class="at">fill =</span> TREAT),</span>
<span id="cb31-4965"><a href="#cb31-4965" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb31-4966"><a href="#cb31-4966" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-4967"><a href="#cb31-4967" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier.colour =</span> <span class="st">"grey"</span></span>
<span id="cb31-4968"><a href="#cb31-4968" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-4969"><a href="#cb31-4969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb31-4970"><a href="#cb31-4970" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span>  . <span class="sc">~</span> measure,</span>
<span id="cb31-4971"><a href="#cb31-4971" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb31-4972"><a href="#cb31-4972" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb31-4973"><a href="#cb31-4973" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">"left"</span>,</span>
<span id="cb31-4974"><a href="#cb31-4974" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">as_labeller</span>(</span>
<span id="cb31-4975"><a href="#cb31-4975" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb31-4976"><a href="#cb31-4976" aria-hidden="true" tabindex="-1"></a>        <span class="at">Tmin =</span> <span class="st">"Tmin (°C)"</span>,</span>
<span id="cb31-4977"><a href="#cb31-4977" aria-hidden="true" tabindex="-1"></a>        <span class="at">SI =</span> <span class="st">"SI growth"</span>,</span>
<span id="cb31-4978"><a href="#cb31-4978" aria-hidden="true" tabindex="-1"></a>        <span class="at">CUEcn =</span> <span class="st">"CUE(C:N)"</span>,</span>
<span id="cb31-4979"><a href="#cb31-4979" aria-hidden="true" tabindex="-1"></a>        <span class="at">CUEcp =</span> <span class="st">"CUE(C:P)"</span>,</span>
<span id="cb31-4980"><a href="#cb31-4980" aria-hidden="true" tabindex="-1"></a>        <span class="at">AG_Q10 =</span> <span class="st">"AG Q10"</span>,</span>
<span id="cb31-4981"><a href="#cb31-4981" aria-hidden="true" tabindex="-1"></a>        <span class="at">BG_Q10 =</span> <span class="st">"BG Q10"</span>,</span>
<span id="cb31-4982"><a href="#cb31-4982" aria-hidden="true" tabindex="-1"></a>        <span class="at">CEL_Q10 =</span> <span class="st">"CE Q10"</span>,</span>
<span id="cb31-4983"><a href="#cb31-4983" aria-hidden="true" tabindex="-1"></a>        <span class="at">XYL_Q10 =</span> <span class="st">"XY Q10"</span>,</span>
<span id="cb31-4984"><a href="#cb31-4984" aria-hidden="true" tabindex="-1"></a>        <span class="at">POX_Q10 =</span> <span class="st">"PX Q10"</span>,</span>
<span id="cb31-4985"><a href="#cb31-4985" aria-hidden="true" tabindex="-1"></a>        <span class="at">NA_Q10 =</span> <span class="st">"N Q10"</span>,</span>
<span id="cb31-4986"><a href="#cb31-4986" aria-hidden="true" tabindex="-1"></a>        <span class="at">LEU_Q10 =</span> <span class="st">"LP Q10"</span>,</span>
<span id="cb31-4987"><a href="#cb31-4987" aria-hidden="true" tabindex="-1"></a>        <span class="at">MUP_Q10 =</span> <span class="st">"P Q10"</span>,</span>
<span id="cb31-4988"><a href="#cb31-4988" aria-hidden="true" tabindex="-1"></a>        <span class="at">BIS_Q10 =</span> <span class="st">"BP Q10"</span>,</span>
<span id="cb31-4989"><a href="#cb31-4989" aria-hidden="true" tabindex="-1"></a>        <span class="at">S_Q10 =</span> <span class="st">"S Q10"</span></span>
<span id="cb31-4990"><a href="#cb31-4990" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb31-4991"><a href="#cb31-4991" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-4992"><a href="#cb31-4992" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-4993"><a href="#cb31-4993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-4994"><a href="#cb31-4994" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4995"><a href="#cb31-4995" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-4996"><a href="#cb31-4996" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4997"><a href="#cb31-4997" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-4998"><a href="#cb31-4998" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-4999"><a href="#cb31-4999" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-5000"><a href="#cb31-5000" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-5001"><a href="#cb31-5001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-5002"><a href="#cb31-5002" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-5003"><a href="#cb31-5003" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>,</span>
<span id="cb31-5004"><a href="#cb31-5004" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-5005"><a href="#cb31-5005" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>,</span>
<span id="cb31-5006"><a href="#cb31-5006" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>,</span>
<span id="cb31-5007"><a href="#cb31-5007" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span></span>
<span id="cb31-5008"><a href="#cb31-5008" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-5009"><a href="#cb31-5009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">''</span>)) <span class="sc">+</span></span>
<span id="cb31-5010"><a href="#cb31-5010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">'Treatment: warming level'</span>)) <span class="sc">+</span></span>
<span id="cb31-5011"><a href="#cb31-5011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"c) Microbial community temperature sensitivity: growth, carbon-use-efficiency &amp; enzyme activity"</span>) <span class="sc">+</span></span>
<span id="cb31-5012"><a href="#cb31-5012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-5013"><a href="#cb31-5013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-5014"><a href="#cb31-5014" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5015"><a href="#cb31-5015" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb31-5016"><a href="#cb31-5016" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5017"><a href="#cb31-5017" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb31-5018"><a href="#cb31-5018" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5019"><a href="#cb31-5019" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb31-5020"><a href="#cb31-5020" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb31-5021"><a href="#cb31-5021" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-5022"><a href="#cb31-5022" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb31-5023"><a href="#cb31-5023" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb31-5024"><a href="#cb31-5024" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-5025"><a href="#cb31-5025" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-5026"><a href="#cb31-5026" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5027"><a href="#cb31-5027" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5028"><a href="#cb31-5028" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5029"><a href="#cb31-5029" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb31-5030"><a href="#cb31-5030" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-5031"><a href="#cb31-5031" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-5032"><a href="#cb31-5032" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-5033"><a href="#cb31-5033" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-5034"><a href="#cb31-5034" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-5035"><a href="#cb31-5035" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5036"><a href="#cb31-5036" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5037"><a href="#cb31-5037" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb31-5038"><a href="#cb31-5038" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-5039"><a href="#cb31-5039" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-5040"><a href="#cb31-5040" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb31-5041"><a href="#cb31-5041" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-5042"><a href="#cb31-5042" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-5043"><a href="#cb31-5043" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5044"><a href="#cb31-5044" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5045"><a href="#cb31-5045" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb31-5046"><a href="#cb31-5046" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-5047"><a href="#cb31-5047" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb31-5048"><a href="#cb31-5048" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-5049"><a href="#cb31-5049" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-5050"><a href="#cb31-5050" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5051"><a href="#cb31-5051" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-5052"><a href="#cb31-5052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5053"><a href="#cb31-5053" aria-hidden="true" tabindex="-1"></a><span class="do">##combined plots</span></span>
<span id="cb31-5054"><a href="#cb31-5054" aria-hidden="true" tabindex="-1"></a>plot.diversity_meta.all <span class="ot">&lt;-</span></span>
<span id="cb31-5055"><a href="#cb31-5055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange_ggplot2</span>(</span>
<span id="cb31-5056"><a href="#cb31-5056" aria-hidden="true" tabindex="-1"></a>    plot.diversity_meta.env,</span>
<span id="cb31-5057"><a href="#cb31-5057" aria-hidden="true" tabindex="-1"></a>    plot.diversity_meta.enzmic,</span>
<span id="cb31-5058"><a href="#cb31-5058" aria-hidden="true" tabindex="-1"></a>    plot.diversity_meta.Tresponse,</span>
<span id="cb31-5059"><a href="#cb31-5059" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb31-5060"><a href="#cb31-5060" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">3</span></span>
<span id="cb31-5061"><a href="#cb31-5061" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-5062"><a href="#cb31-5062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5063"><a href="#cb31-5063" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-5064"><a href="#cb31-5064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">12</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">22</span>),</span>
<span id="cb31-5065"><a href="#cb31-5065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">13</span>, <span class="at">b =</span> <span class="dv">24</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">22</span>),</span>
<span id="cb31-5066"><a href="#cb31-5066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">25</span>, <span class="at">b =</span> <span class="dv">36</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">22</span>)</span>
<span id="cb31-5067"><a href="#cb31-5067" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-5068"><a href="#cb31-5068" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(layout)</span>
<span id="cb31-5069"><a href="#cb31-5069" aria-hidden="true" tabindex="-1"></a>combo_plot <span class="ot">&lt;-</span> </span>
<span id="cb31-5070"><a href="#cb31-5070" aria-hidden="true" tabindex="-1"></a>  plot.diversity_meta.env <span class="sc">+</span> </span>
<span id="cb31-5071"><a href="#cb31-5071" aria-hidden="true" tabindex="-1"></a>           plot.diversity_meta.enzmic <span class="sc">+</span> plot.diversity_meta.Tresponse  <span class="sc">+</span> </span>
<span id="cb31-5072"><a href="#cb31-5072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)  </span>
<span id="cb31-5073"><a href="#cb31-5073" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_6/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_6.png"</span>, <span class="at">height =</span> <span class="fl">21.59</span>, <span class="at">width =</span> <span class="fl">27.94</span>,</span>
<span id="cb31-5074"><a href="#cb31-5074" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-5075"><a href="#cb31-5075" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(combo_plot, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_6/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_6.pdf"</span>, <span class="at">height =</span> <span class="fl">21.59</span>, <span class="at">width =</span> <span class="fl">27.94</span>,</span>
<span id="cb31-5076"><a href="#cb31-5076" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-5077"><a href="#cb31-5077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-5078"><a href="#cb31-5078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5079"><a href="#cb31-5079" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended Data Figure 7</span></span>
<span id="cb31-5080"><a href="#cb31-5080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5081"><a href="#cb31-5081" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-5082"><a href="#cb31-5082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5083"><a href="#cb31-5083" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-5084"><a href="#cb31-5084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5085"><a href="#cb31-5085" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Graphic convertor</span><span class="co">](https://www.lemkesoft.de/en/products/graphicconverter/)</span>. </span>
<span id="cb31-5086"><a href="#cb31-5086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5087"><a href="#cb31-5087" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5088"><a href="#cb31-5088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5089"><a href="#cb31-5089" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-5090"><a href="#cb31-5090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5091"><a href="#cb31-5091" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-5092"><a href="#cb31-5092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5093"><a href="#cb31-5093" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.png)</span></span>
<span id="cb31-5094"><a href="#cb31-5094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5095"><a href="#cb31-5095" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-5096"><a href="#cb31-5096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5097"><a href="#cb31-5097" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/Extended_Data/FIGURES/Extended_Data_Fig_7.png)</span></span>
<span id="cb31-5098"><a href="#cb31-5098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5099"><a href="#cb31-5099" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5100"><a href="#cb31-5100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5101"><a href="#cb31-5101" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-5102"><a href="#cb31-5102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5103"><a href="#cb31-5103" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5104"><a href="#cb31-5104" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 7 data file</span><span class="co">](include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.csv)</span>  </span>
<span id="cb31-5105"><a href="#cb31-5105" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5106"><a href="#cb31-5106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5107"><a href="#cb31-5107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5108"><a href="#cb31-5108" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5109"><a href="#cb31-5109" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Extended Data Figure 7 raw  pdf</span><span class="co">](include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.pdf)</span></span>
<span id="cb31-5110"><a href="#cb31-5110" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5111"><a href="#cb31-5111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5112"><a href="#cb31-5112" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5113"><a href="#cb31-5113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5116"><a href="#cb31-5116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-5117"><a href="#cb31-5117" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Extended Data Figure 7"</span></span>
<span id="cb31-5118"><a href="#cb31-5118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5119"><a href="#cb31-5119" aria-hidden="true" tabindex="-1"></a><span class="co">#clear workspace</span></span>
<span id="cb31-5120"><a href="#cb31-5120" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-5121"><a href="#cb31-5121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5122"><a href="#cb31-5122" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb31-5123"><a href="#cb31-5123" aria-hidden="true" tabindex="-1"></a>enzvmax <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"include/pub/EXD/EXD_Figure_7/Extended_Data_Figure_7.csv"</span>, <span class="at">header =</span> T)</span>
<span id="cb31-5124"><a href="#cb31-5124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5125"><a href="#cb31-5125" aria-hidden="true" tabindex="-1"></a>enzvmax<span class="sc">$</span>Plot <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(enzvmax<span class="sc">$</span>Plot)</span>
<span id="cb31-5126"><a href="#cb31-5126" aria-hidden="true" tabindex="-1"></a>enzvmax<span class="sc">$</span>season <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(enzvmax<span class="sc">$</span>season)</span>
<span id="cb31-5127"><a href="#cb31-5127" aria-hidden="true" tabindex="-1"></a>enzvmax<span class="sc">$</span>Treat <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(enzvmax<span class="sc">$</span>Treat)</span>
<span id="cb31-5128"><a href="#cb31-5128" aria-hidden="true" tabindex="-1"></a>enzvmax<span class="sc">$</span>enzyme <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(enzvmax<span class="sc">$</span>enzyme)</span>
<span id="cb31-5129"><a href="#cb31-5129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5130"><a href="#cb31-5130" aria-hidden="true" tabindex="-1"></a><span class="do">############ Plot all enzyme activities (extended data figure 7)</span></span>
<span id="cb31-5131"><a href="#cb31-5131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5132"><a href="#cb31-5132" aria-hidden="true" tabindex="-1"></a>plot.vmax <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(enzvmax, <span class="fu">aes</span>(<span class="at">x =</span> assayT, <span class="at">y =</span> Vmax), <span class="at">na.rm =</span> T) <span class="sc">+</span></span>
<span id="cb31-5133"><a href="#cb31-5133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb31-5134"><a href="#cb31-5134" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> assayT,</span>
<span id="cb31-5135"><a href="#cb31-5135" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> Vmax,</span>
<span id="cb31-5136"><a href="#cb31-5136" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">factor</span>(Treat),</span>
<span id="cb31-5137"><a href="#cb31-5137" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb31-5138"><a href="#cb31-5138" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb31-5139"><a href="#cb31-5139" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-5140"><a href="#cb31-5140" aria-hidden="true" tabindex="-1"></a><span class="do">## forcats::fct_relevel(Treat, "Control", "+3°C", "+8°C")  </span></span>
<span id="cb31-5141"><a href="#cb31-5141" aria-hidden="true" tabindex="-1"></a><span class="do">## Added by JJS to order facets  </span></span>
<span id="cb31-5142"><a href="#cb31-5142" aria-hidden="true" tabindex="-1"></a><span class="do">## Changed color order as well  </span></span>
<span id="cb31-5143"><a href="#cb31-5143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span>  forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(Treat, <span class="st">"Control"</span>, <span class="st">"+3°C"</span>, <span class="st">"+8°C"</span>) <span class="sc">~</span> enzyme,</span>
<span id="cb31-5144"><a href="#cb31-5144" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb31-5145"><a href="#cb31-5145" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb31-5146"><a href="#cb31-5146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-5147"><a href="#cb31-5147" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span id="cb31-5148"><a href="#cb31-5148" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-5149"><a href="#cb31-5149" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-5150"><a href="#cb31-5150" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-5151"><a href="#cb31-5151" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-5152"><a href="#cb31-5152" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>  <span class="co"># blue</span></span>
<span id="cb31-5153"><a href="#cb31-5153" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-5154"><a href="#cb31-5154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb31-5155"><a href="#cb31-5155" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#71b222"</span>, <span class="co"># green</span></span>
<span id="cb31-5156"><a href="#cb31-5156" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-5157"><a href="#cb31-5157" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-5158"><a href="#cb31-5158" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#b22271"</span>, <span class="co"># pink</span></span>
<span id="cb31-5159"><a href="#cb31-5159" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span>, <span class="co"># blue</span></span>
<span id="cb31-5160"><a href="#cb31-5160" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2271b2"</span> <span class="co"># blue</span></span>
<span id="cb31-5161"><a href="#cb31-5161" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-5162"><a href="#cb31-5162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb31-5163"><a href="#cb31-5163" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.data =</span> mean_cl_normal,</span>
<span id="cb31-5164"><a href="#cb31-5164" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"errorbar"</span>,</span>
<span id="cb31-5165"><a href="#cb31-5165" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb31-5166"><a href="#cb31-5166" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb31-5167"><a href="#cb31-5167" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-5168"><a href="#cb31-5168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb31-5169"><a href="#cb31-5169" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb31-5170"><a href="#cb31-5170" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">I</span>(x <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb31-5171"><a href="#cb31-5171" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb31-5172"><a href="#cb31-5172" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"grey20"</span></span>
<span id="cb31-5173"><a href="#cb31-5173" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-5174"><a href="#cb31-5174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">'Enzyme Vmax'</span>)) <span class="sc">+</span></span>
<span id="cb31-5175"><a href="#cb31-5175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">bquote</span>(<span class="st">'Assay temperature (°C)'</span>)) <span class="sc">+</span></span>
<span id="cb31-5176"><a href="#cb31-5176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb31-5177"><a href="#cb31-5177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-5178"><a href="#cb31-5178" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5179"><a href="#cb31-5179" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb31-5180"><a href="#cb31-5180" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-5181"><a href="#cb31-5181" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb31-5182"><a href="#cb31-5182" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5183"><a href="#cb31-5183" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5184"><a href="#cb31-5184" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-5185"><a href="#cb31-5185" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-5186"><a href="#cb31-5186" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-5187"><a href="#cb31-5187" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-5188"><a href="#cb31-5188" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-5189"><a href="#cb31-5189" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-5190"><a href="#cb31-5190" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb31-5191"><a href="#cb31-5191" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5192"><a href="#cb31-5192" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5193"><a href="#cb31-5193" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-5194"><a href="#cb31-5194" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-5195"><a href="#cb31-5195" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb31-5196"><a href="#cb31-5196" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-5197"><a href="#cb31-5197" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-5198"><a href="#cb31-5198" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-5199"><a href="#cb31-5199" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5200"><a href="#cb31-5200" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5201"><a href="#cb31-5201" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-5202"><a href="#cb31-5202" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb31-5203"><a href="#cb31-5203" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-5204"><a href="#cb31-5204" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-5205"><a href="#cb31-5205" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-5206"><a href="#cb31-5206" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-5207"><a href="#cb31-5207" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-5208"><a href="#cb31-5208" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-5209"><a href="#cb31-5209" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb31-5210"><a href="#cb31-5210" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-5211"><a href="#cb31-5211" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-5212"><a href="#cb31-5212" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> .<span class="dv">5</span>,</span>
<span id="cb31-5213"><a href="#cb31-5213" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">"plain"</span></span>
<span id="cb31-5214"><a href="#cb31-5214" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5215"><a href="#cb31-5215" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-5216"><a href="#cb31-5216" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(plot.vmax, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_7/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_7.png"</span>, <span class="at">height =</span> <span class="fl">21.59</span>, <span class="at">width =</span> <span class="fl">27.94</span>,</span>
<span id="cb31-5217"><a href="#cb31-5217" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-5218"><a href="#cb31-5218" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(plot.vmax, <span class="at">path =</span> <span class="st">"include/pub/EXD/EXD_Figure_7/"</span>, <span class="at">filename =</span> <span class="st">"Extended_Data_Figure_7.pdf"</span>, <span class="at">height =</span> <span class="fl">21.59</span>, <span class="at">width =</span> <span class="fl">27.94</span>,</span>
<span id="cb31-5219"><a href="#cb31-5219" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'cm'</span>, <span class="at">dpi =</span> <span class="dv">600</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb31-5220"><a href="#cb31-5220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5221"><a href="#cb31-5221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-5222"><a href="#cb31-5222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5223"><a href="#cb31-5223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5224"><a href="#cb31-5224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5225"><a href="#cb31-5225" aria-hidden="true" tabindex="-1"></a><span class="fu"># Supplementary Material</span></span>
<span id="cb31-5226"><a href="#cb31-5226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5227"><a href="#cb31-5227" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 1</span></span>
<span id="cb31-5228"><a href="#cb31-5228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5229"><a href="#cb31-5229" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-5230"><a href="#cb31-5230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5231"><a href="#cb31-5231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-5232"><a href="#cb31-5232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5233"><a href="#cb31-5233" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb31-5234"><a href="#cb31-5234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5235"><a href="#cb31-5235" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5236"><a href="#cb31-5236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5237"><a href="#cb31-5237" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-5238"><a href="#cb31-5238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5239"><a href="#cb31-5239" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-5240"><a href="#cb31-5240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5241"><a href="#cb31-5241" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_1.png)</span></span>
<span id="cb31-5242"><a href="#cb31-5242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5243"><a href="#cb31-5243" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-5244"><a href="#cb31-5244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5245"><a href="#cb31-5245" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_main_ssu.png)</span></span>
<span id="cb31-5246"><a href="#cb31-5246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5247"><a href="#cb31-5247" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5248"><a href="#cb31-5248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5249"><a href="#cb31-5249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5250"><a href="#cb31-5250" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-5251"><a href="#cb31-5251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5252"><a href="#cb31-5252" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5253"><a href="#cb31-5253" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 1 data pack</span><span class="co">](include/pub/SOM/Supplementary_Figure_1.rds)</span>  </span>
<span id="cb31-5254"><a href="#cb31-5254" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5255"><a href="#cb31-5255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5256"><a href="#cb31-5256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5257"><a href="#cb31-5257" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5258"><a href="#cb31-5258" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 1 raw  pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_1.pdf)</span></span>
<span id="cb31-5259"><a href="#cb31-5259" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5260"><a href="#cb31-5260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5261"><a href="#cb31-5261" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5262"><a href="#cb31-5262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5265"><a href="#cb31-5265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-5266"><a href="#cb31-5266" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Supplementary Figure 1"</span></span>
<span id="cb31-5267"><a href="#cb31-5267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5268"><a href="#cb31-5268" aria-hidden="true" tabindex="-1"></a><span class="do">## Load data</span></span>
<span id="cb31-5269"><a href="#cb31-5269" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-5270"><a href="#cb31-5270" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">119</span>)</span>
<span id="cb31-5271"><a href="#cb31-5271" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/SOM/Supplementary_Figure_1.rds"</span>)</span>
<span id="cb31-5272"><a href="#cb31-5272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5273"><a href="#cb31-5273" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Get all Class-level Proteobacteria names</span></span>
<span id="cb31-5274"><a href="#cb31-5274" aria-hidden="true" tabindex="-1"></a>ssu18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work"</span>)</span>
<span id="cb31-5275"><a href="#cb31-5275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5276"><a href="#cb31-5276" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5277"><a href="#cb31-5277" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_proteo"</span>))</span>
<span id="cb31-5278"><a href="#cb31-5278" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5279"><a href="#cb31-5279" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">subset_taxa</span>(tmp_get, Phylum <span class="sc">==</span> <span class="st">"Proteobacteria"</span>)</span>
<span id="cb31-5280"><a href="#cb31-5280" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-5281"><a href="#cb31-5281" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-5282"><a href="#cb31-5282" aria-hidden="true" tabindex="-1"></a>     tmp_get_taxa <span class="ot">&lt;-</span> <span class="fu">get_taxa_unique</span>(tmp_df,</span>
<span id="cb31-5283"><a href="#cb31-5283" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_df)[<span class="dv">3</span>],</span>
<span id="cb31-5284"><a href="#cb31-5284" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-5285"><a href="#cb31-5285" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_get_taxa)</span>
<span id="cb31-5286"><a href="#cb31-5286" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5287"><a href="#cb31-5287" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_proteo"</span>))</span>
<span id="cb31-5288"><a href="#cb31-5288" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5289"><a href="#cb31-5289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5290"><a href="#cb31-5290" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span id="cb31-5291"><a href="#cb31-5291" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5292"><a href="#cb31-5292" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>))</span>
<span id="cb31-5293"><a href="#cb31-5293" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb31-5294"><a href="#cb31-5294" aria-hidden="true" tabindex="-1"></a>  tmp_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-5295"><a href="#cb31-5295" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5296"><a href="#cb31-5296" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tmp_clean)) {</span>
<span id="cb31-5297"><a href="#cb31-5297" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-5298"><a href="#cb31-5298" aria-hidden="true" tabindex="-1"></a>        tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Alphaproteobacteria"</span>) {</span>
<span id="cb31-5299"><a href="#cb31-5299" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Alphaproteobacteria"</span>)</span>
<span id="cb31-5300"><a href="#cb31-5300" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-5301"><a href="#cb31-5301" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-5302"><a href="#cb31-5302" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Gammaproteobacteria"</span>) {</span>
<span id="cb31-5303"><a href="#cb31-5303" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Gammaproteobacteria"</span>)</span>
<span id="cb31-5304"><a href="#cb31-5304" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-5305"><a href="#cb31-5305" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-5306"><a href="#cb31-5306" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Zetaproteobacteria"</span>) {</span>
<span id="cb31-5307"><a href="#cb31-5307" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Zetaproteobacteria"</span>)</span>
<span id="cb31-5308"><a href="#cb31-5308" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-5309"><a href="#cb31-5309" aria-hidden="true" tabindex="-1"></a>    }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span></span>
<span id="cb31-5310"><a href="#cb31-5310" aria-hidden="true" tabindex="-1"></a>                 tmp_clean[i, <span class="dv">3</span>] <span class="sc">==</span> <span class="st">"p_Proteobacteria"</span>) {</span>
<span id="cb31-5311"><a href="#cb31-5311" aria-hidden="true" tabindex="-1"></a>      phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p_Proteobacteria"</span>)</span>
<span id="cb31-5312"><a href="#cb31-5312" aria-hidden="true" tabindex="-1"></a>      tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-5313"><a href="#cb31-5313" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-5314"><a href="#cb31-5314" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-5315"><a href="#cb31-5315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(tmp_get) <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_clean)</span>
<span id="cb31-5316"><a href="#cb31-5316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rank_names</span>(tmp_get)</span>
<span id="cb31-5317"><a href="#cb31-5317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_get)</span>
<span id="cb31-5318"><a href="#cb31-5318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(tmp_name, tmp_get))</span>
<span id="cb31-5319"><a href="#cb31-5319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">length</span>(</span>
<span id="cb31-5320"><a href="#cb31-5320" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_taxa_unique</span>(</span>
<span id="cb31-5321"><a href="#cb31-5321" aria-hidden="true" tabindex="-1"></a>      tmp_get,</span>
<span id="cb31-5322"><a href="#cb31-5322" aria-hidden="true" tabindex="-1"></a>      <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">2</span>],</span>
<span id="cb31-5323"><a href="#cb31-5323" aria-hidden="true" tabindex="-1"></a>      <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb31-5324"><a href="#cb31-5324" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5325"><a href="#cb31-5325" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb31-5326"><a href="#cb31-5326" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/SOM/"</span>)</span>
<span id="cb31-5327"><a href="#cb31-5327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5328"><a href="#cb31-5328" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5329"><a href="#cb31-5329" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(class, order, phylum)</span>
<span id="cb31-5330"><a href="#cb31-5330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5331"><a href="#cb31-5331" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) In order to use `microeco`, we need to add the rank designation as a prefix to each taxa. </span></span>
<span id="cb31-5332"><a href="#cb31-5332" aria-hidden="true" tabindex="-1"></a><span class="do">## For example, `Actinobacteriota` is changed to `p__Actinobacteriota`. </span></span>
<span id="cb31-5333"><a href="#cb31-5333" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5334"><a href="#cb31-5334" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>)))</span>
<span id="cb31-5335"><a href="#cb31-5335" aria-hidden="true" tabindex="-1"></a>  tmp_sam_data <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(tmp_get)</span>
<span id="cb31-5336"><a href="#cb31-5336" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-5337"><a href="#cb31-5337" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Phylum <span class="ot">&lt;-</span></span>
<span id="cb31-5338"><a href="#cb31-5338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"p_Proteobacteria"</span>, <span class="st">"Proteobacteria"</span>, tmp_tax_data<span class="sc">$</span>Phylum)</span>
<span id="cb31-5339"><a href="#cb31-5339" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5340"><a href="#cb31-5340" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span></span>
<span id="cb31-5341"><a href="#cb31-5341" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-5342"><a href="#cb31-5342" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5343"><a href="#cb31-5343" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data[] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb31-5344"><a href="#cb31-5344" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(</span>
<span id="cb31-5345"><a href="#cb31-5345" aria-hidden="true" tabindex="-1"></a>      tmp_tax_data,</span>
<span id="cb31-5346"><a href="#cb31-5346" aria-hidden="true" tabindex="-1"></a>      gsub,</span>
<span id="cb31-5347"><a href="#cb31-5347" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">"^[k | p | c | o | f]_.*"</span>,</span>
<span id="cb31-5348"><a href="#cb31-5348" aria-hidden="true" tabindex="-1"></a>      <span class="at">replacement =</span> <span class="st">""</span>,</span>
<span id="cb31-5349"><a href="#cb31-5349" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixed =</span> <span class="cn">FALSE</span></span>
<span id="cb31-5350"><a href="#cb31-5350" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5351"><a href="#cb31-5351" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-5352"><a href="#cb31-5352" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Kingdom <span class="ot">&lt;-</span></span>
<span id="cb31-5353"><a href="#cb31-5353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"k__"</span>, tmp_tax_data<span class="sc">$</span>Kingdom, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5354"><a href="#cb31-5354" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Phylum <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"p__"</span>, tmp_tax_data<span class="sc">$</span>Phylum, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5355"><a href="#cb31-5355" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"c__"</span>, tmp_tax_data<span class="sc">$</span>Class, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5356"><a href="#cb31-5356" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Order <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"o__"</span>, tmp_tax_data<span class="sc">$</span>Order, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5357"><a href="#cb31-5357" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Family <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"f__"</span>, tmp_tax_data<span class="sc">$</span>Family, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5358"><a href="#cb31-5358" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Genus <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"g__"</span>, tmp_tax_data<span class="sc">$</span>Genus, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5359"><a href="#cb31-5359" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax_data)</span>
<span id="cb31-5360"><a href="#cb31-5360" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5361"><a href="#cb31-5361" aria-hidden="true" tabindex="-1"></a>  tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(tmp_get),</span>
<span id="cb31-5362"><a href="#cb31-5362" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">phy_tree</span>(tmp_get),</span>
<span id="cb31-5363"><a href="#cb31-5363" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">tax_table</span>(tmp_tax_data),</span>
<span id="cb31-5364"><a href="#cb31-5364" aria-hidden="true" tabindex="-1"></a>                     tmp_sam_data)</span>
<span id="cb31-5365"><a href="#cb31-5365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_ps)</span>
<span id="cb31-5366"><a href="#cb31-5366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5367"><a href="#cb31-5367" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5368"><a href="#cb31-5368" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_proteo_clean"</span>))</span>
<span id="cb31-5369"><a href="#cb31-5369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5370"><a href="#cb31-5370" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Next, we need to covert each `phyloseq object` to a `microtable class`.  </span></span>
<span id="cb31-5371"><a href="#cb31-5371" aria-hidden="true" tabindex="-1"></a><span class="do">## The microtable class is the basic data structure for the `microeco` package </span></span>
<span id="cb31-5372"><a href="#cb31-5372" aria-hidden="true" tabindex="-1"></a><span class="do">## and designed to store basic information from all the downstream analyses </span></span>
<span id="cb31-5373"><a href="#cb31-5373" aria-hidden="true" tabindex="-1"></a><span class="do">## (e.g, alpha diversity, beta diversity, etc.). </span></span>
<span id="cb31-5374"><a href="#cb31-5374" aria-hidden="true" tabindex="-1"></a><span class="do">## We use the [file2meco](https://github.com/ChiLiubio/file2meco) to read the phyloseq </span></span>
<span id="cb31-5375"><a href="#cb31-5375" aria-hidden="true" tabindex="-1"></a><span class="do">## object and convert into a microtable object. We can add `_me` as a suffix </span></span>
<span id="cb31-5376"><a href="#cb31-5376" aria-hidden="true" tabindex="-1"></a><span class="do">## to each object to distiguish it from its' phyloseq counterpart. </span></span>
<span id="cb31-5377"><a href="#cb31-5377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5378"><a href="#cb31-5378" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5379"><a href="#cb31-5379" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5380"><a href="#cb31-5380" aria-hidden="true" tabindex="-1"></a>  tmp_otu_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb31-5381"><a href="#cb31-5381" aria-hidden="true" tabindex="-1"></a>  tmp_sample_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb31-5382"><a href="#cb31-5382" aria-hidden="true" tabindex="-1"></a>  tmp_taxonomy_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-5383"><a href="#cb31-5383" aria-hidden="true" tabindex="-1"></a>  tmp_phylo_tree <span class="ot">&lt;-</span> <span class="fu">phy_tree</span>(tmp_get)</span>
<span id="cb31-5384"><a href="#cb31-5384" aria-hidden="true" tabindex="-1"></a>  tmp_taxonomy_table <span class="sc">%&lt;&gt;%</span> tidy_taxonomy</span>
<span id="cb31-5385"><a href="#cb31-5385" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> microtable<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb31-5386"><a href="#cb31-5386" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_table =</span> tmp_sample_info,</span>
<span id="cb31-5387"><a href="#cb31-5387" aria-hidden="true" tabindex="-1"></a>    <span class="at">otu_table =</span> tmp_otu_table,</span>
<span id="cb31-5388"><a href="#cb31-5388" aria-hidden="true" tabindex="-1"></a>    <span class="at">tax_table =</span> tmp_taxonomy_table,</span>
<span id="cb31-5389"><a href="#cb31-5389" aria-hidden="true" tabindex="-1"></a>    <span class="at">phylo_tree =</span> tmp_phylo_tree</span>
<span id="cb31-5390"><a href="#cb31-5390" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-5391"><a href="#cb31-5391" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb31-5392"><a href="#cb31-5392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb31-5393"><a href="#cb31-5393" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span>tax_table <span class="sc">%&lt;&gt;%</span> base<span class="sc">::</span><span class="fu">subset</span>(Kingdom <span class="sc">==</span> <span class="st">"k__Archaea"</span> <span class="sc">|</span></span>
<span id="cb31-5394"><a href="#cb31-5394" aria-hidden="true" tabindex="-1"></a>                                            Kingdom <span class="sc">==</span> <span class="st">"k__Bacteria"</span>)</span>
<span id="cb31-5395"><a href="#cb31-5395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb31-5396"><a href="#cb31-5396" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">filter_pollution</span>(<span class="at">taxa =</span> <span class="fu">c</span>(<span class="st">"mitochondria"</span>, <span class="st">"chloroplast"</span>))</span>
<span id="cb31-5397"><a href="#cb31-5397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb31-5398"><a href="#cb31-5398" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb31-5399"><a href="#cb31-5399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb31-5400"><a href="#cb31-5400" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>))</span>
<span id="cb31-5401"><a href="#cb31-5401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_dataset)</span>
<span id="cb31-5402"><a href="#cb31-5402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5403"><a href="#cb31-5403" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb31-5404"><a href="#cb31-5404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5405"><a href="#cb31-5405" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Now, we calculate the taxa abundance at each taxonomic rank using </span></span>
<span id="cb31-5406"><a href="#cb31-5406" aria-hidden="true" tabindex="-1"></a><span class="do">## `cal_abund()`. This function return a list called `taxa_abund` containing </span></span>
<span id="cb31-5407"><a href="#cb31-5407" aria-hidden="true" tabindex="-1"></a><span class="do">## several data frame of the abundance information at each taxonomic rank. </span></span>
<span id="cb31-5408"><a href="#cb31-5408" aria-hidden="true" tabindex="-1"></a><span class="do">## The list is stored in the microtable object automatically. </span></span>
<span id="cb31-5409"><a href="#cb31-5409" aria-hidden="true" tabindex="-1"></a><span class="do">## It’s worth noting that the `cal_abund()` function can be used to solve </span></span>
<span id="cb31-5410"><a href="#cb31-5410" aria-hidden="true" tabindex="-1"></a><span class="do">## some complex cases, such as supporting both the relative and absolute </span></span>
<span id="cb31-5411"><a href="#cb31-5411" aria-hidden="true" tabindex="-1"></a><span class="do">## abundance calculation and selecting the partial taxonomic columns. More </span></span>
<span id="cb31-5412"><a href="#cb31-5412" aria-hidden="true" tabindex="-1"></a><span class="do">## information can be found in the description of the </span></span>
<span id="cb31-5413"><a href="#cb31-5413" aria-hidden="true" tabindex="-1"></a><span class="do">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span></span>
<span id="cb31-5414"><a href="#cb31-5414" aria-hidden="true" tabindex="-1"></a><span class="do">## In the same loop we also create a `trans_abund` class, which is used to </span></span>
<span id="cb31-5415"><a href="#cb31-5415" aria-hidden="true" tabindex="-1"></a><span class="do">## transform taxonomic abundance data for plotting.</span></span>
<span id="cb31-5416"><a href="#cb31-5416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5417"><a href="#cb31-5417" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5418"><a href="#cb31-5418" aria-hidden="true" tabindex="-1"></a>  tmp_me <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb31-5419"><a href="#cb31-5419" aria-hidden="true" tabindex="-1"></a>  tmp_me<span class="sc">$</span><span class="fu">cal_abund</span>()</span>
<span id="cb31-5420"><a href="#cb31-5420" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund <span class="ot">&lt;-</span></span>
<span id="cb31-5421"><a href="#cb31-5421" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_me,</span>
<span id="cb31-5422"><a href="#cb31-5422" aria-hidden="true" tabindex="-1"></a>                    <span class="at">taxrank =</span> <span class="st">"Phylum"</span>,</span>
<span id="cb31-5423"><a href="#cb31-5423" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ntaxa =</span> <span class="dv">12</span>)</span>
<span id="cb31-5424"><a href="#cb31-5424" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb31-5425"><a href="#cb31-5425" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb31-5426"><a href="#cb31-5426" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr <span class="ot">&lt;-</span></span>
<span id="cb31-5427"><a href="#cb31-5427" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb31-5428"><a href="#cb31-5428" aria-hidden="true" tabindex="-1"></a>      <span class="at">dataset =</span> tmp_me,</span>
<span id="cb31-5429"><a href="#cb31-5429" aria-hidden="true" tabindex="-1"></a>      <span class="at">taxrank =</span> <span class="st">"Phylum"</span>,</span>
<span id="cb31-5430"><a href="#cb31-5430" aria-hidden="true" tabindex="-1"></a>      <span class="at">ntaxa =</span> <span class="dv">12</span>,</span>
<span id="cb31-5431"><a href="#cb31-5431" aria-hidden="true" tabindex="-1"></a>      <span class="at">groupmean =</span> <span class="st">"TEMP"</span></span>
<span id="cb31-5432"><a href="#cb31-5432" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5433"><a href="#cb31-5433" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb31-5434"><a href="#cb31-5434" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb31-5435"><a href="#cb31-5435" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>))</span>
<span id="cb31-5436"><a href="#cb31-5436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_me_abund)</span>
<span id="cb31-5437"><a href="#cb31-5437" aria-hidden="true" tabindex="-1"></a>  tmp_name_gr <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>))</span>
<span id="cb31-5438"><a href="#cb31-5438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_gr, tmp_me_abund_gr)</span>
<span id="cb31-5439"><a href="#cb31-5439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5440"><a href="#cb31-5440" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5441"><a href="#cb31-5441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5442"><a href="#cb31-5442" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) I prefer to specify the order of taxa in these kinds of plots. </span></span>
<span id="cb31-5443"><a href="#cb31-5443" aria-hidden="true" tabindex="-1"></a><span class="do">## We can look the top `ntaxa` (defined above) by accessing the </span></span>
<span id="cb31-5444"><a href="#cb31-5444" aria-hidden="true" tabindex="-1"></a><span class="do">## `data_taxanames` character vector of each microtable object.</span></span>
<span id="cb31-5445"><a href="#cb31-5445" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we can define the order. Once we do that, we will override the </span></span>
<span id="cb31-5446"><a href="#cb31-5446" aria-hidden="true" tabindex="-1"></a><span class="do">## `data_taxanames` character vectors with the reordered vectors.</span></span>
<span id="cb31-5447"><a href="#cb31-5447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5448"><a href="#cb31-5448" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_tax_ord <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alphaproteobacteria"</span>, <span class="st">"Gammaproteobacteria"</span>, </span>
<span id="cb31-5449"><a href="#cb31-5449" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, </span>
<span id="cb31-5450"><a href="#cb31-5450" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Myxococcota"</span>, </span>
<span id="cb31-5451"><a href="#cb31-5451" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Verrucomicrobiota"</span>, <span class="st">"Chloroflexi"</span>, </span>
<span id="cb31-5452"><a href="#cb31-5452" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Planctomycetota"</span>, <span class="st">"Methylomirabilota"</span>, </span>
<span id="cb31-5453"><a href="#cb31-5453" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Crenarchaeota"</span>)</span>
<span id="cb31-5454"><a href="#cb31-5454" aria-hidden="true" tabindex="-1"></a><span class="do">## 7) And one more little step before plotting. </span></span>
<span id="cb31-5455"><a href="#cb31-5455" aria-hidden="true" tabindex="-1"></a><span class="do">## Here we  **a**) specify a custom color palette and  </span></span>
<span id="cb31-5456"><a href="#cb31-5456" aria-hidden="true" tabindex="-1"></a><span class="do">## **b**) specify the sample order. </span></span>
<span id="cb31-5457"><a href="#cb31-5457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5458"><a href="#cb31-5458" aria-hidden="true" tabindex="-1"></a>top_level <span class="ot">&lt;-</span> <span class="st">"Phylum"</span></span>
<span id="cb31-5459"><a href="#cb31-5459" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-5460"><a href="#cb31-5460" aria-hidden="true" tabindex="-1"></a>ssu18_colvec.tax <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#00463C"</span>,<span class="st">"#FFD5FD"</span>,<span class="st">"#00A51C"</span>,<span class="st">"#C80B2A"</span>,<span class="st">"#00C7F9"</span>,</span>
<span id="cb31-5461"><a href="#cb31-5461" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#FFA035"</span>, <span class="st">"#ED0DFD"</span>,<span class="st">"#0063E5"</span>,<span class="st">"#5FFFDE"</span>,<span class="st">"#C00B6F"</span>,</span>
<span id="cb31-5462"><a href="#cb31-5462" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#00A090"</span>,<span class="st">"#FF95BA"</span>)</span>
<span id="cb31-5463"><a href="#cb31-5463" aria-hidden="true" tabindex="-1"></a>ssu18_samp_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, </span>
<span id="cb31-5464"><a href="#cb31-5464" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, </span>
<span id="cb31-5465"><a href="#cb31-5465" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P05_D00_010_W3C"</span>, <span class="st">"P07_D00_010_W3D"</span>, </span>
<span id="cb31-5466"><a href="#cb31-5466" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P09_D00_010_W3E"</span>, <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, </span>
<span id="cb31-5467"><a href="#cb31-5467" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P05_D00_010_W8C"</span>, <span class="st">"P07_D00_010_W8D"</span>, <span class="st">"P09_D00_010_W8E"</span>)</span>
<span id="cb31-5468"><a href="#cb31-5468" aria-hidden="true" tabindex="-1"></a><span class="do">## 8) Now we can generate plots (in a loop) for each faceted data set.</span></span>
<span id="cb31-5469"><a href="#cb31-5469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5470"><a href="#cb31-5470" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5471"><a href="#cb31-5471" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>)))</span>
<span id="cb31-5472"><a href="#cb31-5472" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb31-5473"><a href="#cb31-5473" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb31-5474"><a href="#cb31-5474" aria-hidden="true" tabindex="-1"></a>  tmp_facet_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5475"><a href="#cb31-5475" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb31-5476"><a href="#cb31-5476" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> ssu18_colvec.tax,</span>
<span id="cb31-5477"><a href="#cb31-5477" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb31-5478"><a href="#cb31-5478" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb31-5479"><a href="#cb31-5479" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-5480"><a href="#cb31-5480" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5481"><a href="#cb31-5481" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5482"><a href="#cb31-5482" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">6</span>,</span>
<span id="cb31-5483"><a href="#cb31-5483" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span>,</span>
<span id="cb31-5484"><a href="#cb31-5484" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_x =</span> ssu18_samp_order</span>
<span id="cb31-5485"><a href="#cb31-5485" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5486"><a href="#cb31-5486" aria-hidden="true" tabindex="-1"></a>  tmp_facet_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>))</span>
<span id="cb31-5487"><a href="#cb31-5487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_facet_name, tmp_facet_plot)</span>
<span id="cb31-5488"><a href="#cb31-5488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5489"><a href="#cb31-5489" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5490"><a href="#cb31-5490" aria-hidden="true" tabindex="-1"></a><span class="do">## Then add a little formatting to the faceted plots.</span></span>
<span id="cb31-5491"><a href="#cb31-5491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5492"><a href="#cb31-5492" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work_facet_plot"</span>)</span>
<span id="cb31-5493"><a href="#cb31-5493" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb31-5494"><a href="#cb31-5494" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5495"><a href="#cb31-5495" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb31-5496"><a href="#cb31-5496" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb31-5497"><a href="#cb31-5497" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb31-5498"><a href="#cb31-5498" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> top_level,</span>
<span id="cb31-5499"><a href="#cb31-5499" aria-hidden="true" tabindex="-1"></a>      <span class="at">reverse =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5500"><a href="#cb31-5500" aria-hidden="true" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fl">0.7</span>,</span>
<span id="cb31-5501"><a href="#cb31-5501" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fl">0.7</span></span>
<span id="cb31-5502"><a href="#cb31-5502" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb31-5503"><a href="#cb31-5503" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Sample"</span>) <span class="sc">+</span></span>
<span id="cb31-5504"><a href="#cb31-5504" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-5505"><a href="#cb31-5505" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5506"><a href="#cb31-5506" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5507"><a href="#cb31-5507" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5508"><a href="#cb31-5508" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5509"><a href="#cb31-5509" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb31-5510"><a href="#cb31-5510" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb31-5511"><a href="#cb31-5511" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb31-5512"><a href="#cb31-5512" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb31-5513"><a href="#cb31-5513" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb31-5514"><a href="#cb31-5514" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb31-5515"><a href="#cb31-5515" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb31-5516"><a href="#cb31-5516" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb31-5517"><a href="#cb31-5517" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb31-5518"><a href="#cb31-5518" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb31-5519"><a href="#cb31-5519" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb31-5520"><a href="#cb31-5520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb31-5521"><a href="#cb31-5521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5522"><a href="#cb31-5522" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5523"><a href="#cb31-5523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5524"><a href="#cb31-5524" aria-hidden="true" tabindex="-1"></a><span class="do">## And now plots for the group-means sets. We can use the same </span></span>
<span id="cb31-5525"><a href="#cb31-5525" aria-hidden="true" tabindex="-1"></a><span class="do">## taxa order since that should not have changed.</span></span>
<span id="cb31-5526"><a href="#cb31-5526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5527"><a href="#cb31-5527" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work_group_plot"</span>)</span>
<span id="cb31-5528"><a href="#cb31-5528" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5529"><a href="#cb31-5529" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>)))</span>
<span id="cb31-5530"><a href="#cb31-5530" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb31-5531"><a href="#cb31-5531" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb31-5532"><a href="#cb31-5532" aria-hidden="true" tabindex="-1"></a>  tmp_group_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5533"><a href="#cb31-5533" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb31-5534"><a href="#cb31-5534" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> ssu18_colvec.tax,</span>
<span id="cb31-5535"><a href="#cb31-5535" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb31-5536"><a href="#cb31-5536" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-5537"><a href="#cb31-5537" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-5538"><a href="#cb31-5538" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5539"><a href="#cb31-5539" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">10</span>,</span>
<span id="cb31-5540"><a href="#cb31-5540" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span></span>
<span id="cb31-5541"><a href="#cb31-5541" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5542"><a href="#cb31-5542" aria-hidden="true" tabindex="-1"></a>  tmp_group_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>))</span>
<span id="cb31-5543"><a href="#cb31-5543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_group_name, tmp_group_plot)</span>
<span id="cb31-5544"><a href="#cb31-5544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5545"><a href="#cb31-5545" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5546"><a href="#cb31-5546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5547"><a href="#cb31-5547" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's also add a little formatting to the groupmean plots.</span></span>
<span id="cb31-5548"><a href="#cb31-5548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5549"><a href="#cb31-5549" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb31-5550"><a href="#cb31-5550" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5551"><a href="#cb31-5551" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb31-5552"><a href="#cb31-5552" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb31-5553"><a href="#cb31-5553" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative Abundance (% total reads)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Temperature"</span>) <span class="sc">+</span></span>
<span id="cb31-5554"><a href="#cb31-5554" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-5555"><a href="#cb31-5555" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5556"><a href="#cb31-5556" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5557"><a href="#cb31-5557" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5558"><a href="#cb31-5558" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5559"><a href="#cb31-5559" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb31-5560"><a href="#cb31-5560" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-5561"><a href="#cb31-5561" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb31-5562"><a href="#cb31-5562" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb31-5563"><a href="#cb31-5563" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb31-5564"><a href="#cb31-5564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb31-5565"><a href="#cb31-5565" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5566"><a href="#cb31-5566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb31-5567"><a href="#cb31-5567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5568"><a href="#cb31-5568" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5569"><a href="#cb31-5569" aria-hidden="true" tabindex="-1"></a><span class="do">## 10) Finally we use the `patchwork` package to combine the </span></span>
<span id="cb31-5570"><a href="#cb31-5570" aria-hidden="true" tabindex="-1"></a><span class="do">## two plots and customize the look.</span></span>
<span id="cb31-5571"><a href="#cb31-5571" aria-hidden="true" tabindex="-1"></a><span class="do">## single index that acts as an index for referencing elements (variables) in a list</span></span>
<span id="cb31-5572"><a href="#cb31-5572" aria-hidden="true" tabindex="-1"></a><span class="do">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span></span>
<span id="cb31-5573"><a href="#cb31-5573" aria-hidden="true" tabindex="-1"></a>var_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">var1 =</span> ssu18_data_sets,</span>
<span id="cb31-5574"><a href="#cb31-5574" aria-hidden="true" tabindex="-1"></a>                 <span class="at">var2 =</span> <span class="fu">c</span>(<span class="st">"FULL"</span>))</span>
<span id="cb31-5575"><a href="#cb31-5575" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(var_list<span class="sc">$</span>var1)) {</span>
<span id="cb31-5576"><a href="#cb31-5576" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final_name <span class="ot">&lt;-</span></span>
<span id="cb31-5577"><a href="#cb31-5577" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level, <span class="st">"_plot_final"</span>))</span>
<span id="cb31-5578"><a href="#cb31-5578" aria-hidden="true" tabindex="-1"></a>  tmp_set_type <span class="ot">&lt;-</span> var_list<span class="sc">$</span>var2[j]</span>
<span id="cb31-5579"><a href="#cb31-5579" aria-hidden="true" tabindex="-1"></a>  tmp_p_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5580"><a href="#cb31-5580" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>)))</span>
<span id="cb31-5581"><a href="#cb31-5581" aria-hidden="true" tabindex="-1"></a>  tmp_m_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5582"><a href="#cb31-5582" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>)))</span>
<span id="cb31-5583"><a href="#cb31-5583" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_p_plot <span class="sc">+</span> tmp_m_plot</span>
<span id="cb31-5584"><a href="#cb31-5584" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_plot_final <span class="sc">+</span></span>
<span id="cb31-5585"><a href="#cb31-5585" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"a"</span>) <span class="sc">+</span></span>
<span id="cb31-5586"><a href="#cb31-5586" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb31-5587"><a href="#cb31-5587" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-5588"><a href="#cb31-5588" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb31-5589"><a href="#cb31-5589" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb31-5590"><a href="#cb31-5590" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb31-5591"><a href="#cb31-5591" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb31-5592"><a href="#cb31-5592" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb31-5593"><a href="#cb31-5593" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5594"><a href="#cb31-5594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plot_final_name, tmp_plot_final)</span>
<span id="cb31-5595"><a href="#cb31-5595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5596"><a href="#cb31-5596" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5597"><a href="#cb31-5597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5598"><a href="#cb31-5598" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-5599"><a href="#cb31-5599" aria-hidden="true" tabindex="-1"></a>   tmp_plot_final <span class="ot">&lt;-</span> </span>
<span id="cb31-5600"><a href="#cb31-5600" aria-hidden="true" tabindex="-1"></a>     <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level,  <span class="st">"_plot_final"</span>)))</span>
<span id="cb31-5601"><a href="#cb31-5601" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-5602"><a href="#cb31-5602" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb31-5603"><a href="#cb31-5603" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/SOM/"</span>, i, <span class="st">"_tax_div_bar_plots.png"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-5604"><a href="#cb31-5604" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-5605"><a href="#cb31-5605" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-5606"><a href="#cb31-5606" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb31-5607"><a href="#cb31-5607" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/SOM/"</span>, i, <span class="st">"_tax_div_bar_plots.pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-5608"><a href="#cb31-5608" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-5609"><a href="#cb31-5609" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5610"><a href="#cb31-5610" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5611"><a href="#cb31-5611" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/SOM/ssu18_ps_work_tax_div_bar_plots.png"</span>, </span>
<span id="cb31-5612"><a href="#cb31-5612" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/SOM/Supplementary_Figure_1.png"</span>)</span>
<span id="cb31-5613"><a href="#cb31-5613" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/SOM/ssu18_ps_work_tax_div_bar_plots.pdf"</span>, </span>
<span id="cb31-5614"><a href="#cb31-5614" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/SOM/Supplementary_Figure_1.pdf"</span>)</span>
<span id="cb31-5615"><a href="#cb31-5615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-5616"><a href="#cb31-5616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5617"><a href="#cb31-5617" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 2</span></span>
<span id="cb31-5618"><a href="#cb31-5618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5619"><a href="#cb31-5619" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-5620"><a href="#cb31-5620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5621"><a href="#cb31-5621" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-5622"><a href="#cb31-5622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5623"><a href="#cb31-5623" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb31-5624"><a href="#cb31-5624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5625"><a href="#cb31-5625" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5626"><a href="#cb31-5626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5627"><a href="#cb31-5627" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-5628"><a href="#cb31-5628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5629"><a href="#cb31-5629" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-5630"><a href="#cb31-5630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5631"><a href="#cb31-5631" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_2.png)</span></span>
<span id="cb31-5632"><a href="#cb31-5632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5633"><a href="#cb31-5633" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-5634"><a href="#cb31-5634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5635"><a href="#cb31-5635" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_main_its.png)</span></span>
<span id="cb31-5636"><a href="#cb31-5636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5637"><a href="#cb31-5637" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5638"><a href="#cb31-5638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5639"><a href="#cb31-5639" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-5640"><a href="#cb31-5640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5641"><a href="#cb31-5641" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5642"><a href="#cb31-5642" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 2 data pack</span><span class="co">](include/pub/SOM/Supplementary_Figure_2.rds)</span>  </span>
<span id="cb31-5643"><a href="#cb31-5643" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5644"><a href="#cb31-5644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5645"><a href="#cb31-5645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5646"><a href="#cb31-5646" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5647"><a href="#cb31-5647" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 2 raw  pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_2.pdf)</span></span>
<span id="cb31-5648"><a href="#cb31-5648" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5649"><a href="#cb31-5649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5650"><a href="#cb31-5650" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5651"><a href="#cb31-5651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5654"><a href="#cb31-5654" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-5655"><a href="#cb31-5655" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Supplementary Figure 2"</span></span>
<span id="cb31-5656"><a href="#cb31-5656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5657"><a href="#cb31-5657" aria-hidden="true" tabindex="-1"></a>its18_ps_work <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/SOM/Supplementary_Figure_2.rds"</span>)</span>
<span id="cb31-5658"><a href="#cb31-5658" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-5659"><a href="#cb31-5659" aria-hidden="true" tabindex="-1"></a>its18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_work"</span>)</span>
<span id="cb31-5660"><a href="#cb31-5660" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Choose the **number** of taxa to display and the </span></span>
<span id="cb31-5661"><a href="#cb31-5661" aria-hidden="true" tabindex="-1"></a><span class="do">## taxonomic **level**. Aggregate the rest into "Other".</span></span>
<span id="cb31-5662"><a href="#cb31-5662" aria-hidden="true" tabindex="-1"></a>top_hits <span class="ot">&lt;-</span> <span class="dv">14</span></span>
<span id="cb31-5663"><a href="#cb31-5663" aria-hidden="true" tabindex="-1"></a>top_level <span class="ot">&lt;-</span> <span class="st">"Order"</span></span>
<span id="cb31-5664"><a href="#cb31-5664" aria-hidden="true" tabindex="-1"></a><span class="do">## As above, in order to use `microeco`, we need to add the rank </span></span>
<span id="cb31-5665"><a href="#cb31-5665" aria-hidden="true" tabindex="-1"></a><span class="do">## designation as a prefix to each taxa. For example, `Basidiomycota` </span></span>
<span id="cb31-5666"><a href="#cb31-5666" aria-hidden="true" tabindex="-1"></a><span class="do">## is changed to `p__Basidiomycota`. </span></span>
<span id="cb31-5667"><a href="#cb31-5667" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-5668"><a href="#cb31-5668" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5669"><a href="#cb31-5669" aria-hidden="true" tabindex="-1"></a>  tmp_sam_data <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(tmp_get)</span>
<span id="cb31-5670"><a href="#cb31-5670" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-5671"><a href="#cb31-5671" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_ID <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Some have, some do not</span></span>
<span id="cb31-5672"><a href="#cb31-5672" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-5673"><a href="#cb31-5673" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5674"><a href="#cb31-5674" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Kingdom <span class="ot">&lt;-</span></span>
<span id="cb31-5675"><a href="#cb31-5675" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"k__"</span>, tmp_tax_data<span class="sc">$</span>Kingdom, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5676"><a href="#cb31-5676" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Phylum <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"p__"</span>, tmp_tax_data<span class="sc">$</span>Phylum, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5677"><a href="#cb31-5677" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"c__"</span>, tmp_tax_data<span class="sc">$</span>Class, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5678"><a href="#cb31-5678" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Order <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"o__"</span>, tmp_tax_data<span class="sc">$</span>Order, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5679"><a href="#cb31-5679" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Family <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"f__"</span>, tmp_tax_data<span class="sc">$</span>Family, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5680"><a href="#cb31-5680" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data<span class="sc">$</span>Genus <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"g__"</span>, tmp_tax_data<span class="sc">$</span>Genus, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-5681"><a href="#cb31-5681" aria-hidden="true" tabindex="-1"></a>  tmp_tax_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_tax_data)</span>
<span id="cb31-5682"><a href="#cb31-5682" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5683"><a href="#cb31-5683" aria-hidden="true" tabindex="-1"></a>  tmp_ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(tmp_get),</span>
<span id="cb31-5684"><a href="#cb31-5684" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">tax_table</span>(tmp_tax_data),</span>
<span id="cb31-5685"><a href="#cb31-5685" aria-hidden="true" tabindex="-1"></a>                     tmp_sam_data)</span>
<span id="cb31-5686"><a href="#cb31-5686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_ps)</span>
<span id="cb31-5687"><a href="#cb31-5687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5688"><a href="#cb31-5688" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5689"><a href="#cb31-5689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5690"><a href="#cb31-5690" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-5691"><a href="#cb31-5691" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5692"><a href="#cb31-5692" aria-hidden="true" tabindex="-1"></a>  tmp_otu_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb31-5693"><a href="#cb31-5693" aria-hidden="true" tabindex="-1"></a>  tmp_sample_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb31-5694"><a href="#cb31-5694" aria-hidden="true" tabindex="-1"></a>  tmp_taxonomy_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-5695"><a href="#cb31-5695" aria-hidden="true" tabindex="-1"></a>  tmp_dataset <span class="ot">&lt;-</span> microtable<span class="sc">$</span><span class="fu">new</span>(<span class="at">sample_table =</span> tmp_sample_info,</span>
<span id="cb31-5696"><a href="#cb31-5696" aria-hidden="true" tabindex="-1"></a>                                <span class="at">otu_table =</span> tmp_otu_table,</span>
<span id="cb31-5697"><a href="#cb31-5697" aria-hidden="true" tabindex="-1"></a>                                <span class="at">tax_table =</span> tmp_taxonomy_table)</span>
<span id="cb31-5698"><a href="#cb31-5698" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb31-5699"><a href="#cb31-5699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb31-5700"><a href="#cb31-5700" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span>tax_table <span class="sc">%&lt;&gt;%</span> base<span class="sc">::</span><span class="fu">subset</span>(Kingdom <span class="sc">==</span> <span class="st">"k__Fungi"</span>)</span>
<span id="cb31-5701"><a href="#cb31-5701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb31-5702"><a href="#cb31-5702" aria-hidden="true" tabindex="-1"></a>  tmp_dataset<span class="sc">$</span><span class="fu">tidy_dataset</span>()</span>
<span id="cb31-5703"><a href="#cb31-5703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_dataset)</span>
<span id="cb31-5704"><a href="#cb31-5704" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>))</span>
<span id="cb31-5705"><a href="#cb31-5705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_dataset)</span>
<span id="cb31-5706"><a href="#cb31-5706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5707"><a href="#cb31-5707" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb31-5708"><a href="#cb31-5708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5709"><a href="#cb31-5709" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Now, we calculate the taxa abundance at each taxonomic </span></span>
<span id="cb31-5710"><a href="#cb31-5710" aria-hidden="true" tabindex="-1"></a><span class="do">## rank using `cal_abund()`. This function return a list called </span></span>
<span id="cb31-5711"><a href="#cb31-5711" aria-hidden="true" tabindex="-1"></a><span class="do">## `taxa_abund` containing several data frame of the abundance </span></span>
<span id="cb31-5712"><a href="#cb31-5712" aria-hidden="true" tabindex="-1"></a><span class="do">## information at each taxonomic rank. The list is stored in the </span></span>
<span id="cb31-5713"><a href="#cb31-5713" aria-hidden="true" tabindex="-1"></a><span class="do">## microtable object automatically. It’s worth noting that the </span></span>
<span id="cb31-5714"><a href="#cb31-5714" aria-hidden="true" tabindex="-1"></a><span class="do">## `cal_abund()` function can be used to solve some complex cases, </span></span>
<span id="cb31-5715"><a href="#cb31-5715" aria-hidden="true" tabindex="-1"></a><span class="do">## such as supporting both the relative and absolute abundance </span></span>
<span id="cb31-5716"><a href="#cb31-5716" aria-hidden="true" tabindex="-1"></a><span class="do">## calculation and selecting the partial taxonomic columns. </span></span>
<span id="cb31-5717"><a href="#cb31-5717" aria-hidden="true" tabindex="-1"></a><span class="do">## More information can be found in the description of the </span></span>
<span id="cb31-5718"><a href="#cb31-5718" aria-hidden="true" tabindex="-1"></a><span class="do">## [file2meco package](https://github.com/ChiLiubio/file2meco). </span></span>
<span id="cb31-5719"><a href="#cb31-5719" aria-hidden="true" tabindex="-1"></a><span class="do">## In the same loop we also create a `trans_abund` class, which </span></span>
<span id="cb31-5720"><a href="#cb31-5720" aria-hidden="true" tabindex="-1"></a><span class="do">## is used to transform taxonomic abundance data for plotting.</span></span>
<span id="cb31-5721"><a href="#cb31-5721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5722"><a href="#cb31-5722" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-5723"><a href="#cb31-5723" aria-hidden="true" tabindex="-1"></a>  tmp_me <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me"</span>)))</span>
<span id="cb31-5724"><a href="#cb31-5724" aria-hidden="true" tabindex="-1"></a>  tmp_me<span class="sc">$</span><span class="fu">cal_abund</span>()</span>
<span id="cb31-5725"><a href="#cb31-5725" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund <span class="ot">&lt;-</span></span>
<span id="cb31-5726"><a href="#cb31-5726" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(<span class="at">dataset =</span> tmp_me,</span>
<span id="cb31-5727"><a href="#cb31-5727" aria-hidden="true" tabindex="-1"></a>                    <span class="at">taxrank =</span> top_level,</span>
<span id="cb31-5728"><a href="#cb31-5728" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ntaxa =</span> top_hits)</span>
<span id="cb31-5729"><a href="#cb31-5729" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb31-5730"><a href="#cb31-5730" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb31-5731"><a href="#cb31-5731" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr <span class="ot">&lt;-</span></span>
<span id="cb31-5732"><a href="#cb31-5732" aria-hidden="true" tabindex="-1"></a>    trans_abund<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb31-5733"><a href="#cb31-5733" aria-hidden="true" tabindex="-1"></a>      <span class="at">dataset =</span> tmp_me,</span>
<span id="cb31-5734"><a href="#cb31-5734" aria-hidden="true" tabindex="-1"></a>      <span class="at">taxrank =</span> top_level,</span>
<span id="cb31-5735"><a href="#cb31-5735" aria-hidden="true" tabindex="-1"></a>      <span class="at">ntaxa =</span> top_hits,</span>
<span id="cb31-5736"><a href="#cb31-5736" aria-hidden="true" tabindex="-1"></a>      <span class="at">groupmean =</span> <span class="st">"TEMP"</span></span>
<span id="cb31-5737"><a href="#cb31-5737" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5738"><a href="#cb31-5738" aria-hidden="true" tabindex="-1"></a>  tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="ot">&lt;-</span></span>
<span id="cb31-5739"><a href="#cb31-5739" aria-hidden="true" tabindex="-1"></a>    tmp_me_abund_gr<span class="sc">$</span>abund_data<span class="sc">$</span>Abundance <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb31-5740"><a href="#cb31-5740" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>))</span>
<span id="cb31-5741"><a href="#cb31-5741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_me_abund)</span>
<span id="cb31-5742"><a href="#cb31-5742" aria-hidden="true" tabindex="-1"></a>  tmp_name_gr <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>))</span>
<span id="cb31-5743"><a href="#cb31-5743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_gr, tmp_me_abund_gr)</span>
<span id="cb31-5744"><a href="#cb31-5744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5745"><a href="#cb31-5745" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5746"><a href="#cb31-5746" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) I prefer to specify the order of taxa in these kinds of plots. </span></span>
<span id="cb31-5747"><a href="#cb31-5747" aria-hidden="true" tabindex="-1"></a><span class="do">## We can look the top `ntaxa` (defined above) by accessing the </span></span>
<span id="cb31-5748"><a href="#cb31-5748" aria-hidden="true" tabindex="-1"></a><span class="do">## `data_taxanames` character vector of each microtable object.</span></span>
<span id="cb31-5749"><a href="#cb31-5749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5750"><a href="#cb31-5750" aria-hidden="true" tabindex="-1"></a>its18_ps_work_tax_ord <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(</span>
<span id="cb31-5751"><a href="#cb31-5751" aria-hidden="true" tabindex="-1"></a>  <span class="st">"k_Fungi"</span>,  <span class="st">"p_Ascomycota"</span>,  <span class="st">"c_Agaricomycetes"</span>, <span class="st">"Agaricales"</span>,  </span>
<span id="cb31-5752"><a href="#cb31-5752" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Archaeorhizomycetales"</span>,  <span class="st">"Capnodiales"</span>,  <span class="st">"Eurotiales"</span>,  <span class="st">"Geastrales"</span>,  </span>
<span id="cb31-5753"><a href="#cb31-5753" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Glomerales"</span>,  <span class="st">"Helotiales"</span>, <span class="st">"Hypocreales"</span>,  <span class="st">"Saccharomycetales"</span>,  </span>
<span id="cb31-5754"><a href="#cb31-5754" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Trichosporonales"</span>,  <span class="st">"Xylariales"</span>))   </span>
<span id="cb31-5755"><a href="#cb31-5755" aria-hidden="true" tabindex="-1"></a><span class="do">## And one more little step before plotting. Here we  </span></span>
<span id="cb31-5756"><a href="#cb31-5756" aria-hidden="true" tabindex="-1"></a><span class="do">## **a**) specify a custom color palette and  </span></span>
<span id="cb31-5757"><a href="#cb31-5757" aria-hidden="true" tabindex="-1"></a><span class="do">## **b**) specify the sample order. </span></span>
<span id="cb31-5758"><a href="#cb31-5758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5759"><a href="#cb31-5759" aria-hidden="true" tabindex="-1"></a>its18_colvec.tax <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"#323232"</span>, <span class="st">"#004949"</span>, <span class="st">"#924900"</span>, <span class="st">"#490092"</span>, </span>
<span id="cb31-5760"><a href="#cb31-5760" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#6db6ff"</span>, <span class="st">"#920000"</span>, <span class="st">"#ffb6db"</span>, <span class="st">"#24ff24"</span>, </span>
<span id="cb31-5761"><a href="#cb31-5761" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#006ddb"</span>, <span class="st">"#db6d00"</span>, <span class="st">"#b66dff"</span>, <span class="st">"#ffff6d"</span>, </span>
<span id="cb31-5762"><a href="#cb31-5762" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#009292"</span>, <span class="st">"#b6dbff"</span>, <span class="st">"#ff6db6"</span>))</span>
<span id="cb31-5763"><a href="#cb31-5763" aria-hidden="true" tabindex="-1"></a>its18_samp_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P02_D00_010_C0A"</span>, <span class="st">"P04_D00_010_C0B"</span>, <span class="st">"P06_D00_010_C0C"</span>, </span>
<span id="cb31-5764"><a href="#cb31-5764" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P08_D00_010_C0D"</span>, <span class="st">"P10_D00_010_C0E"</span>, <span class="st">"P01_D00_010_W3A"</span>, </span>
<span id="cb31-5765"><a href="#cb31-5765" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P03_D00_010_W3B"</span>, <span class="st">"P07_D00_010_W3D"</span>, <span class="st">"P09_D00_010_W3E"</span>, </span>
<span id="cb31-5766"><a href="#cb31-5766" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P01_D00_010_W8A"</span>, <span class="st">"P03_D00_010_W8B"</span>, <span class="st">"P05_D00_010_W8C"</span>, </span>
<span id="cb31-5767"><a href="#cb31-5767" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"P07_D00_010_W8D"</span>)</span>
<span id="cb31-5768"><a href="#cb31-5768" aria-hidden="true" tabindex="-1"></a><span class="do">## 8) Now we can generate plots (in a loop) for each faceted data set.</span></span>
<span id="cb31-5769"><a href="#cb31-5769" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-5770"><a href="#cb31-5770" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund"</span>)))</span>
<span id="cb31-5771"><a href="#cb31-5771" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb31-5772"><a href="#cb31-5772" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb31-5773"><a href="#cb31-5773" aria-hidden="true" tabindex="-1"></a>  tmp_facet_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5774"><a href="#cb31-5774" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb31-5775"><a href="#cb31-5775" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> its18_colvec.tax,</span>
<span id="cb31-5776"><a href="#cb31-5776" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb31-5777"><a href="#cb31-5777" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet =</span> <span class="st">"TEMP"</span>,</span>
<span id="cb31-5778"><a href="#cb31-5778" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-5779"><a href="#cb31-5779" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5780"><a href="#cb31-5780" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5781"><a href="#cb31-5781" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">6</span>,</span>
<span id="cb31-5782"><a href="#cb31-5782" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span>,</span>
<span id="cb31-5783"><a href="#cb31-5783" aria-hidden="true" tabindex="-1"></a>      <span class="at">order_x =</span> its18_samp_order</span>
<span id="cb31-5784"><a href="#cb31-5784" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5785"><a href="#cb31-5785" aria-hidden="true" tabindex="-1"></a>  tmp_facet_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>))</span>
<span id="cb31-5786"><a href="#cb31-5786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_facet_name, tmp_facet_plot)</span>
<span id="cb31-5787"><a href="#cb31-5787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5788"><a href="#cb31-5788" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5789"><a href="#cb31-5789" aria-hidden="true" tabindex="-1"></a><span class="do">## Then add a little formatting to the faceted plots.</span></span>
<span id="cb31-5790"><a href="#cb31-5790" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_work_facet_plot"</span>)</span>
<span id="cb31-5791"><a href="#cb31-5791" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb31-5792"><a href="#cb31-5792" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5793"><a href="#cb31-5793" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb31-5794"><a href="#cb31-5794" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb31-5795"><a href="#cb31-5795" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb31-5796"><a href="#cb31-5796" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> top_level,</span>
<span id="cb31-5797"><a href="#cb31-5797" aria-hidden="true" tabindex="-1"></a>      <span class="at">reverse =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5798"><a href="#cb31-5798" aria-hidden="true" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fl">0.7</span>,</span>
<span id="cb31-5799"><a href="#cb31-5799" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fl">0.7</span></span>
<span id="cb31-5800"><a href="#cb31-5800" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb31-5801"><a href="#cb31-5801" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Sample"</span>) <span class="sc">+</span></span>
<span id="cb31-5802"><a href="#cb31-5802" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-5803"><a href="#cb31-5803" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5804"><a href="#cb31-5804" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5805"><a href="#cb31-5805" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5806"><a href="#cb31-5806" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5807"><a href="#cb31-5807" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb31-5808"><a href="#cb31-5808" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb31-5809"><a href="#cb31-5809" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb31-5810"><a href="#cb31-5810" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb31-5811"><a href="#cb31-5811" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb31-5812"><a href="#cb31-5812" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb31-5813"><a href="#cb31-5813" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb31-5814"><a href="#cb31-5814" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb31-5815"><a href="#cb31-5815" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb31-5816"><a href="#cb31-5816" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb31-5817"><a href="#cb31-5817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb31-5818"><a href="#cb31-5818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5819"><a href="#cb31-5819" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5820"><a href="#cb31-5820" aria-hidden="true" tabindex="-1"></a><span class="do">## And now plots for the groupmeans sets. </span></span>
<span id="cb31-5821"><a href="#cb31-5821" aria-hidden="true" tabindex="-1"></a><span class="do">## We can use the same taxa order since that </span></span>
<span id="cb31-5822"><a href="#cb31-5822" aria-hidden="true" tabindex="-1"></a><span class="do">## should not have changed.</span></span>
<span id="cb31-5823"><a href="#cb31-5823" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"its18_ps_work_group_plot"</span>)</span>
<span id="cb31-5824"><a href="#cb31-5824" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-5825"><a href="#cb31-5825" aria-hidden="true" tabindex="-1"></a>  tmp_abund <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_me_abund_group"</span>)))</span>
<span id="cb31-5826"><a href="#cb31-5826" aria-hidden="true" tabindex="-1"></a>  tmp_tax_order <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax_ord"</span>)))</span>
<span id="cb31-5827"><a href="#cb31-5827" aria-hidden="true" tabindex="-1"></a>  tmp_abund<span class="sc">$</span>data_taxanames <span class="ot">&lt;-</span> tmp_tax_order</span>
<span id="cb31-5828"><a href="#cb31-5828" aria-hidden="true" tabindex="-1"></a>  tmp_group_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5829"><a href="#cb31-5829" aria-hidden="true" tabindex="-1"></a>    tmp_abund<span class="sc">$</span><span class="fu">plot_bar</span>(</span>
<span id="cb31-5830"><a href="#cb31-5830" aria-hidden="true" tabindex="-1"></a>      <span class="at">color_values =</span> its18_colvec.tax,</span>
<span id="cb31-5831"><a href="#cb31-5831" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_color =</span> <span class="st">"#323232"</span>,</span>
<span id="cb31-5832"><a href="#cb31-5832" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_keep =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-5833"><a href="#cb31-5833" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_type_hor =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-5834"><a href="#cb31-5834" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend_text_italic =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-5835"><a href="#cb31-5835" aria-hidden="true" tabindex="-1"></a>      <span class="at">xtext_size =</span> <span class="dv">10</span>,</span>
<span id="cb31-5836"><a href="#cb31-5836" aria-hidden="true" tabindex="-1"></a>      <span class="at">facet_color =</span> <span class="st">"#cccccc"</span></span>
<span id="cb31-5837"><a href="#cb31-5837" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5838"><a href="#cb31-5838" aria-hidden="true" tabindex="-1"></a>  tmp_group_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>))</span>
<span id="cb31-5839"><a href="#cb31-5839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_group_name, tmp_group_plot)</span>
<span id="cb31-5840"><a href="#cb31-5840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5841"><a href="#cb31-5841" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5842"><a href="#cb31-5842" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's also add a little formatting to the groupmean plots.</span></span>
<span id="cb31-5843"><a href="#cb31-5843" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span>  set_to_plot) {</span>
<span id="cb31-5844"><a href="#cb31-5844" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-5845"><a href="#cb31-5845" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> tmp_get <span class="sc">+</span></span>
<span id="cb31-5846"><a href="#cb31-5846" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb31-5847"><a href="#cb31-5847" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative Abundance (% total reads)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Temperature"</span>) <span class="sc">+</span></span>
<span id="cb31-5848"><a href="#cb31-5848" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-5849"><a href="#cb31-5849" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5850"><a href="#cb31-5850" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-5851"><a href="#cb31-5851" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5852"><a href="#cb31-5852" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-5853"><a href="#cb31-5853" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb31-5854"><a href="#cb31-5854" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb31-5855"><a href="#cb31-5855" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb31-5856"><a href="#cb31-5856" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb31-5857"><a href="#cb31-5857" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb31-5858"><a href="#cb31-5858" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>()</span>
<span id="cb31-5859"><a href="#cb31-5859" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5860"><a href="#cb31-5860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(i, tmp_get)</span>
<span id="cb31-5861"><a href="#cb31-5861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5862"><a href="#cb31-5862" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5863"><a href="#cb31-5863" aria-hidden="true" tabindex="-1"></a><span class="do">## 10) Finally we use the `patchwork` package to combine the </span></span>
<span id="cb31-5864"><a href="#cb31-5864" aria-hidden="true" tabindex="-1"></a><span class="do">## two plots and customize the look.</span></span>
<span id="cb31-5865"><a href="#cb31-5865" aria-hidden="true" tabindex="-1"></a><span class="do">## single index that acts as an index for referencing elements (variables) in a list</span></span>
<span id="cb31-5866"><a href="#cb31-5866" aria-hidden="true" tabindex="-1"></a><span class="do">##  solution modified from this SO answerhttps://stackoverflow.com/a/54451460</span></span>
<span id="cb31-5867"><a href="#cb31-5867" aria-hidden="true" tabindex="-1"></a>var_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">var1 =</span> its18_data_sets,</span>
<span id="cb31-5868"><a href="#cb31-5868" aria-hidden="true" tabindex="-1"></a>                 <span class="at">var2 =</span> <span class="fu">c</span>(<span class="st">"FULL"</span>))</span>
<span id="cb31-5869"><a href="#cb31-5869" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(var_list<span class="sc">$</span>var1)) {</span>
<span id="cb31-5870"><a href="#cb31-5870" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final_name <span class="ot">&lt;-</span></span>
<span id="cb31-5871"><a href="#cb31-5871" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level, <span class="st">"_plot_final"</span>))</span>
<span id="cb31-5872"><a href="#cb31-5872" aria-hidden="true" tabindex="-1"></a>  tmp_set_type <span class="ot">&lt;-</span> var_list<span class="sc">$</span>var2[j]</span>
<span id="cb31-5873"><a href="#cb31-5873" aria-hidden="true" tabindex="-1"></a>  tmp_p_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5874"><a href="#cb31-5874" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_group_plot"</span>)))</span>
<span id="cb31-5875"><a href="#cb31-5875" aria-hidden="true" tabindex="-1"></a>  tmp_m_plot <span class="ot">&lt;-</span></span>
<span id="cb31-5876"><a href="#cb31-5876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(var_list<span class="sc">$</span>var1[j], <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_facet_plot"</span>)))</span>
<span id="cb31-5877"><a href="#cb31-5877" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_p_plot <span class="sc">+</span> tmp_m_plot</span>
<span id="cb31-5878"><a href="#cb31-5878" aria-hidden="true" tabindex="-1"></a>  tmp_plot_final <span class="ot">&lt;-</span> tmp_plot_final <span class="sc">+</span></span>
<span id="cb31-5879"><a href="#cb31-5879" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"a"</span>) <span class="sc">+</span></span>
<span id="cb31-5880"><a href="#cb31-5880" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb31-5881"><a href="#cb31-5881" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-5882"><a href="#cb31-5882" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb31-5883"><a href="#cb31-5883" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb31-5884"><a href="#cb31-5884" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb31-5885"><a href="#cb31-5885" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb31-5886"><a href="#cb31-5886" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb31-5887"><a href="#cb31-5887" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-5888"><a href="#cb31-5888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plot_final_name, tmp_plot_final)</span>
<span id="cb31-5889"><a href="#cb31-5889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5890"><a href="#cb31-5890" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5891"><a href="#cb31-5891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5892"><a href="#cb31-5892" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> its18_data_sets) {</span>
<span id="cb31-5893"><a href="#cb31-5893" aria-hidden="true" tabindex="-1"></a>   tmp_plot_final <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_"</span>, top_level,  <span class="st">"_plot_final"</span>)))</span>
<span id="cb31-5894"><a href="#cb31-5894" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-5895"><a href="#cb31-5895" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb31-5896"><a href="#cb31-5896" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/SOM/"</span>, i, <span class="st">"_tax_div_bar_plots.png"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-5897"><a href="#cb31-5897" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-5898"><a href="#cb31-5898" aria-hidden="true" tabindex="-1"></a>   ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-5899"><a href="#cb31-5899" aria-hidden="true" tabindex="-1"></a>     tmp_plot_final, </span>
<span id="cb31-5900"><a href="#cb31-5900" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/SOM/"</span>, i, <span class="st">"_tax_div_bar_plots.pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-5901"><a href="#cb31-5901" aria-hidden="true" tabindex="-1"></a>     <span class="at">height =</span> <span class="dv">2544</span>, <span class="at">width =</span> <span class="dv">5043</span>, <span class="at">units =</span> <span class="st">'px'</span>, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb31-5902"><a href="#cb31-5902" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-5903"><a href="#cb31-5903" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5904"><a href="#cb31-5904" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/SOM/its18_ps_work_tax_div_bar_plots.png"</span>, </span>
<span id="cb31-5905"><a href="#cb31-5905" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/SOM/Supplementary_Figure_2.png"</span>)</span>
<span id="cb31-5906"><a href="#cb31-5906" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="st">"include/pub/SOM/its18_ps_work_tax_div_bar_plots.pdf"</span>, </span>
<span id="cb31-5907"><a href="#cb31-5907" aria-hidden="true" tabindex="-1"></a>            <span class="st">"include/pub/SOM/Supplementary_Figure_2.pdf"</span>)</span>
<span id="cb31-5908"><a href="#cb31-5908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-5909"><a href="#cb31-5909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5910"><a href="#cb31-5910" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 3</span></span>
<span id="cb31-5911"><a href="#cb31-5911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5912"><a href="#cb31-5912" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-5913"><a href="#cb31-5913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5914"><a href="#cb31-5914" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-5915"><a href="#cb31-5915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5916"><a href="#cb31-5916" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<span class="in">`*`</span>). </span>
<span id="cb31-5917"><a href="#cb31-5917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5918"><a href="#cb31-5918" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5919"><a href="#cb31-5919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5920"><a href="#cb31-5920" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-5921"><a href="#cb31-5921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5922"><a href="#cb31-5922" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-5923"><a href="#cb31-5923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5924"><a href="#cb31-5924" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_3.png)</span></span>
<span id="cb31-5925"><a href="#cb31-5925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5926"><a href="#cb31-5926" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-5927"><a href="#cb31-5927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5928"><a href="#cb31-5928" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/ssu_supp_alpha_div.png)</span></span>
<span id="cb31-5929"><a href="#cb31-5929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5930"><a href="#cb31-5930" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5931"><a href="#cb31-5931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5932"><a href="#cb31-5932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5933"><a href="#cb31-5933" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-5934"><a href="#cb31-5934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5935"><a href="#cb31-5935" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5936"><a href="#cb31-5936" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 3 data pack</span><span class="co">](include/pub/SOM/Supplementary_Figure_3.rdata)</span>  </span>
<span id="cb31-5937"><a href="#cb31-5937" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5938"><a href="#cb31-5938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5939"><a href="#cb31-5939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5940"><a href="#cb31-5940" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-5941"><a href="#cb31-5941" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 3 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_3.pdf)</span></span>
<span id="cb31-5942"><a href="#cb31-5942" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5943"><a href="#cb31-5943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5944"><a href="#cb31-5944" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-5945"><a href="#cb31-5945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5948"><a href="#cb31-5948" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-5949"><a href="#cb31-5949" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Supplementary Figure 3"</span></span>
<span id="cb31-5950"><a href="#cb31-5950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5951"><a href="#cb31-5951" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-5952"><a href="#cb31-5952" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/SOM/Supplementary_Figure_3.rdata"</span>)</span>
<span id="cb31-5953"><a href="#cb31-5953" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-5954"><a href="#cb31-5954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5955"><a href="#cb31-5955" aria-hidden="true" tabindex="-1"></a>div_test_plot_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (divtest, chart, colour, posthoc, threshold) </span>
<span id="cb31-5956"><a href="#cb31-5956" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-5957"><a href="#cb31-5957" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(chart)) {</span>
<span id="cb31-5958"><a href="#cb31-5958" aria-hidden="true" tabindex="-1"></a>        chart <span class="ot">=</span> <span class="st">"box"</span></span>
<span id="cb31-5959"><a href="#cb31-5959" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-5960"><a href="#cb31-5960" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(posthoc)) {</span>
<span id="cb31-5961"><a href="#cb31-5961" aria-hidden="true" tabindex="-1"></a>        posthoc <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb31-5962"><a href="#cb31-5962" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-5963"><a href="#cb31-5963" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">names</span>(divtest)[<span class="dv">1</span>] <span class="sc">!=</span> <span class="st">"data"</span>) <span class="sc">&amp;</span> (<span class="fu">names</span>(divtest)[<span class="dv">2</span>] <span class="sc">!=</span> </span>
<span id="cb31-5964"><a href="#cb31-5964" aria-hidden="true" tabindex="-1"></a>        <span class="st">"normality.pvalue"</span>)) </span>
<span id="cb31-5965"><a href="#cb31-5965" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"The input object does not seem to be a div_test output."</span>)</span>
<span id="cb31-5966"><a href="#cb31-5966" aria-hidden="true" tabindex="-1"></a>    divtestdata <span class="ot">&lt;-</span> divtest<span class="sc">$</span>data</span>
<span id="cb31-5967"><a href="#cb31-5967" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(divtestdata<span class="sc">$</span>Group)</span>
<span id="cb31-5968"><a href="#cb31-5968" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(divtestdata<span class="sc">$</span>Group, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(divtestdata<span class="sc">$</span>Group)))</span>
<span id="cb31-5969"><a href="#cb31-5969" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(colour) <span class="sc">||</span> (<span class="fu">length</span>(colour) <span class="sc">&lt;</span> divtest<span class="sc">$</span>groups)) {</span>
<span id="cb31-5970"><a href="#cb31-5970" aria-hidden="true" tabindex="-1"></a>        getPalette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(divtest<span class="sc">$</span>groups, </span>
<span id="cb31-5971"><a href="#cb31-5971" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Paired"</span>))</span>
<span id="cb31-5972"><a href="#cb31-5972" aria-hidden="true" tabindex="-1"></a>        colour <span class="ot">&lt;-</span> <span class="fu">getPalette</span>(divtest<span class="sc">$</span>groups)</span>
<span id="cb31-5973"><a href="#cb31-5973" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-5974"><a href="#cb31-5974" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-5975"><a href="#cb31-5975" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">names</span>(divtest)[<span class="dv">7</span>])) </span>
<span id="cb31-5976"><a href="#cb31-5976" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span id="cb31-5977"><a href="#cb31-5977" aria-hidden="true" tabindex="-1"></a><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span>)</span>
<span id="cb31-5978"><a href="#cb31-5978" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Tukey post-hoc test"</span>) {</span>
<span id="cb31-5979"><a href="#cb31-5979" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb31-5980"><a href="#cb31-5980" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb31-5981"><a href="#cb31-5981" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-5982"><a href="#cb31-5982" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">4</span>], <span class="dv">4</span>)</span>
<span id="cb31-5983"><a href="#cb31-5983" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb31-5984"><a href="#cb31-5984" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb31-5985"><a href="#cb31-5985" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb31-5986"><a href="#cb31-5986" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb31-5987"><a href="#cb31-5987" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-5988"><a href="#cb31-5988" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span>) {</span>
<span id="cb31-5989"><a href="#cb31-5989" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb31-5990"><a href="#cb31-5990" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb31-5991"><a href="#cb31-5991" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-5992"><a href="#cb31-5992" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">3</span>], <span class="dv">4</span>)</span>
<span id="cb31-5993"><a href="#cb31-5993" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb31-5994"><a href="#cb31-5994" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb31-5995"><a href="#cb31-5995" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb31-5996"><a href="#cb31-5996" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb31-5997"><a href="#cb31-5997" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-5998"><a href="#cb31-5998" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">1</span>])</span>
<span id="cb31-5999"><a href="#cb31-5999" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">2</span>])</span>
<span id="cb31-6000"><a href="#cb31-6000" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(pairwisetable[, </span>
<span id="cb31-6001"><a href="#cb31-6001" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>]))</span>
<span id="cb31-6002"><a href="#cb31-6002" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(threshold)) {</span>
<span id="cb31-6003"><a href="#cb31-6003" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> pairwisetable[<span class="fu">which</span>(pairwisetable<span class="sc">$</span>p <span class="sc">&lt;</span> </span>
<span id="cb31-6004"><a href="#cb31-6004" aria-hidden="true" tabindex="-1"></a>                threshold), ]</span>
<span id="cb31-6005"><a href="#cb31-6005" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6006"><a href="#cb31-6006" aria-hidden="true" tabindex="-1"></a>        sortedgroups <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(pairwisetable<span class="sc">$</span>group1, pairwisetable<span class="sc">$</span>group2)))</span>
<span id="cb31-6007"><a href="#cb31-6007" aria-hidden="true" tabindex="-1"></a>        datamax <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">max</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb31-6008"><a href="#cb31-6008" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb31-6009"><a href="#cb31-6009" aria-hidden="true" tabindex="-1"></a>        datamin <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">min</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb31-6010"><a href="#cb31-6010" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb31-6011"><a href="#cb31-6011" aria-hidden="true" tabindex="-1"></a>        datarange <span class="ot">&lt;-</span> datamax <span class="sc">-</span> datamin</span>
<span id="cb31-6012"><a href="#cb31-6012" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">&lt;-</span> datarange <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb31-6013"><a href="#cb31-6013" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">&lt;-</span> datamax</span>
<span id="cb31-6014"><a href="#cb31-6014" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">&lt;-</span> min <span class="sc">+</span> (by <span class="sc">*</span> <span class="fu">nrow</span>(pairwisetable))</span>
<span id="cb31-6015"><a href="#cb31-6015" aria-hidden="true" tabindex="-1"></a>        ypos <span class="ot">&lt;-</span> <span class="fu">seq</span>(min, max, by)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb31-6016"><a href="#cb31-6016" aria-hidden="true" tabindex="-1"></a>        pairwisetable<span class="sc">$</span>ypos <span class="ot">&lt;-</span> ypos</span>
<span id="cb31-6017"><a href="#cb31-6017" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6018"><a href="#cb31-6018" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"box"</span>) {</span>
<span id="cb31-6019"><a href="#cb31-6019" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">outlier.size =</span> <span class="dv">3</span>,</span>
<span id="cb31-6020"><a href="#cb31-6020" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb31-6021"><a href="#cb31-6021" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-6022"><a href="#cb31-6022" aria-hidden="true" tabindex="-1"></a>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span id="cb31-6023"><a href="#cb31-6023" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb31-6024"><a href="#cb31-6024" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb31-6025"><a href="#cb31-6025" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_linetype_manual</span>()</span>
<span id="cb31-6026"><a href="#cb31-6026" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-6027"><a href="#cb31-6027" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-6028"><a href="#cb31-6028" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-6029"><a href="#cb31-6029" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6030"><a href="#cb31-6030" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(plot)</span>
<span id="cb31-6031"><a href="#cb31-6031" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6032"><a href="#cb31-6032" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"jitter"</span>) {</span>
<span id="cb31-6033"><a href="#cb31-6033" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb31-6034"><a href="#cb31-6034" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb31-6035"><a href="#cb31-6035" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-6036"><a href="#cb31-6036" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-6037"><a href="#cb31-6037" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>))</span>
<span id="cb31-6038"><a href="#cb31-6038" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-6039"><a href="#cb31-6039" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-6040"><a href="#cb31-6040" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-6041"><a href="#cb31-6041" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6042"><a href="#cb31-6042" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb31-6043"><a href="#cb31-6043" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6044"><a href="#cb31-6044" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"violin"</span>) {</span>
<span id="cb31-6045"><a href="#cb31-6045" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggviolin</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb31-6046"><a href="#cb31-6046" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb31-6047"><a href="#cb31-6047" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-6048"><a href="#cb31-6048" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-6049"><a href="#cb31-6049" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-6050"><a href="#cb31-6050" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>))</span>
<span id="cb31-6051"><a href="#cb31-6051" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-6052"><a href="#cb31-6052" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-6053"><a href="#cb31-6053" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-6054"><a href="#cb31-6054" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6055"><a href="#cb31-6055" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb31-6056"><a href="#cb31-6056" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6057"><a href="#cb31-6057" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6058"><a href="#cb31-6058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6059"><a href="#cb31-6059" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb31-6060"><a href="#cb31-6060" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb31-6061"><a href="#cb31-6061" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb31-6062"><a href="#cb31-6062" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-6063"><a href="#cb31-6063" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get,</span>
<span id="cb31-6064"><a href="#cb31-6064" aria-hidden="true" tabindex="-1"></a>                              <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb31-6065"><a href="#cb31-6065" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colour    =</span> swel_col,</span>
<span id="cb31-6066"><a href="#cb31-6066" aria-hidden="true" tabindex="-1"></a>                              <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6067"><a href="#cb31-6067" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb31-6068"><a href="#cb31-6068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-6069"><a href="#cb31-6069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-6070"><a href="#cb31-6070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6071"><a href="#cb31-6071" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6072"><a href="#cb31-6072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6073"><a href="#cb31-6073" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>)) {</span>
<span id="cb31-6074"><a href="#cb31-6074" aria-hidden="true" tabindex="-1"></a>  tmp_split <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(i, <span class="st">"_"</span>)</span>
<span id="cb31-6075"><a href="#cb31-6075" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6076"><a href="#cb31-6076" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"work"</span>) {</span>
<span id="cb31-6077"><a href="#cb31-6077" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"f"</span></span>
<span id="cb31-6078"><a href="#cb31-6078" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FULL"</span></span>
<span id="cb31-6079"><a href="#cb31-6079" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"filt"</span>) {</span>
<span id="cb31-6080"><a href="#cb31-6080" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"l"</span></span>
<span id="cb31-6081"><a href="#cb31-6081" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FILT"</span></span>
<span id="cb31-6082"><a href="#cb31-6082" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"perfect"</span>) {</span>
<span id="cb31-6083"><a href="#cb31-6083" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"r"</span></span>
<span id="cb31-6084"><a href="#cb31-6084" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb31-6085"><a href="#cb31-6085" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"pime"</span>) {</span>
<span id="cb31-6086"><a href="#cb31-6086" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"p"</span></span>
<span id="cb31-6087"><a href="#cb31-6087" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PIME"</span></span>
<span id="cb31-6088"><a href="#cb31-6088" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-6089"><a href="#cb31-6089" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6090"><a href="#cb31-6090" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q0"</span>) {</span>
<span id="cb31-6091"><a href="#cb31-6091" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"0"</span></span>
<span id="cb31-6092"><a href="#cb31-6092" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb31-6093"><a href="#cb31-6093" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q1"</span>) {</span>
<span id="cb31-6094"><a href="#cb31-6094" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb31-6095"><a href="#cb31-6095" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb31-6096"><a href="#cb31-6096" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q2"</span>) {</span>
<span id="cb31-6097"><a href="#cb31-6097" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"2"</span></span>
<span id="cb31-6098"><a href="#cb31-6098" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb31-6099"><a href="#cb31-6099" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-6100"><a href="#cb31-6100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6101"><a href="#cb31-6101" aria-hidden="true" tabindex="-1"></a>  tmp_var <span class="ot">&lt;-</span></span>
<span id="cb31-6102"><a href="#cb31-6102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_split[[<span class="dv">1</span>]][<span class="dv">1</span>], <span class="st">"_asv"</span>, tmp_ds, tmp_hill, <span class="st">"_lab"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-6103"><a href="#cb31-6103" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(tmp_name1, <span class="st">" ("</span>, tmp_name2, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-6104"><a href="#cb31-6104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_var, tmp_name)</span>
<span id="cb31-6105"><a href="#cb31-6105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6106"><a href="#cb31-6106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6107"><a href="#cb31-6107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6108"><a href="#cb31-6108" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_work_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6109"><a href="#cb31-6109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6110"><a href="#cb31-6110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvf0_lab) <span class="sc">+</span></span>
<span id="cb31-6111"><a href="#cb31-6111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6112"><a href="#cb31-6112" aria-hidden="true" tabindex="-1"></a>ssu18_ps_filt_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_filt_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6113"><a href="#cb31-6113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6114"><a href="#cb31-6114" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6115"><a href="#cb31-6115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvl0_lab) <span class="sc">+</span></span>
<span id="cb31-6116"><a href="#cb31-6116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6117"><a href="#cb31-6117" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6118"><a href="#cb31-6118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6119"><a href="#cb31-6119" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6120"><a href="#cb31-6120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvr0_lab) <span class="sc">+</span></span>
<span id="cb31-6121"><a href="#cb31-6121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6122"><a href="#cb31-6122" aria-hidden="true" tabindex="-1"></a>ssu18_ps_pime_q0_adt_plot <span class="ot">&lt;-</span> ssu18_ps_pime_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6123"><a href="#cb31-6123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6124"><a href="#cb31-6124" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6125"><a href="#cb31-6125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvp0_lab) <span class="sc">+</span></span>
<span id="cb31-6126"><a href="#cb31-6126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6127"><a href="#cb31-6127" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb31-6128"><a href="#cb31-6128" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_work_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6129"><a href="#cb31-6129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6130"><a href="#cb31-6130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvf1_lab) <span class="sc">+</span></span>
<span id="cb31-6131"><a href="#cb31-6131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6132"><a href="#cb31-6132" aria-hidden="true" tabindex="-1"></a>ssu18_ps_filt_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_filt_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6133"><a href="#cb31-6133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6134"><a href="#cb31-6134" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6135"><a href="#cb31-6135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvl1_lab) <span class="sc">+</span></span>
<span id="cb31-6136"><a href="#cb31-6136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6137"><a href="#cb31-6137" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6138"><a href="#cb31-6138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6139"><a href="#cb31-6139" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6140"><a href="#cb31-6140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvr1_lab) <span class="sc">+</span></span>
<span id="cb31-6141"><a href="#cb31-6141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6142"><a href="#cb31-6142" aria-hidden="true" tabindex="-1"></a>ssu18_ps_pime_q1_adt_plot <span class="ot">&lt;-</span> ssu18_ps_pime_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6143"><a href="#cb31-6143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6144"><a href="#cb31-6144" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6145"><a href="#cb31-6145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvp1_lab) <span class="sc">+</span></span>
<span id="cb31-6146"><a href="#cb31-6146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6147"><a href="#cb31-6147" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb31-6148"><a href="#cb31-6148" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_work_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6149"><a href="#cb31-6149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvf2_lab) <span class="sc">+</span></span>
<span id="cb31-6150"><a href="#cb31-6150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6151"><a href="#cb31-6151" aria-hidden="true" tabindex="-1"></a>ssu18_ps_filt_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_filt_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6152"><a href="#cb31-6152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6153"><a href="#cb31-6153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvl2_lab) <span class="sc">+</span></span>
<span id="cb31-6154"><a href="#cb31-6154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6155"><a href="#cb31-6155" aria-hidden="true" tabindex="-1"></a>ssu18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6156"><a href="#cb31-6156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6157"><a href="#cb31-6157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvr2_lab) <span class="sc">+</span></span>
<span id="cb31-6158"><a href="#cb31-6158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6159"><a href="#cb31-6159" aria-hidden="true" tabindex="-1"></a>ssu18_ps_pime_q2_adt_plot <span class="ot">&lt;-</span> ssu18_ps_pime_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6160"><a href="#cb31-6160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6161"><a href="#cb31-6161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(ssu18_asvp2_lab) <span class="sc">+</span></span>
<span id="cb31-6162"><a href="#cb31-6162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6163"><a href="#cb31-6163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6164"><a href="#cb31-6164" aria-hidden="true" tabindex="-1"></a>ssu18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb31-6165"><a href="#cb31-6165" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_work_q0_adt_plot,</span>
<span id="cb31-6166"><a href="#cb31-6166" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_filt_q0_adt_plot,</span>
<span id="cb31-6167"><a href="#cb31-6167" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q0_adt_plot,</span>
<span id="cb31-6168"><a href="#cb31-6168" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_pime_q0_adt_plot,</span>
<span id="cb31-6169"><a href="#cb31-6169" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_work_q1_adt_plot,</span>
<span id="cb31-6170"><a href="#cb31-6170" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_filt_q1_adt_plot,</span>
<span id="cb31-6171"><a href="#cb31-6171" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q1_adt_plot,</span>
<span id="cb31-6172"><a href="#cb31-6172" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_pime_q1_adt_plot,</span>
<span id="cb31-6173"><a href="#cb31-6173" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_work_q2_adt_plot,</span>
<span id="cb31-6174"><a href="#cb31-6174" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_filt_q2_adt_plot,</span>
<span id="cb31-6175"><a href="#cb31-6175" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_perfect_q2_adt_plot,</span>
<span id="cb31-6176"><a href="#cb31-6176" aria-hidden="true" tabindex="-1"></a>  ssu18_ps_pime_q2_adt_plot,</span>
<span id="cb31-6177"><a href="#cb31-6177" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb31-6178"><a href="#cb31-6178" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span></span>
<span id="cb31-6179"><a href="#cb31-6179" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6180"><a href="#cb31-6180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6181"><a href="#cb31-6181" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6182"><a href="#cb31-6182" aria-hidden="true" tabindex="-1"></a>  ssu18_alph_div_plots_asv,</span>
<span id="cb31-6183"><a href="#cb31-6183" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.png"</span>,</span>
<span id="cb31-6184"><a href="#cb31-6184" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb31-6185"><a href="#cb31-6185" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb31-6186"><a href="#cb31-6186" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6187"><a href="#cb31-6187" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6188"><a href="#cb31-6188" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6189"><a href="#cb31-6189" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6190"><a href="#cb31-6190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6191"><a href="#cb31-6191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6192"><a href="#cb31-6192" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6193"><a href="#cb31-6193" aria-hidden="true" tabindex="-1"></a>  ssu18_alph_div_plots_asv,</span>
<span id="cb31-6194"><a href="#cb31-6194" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb31-6195"><a href="#cb31-6195" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb31-6196"><a href="#cb31-6196" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb31-6197"><a href="#cb31-6197" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6198"><a href="#cb31-6198" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6199"><a href="#cb31-6199" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6200"><a href="#cb31-6200" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6201"><a href="#cb31-6201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6202"><a href="#cb31-6202" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6203"><a href="#cb31-6203" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.png"</span>,</span>
<span id="cb31-6204"><a href="#cb31-6204" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_3.png"</span></span>
<span id="cb31-6205"><a href="#cb31-6205" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6206"><a href="#cb31-6206" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6207"><a href="#cb31-6207" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/ssu18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb31-6208"><a href="#cb31-6208" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_3.pdf"</span></span>
<span id="cb31-6209"><a href="#cb31-6209" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6210"><a href="#cb31-6210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-6211"><a href="#cb31-6211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6212"><a href="#cb31-6212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6213"><a href="#cb31-6213" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 4</span></span>
<span id="cb31-6214"><a href="#cb31-6214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6215"><a href="#cb31-6215" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-6216"><a href="#cb31-6216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6217"><a href="#cb31-6217" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-6218"><a href="#cb31-6218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6219"><a href="#cb31-6219" aria-hidden="true" tabindex="-1"></a>Post processing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, removing non-significant values from plots, and changing significant p-values to asterisks (<span class="in">`*`</span>). </span>
<span id="cb31-6220"><a href="#cb31-6220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6221"><a href="#cb31-6221" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6222"><a href="#cb31-6222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6223"><a href="#cb31-6223" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-6224"><a href="#cb31-6224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6225"><a href="#cb31-6225" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-6226"><a href="#cb31-6226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6227"><a href="#cb31-6227" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_4.png)</span></span>
<span id="cb31-6228"><a href="#cb31-6228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6229"><a href="#cb31-6229" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-6230"><a href="#cb31-6230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6231"><a href="#cb31-6231" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/its_supp_alpha_div.png)</span></span>
<span id="cb31-6232"><a href="#cb31-6232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6233"><a href="#cb31-6233" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6234"><a href="#cb31-6234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6235"><a href="#cb31-6235" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-6236"><a href="#cb31-6236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6237"><a href="#cb31-6237" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-6238"><a href="#cb31-6238" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 4 data pack</span><span class="co">](include/pub/SOM/Supplementary_Figure_4.rdata)</span>  </span>
<span id="cb31-6239"><a href="#cb31-6239" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6240"><a href="#cb31-6240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6241"><a href="#cb31-6241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6242"><a href="#cb31-6242" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-6243"><a href="#cb31-6243" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 4 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_4.pdf)</span></span>
<span id="cb31-6244"><a href="#cb31-6244" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6245"><a href="#cb31-6245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6246"><a href="#cb31-6246" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6247"><a href="#cb31-6247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6250"><a href="#cb31-6250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-6251"><a href="#cb31-6251" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Supplementary Figure 4"</span></span>
<span id="cb31-6252"><a href="#cb31-6252" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-6253"><a href="#cb31-6253" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"include/pub/SOM/Supplementary_Figure_4.rdata"</span>)</span>
<span id="cb31-6254"><a href="#cb31-6254" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2271B2"</span>, <span class="st">"#71B222"</span>, <span class="st">"#B22271"</span>)</span>
<span id="cb31-6255"><a href="#cb31-6255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6256"><a href="#cb31-6256" aria-hidden="true" tabindex="-1"></a>div_test_plot_jjs <span class="ot">&lt;-</span> <span class="cf">function</span> (divtest, chart, colour, posthoc, threshold) </span>
<span id="cb31-6257"><a href="#cb31-6257" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-6258"><a href="#cb31-6258" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(chart)) {</span>
<span id="cb31-6259"><a href="#cb31-6259" aria-hidden="true" tabindex="-1"></a>        chart <span class="ot">=</span> <span class="st">"box"</span></span>
<span id="cb31-6260"><a href="#cb31-6260" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6261"><a href="#cb31-6261" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(posthoc)) {</span>
<span id="cb31-6262"><a href="#cb31-6262" aria-hidden="true" tabindex="-1"></a>        posthoc <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb31-6263"><a href="#cb31-6263" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6264"><a href="#cb31-6264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="fu">names</span>(divtest)[<span class="dv">1</span>] <span class="sc">!=</span> <span class="st">"data"</span>) <span class="sc">&amp;</span> (<span class="fu">names</span>(divtest)[<span class="dv">2</span>] <span class="sc">!=</span> </span>
<span id="cb31-6265"><a href="#cb31-6265" aria-hidden="true" tabindex="-1"></a>        <span class="st">"normality.pvalue"</span>)) </span>
<span id="cb31-6266"><a href="#cb31-6266" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"The input object does not seem to be a div_test output."</span>)</span>
<span id="cb31-6267"><a href="#cb31-6267" aria-hidden="true" tabindex="-1"></a>    divtestdata <span class="ot">&lt;-</span> divtest<span class="sc">$</span>data</span>
<span id="cb31-6268"><a href="#cb31-6268" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(divtestdata<span class="sc">$</span>Group)</span>
<span id="cb31-6269"><a href="#cb31-6269" aria-hidden="true" tabindex="-1"></a>    divtestdata<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(divtestdata<span class="sc">$</span>Group, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(divtestdata<span class="sc">$</span>Group)))</span>
<span id="cb31-6270"><a href="#cb31-6270" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">missing</span>(colour) <span class="sc">||</span> (<span class="fu">length</span>(colour) <span class="sc">&lt;</span> divtest<span class="sc">$</span>groups)) {</span>
<span id="cb31-6271"><a href="#cb31-6271" aria-hidden="true" tabindex="-1"></a>        getPalette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(divtest<span class="sc">$</span>groups, </span>
<span id="cb31-6272"><a href="#cb31-6272" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Paired"</span>))</span>
<span id="cb31-6273"><a href="#cb31-6273" aria-hidden="true" tabindex="-1"></a>        colour <span class="ot">&lt;-</span> <span class="fu">getPalette</span>(divtest<span class="sc">$</span>groups)</span>
<span id="cb31-6274"><a href="#cb31-6274" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6275"><a href="#cb31-6275" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-6276"><a href="#cb31-6276" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(<span class="fu">names</span>(divtest)[<span class="dv">7</span>])) </span>
<span id="cb31-6277"><a href="#cb31-6277" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">"The input div_test object does not seem to contain pairwise posthoc data. </span></span>
<span id="cb31-6278"><a href="#cb31-6278" aria-hidden="true" tabindex="-1"></a><span class="st">                 Re-run div_test() using 'posthoc=TRUE' argument."</span>)</span>
<span id="cb31-6279"><a href="#cb31-6279" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Tukey post-hoc test"</span>) {</span>
<span id="cb31-6280"><a href="#cb31-6280" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb31-6281"><a href="#cb31-6281" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb31-6282"><a href="#cb31-6282" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6283"><a href="#cb31-6283" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">4</span>], <span class="dv">4</span>)</span>
<span id="cb31-6284"><a href="#cb31-6284" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb31-6285"><a href="#cb31-6285" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb31-6286"><a href="#cb31-6286" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb31-6287"><a href="#cb31-6287" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb31-6288"><a href="#cb31-6288" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6289"><a href="#cb31-6289" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (divtest[<span class="dv">7</span>] <span class="sc">==</span> <span class="st">"Dunn test with Benjamini-Hochberg correction"</span>) {</span>
<span id="cb31-6290"><a href="#cb31-6290" aria-hidden="true" tabindex="-1"></a>            combinations <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">gsub</span>(<span class="st">" $"</span>, <span class="st">""</span>, <span class="fu">gsub</span>(<span class="st">"^ "</span>, </span>
<span id="cb31-6291"><a href="#cb31-6291" aria-hidden="true" tabindex="-1"></a>                <span class="st">""</span>, <span class="fu">unlist</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(<span class="fu">rownames</span>(divtest<span class="sc">$</span>posthoc)), </span>
<span id="cb31-6292"><a href="#cb31-6292" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"-"</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)))), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6293"><a href="#cb31-6293" aria-hidden="true" tabindex="-1"></a>            pvalue <span class="ot">&lt;-</span> <span class="fu">round</span>(divtest<span class="sc">$</span>posthoc[, <span class="dv">3</span>], <span class="dv">4</span>)</span>
<span id="cb31-6294"><a href="#cb31-6294" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(combinations, </span>
<span id="cb31-6295"><a href="#cb31-6295" aria-hidden="true" tabindex="-1"></a>                pvalue))</span>
<span id="cb31-6296"><a href="#cb31-6296" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(pairwisetable) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>, </span>
<span id="cb31-6297"><a href="#cb31-6297" aria-hidden="true" tabindex="-1"></a>                <span class="st">"p"</span>)</span>
<span id="cb31-6298"><a href="#cb31-6298" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6299"><a href="#cb31-6299" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">1</span>])</span>
<span id="cb31-6300"><a href="#cb31-6300" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(pairwisetable[, <span class="dv">2</span>])</span>
<span id="cb31-6301"><a href="#cb31-6301" aria-hidden="true" tabindex="-1"></a>        pairwisetable[, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(pairwisetable[, </span>
<span id="cb31-6302"><a href="#cb31-6302" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>]))</span>
<span id="cb31-6303"><a href="#cb31-6303" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(threshold)) {</span>
<span id="cb31-6304"><a href="#cb31-6304" aria-hidden="true" tabindex="-1"></a>            pairwisetable <span class="ot">&lt;-</span> pairwisetable[<span class="fu">which</span>(pairwisetable<span class="sc">$</span>p <span class="sc">&lt;</span> </span>
<span id="cb31-6305"><a href="#cb31-6305" aria-hidden="true" tabindex="-1"></a>                threshold), ]</span>
<span id="cb31-6306"><a href="#cb31-6306" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6307"><a href="#cb31-6307" aria-hidden="true" tabindex="-1"></a>        sortedgroups <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(pairwisetable<span class="sc">$</span>group1, pairwisetable<span class="sc">$</span>group2)))</span>
<span id="cb31-6308"><a href="#cb31-6308" aria-hidden="true" tabindex="-1"></a>        datamax <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">max</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb31-6309"><a href="#cb31-6309" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb31-6310"><a href="#cb31-6310" aria-hidden="true" tabindex="-1"></a>        datamin <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">min</span>(divtest<span class="sc">$</span>data[<span class="fu">which</span>(divtest<span class="sc">$</span>data<span class="sc">$</span>Group <span class="sc">%in%</span> </span>
<span id="cb31-6311"><a href="#cb31-6311" aria-hidden="true" tabindex="-1"></a>            sortedgroups), <span class="dv">3</span>]))</span>
<span id="cb31-6312"><a href="#cb31-6312" aria-hidden="true" tabindex="-1"></a>        datarange <span class="ot">&lt;-</span> datamax <span class="sc">-</span> datamin</span>
<span id="cb31-6313"><a href="#cb31-6313" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">&lt;-</span> datarange <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb31-6314"><a href="#cb31-6314" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">&lt;-</span> datamax</span>
<span id="cb31-6315"><a href="#cb31-6315" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">&lt;-</span> min <span class="sc">+</span> (by <span class="sc">*</span> <span class="fu">nrow</span>(pairwisetable))</span>
<span id="cb31-6316"><a href="#cb31-6316" aria-hidden="true" tabindex="-1"></a>        ypos <span class="ot">&lt;-</span> <span class="fu">seq</span>(min, max, by)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb31-6317"><a href="#cb31-6317" aria-hidden="true" tabindex="-1"></a>        pairwisetable<span class="sc">$</span>ypos <span class="ot">&lt;-</span> ypos</span>
<span id="cb31-6318"><a href="#cb31-6318" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6319"><a href="#cb31-6319" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"box"</span>) {</span>
<span id="cb31-6320"><a href="#cb31-6320" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">outlier.size =</span> <span class="dv">3</span>,</span>
<span id="cb31-6321"><a href="#cb31-6321" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb31-6322"><a href="#cb31-6322" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-6323"><a href="#cb31-6323" aria-hidden="true" tabindex="-1"></a>            <span class="co">#scale_colour_manual(values = scales::alpha(colour, 1)) + </span></span>
<span id="cb31-6324"><a href="#cb31-6324" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#191919"</span>, <span class="st">"#191919"</span>, <span class="st">"#191919"</span>)) <span class="sc">+</span> </span>
<span id="cb31-6325"><a href="#cb31-6325" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb31-6326"><a href="#cb31-6326" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_linetype_manual</span>()</span>
<span id="cb31-6327"><a href="#cb31-6327" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-6328"><a href="#cb31-6328" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-6329"><a href="#cb31-6329" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-6330"><a href="#cb31-6330" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6331"><a href="#cb31-6331" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(plot)</span>
<span id="cb31-6332"><a href="#cb31-6332" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6333"><a href="#cb31-6333" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"jitter"</span>) {</span>
<span id="cb31-6334"><a href="#cb31-6334" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggboxplot</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb31-6335"><a href="#cb31-6335" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">add =</span> <span class="st">"jitter"</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb31-6336"><a href="#cb31-6336" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-6337"><a href="#cb31-6337" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-6338"><a href="#cb31-6338" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>))</span>
<span id="cb31-6339"><a href="#cb31-6339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-6340"><a href="#cb31-6340" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-6341"><a href="#cb31-6341" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-6342"><a href="#cb31-6342" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6343"><a href="#cb31-6343" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb31-6344"><a href="#cb31-6344" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6345"><a href="#cb31-6345" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart <span class="sc">==</span> <span class="st">"violin"</span>) {</span>
<span id="cb31-6346"><a href="#cb31-6346" aria-hidden="true" tabindex="-1"></a>        plot <span class="ot">&lt;-</span> <span class="fu">ggviolin</span>(divtestdata, <span class="at">x =</span> <span class="st">"Group"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, </span>
<span id="cb31-6347"><a href="#cb31-6347" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">fill =</span> <span class="st">"Group"</span>, <span class="at">x.text.angle =</span> <span class="dv">45</span>) <span class="sc">+</span> </span>
<span id="cb31-6348"><a href="#cb31-6348" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">"Effective no. of Taxon Units"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Treatment"</span>) <span class="sc">+</span> </span>
<span id="cb31-6349"><a href="#cb31-6349" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-6350"><a href="#cb31-6350" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.1</span>)) <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(colour, </span>
<span id="cb31-6351"><a href="#cb31-6351" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>))</span>
<span id="cb31-6352"><a href="#cb31-6352" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (posthoc <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-6353"><a href="#cb31-6353" aria-hidden="true" tabindex="-1"></a>            plot <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(plot <span class="sc">+</span> <span class="fu">stat_pvalue_manual</span>(pairwisetable, </span>
<span id="cb31-6354"><a href="#cb31-6354" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"p"</span>, <span class="at">y.position =</span> <span class="st">"ypos"</span>))</span>
<span id="cb31-6355"><a href="#cb31-6355" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-6356"><a href="#cb31-6356" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(plot)</span>
<span id="cb31-6357"><a href="#cb31-6357" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6358"><a href="#cb31-6358" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6359"><a href="#cb31-6359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6360"><a href="#cb31-6360" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>))</span>
<span id="cb31-6361"><a href="#cb31-6361" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt"</span>)) {</span>
<span id="cb31-6362"><a href="#cb31-6362" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_plot"</span>))</span>
<span id="cb31-6363"><a href="#cb31-6363" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-6364"><a href="#cb31-6364" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">div_test_plot_jjs</span>(tmp_get,</span>
<span id="cb31-6365"><a href="#cb31-6365" aria-hidden="true" tabindex="-1"></a>                              <span class="at">chart =</span> <span class="st">"box"</span>,</span>
<span id="cb31-6366"><a href="#cb31-6366" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colour    =</span> swel_col,</span>
<span id="cb31-6367"><a href="#cb31-6367" aria-hidden="true" tabindex="-1"></a>                              <span class="at">posthoc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6368"><a href="#cb31-6368" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ggpar</span>(tmp_df, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb31-6369"><a href="#cb31-6369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-6370"><a href="#cb31-6370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-6371"><a href="#cb31-6371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6372"><a href="#cb31-6372" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6373"><a href="#cb31-6373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6374"><a href="#cb31-6374" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_adt_plot"</span>)) {</span>
<span id="cb31-6375"><a href="#cb31-6375" aria-hidden="true" tabindex="-1"></a>  tmp_split <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(i, <span class="st">"_"</span>)</span>
<span id="cb31-6376"><a href="#cb31-6376" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6377"><a href="#cb31-6377" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"work"</span>) {</span>
<span id="cb31-6378"><a href="#cb31-6378" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"f"</span></span>
<span id="cb31-6379"><a href="#cb31-6379" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FULL"</span></span>
<span id="cb31-6380"><a href="#cb31-6380" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"filt"</span>) {</span>
<span id="cb31-6381"><a href="#cb31-6381" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"l"</span></span>
<span id="cb31-6382"><a href="#cb31-6382" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"FILT"</span></span>
<span id="cb31-6383"><a href="#cb31-6383" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"perfect"</span>) {</span>
<span id="cb31-6384"><a href="#cb31-6384" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"r"</span></span>
<span id="cb31-6385"><a href="#cb31-6385" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PERfect"</span></span>
<span id="cb31-6386"><a href="#cb31-6386" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"pime"</span>) {</span>
<span id="cb31-6387"><a href="#cb31-6387" aria-hidden="true" tabindex="-1"></a>    tmp_ds <span class="ot">&lt;-</span> <span class="st">"p"</span></span>
<span id="cb31-6388"><a href="#cb31-6388" aria-hidden="true" tabindex="-1"></a>    tmp_name1 <span class="ot">&lt;-</span> <span class="st">"PIME"</span></span>
<span id="cb31-6389"><a href="#cb31-6389" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-6390"><a href="#cb31-6390" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6391"><a href="#cb31-6391" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q0"</span>) {</span>
<span id="cb31-6392"><a href="#cb31-6392" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"0"</span></span>
<span id="cb31-6393"><a href="#cb31-6393" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Observed"</span></span>
<span id="cb31-6394"><a href="#cb31-6394" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q1"</span>) {</span>
<span id="cb31-6395"><a href="#cb31-6395" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb31-6396"><a href="#cb31-6396" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Shannon exponential"</span></span>
<span id="cb31-6397"><a href="#cb31-6397" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (tmp_split[[<span class="dv">1</span>]][<span class="dv">4</span>] <span class="sc">==</span> <span class="st">"q2"</span>) {</span>
<span id="cb31-6398"><a href="#cb31-6398" aria-hidden="true" tabindex="-1"></a>    tmp_hill <span class="ot">&lt;-</span> <span class="st">"2"</span></span>
<span id="cb31-6399"><a href="#cb31-6399" aria-hidden="true" tabindex="-1"></a>    tmp_name2 <span class="ot">&lt;-</span> <span class="st">"Inverse Simpson"</span></span>
<span id="cb31-6400"><a href="#cb31-6400" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-6401"><a href="#cb31-6401" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6402"><a href="#cb31-6402" aria-hidden="true" tabindex="-1"></a>  tmp_var <span class="ot">&lt;-</span></span>
<span id="cb31-6403"><a href="#cb31-6403" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(tmp_split[[<span class="dv">1</span>]][<span class="dv">1</span>], <span class="st">"_asv"</span>, tmp_ds, tmp_hill, <span class="st">"_lab"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-6404"><a href="#cb31-6404" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(tmp_name1, <span class="st">" ("</span>, tmp_name2, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb31-6405"><a href="#cb31-6405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_var, tmp_name)</span>
<span id="cb31-6406"><a href="#cb31-6406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6407"><a href="#cb31-6407" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6408"><a href="#cb31-6408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6409"><a href="#cb31-6409" aria-hidden="true" tabindex="-1"></a>its18_ps_work_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_work_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6410"><a href="#cb31-6410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6411"><a href="#cb31-6411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvf0_lab) <span class="sc">+</span></span>
<span id="cb31-6412"><a href="#cb31-6412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6413"><a href="#cb31-6413" aria-hidden="true" tabindex="-1"></a>its18_ps_filt_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_filt_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6414"><a href="#cb31-6414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6415"><a href="#cb31-6415" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6416"><a href="#cb31-6416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvl0_lab) <span class="sc">+</span></span>
<span id="cb31-6417"><a href="#cb31-6417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6418"><a href="#cb31-6418" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6419"><a href="#cb31-6419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6420"><a href="#cb31-6420" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6421"><a href="#cb31-6421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvr0_lab) <span class="sc">+</span></span>
<span id="cb31-6422"><a href="#cb31-6422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6423"><a href="#cb31-6423" aria-hidden="true" tabindex="-1"></a>its18_ps_pime_q0_adt_plot <span class="ot">&lt;-</span> its18_ps_pime_q0_adt_plot <span class="sc">+</span></span>
<span id="cb31-6424"><a href="#cb31-6424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6425"><a href="#cb31-6425" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6426"><a href="#cb31-6426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvp0_lab) <span class="sc">+</span></span>
<span id="cb31-6427"><a href="#cb31-6427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6428"><a href="#cb31-6428" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb31-6429"><a href="#cb31-6429" aria-hidden="true" tabindex="-1"></a>its18_ps_work_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_work_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6430"><a href="#cb31-6430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6431"><a href="#cb31-6431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvf1_lab) <span class="sc">+</span></span>
<span id="cb31-6432"><a href="#cb31-6432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6433"><a href="#cb31-6433" aria-hidden="true" tabindex="-1"></a>its18_ps_filt_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_filt_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6434"><a href="#cb31-6434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6435"><a href="#cb31-6435" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6436"><a href="#cb31-6436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvl1_lab) <span class="sc">+</span></span>
<span id="cb31-6437"><a href="#cb31-6437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6438"><a href="#cb31-6438" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6439"><a href="#cb31-6439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6440"><a href="#cb31-6440" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6441"><a href="#cb31-6441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvr1_lab) <span class="sc">+</span></span>
<span id="cb31-6442"><a href="#cb31-6442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6443"><a href="#cb31-6443" aria-hidden="true" tabindex="-1"></a>its18_ps_pime_q1_adt_plot <span class="ot">&lt;-</span> its18_ps_pime_q1_adt_plot <span class="sc">+</span></span>
<span id="cb31-6444"><a href="#cb31-6444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6445"><a href="#cb31-6445" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6446"><a href="#cb31-6446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvp1_lab) <span class="sc">+</span></span>
<span id="cb31-6447"><a href="#cb31-6447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6448"><a href="#cb31-6448" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb31-6449"><a href="#cb31-6449" aria-hidden="true" tabindex="-1"></a>its18_ps_work_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_work_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6450"><a href="#cb31-6450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvf2_lab) <span class="sc">+</span></span>
<span id="cb31-6451"><a href="#cb31-6451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6452"><a href="#cb31-6452" aria-hidden="true" tabindex="-1"></a>its18_ps_filt_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_filt_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6453"><a href="#cb31-6453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6454"><a href="#cb31-6454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvl2_lab) <span class="sc">+</span></span>
<span id="cb31-6455"><a href="#cb31-6455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6456"><a href="#cb31-6456" aria-hidden="true" tabindex="-1"></a>its18_ps_perfect_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_perfect_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6457"><a href="#cb31-6457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6458"><a href="#cb31-6458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvr2_lab) <span class="sc">+</span></span>
<span id="cb31-6459"><a href="#cb31-6459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6460"><a href="#cb31-6460" aria-hidden="true" tabindex="-1"></a>its18_ps_pime_q2_adt_plot <span class="ot">&lt;-</span> its18_ps_pime_q2_adt_plot <span class="sc">+</span></span>
<span id="cb31-6461"><a href="#cb31-6461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb31-6462"><a href="#cb31-6462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(its18_asvp2_lab) <span class="sc">+</span></span>
<span id="cb31-6463"><a href="#cb31-6463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb31-6464"><a href="#cb31-6464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6465"><a href="#cb31-6465" aria-hidden="true" tabindex="-1"></a>its18_alph_div_plots_asv <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb31-6466"><a href="#cb31-6466" aria-hidden="true" tabindex="-1"></a>  its18_ps_work_q0_adt_plot,</span>
<span id="cb31-6467"><a href="#cb31-6467" aria-hidden="true" tabindex="-1"></a>  its18_ps_filt_q0_adt_plot,</span>
<span id="cb31-6468"><a href="#cb31-6468" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q0_adt_plot,</span>
<span id="cb31-6469"><a href="#cb31-6469" aria-hidden="true" tabindex="-1"></a>  its18_ps_pime_q0_adt_plot,</span>
<span id="cb31-6470"><a href="#cb31-6470" aria-hidden="true" tabindex="-1"></a>  its18_ps_work_q1_adt_plot,</span>
<span id="cb31-6471"><a href="#cb31-6471" aria-hidden="true" tabindex="-1"></a>  its18_ps_filt_q1_adt_plot,</span>
<span id="cb31-6472"><a href="#cb31-6472" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q1_adt_plot,</span>
<span id="cb31-6473"><a href="#cb31-6473" aria-hidden="true" tabindex="-1"></a>  its18_ps_pime_q1_adt_plot,</span>
<span id="cb31-6474"><a href="#cb31-6474" aria-hidden="true" tabindex="-1"></a>  its18_ps_work_q2_adt_plot,</span>
<span id="cb31-6475"><a href="#cb31-6475" aria-hidden="true" tabindex="-1"></a>  its18_ps_filt_q2_adt_plot,</span>
<span id="cb31-6476"><a href="#cb31-6476" aria-hidden="true" tabindex="-1"></a>  its18_ps_perfect_q2_adt_plot,</span>
<span id="cb31-6477"><a href="#cb31-6477" aria-hidden="true" tabindex="-1"></a>  its18_ps_pime_q2_adt_plot,</span>
<span id="cb31-6478"><a href="#cb31-6478" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb31-6479"><a href="#cb31-6479" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span></span>
<span id="cb31-6480"><a href="#cb31-6480" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6481"><a href="#cb31-6481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6482"><a href="#cb31-6482" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6483"><a href="#cb31-6483" aria-hidden="true" tabindex="-1"></a>  its18_alph_div_plots_asv,</span>
<span id="cb31-6484"><a href="#cb31-6484" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.png"</span>,</span>
<span id="cb31-6485"><a href="#cb31-6485" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb31-6486"><a href="#cb31-6486" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb31-6487"><a href="#cb31-6487" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6488"><a href="#cb31-6488" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6489"><a href="#cb31-6489" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6490"><a href="#cb31-6490" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6491"><a href="#cb31-6491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6492"><a href="#cb31-6492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6493"><a href="#cb31-6493" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6494"><a href="#cb31-6494" aria-hidden="true" tabindex="-1"></a>  its18_alph_div_plots_asv,</span>
<span id="cb31-6495"><a href="#cb31-6495" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb31-6496"><a href="#cb31-6496" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5852</span>,</span>
<span id="cb31-6497"><a href="#cb31-6497" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7449</span>,</span>
<span id="cb31-6498"><a href="#cb31-6498" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6499"><a href="#cb31-6499" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6500"><a href="#cb31-6500" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6501"><a href="#cb31-6501" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6502"><a href="#cb31-6502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6503"><a href="#cb31-6503" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6504"><a href="#cb31-6504" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.png"</span>,</span>
<span id="cb31-6505"><a href="#cb31-6505" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_4.png"</span></span>
<span id="cb31-6506"><a href="#cb31-6506" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6507"><a href="#cb31-6507" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6508"><a href="#cb31-6508" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/its18_alph_div_plots_asv.pdf"</span>,</span>
<span id="cb31-6509"><a href="#cb31-6509" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_4.pdf"</span></span>
<span id="cb31-6510"><a href="#cb31-6510" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6511"><a href="#cb31-6511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-6512"><a href="#cb31-6512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6513"><a href="#cb31-6513" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 5</span></span>
<span id="cb31-6514"><a href="#cb31-6514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6515"><a href="#cb31-6515" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-6516"><a href="#cb31-6516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6517"><a href="#cb31-6517" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-6518"><a href="#cb31-6518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6519"><a href="#cb31-6519" aria-hidden="true" tabindex="-1"></a>No post processing performed.</span>
<span id="cb31-6520"><a href="#cb31-6520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6521"><a href="#cb31-6521" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6522"><a href="#cb31-6522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6523"><a href="#cb31-6523" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-6524"><a href="#cb31-6524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6525"><a href="#cb31-6525" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-6526"><a href="#cb31-6526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6527"><a href="#cb31-6527" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_5.png)</span></span>
<span id="cb31-6528"><a href="#cb31-6528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6529"><a href="#cb31-6529" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-6530"><a href="#cb31-6530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6531"><a href="#cb31-6531" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/ssu18_auto_cor_combo.png)</span></span>
<span id="cb31-6532"><a href="#cb31-6532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6533"><a href="#cb31-6533" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6534"><a href="#cb31-6534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6535"><a href="#cb31-6535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6536"><a href="#cb31-6536" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-6537"><a href="#cb31-6537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6538"><a href="#cb31-6538" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-6539"><a href="#cb31-6539" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 5 data pack</span><span class="co">](include/pub/SOM/Supplementary_Figure_5.rds)</span>  </span>
<span id="cb31-6540"><a href="#cb31-6540" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6541"><a href="#cb31-6541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6542"><a href="#cb31-6542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6543"><a href="#cb31-6543" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-6544"><a href="#cb31-6544" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 5 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_5.pdf)</span></span>
<span id="cb31-6545"><a href="#cb31-6545" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6546"><a href="#cb31-6546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6547"><a href="#cb31-6547" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6548"><a href="#cb31-6548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6551"><a href="#cb31-6551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-6552"><a href="#cb31-6552" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Supplementary Figure 5"</span></span>
<span id="cb31-6553"><a href="#cb31-6553" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-6554"><a href="#cb31-6554" aria-hidden="true" tabindex="-1"></a>ssu18_select_mc_norm_split <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb31-6555"><a href="#cb31-6555" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_5.rds"</span></span>
<span id="cb31-6556"><a href="#cb31-6556" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-6557"><a href="#cb31-6557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6558"><a href="#cb31-6558" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor <span class="ot">&lt;-</span> ssu18_select_mc_norm_split<span class="sc">$</span>edaphic</span>
<span id="cb31-6559"><a href="#cb31-6559" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-6560"><a href="#cb31-6560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6561"><a href="#cb31-6561" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor <span class="ot">&lt;-</span> ssu18_select_mc_norm_split<span class="sc">$</span>soil_funct</span>
<span id="cb31-6562"><a href="#cb31-6562" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-6563"><a href="#cb31-6563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6564"><a href="#cb31-6564" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor <span class="ot">&lt;-</span> ssu18_select_mc_norm_split<span class="sc">$</span>temp_adapt</span>
<span id="cb31-6565"><a href="#cb31-6565" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-6566"><a href="#cb31-6566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6567"><a href="#cb31-6567" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_cor$"</span>)) {</span>
<span id="cb31-6568"><a href="#cb31-6568" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-6569"><a href="#cb31-6569" aria-hidden="true" tabindex="-1"></a>  tmp_cormat <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(tmp_get), <span class="dv">2</span>)</span>
<span id="cb31-6570"><a href="#cb31-6570" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_cormat)</span>
<span id="cb31-6571"><a href="#cb31-6571" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6572"><a href="#cb31-6572" aria-hidden="true" tabindex="-1"></a>  tmp_get_lower_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb31-6573"><a href="#cb31-6573" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">upper.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb31-6574"><a href="#cb31-6574" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb31-6575"><a href="#cb31-6575" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6576"><a href="#cb31-6576" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get upper triangle of the correlation matrix</span></span>
<span id="cb31-6577"><a href="#cb31-6577" aria-hidden="true" tabindex="-1"></a>  tmp_get_upper_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb31-6578"><a href="#cb31-6578" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">lower.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb31-6579"><a href="#cb31-6579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb31-6580"><a href="#cb31-6580" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6581"><a href="#cb31-6581" aria-hidden="true" tabindex="-1"></a>  tmp_upper_tri <span class="ot">&lt;-</span> <span class="fu">tmp_get_upper_tri</span>(tmp_cormat)</span>
<span id="cb31-6582"><a href="#cb31-6582" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_upper_tri, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6583"><a href="#cb31-6583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb31-6584"><a href="#cb31-6584" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>()</span>
<span id="cb31-6585"><a href="#cb31-6585" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6586"><a href="#cb31-6586" aria-hidden="true" tabindex="-1"></a>  tmp_ggheatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(Var2, Var1, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb31-6587"><a href="#cb31-6587" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb31-6588"><a href="#cb31-6588" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, </span>
<span id="cb31-6589"><a href="#cb31-6589" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">space =</span> <span class="st">"Lab"</span>, </span>
<span id="cb31-6590"><a href="#cb31-6590" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name=</span><span class="st">"Pearson</span><span class="sc">\n</span><span class="st">Correlation"</span>) <span class="sc">+</span></span>
<span id="cb31-6591"><a href="#cb31-6591" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb31-6592"><a href="#cb31-6592" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, </span>
<span id="cb31-6593"><a href="#cb31-6593" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb31-6594"><a href="#cb31-6594" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb31-6595"><a href="#cb31-6595" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb31-6596"><a href="#cb31-6596" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(Var2, Var1, <span class="at">label =</span> value), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.75</span>) <span class="sc">+</span></span>
<span id="cb31-6597"><a href="#cb31-6597" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-6598"><a href="#cb31-6598" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6599"><a href="#cb31-6599" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6600"><a href="#cb31-6600" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6601"><a href="#cb31-6601" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6602"><a href="#cb31-6602" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6603"><a href="#cb31-6603" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6604"><a href="#cb31-6604" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb31-6605"><a href="#cb31-6605" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>),</span>
<span id="cb31-6606"><a href="#cb31-6606" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb31-6607"><a href="#cb31-6607" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="dv">7</span>, <span class="at">barheight =</span> <span class="dv">1</span>,</span>
<span id="cb31-6608"><a href="#cb31-6608" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.position =</span> <span class="st">"top"</span>, </span>
<span id="cb31-6609"><a href="#cb31-6609" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb31-6610"><a href="#cb31-6610" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_ggheatmap"</span>))</span>
<span id="cb31-6611"><a href="#cb31-6611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_ggheatmap)</span>
<span id="cb31-6612"><a href="#cb31-6612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-6613"><a href="#cb31-6613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6614"><a href="#cb31-6614" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb31-6615"><a href="#cb31-6615" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_ggheatmap"</span>)</span>
<span id="cb31-6616"><a href="#cb31-6616" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor_ggheatmap</span>
<span id="cb31-6617"><a href="#cb31-6617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6618"><a href="#cb31-6618" aria-hidden="true" tabindex="-1"></a>auto_cor_figs <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb31-6619"><a href="#cb31-6619" aria-hidden="true" tabindex="-1"></a>  edaphic_norm_cor_ggheatmap,</span>
<span id="cb31-6620"><a href="#cb31-6620" aria-hidden="true" tabindex="-1"></a>  soil_funct_norm_cor_ggheatmap,</span>
<span id="cb31-6621"><a href="#cb31-6621" aria-hidden="true" tabindex="-1"></a>  temp_adapt_norm_cor_ggheatmap,</span>
<span id="cb31-6622"><a href="#cb31-6622" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb31-6623"><a href="#cb31-6623" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb31-6624"><a href="#cb31-6624" aria-hidden="true" tabindex="-1"></a>  <span class="at">common.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb31-6625"><a href="#cb31-6625" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6626"><a href="#cb31-6626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6627"><a href="#cb31-6627" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6628"><a href="#cb31-6628" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb31-6629"><a href="#cb31-6629" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.png"</span>,</span>
<span id="cb31-6630"><a href="#cb31-6630" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb31-6631"><a href="#cb31-6631" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb31-6632"><a href="#cb31-6632" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6633"><a href="#cb31-6633" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6634"><a href="#cb31-6634" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6635"><a href="#cb31-6635" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6636"><a href="#cb31-6636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6637"><a href="#cb31-6637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6638"><a href="#cb31-6638" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6639"><a href="#cb31-6639" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb31-6640"><a href="#cb31-6640" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.pdf"</span>,</span>
<span id="cb31-6641"><a href="#cb31-6641" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb31-6642"><a href="#cb31-6642" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb31-6643"><a href="#cb31-6643" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6644"><a href="#cb31-6644" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6645"><a href="#cb31-6645" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6646"><a href="#cb31-6646" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6647"><a href="#cb31-6647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6648"><a href="#cb31-6648" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6649"><a href="#cb31-6649" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.png"</span>,</span>
<span id="cb31-6650"><a href="#cb31-6650" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_5.png"</span></span>
<span id="cb31-6651"><a href="#cb31-6651" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6652"><a href="#cb31-6652" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6653"><a href="#cb31-6653" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/ssu18_auto_cor_figs.pdf"</span>,</span>
<span id="cb31-6654"><a href="#cb31-6654" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_5.pdf"</span></span>
<span id="cb31-6655"><a href="#cb31-6655" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6656"><a href="#cb31-6656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-6657"><a href="#cb31-6657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6658"><a href="#cb31-6658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6659"><a href="#cb31-6659" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figure 6</span></span>
<span id="cb31-6660"><a href="#cb31-6660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6661"><a href="#cb31-6661" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-6662"><a href="#cb31-6662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6663"><a href="#cb31-6663" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-6664"><a href="#cb31-6664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6665"><a href="#cb31-6665" aria-hidden="true" tabindex="-1"></a>No post processing performed.</span>
<span id="cb31-6666"><a href="#cb31-6666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6667"><a href="#cb31-6667" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6668"><a href="#cb31-6668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6669"><a href="#cb31-6669" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-6670"><a href="#cb31-6670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6671"><a href="#cb31-6671" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original </span></span>
<span id="cb31-6672"><a href="#cb31-6672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6673"><a href="#cb31-6673" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_6.png)</span></span>
<span id="cb31-6674"><a href="#cb31-6674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6675"><a href="#cb31-6675" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final</span></span>
<span id="cb31-6676"><a href="#cb31-6676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6677"><a href="#cb31-6677" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/its18_auto_cor_combo.png)</span></span>
<span id="cb31-6678"><a href="#cb31-6678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6679"><a href="#cb31-6679" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6680"><a href="#cb31-6680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6681"><a href="#cb31-6681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6682"><a href="#cb31-6682" aria-hidden="true" tabindex="-1"></a>::: {layout="[ <span class="co">[</span><span class="ot">1,1</span><span class="co">]</span> ]"}</span>
<span id="cb31-6683"><a href="#cb31-6683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6684"><a href="#cb31-6684" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-6685"><a href="#cb31-6685" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 6 data pack</span><span class="co">](include/pub/SOM/Supplementary_Figure_6.rds)</span>  </span>
<span id="cb31-6686"><a href="#cb31-6686" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6687"><a href="#cb31-6687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6688"><a href="#cb31-6688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6689"><a href="#cb31-6689" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-6690"><a href="#cb31-6690" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 6 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_6.pdf)</span></span>
<span id="cb31-6691"><a href="#cb31-6691" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6692"><a href="#cb31-6692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6693"><a href="#cb31-6693" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6694"><a href="#cb31-6694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6697"><a href="#cb31-6697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-6698"><a href="#cb31-6698" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Supplementary Figure 6"</span></span>
<span id="cb31-6699"><a href="#cb31-6699" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-6700"><a href="#cb31-6700" aria-hidden="true" tabindex="-1"></a>its18_select_mc_norm_split <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/SOM/Supplementary_Figure_6.rds"</span>)</span>
<span id="cb31-6701"><a href="#cb31-6701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6702"><a href="#cb31-6702" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor <span class="ot">&lt;-</span> its18_select_mc_norm_split<span class="sc">$</span>edaphic</span>
<span id="cb31-6703"><a href="#cb31-6703" aria-hidden="true" tabindex="-1"></a>edaphic_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-6704"><a href="#cb31-6704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6705"><a href="#cb31-6705" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor <span class="ot">&lt;-</span> its18_select_mc_norm_split<span class="sc">$</span>soil_funct</span>
<span id="cb31-6706"><a href="#cb31-6706" aria-hidden="true" tabindex="-1"></a>soil_funct_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-6707"><a href="#cb31-6707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6708"><a href="#cb31-6708" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor <span class="ot">&lt;-</span> its18_select_mc_norm_split<span class="sc">$</span>temp_adapt</span>
<span id="cb31-6709"><a href="#cb31-6709" aria-hidden="true" tabindex="-1"></a>temp_adapt_norm_cor[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb31-6710"><a href="#cb31-6710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6711"><a href="#cb31-6711" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_cor$"</span>)) {</span>
<span id="cb31-6712"><a href="#cb31-6712" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-6713"><a href="#cb31-6713" aria-hidden="true" tabindex="-1"></a>  tmp_cormat <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(tmp_get), <span class="dv">2</span>)</span>
<span id="cb31-6714"><a href="#cb31-6714" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_cormat)</span>
<span id="cb31-6715"><a href="#cb31-6715" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6716"><a href="#cb31-6716" aria-hidden="true" tabindex="-1"></a>  tmp_get_lower_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb31-6717"><a href="#cb31-6717" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">upper.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb31-6718"><a href="#cb31-6718" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb31-6719"><a href="#cb31-6719" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6720"><a href="#cb31-6720" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get upper triangle of the correlation matrix</span></span>
<span id="cb31-6721"><a href="#cb31-6721" aria-hidden="true" tabindex="-1"></a>  tmp_get_upper_tri <span class="ot">&lt;-</span> <span class="cf">function</span>(tmp_cormat){</span>
<span id="cb31-6722"><a href="#cb31-6722" aria-hidden="true" tabindex="-1"></a>    tmp_cormat[<span class="fu">lower.tri</span>(tmp_cormat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb31-6723"><a href="#cb31-6723" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tmp_cormat)</span>
<span id="cb31-6724"><a href="#cb31-6724" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-6725"><a href="#cb31-6725" aria-hidden="true" tabindex="-1"></a>  tmp_upper_tri <span class="ot">&lt;-</span> <span class="fu">tmp_get_upper_tri</span>(tmp_cormat)</span>
<span id="cb31-6726"><a href="#cb31-6726" aria-hidden="true" tabindex="-1"></a>  tmp_melted_cormat <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(tmp_upper_tri, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6727"><a href="#cb31-6727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb31-6728"><a href="#cb31-6728" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>()</span>
<span id="cb31-6729"><a href="#cb31-6729" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6730"><a href="#cb31-6730" aria-hidden="true" tabindex="-1"></a>  tmp_ggheatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> tmp_melted_cormat, <span class="fu">aes</span>(Var2, Var1, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb31-6731"><a href="#cb31-6731" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb31-6732"><a href="#cb31-6732" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, </span>
<span id="cb31-6733"><a href="#cb31-6733" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="dv">0</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">space =</span> <span class="st">"Lab"</span>, </span>
<span id="cb31-6734"><a href="#cb31-6734" aria-hidden="true" tabindex="-1"></a>                         <span class="at">name=</span><span class="st">"Pearson</span><span class="sc">\n</span><span class="st">Correlation"</span>) <span class="sc">+</span></span>
<span id="cb31-6735"><a href="#cb31-6735" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb31-6736"><a href="#cb31-6736" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, </span>
<span id="cb31-6737"><a href="#cb31-6737" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb31-6738"><a href="#cb31-6738" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb31-6739"><a href="#cb31-6739" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb31-6740"><a href="#cb31-6740" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(Var2, Var1, <span class="at">label =</span> value), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.75</span>) <span class="sc">+</span></span>
<span id="cb31-6741"><a href="#cb31-6741" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-6742"><a href="#cb31-6742" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6743"><a href="#cb31-6743" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6744"><a href="#cb31-6744" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6745"><a href="#cb31-6745" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6746"><a href="#cb31-6746" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6747"><a href="#cb31-6747" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-6748"><a href="#cb31-6748" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb31-6749"><a href="#cb31-6749" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>),</span>
<span id="cb31-6750"><a href="#cb31-6750" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>) <span class="sc">+</span></span>
<span id="cb31-6751"><a href="#cb31-6751" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="dv">7</span>, <span class="at">barheight =</span> <span class="dv">1</span>,</span>
<span id="cb31-6752"><a href="#cb31-6752" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.position =</span> <span class="st">"top"</span>, </span>
<span id="cb31-6753"><a href="#cb31-6753" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb31-6754"><a href="#cb31-6754" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_ggheatmap"</span>))</span>
<span id="cb31-6755"><a href="#cb31-6755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_ggheatmap)</span>
<span id="cb31-6756"><a href="#cb31-6756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-6757"><a href="#cb31-6757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6758"><a href="#cb31-6758" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb31-6759"><a href="#cb31-6759" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">"_ggheatmap"</span>)</span>
<span id="cb31-6760"><a href="#cb31-6760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6761"><a href="#cb31-6761" aria-hidden="true" tabindex="-1"></a>auto_cor_figs <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb31-6762"><a href="#cb31-6762" aria-hidden="true" tabindex="-1"></a>  edaphic_norm_cor_ggheatmap, </span>
<span id="cb31-6763"><a href="#cb31-6763" aria-hidden="true" tabindex="-1"></a>  soil_funct_norm_cor_ggheatmap, </span>
<span id="cb31-6764"><a href="#cb31-6764" aria-hidden="true" tabindex="-1"></a>  temp_adapt_norm_cor_ggheatmap,</span>
<span id="cb31-6765"><a href="#cb31-6765" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">common.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-6766"><a href="#cb31-6766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6767"><a href="#cb31-6767" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6768"><a href="#cb31-6768" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb31-6769"><a href="#cb31-6769" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/its18_auto_cor_figs.png"</span>,</span>
<span id="cb31-6770"><a href="#cb31-6770" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb31-6771"><a href="#cb31-6771" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb31-6772"><a href="#cb31-6772" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6773"><a href="#cb31-6773" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6774"><a href="#cb31-6774" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6775"><a href="#cb31-6775" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6776"><a href="#cb31-6776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6777"><a href="#cb31-6777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6778"><a href="#cb31-6778" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-6779"><a href="#cb31-6779" aria-hidden="true" tabindex="-1"></a>  auto_cor_figs,</span>
<span id="cb31-6780"><a href="#cb31-6780" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"include/pub/SOM/its18_auto_cor_figs.pdf"</span>,</span>
<span id="cb31-6781"><a href="#cb31-6781" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">2500</span>,</span>
<span id="cb31-6782"><a href="#cb31-6782" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7500</span>,</span>
<span id="cb31-6783"><a href="#cb31-6783" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-6784"><a href="#cb31-6784" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-6785"><a href="#cb31-6785" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-6786"><a href="#cb31-6786" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6787"><a href="#cb31-6787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6788"><a href="#cb31-6788" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6789"><a href="#cb31-6789" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/its18_auto_cor_figs.png"</span>,</span>
<span id="cb31-6790"><a href="#cb31-6790" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_6.png"</span></span>
<span id="cb31-6791"><a href="#cb31-6791" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6792"><a href="#cb31-6792" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-6793"><a href="#cb31-6793" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/its18_auto_cor_figs.pdf"</span>,</span>
<span id="cb31-6794"><a href="#cb31-6794" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_6.pdf"</span></span>
<span id="cb31-6795"><a href="#cb31-6795" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6796"><a href="#cb31-6796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-6797"><a href="#cb31-6797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6798"><a href="#cb31-6798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6799"><a href="#cb31-6799" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supplementary Figures 7--14</span></span>
<span id="cb31-6800"><a href="#cb31-6800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6801"><a href="#cb31-6801" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-6802"><a href="#cb31-6802" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figures 7-14 data pack</span><span class="co">](include/pub/SOM/Supplementary_Figure_7.rds)</span>  </span>
<span id="cb31-6803"><a href="#cb31-6803" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-6804"><a href="#cb31-6804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6807"><a href="#cb31-6807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-6808"><a href="#cb31-6808" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Access the code for Supplementary Figures 7--14"</span></span>
<span id="cb31-6809"><a href="#cb31-6809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6810"><a href="#cb31-6810" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-6811"><a href="#cb31-6811" aria-hidden="true" tabindex="-1"></a>ssu18_ps_work <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"include/pub/SOM/Supplementary_Figure_7.rds"</span>)</span>
<span id="cb31-6812"><a href="#cb31-6812" aria-hidden="true" tabindex="-1"></a>ssu18_data_sets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ssu18_ps_work"</span>)</span>
<span id="cb31-6813"><a href="#cb31-6813" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-6814"><a href="#cb31-6814" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_proteo"</span>))</span>
<span id="cb31-6815"><a href="#cb31-6815" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-6816"><a href="#cb31-6816" aria-hidden="true" tabindex="-1"></a>     tmp_df <span class="ot">&lt;-</span> <span class="fu">subset_taxa</span>(tmp_get, Phylum <span class="sc">==</span> <span class="st">"Proteobacteria"</span>)</span>
<span id="cb31-6817"><a href="#cb31-6817" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-6818"><a href="#cb31-6818" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb31-6819"><a href="#cb31-6819" aria-hidden="true" tabindex="-1"></a>     tmp_get_taxa <span class="ot">&lt;-</span> <span class="fu">get_taxa_unique</span>(tmp_df,</span>
<span id="cb31-6820"><a href="#cb31-6820" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_df)[<span class="dv">3</span>],</span>
<span id="cb31-6821"><a href="#cb31-6821" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">errorIfNULL=</span><span class="cn">TRUE</span>)</span>
<span id="cb31-6822"><a href="#cb31-6822" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_get_taxa)</span>
<span id="cb31-6823"><a href="#cb31-6823" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6824"><a href="#cb31-6824" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_proteo"</span>))</span>
<span id="cb31-6825"><a href="#cb31-6825" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6826"><a href="#cb31-6826" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Replace Phylum Proteobacteria with the Class name.</span></span>
<span id="cb31-6827"><a href="#cb31-6827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6828"><a href="#cb31-6828" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> ssu18_data_sets) {</span>
<span id="cb31-6829"><a href="#cb31-6829" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(j, <span class="sc">~</span><span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>))</span>
<span id="cb31-6830"><a href="#cb31-6830" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(j)</span>
<span id="cb31-6831"><a href="#cb31-6831" aria-hidden="true" tabindex="-1"></a>  tmp_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get))</span>
<span id="cb31-6832"><a href="#cb31-6832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6833"><a href="#cb31-6833" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tmp_clean)){</span>
<span id="cb31-6834"><a href="#cb31-6834" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Alphaproteobacteria"</span>){</span>
<span id="cb31-6835"><a href="#cb31-6835" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Alphaproteobacteria"</span>)</span>
<span id="cb31-6836"><a href="#cb31-6836" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-6837"><a href="#cb31-6837" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Gammaproteobacteria"</span>){</span>
<span id="cb31-6838"><a href="#cb31-6838" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Gammaproteobacteria"</span>)</span>
<span id="cb31-6839"><a href="#cb31-6839" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-6840"><a href="#cb31-6840" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"Zetaproteobacteria"</span>){</span>
<span id="cb31-6841"><a href="#cb31-6841" aria-hidden="true" tabindex="-1"></a>              phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"Zetaproteobacteria"</span>)</span>
<span id="cb31-6842"><a href="#cb31-6842" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-6843"><a href="#cb31-6843" aria-hidden="true" tabindex="-1"></a>   }   <span class="cf">else</span> <span class="cf">if</span> (tmp_clean[i,<span class="dv">2</span>] <span class="sc">==</span> <span class="st">"Proteobacteria"</span> <span class="sc">&amp;</span> tmp_clean[i,<span class="dv">3</span>] <span class="sc">==</span> <span class="st">"p_Proteobacteria"</span>){</span>
<span id="cb31-6844"><a href="#cb31-6844" aria-hidden="true" tabindex="-1"></a>           phylum <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">paste</span>(<span class="st">"p_Proteobacteria"</span>)</span>
<span id="cb31-6845"><a href="#cb31-6845" aria-hidden="true" tabindex="-1"></a>           tmp_clean[i, <span class="dv">2</span>] <span class="ot">&lt;-</span> phylum</span>
<span id="cb31-6846"><a href="#cb31-6846" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb31-6847"><a href="#cb31-6847" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb31-6848"><a href="#cb31-6848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(tmp_get) <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_clean)</span>
<span id="cb31-6849"><a href="#cb31-6849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rank_names</span>(tmp_get)</span>
<span id="cb31-6850"><a href="#cb31-6850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_get)</span>
<span id="cb31-6851"><a href="#cb31-6851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(tmp_name, tmp_get))</span>
<span id="cb31-6852"><a href="#cb31-6852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">length</span>(<span class="fu">get_taxa_unique</span>(tmp_get,</span>
<span id="cb31-6853"><a href="#cb31-6853" aria-hidden="true" tabindex="-1"></a>                               <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">2</span>],</span>
<span id="cb31-6854"><a href="#cb31-6854" aria-hidden="true" tabindex="-1"></a>                               <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb31-6855"><a href="#cb31-6855" aria-hidden="true" tabindex="-1"></a>  tmp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"include/pub/SOM/"</span>)</span>
<span id="cb31-6856"><a href="#cb31-6856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6857"><a href="#cb31-6857" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6858"><a href="#cb31-6858" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(class, order, phylum)</span>
<span id="cb31-6859"><a href="#cb31-6859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6860"><a href="#cb31-6860" aria-hidden="true" tabindex="-1"></a>set_to_plot <span class="ot">&lt;-</span> <span class="st">"ssu18_ps_work"</span></span>
<span id="cb31-6861"><a href="#cb31-6861" aria-hidden="true" tabindex="-1"></a>tax_group <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-6862"><a href="#cb31-6862" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alphaproteobacteria"</span>,</span>
<span id="cb31-6863"><a href="#cb31-6863" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gammaproteobacteria"</span>,</span>
<span id="cb31-6864"><a href="#cb31-6864" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Acidobacteriota"</span>,</span>
<span id="cb31-6865"><a href="#cb31-6865" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Actinobacteriota"</span>,</span>
<span id="cb31-6866"><a href="#cb31-6866" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bacteroidota"</span>,</span>
<span id="cb31-6867"><a href="#cb31-6867" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Firmicutes"</span>,</span>
<span id="cb31-6868"><a href="#cb31-6868" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Myxococcota"</span>,</span>
<span id="cb31-6869"><a href="#cb31-6869" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Verrucomicrobiota"</span></span>
<span id="cb31-6870"><a href="#cb31-6870" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6871"><a href="#cb31-6871" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> set_to_plot) {</span>
<span id="cb31-6872"><a href="#cb31-6872" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> tax_group) {</span>
<span id="cb31-6873"><a href="#cb31-6873" aria-hidden="true" tabindex="-1"></a>    tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_proteo_clean"</span>)))</span>
<span id="cb31-6874"><a href="#cb31-6874" aria-hidden="true" tabindex="-1"></a>    tmp_sub <span class="ot">&lt;-</span> <span class="fu">subset_taxa</span>(tmp_get, Phylum <span class="sc">==</span> j)</span>
<span id="cb31-6875"><a href="#cb31-6875" aria-hidden="true" tabindex="-1"></a>    tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_"</span>, j))</span>
<span id="cb31-6876"><a href="#cb31-6876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(tmp_name, tmp_sub)</span>
<span id="cb31-6877"><a href="#cb31-6877" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6878"><a href="#cb31-6878" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-6879"><a href="#cb31-6879" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6880"><a href="#cb31-6880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6881"><a href="#cb31-6881" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-6882"><a href="#cb31-6882" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i)))</span>
<span id="cb31-6883"><a href="#cb31-6883" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span>  <span class="fu">get_taxa_unique</span>(tmp_get, <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">5</span>], <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6884"><a href="#cb31-6884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6885"><a href="#cb31-6885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"####################################################"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6886"><a href="#cb31-6886" aria-hidden="true" tabindex="-1"></a>  tmp_print <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unique taxa:"</span>, i)</span>
<span id="cb31-6887"><a href="#cb31-6887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(tmp_print, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6888"><a href="#cb31-6888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"####################################################"</span>)</span>
<span id="cb31-6889"><a href="#cb31-6889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6890"><a href="#cb31-6890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tmp_list)</span>
<span id="cb31-6891"><a href="#cb31-6891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6892"><a href="#cb31-6892" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6893"><a href="#cb31-6893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6894"><a href="#cb31-6894" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Choose the **number** of taxa to display and the taxonomic **level**. </span></span>
<span id="cb31-6895"><a href="#cb31-6895" aria-hidden="true" tabindex="-1"></a><span class="do">## Aggregate the rest into "Other".</span></span>
<span id="cb31-6896"><a href="#cb31-6896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6897"><a href="#cb31-6897" aria-hidden="true" tabindex="-1"></a>aggregate_top_taxa <span class="ot">&lt;-</span> <span class="cf">function</span> (x, top, level) {</span>
<span id="cb31-6898"><a href="#cb31-6898" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">aggregate_taxa</span>(x, level)</span>
<span id="cb31-6899"><a href="#cb31-6899" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6900"><a href="#cb31-6900" aria-hidden="true" tabindex="-1"></a>  tops <span class="ot">&lt;-</span> microbiome<span class="sc">::</span><span class="fu">top_taxa</span>(x, top)</span>
<span id="cb31-6901"><a href="#cb31-6901" aria-hidden="true" tabindex="-1"></a>  tax <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(x)</span>
<span id="cb31-6902"><a href="#cb31-6902" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6903"><a href="#cb31-6903" aria-hidden="true" tabindex="-1"></a>  inds <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">rownames</span>(tax) <span class="sc">%in%</span> tops)</span>
<span id="cb31-6904"><a href="#cb31-6904" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6905"><a href="#cb31-6905" aria-hidden="true" tabindex="-1"></a>  tax[inds, level] <span class="ot">&lt;-</span> <span class="st">"Other"</span></span>
<span id="cb31-6906"><a href="#cb31-6906" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6907"><a href="#cb31-6907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(x) <span class="ot">&lt;-</span> tax</span>
<span id="cb31-6908"><a href="#cb31-6908" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6909"><a href="#cb31-6909" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(x)[, level]</span>
<span id="cb31-6910"><a href="#cb31-6910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_table</span>(x) <span class="ot">&lt;-</span> <span class="fu">tax_table</span>(tt)</span>
<span id="cb31-6911"><a href="#cb31-6911" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-6912"><a href="#cb31-6912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aggregate_taxa</span>(x, level)</span>
<span id="cb31-6913"><a href="#cb31-6913" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6914"><a href="#cb31-6914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6915"><a href="#cb31-6915" aria-hidden="true" tabindex="-1"></a>top_hits <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb31-6916"><a href="#cb31-6916" aria-hidden="true" tabindex="-1"></a>top_level <span class="ot">&lt;-</span> <span class="st">"Family"</span></span>
<span id="cb31-6917"><a href="#cb31-6917" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-6918"><a href="#cb31-6918" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i)))</span>
<span id="cb31-6919"><a href="#cb31-6919" aria-hidden="true" tabindex="-1"></a>  tmp_otu <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(tmp_get)))</span>
<span id="cb31-6920"><a href="#cb31-6920" aria-hidden="true" tabindex="-1"></a>  tmp_otu[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tmp_otu, as.numeric)</span>
<span id="cb31-6921"><a href="#cb31-6921" aria-hidden="true" tabindex="-1"></a>  tmp_otu <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_otu)</span>
<span id="cb31-6922"><a href="#cb31-6922" aria-hidden="true" tabindex="-1"></a>  tmp_tax <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">data.frame</span>(<span class="fu">tax_table</span>(tmp_get)))</span>
<span id="cb31-6923"><a href="#cb31-6923" aria-hidden="true" tabindex="-1"></a>  tmp_samples <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb31-6924"><a href="#cb31-6924" aria-hidden="true" tabindex="-1"></a>  tmp_clean_df <span class="ot">&lt;-</span></span>
<span id="cb31-6925"><a href="#cb31-6925" aria-hidden="true" tabindex="-1"></a>    <span class="fu">merge_phyloseq</span>(</span>
<span id="cb31-6926"><a href="#cb31-6926" aria-hidden="true" tabindex="-1"></a>      <span class="fu">otu_table</span>(tmp_otu, <span class="at">taxa_are_rows =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-6927"><a href="#cb31-6927" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tax_table</span>(tmp_tax),</span>
<span id="cb31-6928"><a href="#cb31-6928" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sample_data</span>(tmp_samples)</span>
<span id="cb31-6929"><a href="#cb31-6929" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-6930"><a href="#cb31-6930" aria-hidden="true" tabindex="-1"></a>  tmp_agg_df <span class="ot">&lt;-</span> <span class="fu">aggregate_top_taxa</span>(tmp_clean_df,</span>
<span id="cb31-6931"><a href="#cb31-6931" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">top =</span> top_hits,</span>
<span id="cb31-6932"><a href="#cb31-6932" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">level =</span> top_level)</span>
<span id="cb31-6933"><a href="#cb31-6933" aria-hidden="true" tabindex="-1"></a>  tmp_agg_name <span class="ot">&lt;-</span></span>
<span id="cb31-6934"><a href="#cb31-6934" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg"</span>))</span>
<span id="cb31-6935"><a href="#cb31-6935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_agg_name, tmp_agg_df)</span>
<span id="cb31-6936"><a href="#cb31-6936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"_sep_agg"</span>))</span>
<span id="cb31-6937"><a href="#cb31-6937" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6938"><a href="#cb31-6938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6939"><a href="#cb31-6939" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group){</span>
<span id="cb31-6940"><a href="#cb31-6940" aria-hidden="true" tabindex="-1"></a>  tmp_data <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg"</span>))</span>
<span id="cb31-6941"><a href="#cb31-6941" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_data)</span>
<span id="cb31-6942"><a href="#cb31-6942" aria-hidden="true" tabindex="-1"></a>  tmp_list <span class="ot">&lt;-</span> <span class="fu">get_taxa_unique</span>(tmp_get, <span class="at">taxonomic.rank =</span> <span class="fu">rank_names</span>(tmp_get)[<span class="dv">2</span>],</span>
<span id="cb31-6943"><a href="#cb31-6943" aria-hidden="true" tabindex="-1"></a>                        <span class="at">errorIfNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6944"><a href="#cb31-6944" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(tmp_data, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_order"</span>))</span>
<span id="cb31-6945"><a href="#cb31-6945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_list)</span>
<span id="cb31-6946"><a href="#cb31-6946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6947"><a href="#cb31-6947" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6948"><a href="#cb31-6948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6949"><a href="#cb31-6949" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-6950"><a href="#cb31-6950" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg_order"</span>)))</span>
<span id="cb31-6951"><a href="#cb31-6951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6952"><a href="#cb31-6952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"#########"</span>, i, <span class="st">"########"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6953"><a href="#cb31-6953" aria-hidden="true" tabindex="-1"></a>  tmp_print <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp_get)</span>
<span id="cb31-6954"><a href="#cb31-6954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(tmp_print, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6955"><a href="#cb31-6955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"####################################################"</span>)</span>
<span id="cb31-6956"><a href="#cb31-6956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb31-6957"><a href="#cb31-6957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-6958"><a href="#cb31-6958" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-6959"><a href="#cb31-6959" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(i, j)</span>
<span id="cb31-6960"><a href="#cb31-6960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6961"><a href="#cb31-6961" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Alphaproteobacteria"</span>, <span class="st">"o_Elsterales"</span>, </span>
<span id="cb31-6962"><a href="#cb31-6962" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Azospirillales"</span>, <span class="st">"Rhizobiales_Incertae_Sedis"</span>, </span>
<span id="cb31-6963"><a href="#cb31-6963" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Xanthobacteraceae"</span>, <span class="st">"Sphingomonadaceae"</span>, <span class="st">"Rhizobiaceae"</span>, </span>
<span id="cb31-6964"><a href="#cb31-6964" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Micropepsaceae"</span>, <span class="st">"Methyloligellaceae"</span>, <span class="st">"KF-JG30-B3"</span>, </span>
<span id="cb31-6965"><a href="#cb31-6965" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Hyphomicrobiaceae"</span>, <span class="st">"Dongiaceae"</span>))</span>
<span id="cb31-6966"><a href="#cb31-6966" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Alphaproteobacteria"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-6967"><a href="#cb31-6967" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-6968"><a href="#cb31-6968" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-6969"><a href="#cb31-6969" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Gammaproteobacteria"</span>, <span class="st">"o_PLTA13"</span>, <span class="st">"o_CCD24"</span>, </span>
<span id="cb31-6970"><a href="#cb31-6970" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Unknown_Family"</span>, <span class="st">"Xanthomonadaceae"</span>, <span class="st">"TRA3-20"</span>, </span>
<span id="cb31-6971"><a href="#cb31-6971" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Steroidobacteraceae"</span>, <span class="st">"SC-I-84"</span>, <span class="st">"Nitrosomonadaceae"</span>, </span>
<span id="cb31-6972"><a href="#cb31-6972" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Comamonadaceae"</span>, <span class="st">"Burkholderiaceae"</span>, <span class="st">"B1-7BS"</span>))</span>
<span id="cb31-6973"><a href="#cb31-6973" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-6974"><a href="#cb31-6974" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-6975"><a href="#cb31-6975" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-6976"><a href="#cb31-6976" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Subgroup_22"</span>, <span class="st">"c_Subgroup_25"</span>, <span class="st">"c_Subgroup_5"</span>, </span>
<span id="cb31-6977"><a href="#cb31-6977" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Vicinamibacterales"</span>, <span class="st">"o_11-24"</span>, <span class="st">"o_Subgroup_17"</span>, </span>
<span id="cb31-6978"><a href="#cb31-6978" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Subgroup_2"</span>, <span class="st">"o_Subgroup_7"</span>, <span class="st">"o_Acidobacteriales"</span>, </span>
<span id="cb31-6979"><a href="#cb31-6979" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Vicinamibacteraceae"</span>, <span class="st">"Solibacteraceae"</span>, <span class="st">"Pyrinomonadaceae"</span>))</span>
<span id="cb31-6980"><a href="#cb31-6980" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Acidobacteriota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-6981"><a href="#cb31-6981" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-6982"><a href="#cb31-6982" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-6983"><a href="#cb31-6983" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_MB-A2-108"</span>, <span class="st">"o_IMCC26256"</span>, <span class="st">"o_Gaiellales"</span>, </span>
<span id="cb31-6984"><a href="#cb31-6984" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_Frankiales"</span>, <span class="st">"Streptomycetaceae"</span>, <span class="st">"Solirubrobacteraceae"</span>, </span>
<span id="cb31-6985"><a href="#cb31-6985" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Nocardioidaceae"</span>, <span class="st">"Mycobacteriaceae"</span>, <span class="st">"Micromonosporaceae"</span>, </span>
<span id="cb31-6986"><a href="#cb31-6986" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Gaiellaceae"</span>, <span class="st">"Acidothermaceae"</span>, <span class="st">"67-14"</span>))</span>
<span id="cb31-6987"><a href="#cb31-6987" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-6988"><a href="#cb31-6988" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-6989"><a href="#cb31-6989" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-6990"><a href="#cb31-6990" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_SJA-28"</span>, <span class="st">"o_Chitinophagales"</span>, <span class="st">"Sphingobacteriaceae"</span>, </span>
<span id="cb31-6991"><a href="#cb31-6991" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Saprospiraceae"</span>, <span class="st">"Microscillaceae"</span>, <span class="st">"Hymenobacteraceae"</span>, </span>
<span id="cb31-6992"><a href="#cb31-6992" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Flavobacteriaceae"</span>, <span class="st">"Cytophagaceae"</span>, <span class="st">"Chitinophagaceae"</span>, </span>
<span id="cb31-6993"><a href="#cb31-6993" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"BSV26"</span>, <span class="st">"env.OPS_17"</span>, <span class="st">"AKYH767"</span>))</span>
<span id="cb31-6994"><a href="#cb31-6994" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Bacteroidota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-6995"><a href="#cb31-6995" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-6996"><a href="#cb31-6996" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-6997"><a href="#cb31-6997" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"p_Firmicutes"</span>, <span class="st">"c_Bacilli"</span>, <span class="st">"o_Bacillales"</span>, </span>
<span id="cb31-6998"><a href="#cb31-6998" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Thermoactinomycetaceae"</span>, <span class="st">"type_III"</span>, <span class="st">"Paenibacillaceae"</span>, </span>
<span id="cb31-6999"><a href="#cb31-6999" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Lachnospiraceae"</span>, <span class="st">"Hungateiclostridiaceae"</span>, <span class="st">"Clostridiaceae"</span>, </span>
<span id="cb31-7000"><a href="#cb31-7000" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Bacillaceae"</span>, <span class="st">"Alicyclobacillaceae"</span>, <span class="st">"Planococcaceae"</span>))</span>
<span id="cb31-7001"><a href="#cb31-7001" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-7002"><a href="#cb31-7002" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-7003"><a href="#cb31-7003" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-7004"><a href="#cb31-7004" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"p_Myxococcota"</span>, <span class="st">"c_bacteriap25"</span>, <span class="st">"c_Polyangia"</span>, </span>
<span id="cb31-7005"><a href="#cb31-7005" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_mle1-27"</span>, <span class="st">"o_MSB-4B10"</span>, <span class="st">"Sandaracinaceae"</span>, <span class="st">"Polyangiaceae"</span>, </span>
<span id="cb31-7006"><a href="#cb31-7006" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Phaselicystidaceae"</span>, <span class="st">"Myxococcaceae"</span>, <span class="st">"Haliangiaceae"</span>, </span>
<span id="cb31-7007"><a href="#cb31-7007" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"BIrii41"</span>, <span class="st">"Anaeromyxobacteraceae"</span>))</span>
<span id="cb31-7008"><a href="#cb31-7008" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Myxococcota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-7009"><a href="#cb31-7009" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-7010"><a href="#cb31-7010" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-7011"><a href="#cb31-7011" aria-hidden="true" tabindex="-1"></a>tmp_order <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"c_Verrucomicrobiae"</span>, <span class="st">"o_Chlamydiales"</span>, <span class="st">"o_LD1-PA32"</span>, </span>
<span id="cb31-7012"><a href="#cb31-7012" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"o_S-BQ2-57_soil_group"</span>, <span class="st">"Xiphinematobacteraceae"</span>, </span>
<span id="cb31-7013"><a href="#cb31-7013" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Simkaniaceae"</span>, <span class="st">"Pedosphaeraceae"</span>, <span class="st">"Parachlamydiaceae"</span>, </span>
<span id="cb31-7014"><a href="#cb31-7014" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Opitutaceae"</span>, <span class="st">"Omnitrophaceae"</span>, <span class="st">"cvE6"</span>, <span class="st">"Chthoniobacteraceae"</span>))</span>
<span id="cb31-7015"><a href="#cb31-7015" aria-hidden="true" tabindex="-1"></a><span class="fu">assign</span>(<span class="fu">paste</span>(set_to_plot, <span class="st">"_"</span>, <span class="st">"Verrucomicrobiota"</span>, <span class="st">"_agg_order"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb31-7016"><a href="#cb31-7016" aria-hidden="true" tabindex="-1"></a>       tmp_order) </span>
<span id="cb31-7017"><a href="#cb31-7017" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb31-7018"><a href="#cb31-7018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7019"><a href="#cb31-7019" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Now, transform the data to relative abundance.</span></span>
<span id="cb31-7020"><a href="#cb31-7020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7021"><a href="#cb31-7021" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-7022"><a href="#cb31-7022" aria-hidden="true" tabindex="-1"></a>  tmp_agg <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg"</span>))</span>
<span id="cb31-7023"><a href="#cb31-7023" aria-hidden="true" tabindex="-1"></a>  tmp_order <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(tmp_agg, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_order"</span>))</span>
<span id="cb31-7024"><a href="#cb31-7024" aria-hidden="true" tabindex="-1"></a>  tmp_get_agg <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_agg)</span>
<span id="cb31-7025"><a href="#cb31-7025" aria-hidden="true" tabindex="-1"></a>  tmp_get_order <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_order)</span>
<span id="cb31-7026"><a href="#cb31-7026" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> tmp_get_agg <span class="sc">%&gt;%</span></span>
<span id="cb31-7027"><a href="#cb31-7027" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transform_sample_counts</span>(<span class="cf">function</span>(x) {</span>
<span id="cb31-7028"><a href="#cb31-7028" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">/</span> <span class="fu">sum</span>(x)</span>
<span id="cb31-7029"><a href="#cb31-7029" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span></span>
<span id="cb31-7030"><a href="#cb31-7030" aria-hidden="true" tabindex="-1"></a>    <span class="fu">psmelt</span>()</span>
<span id="cb31-7031"><a href="#cb31-7031" aria-hidden="true" tabindex="-1"></a>  tmp_df[[top_level]] <span class="ot">&lt;-</span> gdata<span class="sc">::</span><span class="fu">reorder.factor</span>(tmp_df[[top_level]],</span>
<span id="cb31-7032"><a href="#cb31-7032" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">new.order =</span> <span class="fu">rev</span>(tmp_get_order))</span>
<span id="cb31-7033"><a href="#cb31-7033" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> tmp_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">get</span>(top_level))</span>
<span id="cb31-7034"><a href="#cb31-7034" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(tmp_agg, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">"_tax"</span>))</span>
<span id="cb31-7035"><a href="#cb31-7035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb31-7036"><a href="#cb31-7036" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(c(i, tmp_name, tmp_agg))</span></span>
<span id="cb31-7037"><a href="#cb31-7037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-7038"><a href="#cb31-7038" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7039"><a href="#cb31-7039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7040"><a href="#cb31-7040" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-7041"><a href="#cb31-7041" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span></span>
<span id="cb31-7042"><a href="#cb31-7042" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg_tax"</span>)))</span>
<span id="cb31-7043"><a href="#cb31-7043" aria-hidden="true" tabindex="-1"></a>  tmp_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(tmp_get[[top_level]])</span>
<span id="cb31-7044"><a href="#cb31-7044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(i, tmp_levels))</span>
<span id="cb31-7045"><a href="#cb31-7045" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7046"><a href="#cb31-7046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7047"><a href="#cb31-7047" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Plot the data for a single phyloseq object. Here you use an aggregated tax file.</span></span>
<span id="cb31-7048"><a href="#cb31-7048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7049"><a href="#cb31-7049" aria-hidden="true" tabindex="-1"></a>ssu18_colvec.tax <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-7050"><a href="#cb31-7050" aria-hidden="true" tabindex="-1"></a><span class="st">"#3D3C04"</span>,</span>
<span id="cb31-7051"><a href="#cb31-7051" aria-hidden="true" tabindex="-1"></a><span class="st">"#FF95BA"</span>,</span>
<span id="cb31-7052"><a href="#cb31-7052" aria-hidden="true" tabindex="-1"></a><span class="st">"#00A090"</span>,</span>
<span id="cb31-7053"><a href="#cb31-7053" aria-hidden="true" tabindex="-1"></a><span class="st">"#C00B6F"</span>,</span>
<span id="cb31-7054"><a href="#cb31-7054" aria-hidden="true" tabindex="-1"></a><span class="st">"#5FFFDE"</span>,</span>
<span id="cb31-7055"><a href="#cb31-7055" aria-hidden="true" tabindex="-1"></a><span class="st">"#0063E5"</span>,</span>
<span id="cb31-7056"><a href="#cb31-7056" aria-hidden="true" tabindex="-1"></a><span class="st">"#ED0DFD"</span>,</span>
<span id="cb31-7057"><a href="#cb31-7057" aria-hidden="true" tabindex="-1"></a><span class="st">"#FFA035"</span>,</span>
<span id="cb31-7058"><a href="#cb31-7058" aria-hidden="true" tabindex="-1"></a><span class="st">"#00C7F9"</span>,</span>
<span id="cb31-7059"><a href="#cb31-7059" aria-hidden="true" tabindex="-1"></a><span class="st">"#C80B2A"</span>,</span>
<span id="cb31-7060"><a href="#cb31-7060" aria-hidden="true" tabindex="-1"></a><span class="st">"#00A51C"</span>,</span>
<span id="cb31-7061"><a href="#cb31-7061" aria-hidden="true" tabindex="-1"></a><span class="st">"#FFD5FD"</span>,</span>
<span id="cb31-7062"><a href="#cb31-7062" aria-hidden="true" tabindex="-1"></a><span class="st">"#00463C"</span></span>
<span id="cb31-7063"><a href="#cb31-7063" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7064"><a href="#cb31-7064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7065"><a href="#cb31-7065" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-7066"><a href="#cb31-7066" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span></span>
<span id="cb31-7067"><a href="#cb31-7067" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, i, <span class="st">"_agg_tax"</span>)))</span>
<span id="cb31-7068"><a href="#cb31-7068" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_get, <span class="fu">aes</span>(</span>
<span id="cb31-7069"><a href="#cb31-7069" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">factor</span>(TEMP),</span>
<span id="cb31-7070"><a href="#cb31-7070" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> Abundance,</span>
<span id="cb31-7071"><a href="#cb31-7071" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">get</span>(top_level)</span>
<span id="cb31-7072"><a href="#cb31-7072" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb31-7073"><a href="#cb31-7073" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb31-7074"><a href="#cb31-7074" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> ssu18_colvec.tax) <span class="sc">+</span></span>
<span id="cb31-7075"><a href="#cb31-7075" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb31-7076"><a href="#cb31-7076" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> top_level)) <span class="sc">+</span></span>
<span id="cb31-7077"><a href="#cb31-7077" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative Abundance (% total reads)"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Temperature"</span>) <span class="sc">+</span></span>
<span id="cb31-7078"><a href="#cb31-7078" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-7079"><a href="#cb31-7079" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-7080"><a href="#cb31-7080" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-7081"><a href="#cb31-7081" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-7082"><a href="#cb31-7082" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-7083"><a href="#cb31-7083" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb31-7084"><a href="#cb31-7084" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb31-7085"><a href="#cb31-7085" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-7086"><a href="#cb31-7086" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span></span>
<span id="cb31-7087"><a href="#cb31-7087" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot"</span>))</span>
<span id="cb31-7088"><a href="#cb31-7088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-7089"><a href="#cb31-7089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-7090"><a href="#cb31-7090" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7091"><a href="#cb31-7091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7092"><a href="#cb31-7092" aria-hidden="true" tabindex="-1"></a><span class="do">## 6) Plot the data for multiple taxa. Here again you use an aggregated tax file. </span></span>
<span id="cb31-7093"><a href="#cb31-7093" aria-hidden="true" tabindex="-1"></a><span class="do">## This code can be used to generate plots for multiple data frames by adding the </span></span>
<span id="cb31-7094"><a href="#cb31-7094" aria-hidden="true" tabindex="-1"></a><span class="do">## base  phyloseq names to the `ssu18_split_df` variable. This code will also </span></span>
<span id="cb31-7095"><a href="#cb31-7095" aria-hidden="true" tabindex="-1"></a><span class="do">## facet the plots by a metadata variable. If you do not want to facet remove </span></span>
<span id="cb31-7096"><a href="#cb31-7096" aria-hidden="true" tabindex="-1"></a><span class="do">## the line beginning with `facet_grid`.</span></span>
<span id="cb31-7097"><a href="#cb31-7097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7098"><a href="#cb31-7098" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-7099"><a href="#cb31-7099" aria-hidden="true" tabindex="-1"></a>  tmp_level_get <span class="ot">&lt;-</span></span>
<span id="cb31-7100"><a href="#cb31-7100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, .)))</span>
<span id="cb31-7101"><a href="#cb31-7101" aria-hidden="true" tabindex="-1"></a>  tmp_level <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_level_get))</span>
<span id="cb31-7102"><a href="#cb31-7102" aria-hidden="true" tabindex="-1"></a>  tmp_level <span class="ot">&lt;-</span> tmp_level[<span class="fu">order</span>(tmp_level<span class="sc">$</span>TEMP),]</span>
<span id="cb31-7103"><a href="#cb31-7103" aria-hidden="true" tabindex="-1"></a>  tmp_level <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(tmp_level<span class="sc">$</span>SamName)</span>
<span id="cb31-7104"><a href="#cb31-7104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7105"><a href="#cb31-7105" aria-hidden="true" tabindex="-1"></a>  tmp_agg_name <span class="ot">&lt;-</span></span>
<span id="cb31-7106"><a href="#cb31-7106" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, .,  <span class="st">"_agg_tax"</span>))</span>
<span id="cb31-7107"><a href="#cb31-7107" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(tmp_agg_name)</span>
<span id="cb31-7108"><a href="#cb31-7108" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span></span>
<span id="cb31-7109"><a href="#cb31-7109" aria-hidden="true" tabindex="-1"></a>    reshape<span class="sc">::</span><span class="fu">melt</span>(tmp_get, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"Sample"</span>, <span class="st">"TEMP"</span>, <span class="st">"Abundance"</span>, <span class="st">"Family"</span>))</span>
<span id="cb31-7110"><a href="#cb31-7110" aria-hidden="true" tabindex="-1"></a>  tmp_plot_name <span class="ot">&lt;-</span></span>
<span id="cb31-7111"><a href="#cb31-7111" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot_melt"</span>))</span>
<span id="cb31-7112"><a href="#cb31-7112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7113"><a href="#cb31-7113" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df,</span>
<span id="cb31-7114"><a href="#cb31-7114" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(</span>
<span id="cb31-7115"><a href="#cb31-7115" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x =</span> Sample,</span>
<span id="cb31-7116"><a href="#cb31-7116" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> Abundance,</span>
<span id="cb31-7117"><a href="#cb31-7117" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> <span class="fu">get</span>(top_level)</span>
<span id="cb31-7118"><a href="#cb31-7118" aria-hidden="true" tabindex="-1"></a>                     )) <span class="sc">+</span></span>
<span id="cb31-7119"><a href="#cb31-7119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(. <span class="sc">~</span> TEMP, <span class="at">scale =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb31-7120"><a href="#cb31-7120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>)  <span class="sc">+</span></span>
<span id="cb31-7121"><a href="#cb31-7121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> ssu18_colvec.tax) <span class="sc">+</span></span>
<span id="cb31-7122"><a href="#cb31-7122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb31-7123"><a href="#cb31-7123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb31-7124"><a href="#cb31-7124" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> top_level,</span>
<span id="cb31-7125"><a href="#cb31-7125" aria-hidden="true" tabindex="-1"></a>      <span class="at">reverse =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-7126"><a href="#cb31-7126" aria-hidden="true" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fl">0.7</span>,</span>
<span id="cb31-7127"><a href="#cb31-7127" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fl">0.7</span></span>
<span id="cb31-7128"><a href="#cb31-7128" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb31-7129"><a href="#cb31-7129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb31-7130"><a href="#cb31-7130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-7131"><a href="#cb31-7131" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-7132"><a href="#cb31-7132" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb31-7133"><a href="#cb31-7133" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-7134"><a href="#cb31-7134" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb31-7135"><a href="#cb31-7135" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb31-7136"><a href="#cb31-7136" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb31-7137"><a href="#cb31-7137" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb31-7138"><a href="#cb31-7138" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb31-7139"><a href="#cb31-7139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span>
<span id="cb31-7140"><a href="#cb31-7140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7141"><a href="#cb31-7141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plot_name, tmp_plot)</span>
<span id="cb31-7142"><a href="#cb31-7142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-7143"><a href="#cb31-7143" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7144"><a href="#cb31-7144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7145"><a href="#cb31-7145" aria-hidden="true" tabindex="-1"></a><span class="do">## 7) Finally we use the `patchwork` package to combine the two </span></span>
<span id="cb31-7146"><a href="#cb31-7146" aria-hidden="true" tabindex="-1"></a><span class="do">## plots and customize the look.</span></span>
<span id="cb31-7147"><a href="#cb31-7147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7148"><a href="#cb31-7148" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> tax_group) {</span>
<span id="cb31-7149"><a href="#cb31-7149" aria-hidden="true" tabindex="-1"></a>  tmp_plot_main <span class="ot">&lt;-</span></span>
<span id="cb31-7150"><a href="#cb31-7150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot"</span>)))</span>
<span id="cb31-7151"><a href="#cb31-7151" aria-hidden="true" tabindex="-1"></a>  tmp_plot_melt <span class="ot">&lt;-</span></span>
<span id="cb31-7152"><a href="#cb31-7152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_plot_melt"</span>)))</span>
<span id="cb31-7153"><a href="#cb31-7153" aria-hidden="true" tabindex="-1"></a>  tmp_final <span class="ot">&lt;-</span> tmp_plot_main <span class="sc">+</span> tmp_plot_melt</span>
<span id="cb31-7154"><a href="#cb31-7154" aria-hidden="true" tabindex="-1"></a>  tmp_final <span class="ot">&lt;-</span> tmp_final <span class="sc">+</span></span>
<span id="cb31-7155"><a href="#cb31-7155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb31-7156"><a href="#cb31-7156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-7157"><a href="#cb31-7157" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb31-7158"><a href="#cb31-7158" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb31-7159"><a href="#cb31-7159" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb31-7160"><a href="#cb31-7160" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb31-7161"><a href="#cb31-7161" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb31-7162"><a href="#cb31-7162" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb31-7163"><a href="#cb31-7163" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb31-7164"><a href="#cb31-7164" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb31-7165"><a href="#cb31-7165" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-7166"><a href="#cb31-7166" aria-hidden="true" tabindex="-1"></a>  tmp_name <span class="ot">&lt;-</span></span>
<span id="cb31-7167"><a href="#cb31-7167" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(set_to_plot, <span class="st">"_"</span>, ., <span class="st">"_final_plot"</span>))</span>
<span id="cb31-7168"><a href="#cb31-7168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_final)</span>
<span id="cb31-7169"><a href="#cb31-7169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"tmp_"</span>))</span>
<span id="cb31-7170"><a href="#cb31-7170" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7171"><a href="#cb31-7171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7172"><a href="#cb31-7172" aria-hidden="true" tabindex="-1"></a>taxa_to_plot <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Acidobacteriota"</span>, <span class="st">"Actinobacteriota"</span>, <span class="st">"Alphaproteobacteria"</span>, </span>
<span id="cb31-7173"><a href="#cb31-7173" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Bacteroidota"</span>, <span class="st">"Firmicutes"</span>, <span class="st">"Gammaproteobacteria"</span>, <span class="st">"Myxococcota"</span>, </span>
<span id="cb31-7174"><a href="#cb31-7174" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Verrucomicrobiota"</span>)</span>
<span id="cb31-7175"><a href="#cb31-7175" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> taxa_to_plot) {</span>
<span id="cb31-7176"><a href="#cb31-7176" aria-hidden="true" tabindex="-1"></a>  tmp_get <span class="ot">&lt;-</span></span>
<span id="cb31-7177"><a href="#cb31-7177" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb31-7178"><a href="#cb31-7178" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ssu18_ps_work_"</span>, i, <span class="st">"_final_plot"</span>, <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb31-7179"><a href="#cb31-7179" aria-hidden="true" tabindex="-1"></a>    )))</span>
<span id="cb31-7180"><a href="#cb31-7180" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-7181"><a href="#cb31-7181" aria-hidden="true" tabindex="-1"></a>    tmp_get,</span>
<span id="cb31-7182"><a href="#cb31-7182" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/SOM/"</span>, i, <span class="st">"_tax_div_bar_plots.png"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-7183"><a href="#cb31-7183" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">2415</span>,</span>
<span id="cb31-7184"><a href="#cb31-7184" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6350</span>,</span>
<span id="cb31-7185"><a href="#cb31-7185" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-7186"><a href="#cb31-7186" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-7187"><a href="#cb31-7187" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-7188"><a href="#cb31-7188" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-7189"><a href="#cb31-7189" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb31-7190"><a href="#cb31-7190" aria-hidden="true" tabindex="-1"></a>    tmp_get,</span>
<span id="cb31-7191"><a href="#cb31-7191" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"include/pub/SOM/"</span>, i, <span class="st">"_tax_div_bar_plots.pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb31-7192"><a href="#cb31-7192" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">2415</span>,</span>
<span id="cb31-7193"><a href="#cb31-7193" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6350</span>,</span>
<span id="cb31-7194"><a href="#cb31-7194" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">'px'</span>,</span>
<span id="cb31-7195"><a href="#cb31-7195" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb31-7196"><a href="#cb31-7196" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb31-7197"><a href="#cb31-7197" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-7198"><a href="#cb31-7198" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7199"><a href="#cb31-7199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7200"><a href="#cb31-7200" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7201"><a href="#cb31-7201" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Acidobacteriota_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7202"><a href="#cb31-7202" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_7.png"</span></span>
<span id="cb31-7203"><a href="#cb31-7203" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7204"><a href="#cb31-7204" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7205"><a href="#cb31-7205" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Actinobacteriota_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7206"><a href="#cb31-7206" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_8.png"</span></span>
<span id="cb31-7207"><a href="#cb31-7207" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7208"><a href="#cb31-7208" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7209"><a href="#cb31-7209" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Alphaproteobacteria_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7210"><a href="#cb31-7210" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_9.png"</span></span>
<span id="cb31-7211"><a href="#cb31-7211" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7212"><a href="#cb31-7212" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7213"><a href="#cb31-7213" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Gammaproteobacteria_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7214"><a href="#cb31-7214" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_10.png"</span></span>
<span id="cb31-7215"><a href="#cb31-7215" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7216"><a href="#cb31-7216" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7217"><a href="#cb31-7217" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Bacteroidota_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7218"><a href="#cb31-7218" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_11.png"</span></span>
<span id="cb31-7219"><a href="#cb31-7219" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7220"><a href="#cb31-7220" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7221"><a href="#cb31-7221" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Firmicutes_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7222"><a href="#cb31-7222" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_12.png"</span></span>
<span id="cb31-7223"><a href="#cb31-7223" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7224"><a href="#cb31-7224" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7225"><a href="#cb31-7225" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Myxococcota_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7226"><a href="#cb31-7226" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_13.png"</span></span>
<span id="cb31-7227"><a href="#cb31-7227" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7228"><a href="#cb31-7228" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7229"><a href="#cb31-7229" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Verrucomicrobiota_tax_div_bar_plots.png"</span>,</span>
<span id="cb31-7230"><a href="#cb31-7230" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_14.png"</span></span>
<span id="cb31-7231"><a href="#cb31-7231" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7232"><a href="#cb31-7232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7233"><a href="#cb31-7233" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7234"><a href="#cb31-7234" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Acidobacteriota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7235"><a href="#cb31-7235" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_7.pdf"</span></span>
<span id="cb31-7236"><a href="#cb31-7236" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7237"><a href="#cb31-7237" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7238"><a href="#cb31-7238" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Actinobacteriota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7239"><a href="#cb31-7239" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_8.pdf"</span></span>
<span id="cb31-7240"><a href="#cb31-7240" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7241"><a href="#cb31-7241" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7242"><a href="#cb31-7242" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Alphaproteobacteria_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7243"><a href="#cb31-7243" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_9.pdf"</span></span>
<span id="cb31-7244"><a href="#cb31-7244" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7245"><a href="#cb31-7245" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7246"><a href="#cb31-7246" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Gammaproteobacteria_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7247"><a href="#cb31-7247" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_10.pdf"</span></span>
<span id="cb31-7248"><a href="#cb31-7248" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7249"><a href="#cb31-7249" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7250"><a href="#cb31-7250" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Bacteroidota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7251"><a href="#cb31-7251" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_11.pdf"</span></span>
<span id="cb31-7252"><a href="#cb31-7252" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7253"><a href="#cb31-7253" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7254"><a href="#cb31-7254" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Firmicutes_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7255"><a href="#cb31-7255" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_12.pdf"</span></span>
<span id="cb31-7256"><a href="#cb31-7256" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7257"><a href="#cb31-7257" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7258"><a href="#cb31-7258" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Myxococcota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7259"><a href="#cb31-7259" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_13.pdf"</span></span>
<span id="cb31-7260"><a href="#cb31-7260" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7261"><a href="#cb31-7261" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb31-7262"><a href="#cb31-7262" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Verrucomicrobiota_tax_div_bar_plots.pdf"</span>,</span>
<span id="cb31-7263"><a href="#cb31-7263" aria-hidden="true" tabindex="-1"></a>  <span class="st">"include/pub/SOM/Supplementary_Figure_14.pdf"</span></span>
<span id="cb31-7264"><a href="#cb31-7264" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7265"><a href="#cb31-7265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-7266"><a href="#cb31-7266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7267"><a href="#cb31-7267" aria-hidden="true" tabindex="-1"></a>::: {.callout-note icon=false}</span>
<span id="cb31-7268"><a href="#cb31-7268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7269"><a href="#cb31-7269" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifications</span></span>
<span id="cb31-7270"><a href="#cb31-7270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7271"><a href="#cb31-7271" aria-hidden="true" tabindex="-1"></a>Post prossessing performed in <span class="co">[</span><span class="ot">Inkscape</span><span class="co">](https://inkscape.org/)</span>. Modifications include sample and variable renaming, and small adjustments in bar height/width. </span>
<span id="cb31-7272"><a href="#cb31-7272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7273"><a href="#cb31-7273" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7274"><a href="#cb31-7274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7275"><a href="#cb31-7275" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7276"><a href="#cb31-7276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7277"><a href="#cb31-7277" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF7)</span></span>
<span id="cb31-7278"><a href="#cb31-7278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7279"><a href="#cb31-7279" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_7.png)</span></span>
<span id="cb31-7280"><a href="#cb31-7280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7281"><a href="#cb31-7281" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF7)</span></span>
<span id="cb31-7282"><a href="#cb31-7282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7283"><a href="#cb31-7283" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Acido.png)</span></span>
<span id="cb31-7284"><a href="#cb31-7284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7285"><a href="#cb31-7285" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7286"><a href="#cb31-7286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7287"><a href="#cb31-7287" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7288"><a href="#cb31-7288" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 7 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_7.pdf)</span></span>
<span id="cb31-7289"><a href="#cb31-7289" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7290"><a href="#cb31-7290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7291"><a href="#cb31-7291" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7292"><a href="#cb31-7292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7293"><a href="#cb31-7293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF8)</span></span>
<span id="cb31-7294"><a href="#cb31-7294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7295"><a href="#cb31-7295" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_8.png)</span></span>
<span id="cb31-7296"><a href="#cb31-7296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7297"><a href="#cb31-7297" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF8)</span></span>
<span id="cb31-7298"><a href="#cb31-7298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7299"><a href="#cb31-7299" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Actino.png)</span></span>
<span id="cb31-7300"><a href="#cb31-7300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7301"><a href="#cb31-7301" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7302"><a href="#cb31-7302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7303"><a href="#cb31-7303" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7304"><a href="#cb31-7304" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 8 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_8.pdf)</span></span>
<span id="cb31-7305"><a href="#cb31-7305" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7306"><a href="#cb31-7306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7307"><a href="#cb31-7307" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7308"><a href="#cb31-7308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7309"><a href="#cb31-7309" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF9)</span></span>
<span id="cb31-7310"><a href="#cb31-7310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7311"><a href="#cb31-7311" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_9.png)</span></span>
<span id="cb31-7312"><a href="#cb31-7312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7313"><a href="#cb31-7313" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF9)</span></span>
<span id="cb31-7314"><a href="#cb31-7314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7315"><a href="#cb31-7315" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Alpha.png)</span></span>
<span id="cb31-7316"><a href="#cb31-7316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7317"><a href="#cb31-7317" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7318"><a href="#cb31-7318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7319"><a href="#cb31-7319" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7320"><a href="#cb31-7320" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 9 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_9.pdf)</span></span>
<span id="cb31-7321"><a href="#cb31-7321" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7322"><a href="#cb31-7322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7323"><a href="#cb31-7323" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7324"><a href="#cb31-7324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7325"><a href="#cb31-7325" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF10)</span></span>
<span id="cb31-7326"><a href="#cb31-7326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7327"><a href="#cb31-7327" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_10.png)</span></span>
<span id="cb31-7328"><a href="#cb31-7328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7329"><a href="#cb31-7329" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF10)</span></span>
<span id="cb31-7330"><a href="#cb31-7330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7331"><a href="#cb31-7331" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Gamma.png)</span></span>
<span id="cb31-7332"><a href="#cb31-7332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7333"><a href="#cb31-7333" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7334"><a href="#cb31-7334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7335"><a href="#cb31-7335" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7336"><a href="#cb31-7336" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 10 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_10.pdf)</span></span>
<span id="cb31-7337"><a href="#cb31-7337" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7338"><a href="#cb31-7338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7339"><a href="#cb31-7339" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7340"><a href="#cb31-7340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7341"><a href="#cb31-7341" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF11) </span></span>
<span id="cb31-7342"><a href="#cb31-7342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7343"><a href="#cb31-7343" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_11.png)</span></span>
<span id="cb31-7344"><a href="#cb31-7344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7345"><a href="#cb31-7345" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF11)</span></span>
<span id="cb31-7346"><a href="#cb31-7346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7347"><a href="#cb31-7347" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Bacter.png)</span></span>
<span id="cb31-7348"><a href="#cb31-7348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7349"><a href="#cb31-7349" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7350"><a href="#cb31-7350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7351"><a href="#cb31-7351" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7352"><a href="#cb31-7352" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 11 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_11.pdf)</span></span>
<span id="cb31-7353"><a href="#cb31-7353" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7354"><a href="#cb31-7354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7355"><a href="#cb31-7355" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7356"><a href="#cb31-7356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7357"><a href="#cb31-7357" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original  (SF12)</span></span>
<span id="cb31-7358"><a href="#cb31-7358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7359"><a href="#cb31-7359" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_12.png)</span></span>
<span id="cb31-7360"><a href="#cb31-7360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7361"><a href="#cb31-7361" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF12)</span></span>
<span id="cb31-7362"><a href="#cb31-7362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7363"><a href="#cb31-7363" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Firm.png)</span></span>
<span id="cb31-7364"><a href="#cb31-7364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7365"><a href="#cb31-7365" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7366"><a href="#cb31-7366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7367"><a href="#cb31-7367" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7368"><a href="#cb31-7368" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 12 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_12.pdf)</span></span>
<span id="cb31-7369"><a href="#cb31-7369" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7370"><a href="#cb31-7370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7371"><a href="#cb31-7371" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7372"><a href="#cb31-7372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7373"><a href="#cb31-7373" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF13) </span></span>
<span id="cb31-7374"><a href="#cb31-7374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7375"><a href="#cb31-7375" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_13.png)</span></span>
<span id="cb31-7376"><a href="#cb31-7376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7377"><a href="#cb31-7377" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF13)</span></span>
<span id="cb31-7378"><a href="#cb31-7378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7379"><a href="#cb31-7379" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Myxo.png)</span></span>
<span id="cb31-7380"><a href="#cb31-7380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7381"><a href="#cb31-7381" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7382"><a href="#cb31-7382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7383"><a href="#cb31-7383" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7384"><a href="#cb31-7384" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 13 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_13.pdf)</span></span>
<span id="cb31-7385"><a href="#cb31-7385" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7386"><a href="#cb31-7386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7387"><a href="#cb31-7387" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb31-7388"><a href="#cb31-7388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7389"><a href="#cb31-7389" aria-hidden="true" tabindex="-1"></a><span class="fu">### Original (SF14)</span></span>
<span id="cb31-7390"><a href="#cb31-7390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7391"><a href="#cb31-7391" aria-hidden="true" tabindex="-1"></a><span class="al">![](include/pub/SOM/Supplementary_Figure_14.png)</span></span>
<span id="cb31-7392"><a href="#cb31-7392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7393"><a href="#cb31-7393" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified (SF14)</span></span>
<span id="cb31-7394"><a href="#cb31-7394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7395"><a href="#cb31-7395" aria-hidden="true" tabindex="-1"></a><span class="al">![](paper/ESM/FIGURES/taxa_plots_class_Verruco.png)</span></span>
<span id="cb31-7396"><a href="#cb31-7396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7397"><a href="#cb31-7397" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7398"><a href="#cb31-7398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7399"><a href="#cb31-7399" aria-hidden="true" tabindex="-1"></a>::: {.callout appearance="minimal"}</span>
<span id="cb31-7400"><a href="#cb31-7400" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;i</span> <span class="er">class</span><span class="ot">=</span><span class="st">"bi bi-download"</span><span class="kw">&gt;&lt;/i&gt;</span> <span class="co">[</span><span class="ot">Download Supplementary Figure 14 raw pdf</span><span class="co">](include/pub/SOM/Supplementary_Figure_14.pdf)</span></span>
<span id="cb31-7401"><a href="#cb31-7401" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-7402"><a href="#cb31-7402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7403"><a href="#cb31-7403" aria-hidden="true" tabindex="-1"></a><span class="fu"># R Session Information</span></span>
<span id="cb31-7404"><a href="#cb31-7404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7405"><a href="#cb31-7405" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;details</span> <span class="er">markdown</span><span class="ot">=</span><span class="st">"1"</span><span class="kw">&gt;&lt;summary&gt;</span>Show/hide  R Session Info<span class="kw">&lt;/summary&gt;</span></span>
<span id="cb31-7406"><a href="#cb31-7406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7409"><a href="#cb31-7409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-7410"><a href="#cb31-7410" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb31-7411"><a href="#cb31-7411" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb31-7412"><a href="#cb31-7412" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb31-7413"><a href="#cb31-7413" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span>
<span id="cb31-7414"><a href="#cb31-7414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-7415"><a href="#cb31-7415" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/details&gt;</span></span>
<span id="cb31-7416"><a href="#cb31-7416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7419"><a href="#cb31-7419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-7420"><a href="#cb31-7420" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb31-7421"><a href="#cb31-7421" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb31-7422"><a href="#cb31-7422" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb31-7423"><a href="#cb31-7423" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb31-7424"><a href="#cb31-7424" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-7425"><a href="#cb31-7425" aria-hidden="true" tabindex="-1"></a><span class="do">### COmmon formatting scripts</span></span>
<span id="cb31-7426"><a href="#cb31-7426" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">NOTE</span><span class="do">: captioner.R must be read BEFORE captions_XYZ.R</span></span>
<span id="cb31-7427"><a href="#cb31-7427" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">file.path</span>(<span class="st">"assets"</span>, <span class="st">"functions.R"</span>))</span>
<span id="cb31-7428"><a href="#cb31-7428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-7429"><a href="#cb31-7429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7430"><a href="#cb31-7430" aria-hidden="true" tabindex="-1"></a><span class="fu">####  Source Code {.appendix}</span></span>
<span id="cb31-7431"><a href="#cb31-7431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7432"><a href="#cb31-7432" aria-hidden="true" tabindex="-1"></a>The source code for this page can be accessed on GitHub <span class="in">`r fa(name = "github")`</span> by <span class="co">[</span><span class="ot">clicking this link</span><span class="co">]</span>(<span class="in">`r source_code()`</span>). </span>
<span id="cb31-7433"><a href="#cb31-7433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7434"><a href="#cb31-7434" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data Availability {.appendix}</span></span>
<span id="cb31-7435"><a href="#cb31-7435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7436"><a href="#cb31-7436" aria-hidden="true" tabindex="-1"></a>Data generated in this workflow and the Rdata need to run the workflow can be accessed on figshare at <span class="co">[</span><span class="ot">10.25573/data.20263857</span><span class="co">](https://doi.org/10.25573/data.20263857.v1)</span>.</span>
<span id="cb31-7437"><a href="#cb31-7437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7438"><a href="#cb31-7438" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Last updated on {.appendix}</span></span>
<span id="cb31-7439"><a href="#cb31-7439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7442"><a href="#cb31-7442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-7443"><a href="#cb31-7443" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb31-7444"><a href="#cb31-7444" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb31-7445"><a href="#cb31-7445" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>()</span>
<span id="cb31-7446"><a href="#cb31-7446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">© Copyright 2022 <a href="https://metacrobe.github.io/">metacrobe</a> &amp; The SWELTR Project. Site constructed using <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>